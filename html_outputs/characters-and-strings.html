<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>10 Caracteres y cadenas | El manual de R para Epi’s</title>
<meta name="author" content="El equipo del manual">
<meta name="description" content="Esta página muestra el uso del paquete stringr para evaluar y manejar valores de caracteres, también denominados “cadenas” (“strings”). Combinar, ordenar, dividir, organizar - str_c(), str_glue(),...">
<meta name="generator" content="bookdown 0.29 with bs4_book()">
<meta property="og:title" content="10 Caracteres y cadenas | El manual de R para Epi’s">
<meta property="og:type" content="book">
<meta property="og:description" content="Esta página muestra el uso del paquete stringr para evaluar y manejar valores de caracteres, también denominados “cadenas” (“strings”). Combinar, ordenar, dividir, organizar - str_c(), str_glue(),...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="10 Caracteres y cadenas | El manual de R para Epi’s">
<meta name="twitter:description" content="Esta página muestra el uso del paquete stringr para evaluar y manejar valores de caracteres, también denominados “cadenas” (“strings”). Combinar, ordenar, dividir, organizar - str_c(), str_glue(),...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.25/datatables.js"></script><link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/tabwid.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/scrool.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.9/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.5.1/plotly-basic-2.5.1.min.js"></script><script src="libs/plotly-cartesian-2.5.1/plotly-cartesian-2.5.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">El manual de R para Epi’s</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">Acerca de este libro</li>
<li><a class="" href="editorial-and-technical-notes.html"><span class="header-section-number">1</span> Notas editoriales y técnicas</a></li>
<li><a class="" href="download-handbook-and-data.html"><span class="header-section-number">2</span> Descargando el manual y los datos</a></li>
<li class="book-part">Aspectos básicos</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">3</span> Fundamentos de R</a></li>
<li><a class="" href="transition-to-r.html"><span class="header-section-number">4</span> Transición a R</a></li>
<li><a class="" href="suggested-packages-1.html"><span class="header-section-number">5</span> Paquetes recomendados</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> Proyectos en R</a></li>
<li><a class="" href="import-and-export.html"><span class="header-section-number">7</span> Importación y exportación</a></li>
<li class="book-part">Gestión de datos</li>
<li><a class="" href="cleaning-data-and-core-functions.html"><span class="header-section-number">8</span> Limpieza de datos y funciones básicas</a></li>
<li><a class="" href="working-with-dates.html"><span class="header-section-number">9</span> Borrador. Trabajando con Fechas</a></li>
<li><a class="active" href="characters-and-strings.html"><span class="header-section-number">10</span> Caracteres y cadenas</a></li>
<li><a class="" href="pivoting-data.html"><span class="header-section-number">11</span> Pivotar datos</a></li>
<li><a class="" href="grouping-data.html"><span class="header-section-number">12</span> Agrupar datos</a></li>
<li><a class="" href="joining-data.html"><span class="header-section-number">13</span> Unir datos</a></li>
<li><a class="" href="de-duplication.html"><span class="header-section-number">14</span> Borrador. De-duplicación</a></li>
<li><a class="" href="iteration-loops-and-lists.html"><span class="header-section-number">15</span> Borrador. Iteración, bucles y listas</a></li>
<li class="book-part">Análisis</li>
<li><a class="" href="descriptive-tables.html"><span class="header-section-number">16</span> Tablas descriptivas</a></li>
<li><a class="" href="simple-statistical-tests.html"><span class="header-section-number">17</span> Tests estadísticos sencillos</a></li>
<li><a class="" href="univariate-and-multivariable-regression.html"><span class="header-section-number">18</span> Borrador. Regresión univariante y multivariable</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">19</span> Borrador. Valores faltantes</a></li>
<li><a class="" href="standardised-rates.html"><span class="header-section-number">20</span> Borrador. Tasas estandarizadas</a></li>
<li><a class="" href="moving-averages.html"><span class="header-section-number">21</span> Borrador. Medias Móviles</a></li>
<li><a class="" href="time-series-and-outbreak-detection.html"><span class="header-section-number">22</span> Borrador. Series temporales y detección de brotes</a></li>
<li><a class="" href="epidemic-modeling.html"><span class="header-section-number">23</span> Borrador. Modelización de epidemias</a></li>
<li><a class="" href="contact-tracing-1.html"><span class="header-section-number">24</span> Borrador. Rastreo de contactos</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">25</span> Borrador. Análisis de encuestas</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">26</span> Borrador. Análisis de supervivencia</a></li>
<li><a class="" href="gis-basics.html"><span class="header-section-number">27</span> Conceptos básicos de los SIG</a></li>
<li class="book-part">Visualización de datos</li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">28</span> Conceptos básicos de ggplot</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">29</span> Consejos de ggplot</a></li>
<li><a class="" href="epidemic-curves.html"><span class="header-section-number">30</span> Curvas epidémicas</a></li>
<li><a class="" href="demographic-pyramids-and-likert-scales.html"><span class="header-section-number">31</span> Pirámides de población y escalas de Likert</a></li>
<li><a class="" href="heat-plots.html"><span class="header-section-number">32</span> Gráficos de calor</a></li>
<li><a class="" href="diagrams-and-charts.html"><span class="header-section-number">33</span> Diagramas y gráficos</a></li>
<li><a class="" href="combinations-analysis.html"><span class="header-section-number">34</span> Borrador. Análisis de combinaciones</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">35</span> Borrador. Cadenas de transmisión</a></li>
<li><a class="" href="phylogenetic-trees-1.html"><span class="header-section-number">36</span> Árboles filogenéticos</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">37</span> Gráficos interactivos</a></li>
<li class="book-part">Informes y Dashboards</li>
<li><a class="" href="reports-with-r-markdown.html"><span class="header-section-number">38</span> Informes con R Markdown</a></li>
<li><a class="" href="organizing-routine-reports.html"><span class="header-section-number">39</span> Organización de informes rutinarios</a></li>
<li><a class="" href="dashboards-with-r-markdown.html"><span class="header-section-number">40</span> Borrador. Dashboards con R Markdown</a></li>
<li><a class="" href="dashboards-with-shiny.html"><span class="header-section-number">41</span> Borrador. Dashboards con Shiny</a></li>
<li class="book-part">Miscelánea</li>
<li><a class="" href="writing-functions-1.html"><span class="header-section-number">42</span> Escribir funciones</a></li>
<li><a class="" href="directory-interactions.html"><span class="header-section-number">43</span> Borrador. Interacciones con directorios</a></li>
<li><a class="" href="version-control-and-collaboration-with-git-and-github.html"><span class="header-section-number">44</span> Control de versiones y colaboración con Git y Github</a></li>
<li><a class="" href="common-errors.html"><span class="header-section-number">45</span> Errores comunes</a></li>
<li><a class="" href="getting-help.html"><span class="header-section-number">46</span> Cómo obtener ayuda</a></li>
<li><a class="" href="r-on-network-drives.html"><span class="header-section-number">47</span> Borrador. R en redes locales</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">48</span> Borrador. data.table</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="characters-and-strings" class="section level1" number="10">
<h1>
<span class="header-section-number">10</span> Caracteres y cadenas<a class="anchor" aria-label="anchor" href="#characters-and-strings"><i class="fas fa-link"></i></a>
</h1>
<div class="inline-figure"><img src="images/Characters_Strings_1500x500.png" width="100%"></div>
<p>Esta página muestra el uso del paquete <strong>stringr</strong> para evaluar y manejar valores de caracteres, también denominados “cadenas” (“strings”).</p>
<ol style="list-style-type: decimal">
<li><p>Combinar, ordenar, dividir, organizar - <code>str_c()</code>, <code>str_glue()</code>, <code>str_order()</code>, <code>str_split()</code><br></p></li>
<li>
<p>Limpiar y normalizar</p>
<ul>
<li>Ajustar la longitud - <code>str_pad()</code>, <code>str_trunc()</code>, <code>str_wrap()</code><br>
</li>
<li>Cambiar mayúsculas y minúsculas - <code>str_to_upper()</code>, <code>str_to_title()</code>, <code>str_to_lower()</code>, <code>str_to_sentence()</code><br>
</li>
</ul>
</li>
<li><p>Evaluar y extraer por posición - <code>str_length()</code>, <code>str_sub()</code>, <code>word()</code><br></p></li>
<li>
<p>Patrones</p>
<ul>
<li>Detectar y localizar - <code>str_detect()</code>, <code>str_subset()</code>, <code>str_match()</code>, <code>str_extract()</code><br>
</li>
<li>Modificar y reemplazar - <code>str_sub()</code>, <code>str_replace_all()</code><br>
</li>
</ul>
</li>
<li><p>Expresiones regulares (“regex”)</p></li>
</ol>
<p>Para facilitar la visualización, la mayoría de los ejemplos se muestran actuando sobre un vector de caracteres definido brevemente, aunque pueden adaptarse fácilmente a una columna dentro de un dataframe.</p>
<p>Esta <a href="https://cran.r-project.org/web/packages/stringr/vignettes/stringr.html">viñeta de stringr</a> proporcionó gran parte de la inspiración para esta página.</p>
<!-- ======================================================= -->
<div id="preparation-1" class="section level2" number="10.1">
<h2>
<span class="header-section-number">10.1</span> Preparación<a class="anchor" aria-label="anchor" href="#preparation-1"><i class="fas fa-link"></i></a>
</h2>
<div id="cargar-paquetes-1" class="section level3 unnumbered">
<h3>Cargar paquetes<a class="anchor" aria-label="anchor" href="#cargar-paquetes-1"><i class="fas fa-link"></i></a>
</h3>
<p>Instala o carga el paquete <strong>stringr</strong> y otros paquetes de <strong>tidyverse</strong>.</p>
<div class="sourceCode" id="cb392"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install/load packages</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
  <span class="va">stringr</span>,    <span class="co"># many functions for handling strings</span>
  <span class="va">tidyverse</span>,  <span class="co"># for optional data manipulation</span>
  <span class="va">tools</span><span class="op">)</span>      <span class="co"># alternative for converting to title case</span></code></pre></div>
</div>
<div id="importar-datos-1" class="section level3 unnumbered">
<h3>Importar datos<a class="anchor" aria-label="anchor" href="#importar-datos-1"><i class="fas fa-link"></i></a>
</h3>
<p>Importar datos</p>
<p>En esta página haremos referencia de vez en cuando a la lista limpia de casos de una epidemia de ébola simulada. Si quieres seguir el proceso, <a href="https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/case_linelists/linelist_cleaned.rds">clica para descargar linelist “limpio”</a> (como archivo .rds). Importa los datos con la función <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> del paquete <strong>rio</strong> (maneja muchos tipos de archivos como .xlsx, .csv, .rds - consulta la página de <a href="import-and-export.html#import-and-export">importación y exportación</a> para más detalles).</p>
<div class="sourceCode" id="cb393"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># import case linelist </span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.rds"</span><span class="op">)</span></code></pre></div>
<p>A continuación se muestran las primeras 50 filas del listado.</p>
<div id="htmlwidget-ed5b6ec8590cc5bb4ae5" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ed5b6ec8590cc5bb4ae5">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399939200000\" data-max=\"1407024000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-29&quot;,&quot;30-49&quot;,&quot;50-69&quot;,&quot;70+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.8184429761563,16.0652496292635,22.4965706447188,71.4144019043841,41.6171224732461,62.0953890870657,0,16.8376536925366,22.7903289734443,53.4119897959184,24.2802636142907,22.4600343506408,54.320987654321,41.0578432556455,28.5664819944598,17.0320552013276,25.0412914912888,38.7172182043977,27.3876813705495,31.5555555555556,14.8069075945662,30.8839811199813,26.6193433895297,59.375,96.6183574879227,19.2394748755093,84.9403122130395,18.4199377406104,27.7722674072605,41.3223140495868,17.2080666586161,24.1671624033314,15.7218971089178,428.994082840237,27.9930220292912,243.261012491782,20.2395007589813,30.527446435638,25.15589569161,47,39.04,31.0661643201798,77.9683671196257,29.5165961238583,166.493236212279,100.308641975309,37.76,20.6037803457852,23.458562375267],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
</div>
<div id="unite-split-and-arrange" class="section level2" number="10.2">
<h2>
<span class="header-section-number">10.2</span> Unir, dividir y ordenar<a class="anchor" aria-label="anchor" href="#unite-split-and-arrange"><i class="fas fa-link"></i></a>
</h2>
<p>Esta sección abarca:</p>
<ul>
<li><p>Uso de <code>str_c()</code>, <code>str_glue()</code>, y <code>unite()</code> para combinar cadenas</p></li>
<li><p>Uso de <code>str_order()</code> para ordenar las cadenas</p></li>
<li><p>Uso de <code>str_split()</code> y <code>separate()</code> para dividir cadenas</p></li>
</ul>
<!-- ======================================================= --><div id="combinar-cadenas" class="section level3 unnumbered">
<h3>Combinar cadenas<a class="anchor" aria-label="anchor" href="#combinar-cadenas"><i class="fas fa-link"></i></a>
</h3>
<p>Para combinar o concatenar varias cadenas en una sola, sugerimos utilizar <code>str_c</code> de <strong>stringr</strong>. Si tienes valores de caracteres distintos para combinar, simplemente proporciónalos como argumentos únicos, separados por comas.</p>
<div class="sourceCode" id="cb394"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_c</span><span class="op">(</span><span class="st">"String1"</span>, <span class="st">"String2"</span>, <span class="st">"String3"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "String1String2String3"</code></pre>
<p>El argumento <code>sep =</code> inserta un valor de carácter entre cada uno de los argumentos proporcionados (por ejemplo, insertando una coma, un espacio o una nueva línea <code>"\n"</code>)</p>
<div class="sourceCode" id="cb396"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_c</span><span class="op">(</span><span class="st">"String1"</span>, <span class="st">"String2"</span>, <span class="st">"String3"</span>, sep <span class="op">=</span> <span class="st">", "</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "String1, String2, String3"</code></pre>
<p>El argumento <code>collapse =</code> es relevante si estás introduciendo múltiples <em>vectores</em> como argumentos a <code>str_c()</code>. Se utiliza para separar los elementos de lo que sería un vector de salida, de forma que el vector de salida sólo tenga un elemento de carácter largo.</p>
<p>El ejemplo siguiente muestra la combinación de dos vectores en uno (nombres y apellidos). Otro ejemplo similar podría ser el de las jurisdicciones y su número de casos. En este ejemplo:</p>
<ul>
<li><p>El valor <code>sep =</code> aparece entre cada nombre y apellido</p></li>
<li><p>El valor de <code>collapse =</code> aparece entre cada persona</p></li>
</ul>
<div class="sourceCode" id="cb398"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">first_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"abdul"</span>, <span class="st">"fahruk"</span>, <span class="st">"janice"</span><span class="op">)</span> 
<span class="va">last_names</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hussein"</span>, <span class="st">"akinleye"</span>, <span class="st">"okeke"</span><span class="op">)</span>

<span class="co"># sep displays between the respective input strings, while collapse displays between the elements produced</span>
<span class="fu">str_c</span><span class="op">(</span><span class="va">first_names</span>, <span class="va">last_names</span>, sep <span class="op">=</span> <span class="st">" "</span>, collapse <span class="op">=</span> <span class="st">";  "</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "abdul hussein;  fahruk akinleye;  janice okeke"</code></pre>
<p>Nota: Dependiendo del contexto de visualización deseado, al imprimir una cadena combinada de este tipo con nuevas líneas, puede ser necesario envolver toda la frase en <code><a href="https://rdrr.io/r/base/cat.html">cat()</a></code> para que las nuevas líneas se impriman correctamente:</p>
<div class="sourceCode" id="cb400"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># For newlines to print correctly, the phrase may need to be wrapped in cat()</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu">str_c</span><span class="op">(</span><span class="va">first_names</span>, <span class="va">last_names</span>, sep <span class="op">=</span> <span class="st">" "</span>, collapse <span class="op">=</span> <span class="st">";\n"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## abdul hussein;
## fahruk akinleye;
## janice okeke</code></pre>
<!-- ======================================================= -->
</div>
<div id="cadenas-dinámicas" class="section level3 unnumbered">
<h3>Cadenas dinámicas<a class="anchor" aria-label="anchor" href="#cadenas-din%C3%A1micas"><i class="fas fa-link"></i></a>
</h3>
<p>Utiliza <code>str_glue()</code> para insertar código R dinámico en una cadena. Se trata de una función muy útil para crear títulos o pies de gráfico dinámicos, como se muestra a continuación.</p>
<ul>
<li><p>Todo el contenido va entre comillas dobles <code>str_glue("")</code></p></li>
<li><p>Cualquier código dinámico o referencias a valores predefinidos se colocan entre llaves <code>{}</code> dentro de las comillas dobles. Puede haber muchas llaves en el mismo comando <code>str_glue()</code>.</p></li>
<li><p>Para usar las comillas de caracteres ’’ dentro de la función, utiliza comillas <em>simples</em> dentro de las comillas dobles que las rodean (por ejemplo, al proporcionar el formato de la fecha - véase el ejemplo siguiente)</p></li>
<li><p>Consejo: Puedes utilizar <code>\n</code> para forzar una nueva línea</p></li>
<li><p>Consejo: Utiliza <code><a href="https://rdrr.io/r/base/format.html">format()</a></code> para ajustar la visualización de la fecha, y utiliza <code><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date()</a></code> para mostrar la fecha actual</p></li>
</ul>
<p>Un ejemplo sencillo, de un título de gráfico dinámico:</p>
<div class="sourceCode" id="cb402"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_glue</span><span class="op">(</span><span class="st">"Data include {nrow(linelist)} cases and are current to {format(Sys.Date(), '%d %b %Y')}."</span><span class="op">)</span></code></pre></div>
<pre><code>## Data include 5888 cases and are current to 18 oct. 2022.</code></pre>
<p>Un formato alternativo es utilizar marcadores de posición dentro de los paréntesis y definir el código en argumentos separados al final de la función <code>str_glue()</code>, como se indica a continuación. Esto puede mejorar la legibilidad del código si el texto es largo.</p>
<div class="sourceCode" id="cb404"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_glue</span><span class="op">(</span><span class="st">"Linelist as of {current_date}.\nLast case hospitalized on {last_hospital}.\n{n_missing_onset} cases are missing date of onset and not shown"</span>,
         current_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'%d %b %Y'</span><span class="op">)</span>,
         last_hospital <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_hospitalisation</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span>, <span class="st">'%d %b %Y'</span><span class="op">)</span>,
         n_missing_onset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
         <span class="op">)</span></code></pre></div>
<pre><code>## Linelist as of 18 oct. 2022.
## Last case hospitalized on 30 abr. 2015.
## 256 cases are missing date of onset and not shown</code></pre>
<p><strong>Extraer de un dataframe</strong></p>
<p>A veces, es útil extraer datos de un dataframe y pegarlos secuencialmente. A continuación se muestra un ejemplo de dataframe. Lo utilizaremos para hacer una declaración resumida sobre las jurisdicciones y los recuentos de casos nuevos y totales.</p>
<div class="sourceCode" id="cb406"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make case data frame</span>
<span class="va">case_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  zone        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Zone 1"</span>, <span class="st">"Zone 2"</span>, <span class="st">"Zone 3"</span>, <span class="st">"Zone 4"</span>, <span class="st">"Zone 5"</span><span class="op">)</span>,
  new_cases   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">0</span>, <span class="fl">7</span>, <span class="fl">0</span>, <span class="fl">15</span><span class="op">)</span>,
  total_cases <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">4</span>, <span class="fl">25</span>, <span class="fl">10</span>, <span class="fl">103</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div id="htmlwidget-87a196cdb3312e451600" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-87a196cdb3312e451600">{"x":{"filter":"none","vertical":false,"data":[["Zone 1","Zone 2","Zone 3","Zone 4","Zone 5"],[3,0,7,0,15],[40,4,25,10,103]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>zone<\/th>\n      <th>new_cases<\/th>\n      <th>total_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Utiliza <code>str_glue_data()</code>, que está hecho especialmente para obtener datos de las filas del dataframe:</p>
<div class="sourceCode" id="cb407"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">case_table</span> <span class="op">%&gt;%</span> 
  <span class="fu">str_glue_data</span><span class="op">(</span><span class="st">"{zone}: {new_cases} ({total_cases} total cases)"</span><span class="op">)</span></code></pre></div>
<pre><code>## Zone 1: 3 (40 total cases)
## Zone 2: 0 (4 total cases)
## Zone 3: 7 (25 total cases)
## Zone 4: 0 (10 total cases)
## Zone 5: 15 (103 total cases)</code></pre>
<p><strong>Combinar cadenas a través de las filas</strong></p>
<p>Si estás intentando “enrollar” valores en una columna del dataframe, por ejemplo, combinar valores de varias filas en una sola fila pegándolos con un separador, consulta la sección <a href="de-duplication.html#str_rollup">“combinación de valores”</a> de la página de <strong>De-duplicación</strong>.</p>
<p><strong>Dataframe a una línea</strong></p>
<p>Puedes hacer que la declaración aparezca en una línea utilizando <code>str_c()</code> (especificando el dataframe y los nombres de las columnas), y proporcionando los argumentos <code>sep =</code> y <code>collapse =</code>.</p>
<div class="sourceCode" id="cb409"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_c</span><span class="op">(</span><span class="va">case_table</span><span class="op">$</span><span class="va">zone</span>, <span class="va">case_table</span><span class="op">$</span><span class="va">new_cases</span>, sep <span class="op">=</span> <span class="st">" = "</span>, collapse <span class="op">=</span> <span class="st">";  "</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Zone 1 = 3;  Zone 2 = 0;  Zone 3 = 7;  Zone 4 = 0;  Zone 5 = 15"</code></pre>
<p>Podría añadir el texto “Nuevos casos:” fijado al principio de la frase envolviéndolo con un <code>str_c()</code> separado (si “Nuevos casos:” estuviera dentro del <code>str_c()</code> original aparecería varias veces).</p>
<div class="sourceCode" id="cb411"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_c</span><span class="op">(</span><span class="st">"New Cases: "</span>, <span class="fu">str_c</span><span class="op">(</span><span class="va">case_table</span><span class="op">$</span><span class="va">zone</span>, <span class="va">case_table</span><span class="op">$</span><span class="va">new_cases</span>, sep <span class="op">=</span> <span class="st">" = "</span>, collapse <span class="op">=</span> <span class="st">";  "</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "New Cases: Zone 1 = 3;  Zone 2 = 0;  Zone 3 = 7;  Zone 4 = 0;  Zone 5 = 15"</code></pre>
</div>
<div id="str_unite" class="section level3 unnumbered">
<h3>Unir columnas<a class="anchor" aria-label="anchor" href="#str_unite"><i class="fas fa-link"></i></a>
</h3>
<p>Dentro de un dataframe, la unión de valores de caracteres de varias columnas puede lograrse con <code>unite()</code> de <strong>tidyr</strong>. Esto es lo contrario de <code>separate()</code>.</p>
<p>Indica el nombre de la nueva columna (que contendrá los valores unidos) y, a continuación, indica los nombres de las columnas que deseas unir.</p>
<ul>
<li><p>Por defecto, el separador utilizado en la columna unida es el guión bajo <code>_</code>, pero puede cambiarse con el argumento <code>sep =</code>.</p></li>
<li><p><code>remove =</code> elimina las columnas del dataframe que queremos unir (TRUE por defecto)</p></li>
<li><p><code>na.rm =</code> elimina los valores perdidos (NA) al realizar la unión (FALSE por defecto)</p></li>
</ul>
<p>A continuación, definimos un mini-dataframe con el que hacer una demostración:</p>
<div class="sourceCode" id="cb413"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  case_ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>,
  symptoms  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"jaundice, fever, chills"</span>,     <span class="co"># patient 1</span>
                <span class="st">"chills, aches, pains"</span>,        <span class="co"># patient 2 </span>
                <span class="st">"fever"</span>,                       <span class="co"># patient 3</span>
                <span class="st">"vomiting, diarrhoea"</span>,         <span class="co"># patient 4</span>
                <span class="st">"bleeding from gums, fever"</span>,   <span class="co"># patient 5</span>
                <span class="st">"rapid pulse, headache"</span><span class="op">)</span>,      <span class="co"># patient 6</span>
  outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Recover"</span>, <span class="st">"Death"</span>, <span class="st">"Death"</span>, <span class="st">"Recover"</span>, <span class="st">"Recover"</span>, <span class="st">"Recover"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb414"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_split</span> <span class="op">&lt;-</span> <span class="fu">separate</span><span class="op">(</span><span class="va">df</span>, <span class="va">symptoms</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sym_1"</span>, <span class="st">"sym_2"</span>, <span class="st">"sym_3"</span><span class="op">)</span>, extra <span class="op">=</span> <span class="st">"merge"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Expected 3 pieces. Missing pieces filled with `NA` in 2 rows [3, 4].</code></pre>
<p>Este es el dataframe de ejemplo:</p>
<div id="htmlwidget-ed3e086c07b231ba6097" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ed3e086c07b231ba6097">{"x":{"filter":"none","vertical":false,"data":[[1,2,3,4,5,6],["jaundice","chills","fever","vomiting","bleeding","rapid"],["fever","aches",null,"diarrhoea","from","pulse"],["chills","pains",null,null,"gums, fever","headache"],["Recover","Death","Death","Recover","Recover","Recover"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_ID<\/th>\n      <th>sym_1<\/th>\n      <th>sym_2<\/th>\n      <th>sym_3<\/th>\n      <th>outcome<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>A continuación, unimos las tres columnas de síntomas:</p>
<div class="sourceCode" id="cb416"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_split</span> <span class="op">%&gt;%</span> 
  <span class="fu">unite</span><span class="op">(</span>
    col <span class="op">=</span> <span class="st">"all_symptoms"</span>,         <span class="co"># name of the new united column</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sym_1"</span>, <span class="st">"sym_2"</span>, <span class="st">"sym_3"</span><span class="op">)</span>, <span class="co"># columns to unite</span>
    sep <span class="op">=</span> <span class="st">", "</span>,                   <span class="co"># separator to use in united column</span>
    remove <span class="op">=</span> <span class="cn">TRUE</span>,                <span class="co"># if TRUE, removes input cols from the data frame</span>
    na.rm <span class="op">=</span> <span class="cn">TRUE</span>                  <span class="co"># if TRUE, missing values are removed before uniting</span>
  <span class="op">)</span></code></pre></div>
<pre><code>##   case_ID                all_symptoms outcome
## 1       1     jaundice, fever, chills Recover
## 2       2        chills, aches, pains   Death
## 3       3                       fever   Death
## 4       4         vomiting, diarrhoea Recover
## 5       5 bleeding, from, gums, fever Recover
## 6       6      rapid, pulse, headache Recover</code></pre>
<!-- ======================================================= -->
</div>
<div id="dividir" class="section level3 unnumbered">
<h3>Dividir<a class="anchor" aria-label="anchor" href="#dividir"><i class="fas fa-link"></i></a>
</h3>
<p>Para dividir una cadena basada en un patrón, utiliza <code>str_split()</code>. Esta función evalúa las cadenas y devuelve una <code>lista</code> de vectores de caracteres formada por los valores recién divididos.</p>
<p>El ejemplo que sigue evalúa una cadena y la divide en tres. Por defecto, devuelve un objeto de tipo <code>list</code> con un elemento (un vector de caracteres) por cada cadena proporcionada inicialmente. Si <code>simplify = TRUE</code> devuelve una matriz de caracteres.</p>
<p>En este ejemplo, se proporciona una cadena y la función devuelve una lista con un elemento: un vector de caracteres con tres valores.</p>
<div class="sourceCode" id="cb418"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_split</span><span class="op">(</span>string <span class="op">=</span> <span class="st">"jaundice, fever, chills"</span>,
          pattern <span class="op">=</span> <span class="st">","</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] "jaundice" " fever"   " chills"</code></pre>
<p>Si se guarda la salida, puedes acceder al enésimo valor dividido con la sintaxis de corchetes. Para acceder a un valor específico puedes utilizar una sintaxis como esta: <code>the_returned_object[[1]][2]</code>, que accedería al segundo valor de la primera cadena evaluada (“fever”). Consulta la página de <a href="r-basics.html#r-basics">fundamentos de R</a> para obtener más detalles sobre el acceso a los elementos.</p>
<div class="sourceCode" id="cb420"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pt1_symptoms</span> <span class="op">&lt;-</span> <span class="fu">str_split</span><span class="op">(</span><span class="st">"jaundice, fever, chills"</span>, <span class="st">","</span><span class="op">)</span>

<span class="va">pt1_symptoms</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>  <span class="co"># extracts 2nd value from 1st (and only) element of the list</span></code></pre></div>
<pre><code>## [1] " fever"</code></pre>
<p>Si se proporcionan varias cadenas mediante <code>str_split()</code>, habrá más de un elemento en la lista devuelta.</p>
<div class="sourceCode" id="cb422"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">symptoms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"jaundice, fever, chills"</span>,     <span class="co"># patient 1</span>
              <span class="st">"chills, aches, pains"</span>,        <span class="co"># patient 2 </span>
              <span class="st">"fever"</span>,                       <span class="co"># patient 3</span>
              <span class="st">"vomiting, diarrhoea"</span>,         <span class="co"># patient 4</span>
              <span class="st">"bleeding from gums, fever"</span>,   <span class="co"># patient 5</span>
              <span class="st">"rapid pulse, headache"</span><span class="op">)</span>       <span class="co"># patient 6</span>

<span class="fu">str_split</span><span class="op">(</span><span class="va">symptoms</span>, <span class="st">","</span><span class="op">)</span>                     <span class="co"># split each patient's symptoms</span></code></pre></div>
<pre><code>## [[1]]
## [1] "jaundice" " fever"   " chills" 
## 
## [[2]]
## [1] "chills" " aches" " pains"
## 
## [[3]]
## [1] "fever"
## 
## [[4]]
## [1] "vomiting"   " diarrhoea"
## 
## [[5]]
## [1] "bleeding from gums" " fever"            
## 
## [[6]]
## [1] "rapid pulse" " headache"</code></pre>
<p>Para devolver una “matriz de caracteres” en su lugar, que puede ser útil si se crean columnas de dataframes, establece el argumento <code>simplify = TRUE</code> como se muestra a continuación:</p>
<div class="sourceCode" id="cb424"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_split</span><span class="op">(</span><span class="va">symptoms</span>, <span class="st">","</span>, simplify <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>##      [,1]                 [,2]         [,3]     
## [1,] "jaundice"           " fever"     " chills"
## [2,] "chills"             " aches"     " pains" 
## [3,] "fever"              ""           ""       
## [4,] "vomiting"           " diarrhoea" ""       
## [5,] "bleeding from gums" " fever"     ""       
## [6,] "rapid pulse"        " headache"  ""</code></pre>
<p>También puedes ajustar el número de divisiones a crear con el argumento <code>n =</code>. Por ejemplo, esto restringe el número de divisiones a 2. De este modo, cualquier otra coma permanece dentro del segundo valor.</p>
<div class="sourceCode" id="cb426"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_split</span><span class="op">(</span><span class="va">symptoms</span>, <span class="st">","</span>, simplify <span class="op">=</span> <span class="cn">TRUE</span>, n <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code>##      [,1]                 [,2]            
## [1,] "jaundice"           " fever, chills"
## [2,] "chills"             " aches, pains" 
## [3,] "fever"              ""              
## [4,] "vomiting"           " diarrhoea"    
## [5,] "bleeding from gums" " fever"        
## [6,] "rapid pulse"        " headache"</code></pre>
<p><em>Nota - los mismos resultados se pueden conseguir con <code>str_split_fixed()</code>, en la que no se da el argumento <code>simplify</code>, sino que se debe designar el número de columnas (<code>n</code>).</em></p>
<div class="sourceCode" id="cb428"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_split_fixed</span><span class="op">(</span><span class="va">symptoms</span>, <span class="st">","</span>, n <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
</div>
<div id="dividir-columnas" class="section level3 unnumbered">
<h3>Dividir columnas<a class="anchor" aria-label="anchor" href="#dividir-columnas"><i class="fas fa-link"></i></a>
</h3>
<p>Si estás intentando dividir una columna de un dataframe, es mejor utilizar la función <code>separate()</code> de <strong>dplyr</strong>. Se utiliza para dividir una columna de caracteres en otras columnas.</p>
<p>Digamos que tenemos un dataframe simple <code>df</code> (definido y unido en la <a href="characters-and-strings.html#str_unite">sección de unir columnas</a>) que contiene una columna <code>case_ID</code>, una columna de caracteres con muchos síntomas y una columna de resultados. Nuestro objetivo es separar la columna de <code>symptoms</code> en varias columnas, cada una de las cuales contiene un síntoma.</p>
<div id="htmlwidget-0e0b72fa05ec5926a272" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-0e0b72fa05ec5926a272">{"x":{"filter":"none","vertical":false,"data":[[1,2,3,4,5,6],["jaundice, fever, chills","chills, aches, pains","fever","vomiting, diarrhoea","bleeding from gums, fever","rapid pulse, headache"],["Recover","Death","Death","Recover","Recover","Recover"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_ID<\/th>\n      <th>symptoms<\/th>\n      <th>outcome<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Asumiendo que los datos son enlazados con pipe en <code>separate()</code>, primero proporciona la columna a separar. A continuación, proporcione en = como un vector <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> que contiene los nombres de las <em>nuevas</em> columnas, como se muestra a continuación.</p>
<ul>
<li><p><code>sep =</code> el separador, puede ser un carácter, o un número (interpretado como la posición del carácter a dividir)</p></li>
<li><p><code>remove =</code> FALSE por defecto, elimina la columna de entrada</p></li>
<li><p><code>convert =</code> FALSE por defecto, hará que las cadenas “NA”s se conviertan en <code>NA</code></p></li>
<li><p><code>extra =</code> controla lo que sucede si hay más valores creados por la separación que nuevas columnas nombradas.</p></li>
<li><p><code>extra = "warn"</code> significa que verá una advertencia, pero quitará los valores en exceso (<strong>el valor por defecto</strong>)</p></li>
<li><p><code>extra = "drop"</code> significa que los valores sobrantes se eliminarán sin previo aviso</p></li>
<li><p><strong><code>extra = "merge"</code> sólo dividirá hasta el número de nuevas columnas listadas en <code>into</code> - <em>esta configuración preservará todos tus datos</em></strong></p></li>
</ul>
<p>A continuación se muestra un ejemplo con <code>extra = "merge"</code> - no se pierde ningún dato. Se definen dos nuevas columnas pero cualquier tercer síntoma se deja en la segunda columna nueva:</p>
<div class="sourceCode" id="cb429"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># third symptoms combined into second new column</span>
<span class="va">df</span> <span class="op">%&gt;%</span> 
  <span class="fu">separate</span><span class="op">(</span><span class="va">symptoms</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sym_1"</span>, <span class="st">"sym_2"</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">","</span>, extra <span class="op">=</span> <span class="st">"merge"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Expected 2 pieces. Missing pieces filled with `NA` in 1 rows [3].</code></pre>
<pre><code>##   case_ID              sym_1          sym_2 outcome
## 1       1           jaundice  fever, chills Recover
## 2       2             chills   aches, pains   Death
## 3       3              fever           &lt;NA&gt;   Death
## 4       4           vomiting      diarrhoea Recover
## 5       5 bleeding from gums          fever Recover
## 6       6        rapid pulse       headache Recover</code></pre>
<p>Cuando se utiliza el <code>extra = "drop"</code> por defecto a continuación, se da una advertencia pero se pierden los terceros síntomas:</p>
<div class="sourceCode" id="cb432"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># third symptoms are lost</span>
<span class="va">df</span> <span class="op">%&gt;%</span> 
  <span class="fu">separate</span><span class="op">(</span><span class="va">symptoms</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sym_1"</span>, <span class="st">"sym_2"</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">","</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Expected 2 pieces. Additional pieces discarded in 2 rows [1, 2].</code></pre>
<pre><code>## Warning: Expected 2 pieces. Missing pieces filled with `NA` in 1 rows [3].</code></pre>
<pre><code>##   case_ID              sym_1      sym_2 outcome
## 1       1           jaundice      fever Recover
## 2       2             chills      aches   Death
## 3       3              fever       &lt;NA&gt;   Death
## 4       4           vomiting  diarrhoea Recover
## 5       5 bleeding from gums      fever Recover
## 6       6        rapid pulse   headache Recover</code></pre>
<p><span style="color: orange;"><strong><em>PRECAUCIÓN:</em></strong> Si no proporcionas suficientes valores <code>into</code> en las nuevas columnas, tus datos pueden quedar truncados. </span></p>
<!-- ======================================================= -->
</div>
<div id="ordenar-alfabéticamente" class="section level3 unnumbered">
<h3>Ordenar alfabéticamente<a class="anchor" aria-label="anchor" href="#ordenar-alfab%C3%A9ticamente"><i class="fas fa-link"></i></a>
</h3>
<p>Se pueden ordenar varias cadenas por orden alfabético. <code>str_order()</code> devuelve el orden, mientras que <code>str_sort()</code> devuelve las cadenas en ese orden.</p>
<div class="sourceCode" id="cb436"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># strings</span>
<span class="va">health_zones</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Alba"</span>, <span class="st">"Takota"</span>, <span class="st">"Delta"</span><span class="op">)</span>

<span class="co"># return the alphabetical order</span>
<span class="fu">str_order</span><span class="op">(</span><span class="va">health_zones</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1 3 2</code></pre>
<div class="sourceCode" id="cb438"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># return the strings in alphabetical order</span>
<span class="fu">str_sort</span><span class="op">(</span><span class="va">health_zones</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Alba"   "Delta"  "Takota"</code></pre>
<p>Para utilizar un alfabeto diferente, añade el argumento <code>locale =</code>. Mira lista completa de locales introduciendo <code><a href="https://rdrr.io/pkg/stringi/man/stri_locale_list.html">stringi::stri_locale_list()</a></code> en la consola de R.</p>
<!-- ======================================================= -->
</div>
<div id="funciones-r-base" class="section level3 unnumbered">
<h3>funciones R base<a class="anchor" aria-label="anchor" href="#funciones-r-base"><i class="fas fa-link"></i></a>
</h3>
<p>Es común ver las funciones de R <strong>base</strong> <code><a href="https://rdrr.io/r/base/paste.html">paste()</a></code> y <code><a href="https://rdrr.io/r/base/paste.html">paste0()</a></code>, que concatenan vectores después de convertir todas las partes en caracteres. Actúan de forma similar a <code>str_c()</code> pero la sintaxis es posiblemente más complicada - en los paréntesis cada parte está separada por una coma. Las partes son o bien texto de carácter (entre comillas) o bien objetos de código predefinidos (sin comillas). Por ejemplo:</p>
<div class="sourceCode" id="cb440"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n_beds</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">n_masks</span> <span class="op">&lt;-</span> <span class="fl">20</span>

<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Regional hospital needs "</span>, <span class="va">n_beds</span>, <span class="st">" beds and "</span>, <span class="va">n_masks</span>, <span class="st">" masks."</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Regional hospital needs 10 beds and 20 masks."</code></pre>
<p>Se pueden especificar los argumentos <code>sep =</code> y <code>collapse =</code>. <code><a href="https://rdrr.io/r/base/paste.html">paste()</a></code> es simplemente <code><a href="https://rdrr.io/r/base/paste.html">paste0()</a></code> con un <code>sep =</code> ” ” por defecto (un espacio).</p>
</div>
</div>
<div id="clean-and-standardise" class="section level2" number="10.3">
<h2>
<span class="header-section-number">10.3</span> Limpiar y normalizar<a class="anchor" aria-label="anchor" href="#clean-and-standardise"><i class="fas fa-link"></i></a>
</h2>
<!-- ======================================================= -->
<div id="cambiar-mayúsculas" class="section level3 unnumbered">
<h3>Cambiar mayúsculas<a class="anchor" aria-label="anchor" href="#cambiar-may%C3%BAsculas"><i class="fas fa-link"></i></a>
</h3>
<p>A menudo hay que alterar las mayúsculas y minúsculas de un valor de cadena, por ejemplo los nombres de las jurisdicciones. Utiliza <code>str_to_upper()</code>, <code>str_to_lower()</code>, y <code>str_to_title()</code>, de <strong>stringr</strong>, como se muestra a continuación:</p>
<div class="sourceCode" id="cb442"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_to_upper</span><span class="op">(</span><span class="st">"California"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "CALIFORNIA"</code></pre>
<div class="sourceCode" id="cb444"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_to_lower</span><span class="op">(</span><span class="st">"California"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "california"</code></pre>
<p>Usando R <strong>base</strong>, lo anterior también se puede lograr con <code><a href="https://rdrr.io/r/base/chartr.html">toupper()</a></code>, <code><a href="https://rdrr.io/r/base/chartr.html">tolower()</a></code>.</p>
<p><strong>Capitalización del título</strong></p>
<p>Se puede transformar la cadena para que cada palabra esté en mayúsculas con <code>str_to_title()</code>:</p>
<div class="sourceCode" id="cb446"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_to_title</span><span class="op">(</span><span class="st">"go to the US state of california "</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Go To The Us State Of California "</code></pre>
<p>Utiliza <code>toTitleCase()</code> del paquete de <strong>tools</strong> para lograr una capitalización más matizada (palabras como “a”, “el” y “de” no se escriben en mayúsculas).</p>
<div class="sourceCode" id="cb448"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/toTitleCase.html">toTitleCase</a></span><span class="op">(</span><span class="st">"This is the US state of california"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "This is the US State of California"</code></pre>
<p>También puedes utilizar <code>str_to_sentence()</code>, que sólo pone en mayúsculas la primera letra de la cadena.</p>
<div class="sourceCode" id="cb450"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_to_sentence</span><span class="op">(</span><span class="st">"the patient must be transported"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "The patient must be transported"</code></pre>
</div>
<div id="str_pad" class="section level3 unnumbered">
<h3>Longitud de la cadena<a class="anchor" aria-label="anchor" href="#str_pad"><i class="fas fa-link"></i></a>
</h3>
<p>Utiliza <code>str_pad()</code> para añadir caracteres a una cadena, con una longitud mínima. Por defecto se añaden espacios, pero también puedes rellenar con otros caracteres utilizando el argumento <code>pad =</code>.</p>
<div class="sourceCode" id="cb452"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># ICD codes of differing length</span>
<span class="va">ICD_codes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"R10.13"</span>,
               <span class="st">"R10.819"</span>,
               <span class="st">"R17"</span><span class="op">)</span>

<span class="co"># ICD codes padded to 7 characters on the right side</span>
<span class="fu">str_pad</span><span class="op">(</span><span class="va">ICD_codes</span>, <span class="fl">7</span>, <span class="st">"right"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "R10.13 " "R10.819" "R17    "</code></pre>
<div class="sourceCode" id="cb454"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Pad with periods instead of spaces</span>
<span class="fu">str_pad</span><span class="op">(</span><span class="va">ICD_codes</span>, <span class="fl">7</span>, <span class="st">"right"</span>, pad <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "R10.13." "R10.819" "R17...."</code></pre>
<p>Por ejemplo, para rellenar números con ceros a la izquierda (como en el caso de las horas o los minutos), puedes rellenar el número hasta una longitud mínima de 2 con pad = “0”.</p>
<div class="sourceCode" id="cb456"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Add leading zeros to two digits (e.g. for times minutes/hours)</span>
<span class="fu">str_pad</span><span class="op">(</span><span class="st">"4"</span>, <span class="fl">2</span>, pad <span class="op">=</span> <span class="st">"0"</span><span class="op">)</span> </code></pre></div>
<pre><code>## [1] "04"</code></pre>
<div class="sourceCode" id="cb458"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># example using a numeric column named "hours"</span>
<span class="co"># hours &lt;- str_pad(hours, 2, pad = "0")</span></code></pre></div>
</div>
<div id="truncar" class="section level3 unnumbered">
<h3>Truncar<a class="anchor" aria-label="anchor" href="#truncar"><i class="fas fa-link"></i></a>
</h3>
<p><code>str_trunc()</code> establece una longitud máxima para cada cadena. Si una cadena supera esta longitud, se trunca (acorta) y se incluye una elipsis (…) para indicar que la cadena era antes más larga. Ten en cuenta que la elipsis <em>se</em> cuenta en la longitud. Los caracteres de la elipsis pueden cambiarse con el argumento <code>ellipsis =</code>. El argumento opcional <code>side =</code>especifica dónde aparecerá la elipsis dentro de la cadena truncada (“left”, “right”, o “center”).</p>
<div class="sourceCode" id="cb459"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">original</span> <span class="op">&lt;-</span> <span class="st">"Symptom onset on 4/3/2020 with vomiting"</span>
<span class="fu">str_trunc</span><span class="op">(</span><span class="va">original</span>, <span class="fl">10</span>, <span class="st">"center"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Symp...ing"</code></pre>
</div>
<div id="normalizar-la-longitud" class="section level3 unnumbered">
<h3>Normalizar la longitud<a class="anchor" aria-label="anchor" href="#normalizar-la-longitud"><i class="fas fa-link"></i></a>
</h3>
<p>Utiliza <code>str_trunc()</code> para establecer una longitud máxima y, a continuación, utiliza <code>str_pad()</code> para ampliar las cadenas muy cortas hasta esa longitud truncada. En el ejemplo siguiente, se establece 6 como longitud máxima (se trunca un valor), y luego se rellena un valor muy corto para alcanzar la longitud de 6.</p>
<div class="sourceCode" id="cb461"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># ICD codes of differing length</span>
<span class="va">ICD_codes</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"R10.13"</span>,
                 <span class="st">"R10.819"</span>,
                 <span class="st">"R17"</span><span class="op">)</span>

<span class="co"># truncate to maximum length of 6</span>
<span class="va">ICD_codes_2</span> <span class="op">&lt;-</span> <span class="fu">str_trunc</span><span class="op">(</span><span class="va">ICD_codes</span>, <span class="fl">6</span><span class="op">)</span>
<span class="va">ICD_codes_2</span></code></pre></div>
<pre><code>## [1] "R10.13" "R10..." "R17"</code></pre>
<div class="sourceCode" id="cb463"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># expand to minimum length of 6</span>
<span class="va">ICD_codes_3</span> <span class="op">&lt;-</span> <span class="fu">str_pad</span><span class="op">(</span><span class="va">ICD_codes_2</span>, <span class="fl">6</span>, <span class="st">"right"</span><span class="op">)</span>
<span class="va">ICD_codes_3</span></code></pre></div>
<pre><code>## [1] "R10.13" "R10..." "R17   "</code></pre>
</div>
<div id="eliminar-los-espacios-en-blanco-iniciales-y-finales" class="section level3 unnumbered">
<h3>Eliminar los espacios en blanco iniciales y finales<a class="anchor" aria-label="anchor" href="#eliminar-los-espacios-en-blanco-iniciales-y-finales"><i class="fas fa-link"></i></a>
</h3>
<p>Utiliza <code>str_trim()</code> para eliminar los espacios, las nuevas líneas (<code>\n</code>) o los tabuladores (<code>\t</code>) de los lados de una cadena de entrada. Añade <code>"right"</code> <code>"left"</code>, o <code>"both"</code> al comando para especificar qué lado recortar (por ejemplo, <code>str_trim(x, "right")</code>.</p>
<div class="sourceCode" id="cb465"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># ID numbers with excess spaces on right</span>
<span class="va">IDs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"provA_1852  "</span>, <span class="co"># two excess spaces</span>
         <span class="st">"provA_2345"</span>,   <span class="co"># zero excess spaces</span>
         <span class="st">"provA_9460 "</span><span class="op">)</span>  <span class="co"># one excess space</span>

<span class="co"># IDs trimmed to remove excess spaces on right side only</span>
<span class="fu">str_trim</span><span class="op">(</span><span class="va">IDs</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "provA_1852" "provA_2345" "provA_9460"</code></pre>
</div>
<div id="eliminar-los-espacios-en-blanco-repetidos-en-una-cadena" class="section level3 unnumbered">
<h3>Eliminar los espacios en blanco repetidos en una cadena<a class="anchor" aria-label="anchor" href="#eliminar-los-espacios-en-blanco-repetidos-en-una-cadena"><i class="fas fa-link"></i></a>
</h3>
<p>Utiliza <code>str_squish()</code> para eliminar los espacios repetidos que aparecen <em>dentro</em> de una cadena. Por ejemplo, para convertir espacios dobles en espacios simples. También elimina espacios, nuevas líneas o tabulaciones en el exterior de la cadena como <code>str_trim()</code>.</p>
<div class="sourceCode" id="cb467"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># original contains excess spaces within string</span>
<span class="fu">str_squish</span><span class="op">(</span><span class="st">"  Pt requires   IV saline\n"</span><span class="op">)</span> </code></pre></div>
<pre><code>## [1] "Pt requires IV saline"</code></pre>
<p>Escribe <code>?str_trim</code>, <code>?str_pad</code> en tu consola de R para ver más detalles.</p>
</div>
<div id="convertir-en-párrafos" class="section level3 unnumbered">
<h3>convertir en párrafos<a class="anchor" aria-label="anchor" href="#convertir-en-p%C3%A1rrafos"><i class="fas fa-link"></i></a>
</h3>
<p>Utiliza <code>str_wrap()</code> para convertir un texto largo no estructurado en un párrafo estructurado con una longitud de línea fija. Proporciona la longitud de caracteres ideal para cada línea, y aplica un algoritmo para insertar nuevas líneas () dentro del párrafo, como se ve en el ejemplo siguiente.</p>
<div class="sourceCode" id="cb469"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pt_course</span> <span class="op">&lt;-</span> <span class="st">"Inicio de los síntomas 1/4/2020 vómitos escalofríos fiebre. La paciente consultó a un curandero tradicional en su pueblo natal el 2/4/2020. El 5/4/2020 los síntomas empeoraron y fue ingresada en la clínica Lumta. Se tomó una muestra y fue trasladada al hospital regional el 6/4/2020. La paciente murió en el hospital regional el 7/4/2020"</span>

<span class="fu">str_wrap</span><span class="op">(</span><span class="va">pt_course</span>, <span class="fl">40</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Inicio de los síntomas 1/4/2020 vómitos\nescalofríos fiebre. La paciente consultó\na un curandero tradicional en su pueblo\nnatal el 2/4/2020. El 5/4/2020 los\nsíntomas empeoraron y fue ingresada en\nla clínica Lumta. Se tomó una muestra\ny fue trasladada al hospital regional\nel 6/4/2020. La paciente murió en el\nhospital regional el 7/4/2020"</code></pre>
<p>La función <strong>base</strong> <code><a href="https://rdrr.io/r/base/cat.html">cat()</a></code> puede envolver el comando anterior para imprimir la salida, mostrando las nuevas líneas añadidas.</p>
<div class="sourceCode" id="cb471"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu">str_wrap</span><span class="op">(</span><span class="va">pt_course</span>, <span class="fl">40</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Inicio de los síntomas 1/4/2020 vómitos
## escalofríos fiebre. La paciente consultó
## a un curandero tradicional en su pueblo
## natal el 2/4/2020. El 5/4/2020 los
## síntomas empeoraron y fue ingresada en
## la clínica Lumta. Se tomó una muestra
## y fue trasladada al hospital regional
## el 6/4/2020. La paciente murió en el
## hospital regional el 7/4/2020</code></pre>
<!-- ======================================================= -->
</div>
</div>
<div id="handle-by-position" class="section level2" number="10.4">
<h2>
<span class="header-section-number">10.4</span> Manipular por posición<a class="anchor" aria-label="anchor" href="#handle-by-position"><i class="fas fa-link"></i></a>
</h2>
<div id="extraer-por-posición-de-carácter" class="section level3 unnumbered">
<h3>Extraer por posición de carácter<a class="anchor" aria-label="anchor" href="#extraer-por-posici%C3%B3n-de-car%C3%A1cter"><i class="fas fa-link"></i></a>
</h3>
<p>Utiliza <code>str_sub()</code> para devolver sólo una parte de una cadena. La función toma tres argumentos principales:</p>
<ol style="list-style-type: decimal">
<li><p>el(los) vector(es) de caracteres</p></li>
<li><p>posición de inicio</p></li>
<li><p>posición final</p></li>
</ol>
<p>Algunas notas sobre los números de posición:</p>
<ul>
<li><p>Si un número de posición es positivo, la posición se cuenta a partir del extremo izquierdo de la cadena.</p></li>
<li><p>Si un número de posición es negativo, se cuenta a partir del extremo derecho de la cadena.</p></li>
<li><p>Los números de posición son inclusivos.</p></li>
<li><p>Las posiciones que se extienden más allá de la cadena serán truncadas (eliminadas).</p></li>
</ul>
<p>A continuación se muestran algunos ejemplos aplicados a la cadena “pneumonia”:</p>
<div class="sourceCode" id="cb473"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># start and end third from left (3rd letter from left)</span>
<span class="fu">str_sub</span><span class="op">(</span><span class="st">"pneumonia"</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "e"</code></pre>
<div class="sourceCode" id="cb475"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 0 is not present</span>
<span class="fu">str_sub</span><span class="op">(</span><span class="st">"pneumonia"</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] ""</code></pre>
<div class="sourceCode" id="cb477"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 6th from left, to the 1st from right</span>
<span class="fu">str_sub</span><span class="op">(</span><span class="st">"pneumonia"</span>, <span class="fl">6</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "onia"</code></pre>
<div class="sourceCode" id="cb479"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 5th from right, to the 2nd from right</span>
<span class="fu">str_sub</span><span class="op">(</span><span class="st">"pneumonia"</span>, <span class="op">-</span><span class="fl">5</span>, <span class="op">-</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "moni"</code></pre>
<div class="sourceCode" id="cb481"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 4th from left to a position outside the string</span>
<span class="fu">str_sub</span><span class="op">(</span><span class="st">"pneumonia"</span>, <span class="fl">4</span>, <span class="fl">15</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "umonia"</code></pre>
</div>
<div id="extraer-por-posición-de-palabra" class="section level3 unnumbered">
<h3>Extraer por posición de palabra<a class="anchor" aria-label="anchor" href="#extraer-por-posici%C3%B3n-de-palabra"><i class="fas fa-link"></i></a>
</h3>
<p>Para extraer la enésima ‘palabra’, utiliza <code>word()</code>, también de <strong>stringr</strong>. Proporciona la(s) cadena(s), luego la primera y la última posición de la palabra a extraer.</p>
<p>Por defecto, se asume que el separador entre ‘palabras’ es un espacio, a menos que se indica lo contrario con <code>sep =</code> (por ejemplo, <code>sep = "_"</code> cuando las palabras están separadas por barra baja.</p>
<div class="sourceCode" id="cb483"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># strings to evaluate</span>
<span class="va">chief_complaints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"I just got out of the hospital 2 days ago, but still can barely breathe."</span>,
                      <span class="st">"My stomach hurts"</span>,
                      <span class="st">"Severe ear pain"</span><span class="op">)</span>

<span class="co"># extract 1st to 3rd words of each string</span>
<span class="fu">word</span><span class="op">(</span><span class="va">chief_complaints</span>, start <span class="op">=</span> <span class="fl">1</span>, end <span class="op">=</span> <span class="fl">3</span>, sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "I just got"       "My stomach hurts" "Severe ear pain"</code></pre>
</div>
<div id="sustituir-por-posición-de-carácter" class="section level3 unnumbered">
<h3>Sustituir por posición de carácter<a class="anchor" aria-label="anchor" href="#sustituir-por-posici%C3%B3n-de-car%C3%A1cter"><i class="fas fa-link"></i></a>
</h3>
<p><code>str_sub()</code> emparejado con el operador de asignación (<code><a href="https://rdrr.io/r/base/assignOps.html">&lt;-</a></code>) puede utilizarse para modificar una parte de una cadena:</p>
<div class="sourceCode" id="cb485"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">word</span> <span class="op">&lt;-</span> <span class="st">"pneumonia"</span>

<span class="co"># convert the third and fourth characters to X </span>
<span class="fu">str_sub</span><span class="op">(</span><span class="va">word</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"XX"</span>

<span class="co"># print</span>
<span class="va">word</span></code></pre></div>
<pre><code>## [1] "pnXXmonia"</code></pre>
<p>Un ejemplo aplicado a varias cadenas (por ejemplo, una columna). Obsérvese la ampliación de la longitud de “HIV”.</p>
<div class="sourceCode" id="cb487"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">words</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"pneumonia"</span>, <span class="st">"tubercolosis"</span>, <span class="st">"HIV"</span><span class="op">)</span>

<span class="co"># convert the third and fourth characters to X </span>
<span class="fu">str_sub</span><span class="op">(</span><span class="va">words</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"XX"</span>

<span class="va">words</span></code></pre></div>
<pre><code>## [1] "pnXXmonia"    "tuXXrcolosis" "HIXX"</code></pre>
</div>
<div id="evaluar-la-longitud" class="section level3 unnumbered">
<h3>Evaluar la longitud<a class="anchor" aria-label="anchor" href="#evaluar-la-longitud"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb489"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_length</span><span class="op">(</span><span class="st">"abc"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>Como alternativa, utiliza <code><a href="https://rdrr.io/r/base/nchar.html">nchar()</a></code> de R <strong>base</strong></p>
<!-- ======================================================= -->
</div>
</div>
<div id="patterns" class="section level2" number="10.5">
<h2>
<span class="header-section-number">10.5</span> Patrones<a class="anchor" aria-label="anchor" href="#patterns"><i class="fas fa-link"></i></a>
</h2>
<p>Muchas funciones de <strong>stringr</strong> trabajan para detectar, localizar, extraer, hacer coincidir, reemplazar y dividir basándose en un <em>patrón</em> especificado.</p>
<!-- ======================================================= -->
<div id="detectar-un-patrón" class="section level3 unnumbered">
<h3>Detectar un patrón<a class="anchor" aria-label="anchor" href="#detectar-un-patr%C3%B3n"><i class="fas fa-link"></i></a>
</h3>
<p>Utiliza <code>str_detect()</code> como se indica a continuación para detectar la presencia/ausencia de un patrón dentro de una cadena. Primero proporciona la cadena o vector en la que a buscar (<code>string =</code>), y luego el patrón a buscar (<code>pattern =</code>). Ten en cuenta que, por defecto, la búsqueda <em>distingue entre mayúsculas y minúsculas</em>.</p>
<div class="sourceCode" id="cb491"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_detect</span><span class="op">(</span>string <span class="op">=</span> <span class="st">"primary school teacher"</span>, pattern <span class="op">=</span> <span class="st">"teach"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Se puede incluir el argumento <code>negate =</code> y ponerlo a <code>TRUE</code> si se quiere saber si el patrón NO está presente.</p>
<div class="sourceCode" id="cb493"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_detect</span><span class="op">(</span>string <span class="op">=</span> <span class="st">"primary school teacher"</span>, pattern <span class="op">=</span> <span class="st">"teach"</span>, negate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>Para ignorar las mayúsculas y minúsculas, envuelve el patrón dentro de <code><a href="https://rdrr.io/r/base/regex.html">regex()</a></code>, y <em>dentro</em> de <code><a href="https://rdrr.io/r/base/regex.html">regex()</a></code> añade el argumento <code>ignore_case = TRUE</code> (o <code>T</code> como abreviatura).</p>
<div class="sourceCode" id="cb495"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_detect</span><span class="op">(</span>string <span class="op">=</span> <span class="st">"Teacher"</span>, pattern <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/regex.html">regex</a></span><span class="op">(</span><span class="st">"teach"</span>, ignore_case <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Cuando <code>str_detect()</code> se aplica a un vector de caracteres o a una columna de un dataframe, devolverá TRUE o FALSE para cada uno de los valores.</p>
<div class="sourceCode" id="cb497"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># a vector/column of occupations </span>
<span class="va">occupations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"field laborer"</span>,
                 <span class="st">"university professor"</span>,
                 <span class="st">"primary school teacher &amp; tutor"</span>,
                 <span class="st">"tutor"</span>,
                 <span class="st">"nurse at regional hospital"</span>,
                 <span class="st">"lineworker at Amberdeen Fish Factory"</span>,
                 <span class="st">"physican"</span>,
                 <span class="st">"cardiologist"</span>,
                 <span class="st">"office worker"</span>,
                 <span class="st">"food service"</span><span class="op">)</span>

<span class="co"># Detect presence of pattern "teach" in each string - output is vector of TRUE/FALSE</span>
<span class="fu">str_detect</span><span class="op">(</span><span class="va">occupations</span>, <span class="st">"teach"</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</code></pre>
<p>Si necesitas contar los <code>TRUE</code>, simplemente <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> la salida. Esto cuenta el número de <code>TRUE</code>.</p>
<div class="sourceCode" id="cb499"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">occupations</span>, <span class="st">"teach"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>Para buscar con varios términos, inclúyelos separados por barras (<code><a href="https://rdrr.io/r/base/Logic.html">|</a></code>) dentro del argumento <code>pattern =</code>, como se muestra a continuación:</p>
<div class="sourceCode" id="cb501"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span>string <span class="op">=</span> <span class="va">occupations</span>, pattern <span class="op">=</span> <span class="st">"teach|professor|tutor"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>Si necesitas construir una larga lista de términos de búsqueda, puedes combinarlos usando <code>str_c()</code> y <code>sep = |</code>, luego definir que esto es un objeto de caracteres, y luego referenciar el vector más adelante de manera más sucinta. El ejemplo siguiente incluye posibles términos de búsqueda de ocupación para proveedores médicos de primera línea.</p>
<div class="sourceCode" id="cb503"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># search terms</span>
<span class="va">occupation_med_frontline</span> <span class="op">&lt;-</span> <span class="fu">str_c</span><span class="op">(</span><span class="st">"medical"</span>, <span class="st">"medicine"</span>, <span class="st">"hcw"</span>, <span class="st">"healthcare"</span>, <span class="st">"home care"</span>, <span class="st">"home health"</span>,
                                <span class="st">"surgeon"</span>, <span class="st">"doctor"</span>, <span class="st">"doc"</span>, <span class="st">"physician"</span>, <span class="st">"surgery"</span>, <span class="st">"peds"</span>, <span class="st">"pediatrician"</span>,
                               <span class="st">"intensivist"</span>, <span class="st">"cardiologist"</span>, <span class="st">"coroner"</span>, <span class="st">"nurse"</span>, <span class="st">"nursing"</span>, <span class="st">"rn"</span>, <span class="st">"lpn"</span>,
                               <span class="st">"cna"</span>, <span class="st">"pa"</span>, <span class="st">"physician assistant"</span>, <span class="st">"mental health"</span>,
                               <span class="st">"emergency department technician"</span>, <span class="st">"resp therapist"</span>, <span class="st">"respiratory"</span>,
                                <span class="st">"phlebotomist"</span>, <span class="st">"pharmacy"</span>, <span class="st">"pharmacist"</span>, <span class="st">"hospital"</span>, <span class="st">"snf"</span>, <span class="st">"rehabilitation"</span>,
                               <span class="st">"rehab"</span>, <span class="st">"activity"</span>, <span class="st">"elderly"</span>, <span class="st">"subacute"</span>, <span class="st">"sub acute"</span>,
                                <span class="st">"clinic"</span>, <span class="st">"post acute"</span>, <span class="st">"therapist"</span>, <span class="st">"extended care"</span>,
                                <span class="st">"dental"</span>, <span class="st">"dential"</span>, <span class="st">"dentist"</span>, sep <span class="op">=</span> <span class="st">"|"</span><span class="op">)</span>

<span class="va">occupation_med_frontline</span></code></pre></div>
<pre><code>## [1] "medical|medicine|hcw|healthcare|home care|home health|surgeon|doctor|doc|physician|surgery|peds|pediatrician|intensivist|cardiologist|coroner|nurse|nursing|rn|lpn|cna|pa|physician assistant|mental health|emergency department technician|resp therapist|respiratory|phlebotomist|pharmacy|pharmacist|hospital|snf|rehabilitation|rehab|activity|elderly|subacute|sub acute|clinic|post acute|therapist|extended care|dental|dential|dentist"</code></pre>
<p>Este comando devuelve el número de ocupaciones que contienen alguno de los términos de búsqueda para proveedores médicos de primera línea (<code>occupation_med_frontline</code>):</p>
<div class="sourceCode" id="cb505"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span>string <span class="op">=</span> <span class="va">occupations</span>, pattern <span class="op">=</span> <span class="va">occupation_med_frontline</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p><strong>Funciones de búsqueda de cadenas en R base</strong></p>
<p><code><a href="https://rdrr.io/r/base/grep.html">grepl()</a></code> de R <strong>base</strong> funciona de forma similar a <code>str_detect()</code>, en el sentido de que busca coincidencias con un patrón y devuelve un vector lógico. La sintaxis básica es <code><a href="https://rdrr.io/r/base/grep.html">grepl(patrón,  cadenas_de_búsqueda, ignore.case = FALSE, ...)</a></code>. Una ventaja es que el argumento ignore.case es más fácil de escribir (no hay necesidad de involucrar la función <code><a href="https://rdrr.io/r/base/regex.html">regex()</a></code>).</p>
<p>Asimismo, las funciones <code><a href="https://rdrr.io/r/base/grep.html">sub()</a></code> y <code><a href="https://rdrr.io/r/base/grep.html">gsub()</a></code>de R <strong>base</strong> actúan de forma similar a <code>str_replace()</code>. Su sintaxis básica es: <code><a href="https://rdrr.io/r/base/grep.html">gsub(patrón, reemplazo, cadenas_de_búsqueda, ignore.case = FALSE)</a></code>. <code><a href="https://rdrr.io/r/base/grep.html">sub()</a></code> reemplazará la primera instancia del patrón, mientras que <code><a href="https://rdrr.io/r/base/grep.html">gsub()</a></code> reemplazará todas las instancias del patrón.</p>
<div id="convertir-comas-en-puntos" class="section level4 unnumbered">
<h4>Convertir comas en puntos<a class="anchor" aria-label="anchor" href="#convertir-comas-en-puntos"><i class="fas fa-link"></i></a>
</h4>
<p>He aquí un ejemplo de uso de <code><a href="https://rdrr.io/r/base/grep.html">gsub()</a></code> para convertir comas en puntos en un vector de números. Esto podría ser útil si tus datos proceden de otras partes del mundo que no sean Estados Unidos o Gran Bretaña.</p>
<p><code><a href="https://rdrr.io/r/base/grep.html">gsub()</a></code> internamente actúa primero sobre <code>lengths</code> convirtiendo cualquier punto en sin espacio ““. El carácter de punto”.” tiene que ser “escapado” con dos barras inclinadas para significar realmente un punto, porque “.” en regex significa “cualquier carácter”. A continuación, el resultado (con sólo comas) se pasa a la función externa <code><a href="https://rdrr.io/r/base/grep.html">gsub()</a></code> en la que las comas se sustituyen por puntos.</p>
<div class="sourceCode" id="cb507"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lengths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2.454,56"</span>, <span class="st">"1,2"</span>, <span class="st">"6.096,5"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">","</span>,                <span class="co"># find commas     </span>
                replacement <span class="op">=</span> <span class="st">"."</span>,            <span class="co"># replace with periods</span>
                x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"\\."</span>, <span class="st">""</span>, <span class="va">lengths</span><span class="op">)</span>  <span class="co"># vector with other periods removed (periods escaped)</span>
                <span class="op">)</span>
           <span class="op">)</span>                                  <span class="co"># convert outcome to numeric</span></code></pre></div>
</div>
</div>
<div id="sustituir-todo" class="section level3 unnumbered">
<h3>Sustituir todo<a class="anchor" aria-label="anchor" href="#sustituir-todo"><i class="fas fa-link"></i></a>
</h3>
<p>Utiliza <code>str_replace_all()</code> como herramienta de “búsqueda y sustitución”. Primero, proporcione las cadenas a evaluar a <code>string =</code>, luego el patrón a reemplazar a <code>pattern =</code>, y luego el valor de reemplazo a <code>replacement =</code>. El ejemplo siguiente reemplaza todas las instancias de “dead” con “deceased”. Ten en cuenta que esto distingue entre mayúsculas y minúsculas.</p>
<div class="sourceCode" id="cb508"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Karl: dead"</span>,
            <span class="st">"Samantha: dead"</span>,
            <span class="st">"Marco: not dead"</span><span class="op">)</span>

<span class="fu">str_replace_all</span><span class="op">(</span>string <span class="op">=</span> <span class="va">outcome</span>, pattern <span class="op">=</span> <span class="st">"dead"</span>, replacement <span class="op">=</span> <span class="st">"deceased"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Karl: deceased"      "Samantha: deceased"  "Marco: not deceased"</code></pre>
<p>Notas:</p>
<ul>
<li><p>Para sustituir un patrón por <code>NA</code>, utiliza <code>str_replace_na()</code>.</p></li>
<li><p>La función <code>str_replace()</code> reemplaza sólo la primera instancia del patrón dentro de cada cadena evaluada.</p></li>
</ul>
<!-- ======================================================= -->
</div>
<div id="detectar-con-lógica" class="section level3 unnumbered">
<h3>Detectar con lógica<a class="anchor" aria-label="anchor" href="#detectar-con-l%C3%B3gica"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Dentro de case_when()</strong></p>
<p><code>str_detect()</code> se utiliza a menudo dentro de <code>case_when()</code> (de <strong>dplyr</strong>). Digamos que ocupaciones es una columna en linelist. La función <code>mutate()</code> de abajo crea una nueva columna llamada <code>is_educator</code> utilizando la lógica condicional a través de <code>case_when()</code>. Mira la página sobre limpieza de datos para aprender más sobre <code>case_when()</code>.</p>
<div class="sourceCode" id="cb510"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>is_educator <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span>
    <span class="co"># term search within occupation, not case sensitive</span>
    <span class="fu">str_detect</span><span class="op">(</span><span class="va">occupations</span>,
               <span class="fu"><a href="https://rdrr.io/r/base/regex.html">regex</a></span><span class="op">(</span><span class="st">"teach|prof|tutor|university"</span>,
                     ignore_case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>              <span class="op">~</span> <span class="st">"Educator"</span>,
    <span class="co"># all others</span>
    <span class="cn">TRUE</span>                                               <span class="op">~</span> <span class="st">"Not an educator"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Como recordatorio, puede ser importante añadir criterios de exclusión a la lógica condicional (<code>negate = F</code>):</p>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="characters-and-strings.html#cb511-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb511-2"><a href="characters-and-strings.html#cb511-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># value in new column is_educator is based on conditional logic</span></span>
<span id="cb511-3"><a href="characters-and-strings.html#cb511-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">is_educator =</span> <span class="fu">case_when</span>(</span>
<span id="cb511-4"><a href="characters-and-strings.html#cb511-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb511-5"><a href="characters-and-strings.html#cb511-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># occupation column must meet 2 criteria to be assigned "Educator":</span></span>
<span id="cb511-6"><a href="characters-and-strings.html#cb511-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># it must have a search term AND NOT any exclusion term</span></span>
<span id="cb511-7"><a href="characters-and-strings.html#cb511-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb511-8"><a href="characters-and-strings.html#cb511-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Must have a search term</span></span>
<span id="cb511-9"><a href="characters-and-strings.html#cb511-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(occupations,</span>
<span id="cb511-10"><a href="characters-and-strings.html#cb511-10" aria-hidden="true" tabindex="-1"></a>               <span class="fu">regex</span>(<span class="st">"teach|prof|tutor|university"</span>, <span class="at">ignore_case =</span> T)) <span class="sc">&amp;</span>              </span>
<span id="cb511-11"><a href="characters-and-strings.html#cb511-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb511-12"><a href="characters-and-strings.html#cb511-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># AND must NOT have an exclusion term</span></span>
<span id="cb511-13"><a href="characters-and-strings.html#cb511-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(occupations,</span>
<span id="cb511-14"><a href="characters-and-strings.html#cb511-14" aria-hidden="true" tabindex="-1"></a>               <span class="fu">regex</span>(<span class="st">"admin"</span>, <span class="at">ignore_case =</span> T),</span>
<span id="cb511-15"><a href="characters-and-strings.html#cb511-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">negate =</span> <span class="cn">TRUE</span>                        <span class="sc">~</span> <span class="st">"Educator"</span></span>
<span id="cb511-16"><a href="characters-and-strings.html#cb511-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb511-17"><a href="characters-and-strings.html#cb511-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># All rows not meeting above criteria</span></span>
<span id="cb511-18"><a href="characters-and-strings.html#cb511-18" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span>                                            <span class="sc">~</span> <span class="st">"Not an educator"</span>))</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="localizar-la-posición-de-un-patrón" class="section level3 unnumbered">
<h3>Localizar la posición de un patrón<a class="anchor" aria-label="anchor" href="#localizar-la-posici%C3%B3n-de-un-patr%C3%B3n"><i class="fas fa-link"></i></a>
</h3>
<p>Para localizar la <em>primera</em> posición de un patrón, utiliza <code>str_locate()</code>. Esta función da como resultado una posición inicial y una final.</p>
<div class="sourceCode" id="cb512"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_locate</span><span class="op">(</span><span class="st">"I wish"</span>, <span class="st">"sh"</span><span class="op">)</span></code></pre></div>
<pre><code>##      start end
## [1,]     5   6</code></pre>
<p>Al igual que otras funciones <code>str</code>, existe una versión “_all” (<code>str_locate_all()</code>) que devolverá las posiciones de <em>todas</em> las instancias del patrón dentro de cada cadena. La salida es una <code>lista</code>.</p>
<div class="sourceCode" id="cb514"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">phrases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"I wish"</span>, <span class="st">"I hope"</span>, <span class="st">"he hopes"</span>, <span class="st">"He hopes"</span><span class="op">)</span>

<span class="fu">str_locate</span><span class="op">(</span><span class="va">phrases</span>, <span class="st">"h"</span> <span class="op">)</span>     <span class="co"># position of *first* instance of the pattern</span></code></pre></div>
<pre><code>##      start end
## [1,]     6   6
## [2,]     3   3
## [3,]     1   1
## [4,]     4   4</code></pre>
<div class="sourceCode" id="cb516"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_locate_all</span><span class="op">(</span><span class="va">phrases</span>, <span class="st">"h"</span> <span class="op">)</span> <span class="co"># position of *every* instance of the pattern</span></code></pre></div>
<pre><code>## [[1]]
##      start end
## [1,]     6   6
## 
## [[2]]
##      start end
## [1,]     3   3
## 
## [[3]]
##      start end
## [1,]     1   1
## [2,]     4   4
## 
## [[4]]
##      start end
## [1,]     4   4</code></pre>
<!-- ======================================================= -->
</div>
<div id="extraer-una-coincidencia" class="section level3 unnumbered">
<h3>Extraer una coincidencia<a class="anchor" aria-label="anchor" href="#extraer-una-coincidencia"><i class="fas fa-link"></i></a>
</h3>
<p><code>str_extract_all()</code> devuelve los patrones coincidentes en sí mismos, lo que resulta muy útil cuando se han ofrecido varios patrones mediante condiciones “OR”. Por ejemplo, buscando en el vector de cadenas de ocupaciones (véase la pestaña anterior) <em>cualquiera</em> “enseñ”, “profesor” o “tutor”.</p>
<p><code>str_extract_all()</code> devuelve una <code>lista</code> que contiene <em>todas las coincidencias</em> de cada cadena evaluada. Mira a continuación cómo la ocupación 3 tiene dos coincidencias de patrón dentro de ella.</p>
<div class="sourceCode" id="cb518"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_extract_all</span><span class="op">(</span><span class="va">occupations</span>, <span class="st">"teach|prof|tutor"</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## character(0)
## 
## [[2]]
## [1] "prof"
## 
## [[3]]
## [1] "teach" "tutor"
## 
## [[4]]
## [1] "tutor"
## 
## [[5]]
## character(0)
## 
## [[6]]
## character(0)
## 
## [[7]]
## character(0)
## 
## [[8]]
## character(0)
## 
## [[9]]
## character(0)
## 
## [[10]]
## character(0)</code></pre>
<p><code>str_extract()</code> extrae <em>sólo la primera coincidencia</em> en cada cadena evaluada, produciendo un vector de caracteres con un elemento por cada cadena evaluada. Devuelve NA cuando no hay coincidencias. Los <code>NA</code>s pueden ser eliminados envolviendo el vector devuelto con <code><a href="https://rdrr.io/r/stats/na.fail.html">na.exclude()</a></code>. Observa cómo la segunda de las coincidencias de la ocupación 3 no se muestra.</p>
<div class="sourceCode" id="cb520"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_extract</span><span class="op">(</span><span class="va">occupations</span>, <span class="st">"teach|prof|tutor"</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] NA      "prof"  "teach" "tutor" NA      NA      NA      NA      NA     
## [10] NA</code></pre>
<!-- ======================================================= -->
</div>
<div id="subconjunto-y-recuento" class="section level3 unnumbered">
<h3>Subconjunto y recuento<a class="anchor" aria-label="anchor" href="#subconjunto-y-recuento"><i class="fas fa-link"></i></a>
</h3>
<p>Las funciones alineadas incluyen <code>str_subset()</code> y <code>str_count()</code>.</p>
<p><code>str_subset()</code> devuelve los valores reales que contienen el patrón:</p>
<div class="sourceCode" id="cb522"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_subset</span><span class="op">(</span><span class="va">occupations</span>, <span class="st">"teach|prof|tutor"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "university professor"           "primary school teacher &amp; tutor"
## [3] "tutor"</code></pre>
<p><code>str_count()</code> devuelve un vector de números: el <strong>número de veces</strong> que aparece un término de búsqueda en cada valor evaluado.</p>
<div class="sourceCode" id="cb524"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_count</span><span class="op">(</span><span class="va">occupations</span>, <span class="fu"><a href="https://rdrr.io/r/base/regex.html">regex</a></span><span class="op">(</span><span class="st">"teach|prof|tutor"</span>, ignore_case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] 0 1 2 1 0 0 0 0 0 0</code></pre>
<!-- ======================================================= -->
</div>
<div id="grupos-regex" class="section level3 unnumbered">
<h3>Grupos Regex<a class="anchor" aria-label="anchor" href="#grupos-regex"><i class="fas fa-link"></i></a>
</h3>
<p>EN CONSTRUCCIÓN</p>
<!-- ======================================================= -->
</div>
</div>
<div id="special-characters" class="section level2" number="10.6">
<h2>
<span class="header-section-number">10.6</span> Caracteres especiales<a class="anchor" aria-label="anchor" href="#special-characters"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Barra invertida <code>\</code> como código de escape</strong></p>
<p>La barra invertida <code>\</code> se utiliza para “escapar” del significado del siguiente carácter. De este modo, se puede utilizar una barra invertida para que una comilla aparezca <em>dentro</em> de otras comillas (<code>\"</code>) - la comilla del medio no “romperá” las comillas circundantes.</p>
<p>Nota - por lo tanto, si quieres <em>mostrar una barra</em> invertida, debes escapar su significado con <em>otra</em> barra invertida. Así que debes escribir dos barras invertidas <code>\\</code> para mostrar una.</p>
<p><strong>Caracteres especiales</strong></p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="64%">
<col width="35%">
</colgroup>
<thead><tr class="header">
<th>Carácter especial</th>
<th>Representa</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>"\\"</code></td>
<td>barra invertida</td>
</tr>
<tr class="even">
<td><code>"\n"</code></td>
<td>una nueva línea</td>
</tr>
<tr class="odd">
<td><code>"\""</code></td>
<td>comillas dobles <em>dentro de</em> comillas dobles</td>
</tr>
<tr class="even">
<td><code>'\''</code></td>
<td>comillas simples <em>dentro de</em> comillas simples</td>
</tr>
<tr class="odd">
<td>
<code>"\</code>“<code>| acento grave</code>”<code>| retorno carro</code>“<code>| tab</code>”<code>| tab vertical</code>“`</td>
<td>retroceso</td>
</tr>
</tbody>
</table></div>
<p>Ejecuta <code><a href="https://rdrr.io/r/base/Quotes.html">?"'"</a></code> en la consola de R para mostrar una lista completa de estos caracteres especiales (aparecerá en el panel de ayuda de RStudio).</p>
<!-- ======================================================= -->
</div>
<div id="regular-expressions-regex" class="section level2" number="10.7">
<h2>
<span class="header-section-number">10.7</span> Expresiones regulares (regex)<a class="anchor" aria-label="anchor" href="#regular-expressions-regex"><i class="fas fa-link"></i></a>
</h2>
<!-- ======================================================= -->
</div>
<div id="regex-and-special-characters" class="section level2" number="10.8">
<h2>
<span class="header-section-number">10.8</span> Regex y caracteres especiales<a class="anchor" aria-label="anchor" href="#regex-and-special-characters"><i class="fas fa-link"></i></a>
</h2>
<p>Las expresiones regulares, o “regex”, son un lenguaje conciso para describir patrones en las cadenas. Si no está familiarizado con él, una expresión regular puede parecer un lenguaje extraño. Aquí tratamos de desmitificar un poco este lenguaje.</p>
<p><em>Gran parte de esta sección está adaptada de <a href="https://towardsdatascience.com/a-gentle-introduction-to-regular-expressions-with-r-df5e897ca432">este tutorial</a> y de <a href="https://evoldyn.gitlab.io/evomics-2018/ref-sheets/R_strings.pdf">esta hoja de trucos</a></em>. Aquí adaptamos selectivamente sabiendo que este manual podría ser visto por personas sin acceso a internet para ver los otros tutoriales.</p>
<p>Una expresión regular se aplica a menudo para extraer patrones específicos de texto “no estructurado”, por ejemplo, notas médicas, quejas principales, historial del paciente u otras columnas de texto libre en un dataframe.</p>
<p>Hay cuatro herramientas básicas que se pueden utilizar para crear una expresión regular básica:</p>
<ol style="list-style-type: decimal">
<li><p>Juegos de caracteres</p></li>
<li><p>Metacaracteres</p></li>
<li><p>Cuantificadores</p></li>
<li><p>Grupos</p></li>
</ol>
<p><strong>Juegos de caracteres</strong></p>
<p>Los conjuntos de caracteres, son una forma de expresar las opciones de la lista para una coincidencia de caracteres, entre paréntesis. Así, cualquier coincidencia se activará si cualquiera de los caracteres dentro de los paréntesis se encuentra en la cadena. Por ejemplo, para buscar vocales se podría utilizar este conjunto de caracteres “[aeiou]”. Otros conjuntos de caracteres comunes son:</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>Caracteres</th>
<th>Coinciden con</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>"[A-Z]"</code></td>
<td>una letra mayúscula</td>
</tr>
<tr class="even">
<td><code>"[a-z]"</code></td>
<td>una letra minúscula</td>
</tr>
<tr class="odd">
<td><code>"[0-9]"</code></td>
<td>un dígito</td>
</tr>
<tr class="even">
<td><code>[:alnum:]</code></td>
<td>un carácter alfanumérico</td>
</tr>
<tr class="odd">
<td><code>[:digit:]</code></td>
<td>un dígito numérico</td>
</tr>
<tr class="even">
<td><code>[:alpha:]</code></td>
<td>una letra (mayúscula o minúscula)</td>
</tr>
<tr class="odd">
<td><code>[:upper:]</code></td>
<td>una letra mayúscula</td>
</tr>
<tr class="even">
<td><code>[:lower:]</code></td>
<td>una letra minúscula</td>
</tr>
</tbody>
</table></div>
<p>Los conjuntos de caracteres pueden combinarse dentro de un paréntesis (¡sin espacios!), como <code>"[A-Za-z]"</code> (cualquier letra mayúscula o minúscula), u otro ejemplo <code>"[t-z0-5]"</code> (de la t a la z en minúscula o del número 0 al 5).</p>
<p><strong>Meta caracteres</strong></p>
<p>Los metacaracteres son la abreviatura de los juegos de caracteres. A continuación se enumeran algunos de los más importantes:</p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="22%">
<col width="77%">
</colgroup>
<thead><tr class="header">
<th>Meta carácter</th>
<th>Coincide con</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>"\\s"</code></td>
<td>un solo espacio</td>
</tr>
<tr class="even">
<td><code>"\\w"</code></td>
<td>cualquier carácter alfanumérico (A-Z, a-z, o 0-9)</td>
</tr>
<tr class="odd">
<td><code>"\\d"</code></td>
<td>cualquier dígito numérico (0-9)</td>
</tr>
</tbody>
</table></div>
<p><strong>Cuantificadores</strong></p>
<p>Normalmente no se desea buscar una coincidencia en un solo carácter. Los cuantificadores le permiten designar la longitud de las letras/números para permitir la coincidencia.</p>
<p>Los cuantificadores son números escritos entre corchetes <code>{ }</code> <em>después</em> del carácter que cuantifican, por ejemplo,</p>
<ul>
<li><p><code>"A{2}"</code> devolverá instancias de <strong>dos</strong> letras A mayúsculas.</p></li>
<li><p><code>"A{2,4}"</code> devolverá instancias de <strong>entre dos y cuatro</strong> letras A mayúsculas <em>(¡no ponga espacios!)</em>.</p></li>
<li><p><code>"A{2,}"</code> devolverá instancias de <strong>dos o más</strong> letras A mayúsculas.</p></li>
<li><p><code>"A+"</code> devolverá instancias de <strong>una o más</strong> letras A mayúsculas (grupo extendido hasta que se encuentre un carácter diferente).</p></li>
<li><p>Preceder con un asterisco <code><a href="https://rdrr.io/r/base/Arithmetic.html">*</a></code> para devolver <strong>cero o más</strong> coincidencias (útil si no está seguro de que el patrón está presente)</p></li>
</ul>
<p>Utilizando el símbolo <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> como cuantificador, la coincidencia se producirá hasta que se encuentre un carácter diferente. Por ejemplo, esta expresión devolverá todas las <em>palabras</em> (caracteres alfa: <code>"[A-Za-z]+"</code></p>
<div class="sourceCode" id="cb526"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># test string for quantifiers</span>
<span class="va">test</span> <span class="op">&lt;-</span> <span class="st">"A-AA-AAA-AAAA"</span></code></pre></div>
<p>Cuando se utiliza un cuantificador de {2}, sólo se devuelven los pares de A consecutivos. Se identifican dos pares dentro de <code>AAAA</code>.</p>
<div class="sourceCode" id="cb527"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_extract_all</span><span class="op">(</span><span class="va">test</span>, <span class="st">"A{2}"</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] "AA" "AA" "AA" "AA"</code></pre>
<p>Cuando se utiliza un cuantificador de {2,4}, se devuelven grupos de A consecutivos de dos a cuatro.</p>
<div class="sourceCode" id="cb529"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_extract_all</span><span class="op">(</span><span class="va">test</span>, <span class="st">"A{2,4}"</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] "AA"   "AAA"  "AAAA"</code></pre>
<p>Con el cuantificador <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>, se devuelven grupos de <strong>uno o más</strong>:</p>
<div class="sourceCode" id="cb531"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_extract_all</span><span class="op">(</span><span class="va">test</span>, <span class="st">"A+"</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] "A"    "AA"   "AAA"  "AAAA"</code></pre>
<p><strong>Posición relativa</strong></p>
<p>Expresan los requisitos de lo que precede o sigue a un patrón. Por ejemplo, para extraer frases, “dos números que van seguidos de un punto” (<code>""</code>). (?&lt;=\.)\s(?=[A-Z])</p>
<div class="sourceCode" id="cb533"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_extract_all</span><span class="op">(</span><span class="va">test</span>, <span class="st">""</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
##  [1] "A" "-" "A" "A" "-" "A" "A" "A" "-" "A" "A" "A" "A"</code></pre>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>Definición posición</th>
<th>Coincide con</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>"(?&lt;=b)a"</code></td>
<td>“a” que <strong>está precedida</strong> con una “b”</td>
</tr>
<tr class="even">
<td><code>"(?&lt;!b)a"</code></td>
<td>“a” que <strong>NO está precedida</strong> con una “b”</td>
</tr>
<tr class="odd">
<td><code>"a(?=b)"</code></td>
<td>“a” que <strong>se sigue</strong> de una “b”</td>
</tr>
<tr class="even">
<td><code>"a(?!b)"</code></td>
<td>“a” que <strong>NO se sigue</strong> de una “b”</td>
</tr>
</tbody>
</table></div>
<p><strong>Grupos</strong></p>
<p>La captura de grupos en su expresión regular es una forma de tener una salida más organizada al momento de la extracción.</p>
<p><strong>Ejemplos de Regex</strong></p>
<p>A continuación se presenta un texto libre para los ejemplos. Intentaremos extraer información útil del mismo utilizando un término de búsqueda de expresión regular.</p>
<div class="sourceCode" id="cb535"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pt_note</span> <span class="op">&lt;-</span> <span class="st">"El paciente llegó a la sala de urgencias del Broward Hospital a las 18:00 horas del 6/12/2005. Se presentó con dolor abdominal irradiado desde el cuadrante LR. La piel estaba pálida, fría y húmeda. Su temperatura era de 99,8 grados Farinheit. El pulso era de 100 lpm y filiforme. La frecuencia respiratoria era de 29 por minuto"</span></code></pre></div>
<p>Esta expresión coincide con todas las palabras (cualquier carácter hasta llegar a un no carácter como un espacio):</p>
<div class="sourceCode" id="cb536"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_extract_all</span><span class="op">(</span><span class="va">pt_note</span>, <span class="st">"[A-Za-z]+"</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
##  [1] "El"           "paciente"     "lleg"         "a"           
##  [5] "la"           "sala"         "de"           "urgencias"   
##  [9] "del"          "Broward"      "Hospital"     "a"           
## [13] "las"          "horas"        "del"          "Se"          
## [17] "present"      "con"          "dolor"        "abdominal"   
## [21] "irradiado"    "desde"        "el"           "cuadrante"   
## [25] "LR"           "La"           "piel"         "estaba"      
## [29] "p"            "lida"         "fr"           "a"           
## [33] "y"            "h"            "meda"         "Su"          
## [37] "temperatura"  "era"          "de"           "grados"      
## [41] "Farinheit"    "El"           "pulso"        "era"         
## [45] "de"           "lpm"          "y"            "filiforme"   
## [49] "La"           "frecuencia"   "respiratoria" "era"         
## [53] "de"           "por"          "minuto"</code></pre>
<p>La expresión <code>"[0-9]{1,2}"</code> coincide con números consecutivos de 1 o 2 dígitos. También podría escribirse <code>"\\d{1,2}"</code>, o <code>"[:digit:]{1,2}"</code>.</p>
<div class="sourceCode" id="cb538"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">str_extract_all</span><span class="op">(</span><span class="va">pt_note</span>, <span class="st">"[0-9]{1,2}"</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
##  [1] "18" "00" "6"  "12" "20" "05" "99" "8"  "10" "0"  "29"</code></pre>
<!-- This expression will extract all sentences (assuming first letter is capitalized, and the sentence ends with a period). The pattern reads in English as: "A capital letter followed by some lowercase letters, a space, some letters, a space,     -->
<!-- ```{r} -->
<!-- str_extract_all(pt_note, "[A-Z][a-z]+\\s\\w+\\s\\d{1,2}\\s\\w+\\s*\\w*") -->
<!-- ``` -->
<p>Puedes ver una lista útil de expresiones regex y consejos en la página 2 de <a href="https://evoldyn.gitlab.io/evomics-2018/ref-sheets/R_strings.pdf">esta hoja de trucos</a></p>
<p>Mira también este <a href="https://towardsdatascience.com/a-gentle-introduction-to-regular-expressions-with-r-df5e897ca432">tutorial</a>.</p>
<!-- ======================================================= -->
</div>
<div id="resources-3" class="section level2" number="10.9">
<h2>
<span class="header-section-number">10.9</span> Recursos<a class="anchor" aria-label="anchor" href="#resources-3"><i class="fas fa-link"></i></a>
</h2>
<p>Puedes encontrar una hoja de referencia para las funciones de <strong>stringr</strong> <a href="https://evoldyn.gitlab.io/evomics-2018/ref-sheets/R_strings.pdf">aquí</a></p>
<p>Puedes encontrar una viñeta sobre <strong>stringr</strong> <a href="https://cran.r-project.org/web/packages/stringr/vignettes/stringr.html">aquí</a></p>

<p>Factores {#factors}</p>
<div class="inline-figure"><img src="images/Factors_1500x500.png" width="100%"></div>
<p>En R, los <em>factores</em> son un tipo de datos que permiten categorías ordenadas con un conjunto fijo de valores.</p>
<p>Normalmente, se convierte una columna de tipo numérico o de caracteres en un factor si se desea establecer un orden intrínseco a los valores (“<em>niveles”</em>) para que puedan mostrarse de forma no alfabética en gráficos y tablas. Otro uso común de los factores es normalizar las leyendas de los gráficos para que no fluctúen si ciertos valores están temporalmente faltantes de datos.</p>
<p>En esta página se muestra el uso de las funciones del paquete <strong>forcats</strong> (nombre abreviado de “<strong>For</strong> <strong>cat</strong>egorical variables”) y algunas funciones de R <strong>base</strong>. También se aborda el uso de <strong>lubridate</strong> y <strong>aweek</strong> para casos de factores especiales relacionados con semanas epidemiológicas.</p>
<p>Puedes encontrar una lista completa de las funciones de <strong>forcats</strong> en línea <a href="https://forcats.tidyverse.org/reference/index.html">aquí</a>. A continuación mostramos algunas de las más comunes.</p>
<!-- ======================================================= -->
</div>
<div id="preparation-2" class="section level2" number="10.10">
<h2>
<span class="header-section-number">10.10</span> Preparación<a class="anchor" aria-label="anchor" href="#preparation-2"><i class="fas fa-link"></i></a>
</h2>
<div id="cargar-paquetes-2" class="section level3 unnumbered">
<h3>Cargar paquetes<a class="anchor" aria-label="anchor" href="#cargar-paquetes-2"><i class="fas fa-link"></i></a>
</h3>
<p>Este trozo de código muestra la carga de los paquetes necesarios para el análisis. En este manual destacamos <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> de <strong>pacman</strong>, que instala el paquete si es necesario <em>y</em> lo carga para su uso. También puede cargar los paquetes instalados con <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> de R <strong>base</strong>. Consulta la página sobre <a href="r-basics.html#r-basics">Fundamentos de R</a> para obtener más información sobre los paquetes de R.</p>
<div class="sourceCode" id="cb540"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
  <span class="va">rio</span>,           <span class="co"># import/export</span>
  <span class="va">here</span>,          <span class="co"># filepaths</span>
  <span class="va">lubridate</span>,     <span class="co"># working with dates</span>
  <span class="va">forcats</span>,       <span class="co"># factors</span>
  <span class="va">aweek</span>,         <span class="co"># create epiweeks with automatic factor levels</span>
  <span class="va">janitor</span>,       <span class="co"># tables</span>
  <span class="va">tidyverse</span>      <span class="co"># data mgmt and viz</span>
  <span class="op">)</span></code></pre></div>
</div>
<div id="importar-datos-2" class="section level3 unnumbered">
<h3>Importar datos<a class="anchor" aria-label="anchor" href="#importar-datos-2"><i class="fas fa-link"></i></a>
</h3>
<p>Importamos los datos de casos de una epidemia de ébola simulada. Si quieres seguir el proceso, <a href="https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/case_linelists/linelist_cleaned.rds">clica para descargar linelist “limpio”</a> (como archivo .rds). Importa sus datos con la función <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> del paquete <strong>rio</strong> (acepta muchos tipos de archivos como .xlsx, .rds, .csv - Mira la página de <a href="import-and-export.html#import-and-export">importación y exportación</a> para más detalles).</p>
<div class="sourceCode" id="cb541"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># import your dataset</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.rds"</span><span class="op">)</span></code></pre></div>
</div>
<div id="fct_newcat" class="section level3 unnumbered">
<h3>Nueva variable categórica<a class="anchor" aria-label="anchor" href="#fct_newcat"><i class="fas fa-link"></i></a>
</h3>
<p>Para mostrarlo en esta página utilizaremos un escenario común - la creación de una nueva variable categórica.</p>
<p>Ten en cuenta que si conviertes una columna numérica en una de tipo factor, no podrás calcular estadísticas numéricas sobre ella.</p>
<div id="crear-columna" class="section level4 unnumbered">
<h4>Crear columna<a class="anchor" aria-label="anchor" href="#crear-columna"><i class="fas fa-link"></i></a>
</h4>
<p>Utilizamos la columna existente <code>days_onset_hosp</code> (días desde el inicio de los síntomas hasta el ingreso en el hospital) y creamos una nueva columna <code>delay_cat</code> clasificando cada fila en una de varias categorías. Lo hacemos con la función <strong>dplyr</strong> <code>case_when()</code>, que aplica secuencialmente criterios lógicos (lado derecho) a cada fila y devuelve el valor correspondiente del lado izquierdo para la nueva columna <code>delay_cat</code>. Puedes leer más sobre <code>case_when()</code> en <a href="cleaning-data-and-core-functions.html#cleaning-data-and-core-functions">Limpieza de datos y funciones básicas</a>.</p>
<div class="sourceCode" id="cb542"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>delay_cat <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span>
    <span class="co"># criteria                                   # new value if TRUE</span>
    <span class="va">days_onset_hosp</span> <span class="op">&lt;</span> <span class="fl">2</span>                        <span class="op">~</span> <span class="st">"&lt;2 days"</span>,
    <span class="va">days_onset_hosp</span> <span class="op">&gt;=</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="va">days_onset_hosp</span> <span class="op">&lt;</span> <span class="fl">5</span> <span class="op">~</span> <span class="st">"2-5 days"</span>,
    <span class="va">days_onset_hosp</span> <span class="op">&gt;=</span> <span class="fl">5</span>                       <span class="op">~</span> <span class="st">"&gt;5 days"</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">days_onset_hosp</span><span class="op">)</span>                     <span class="op">~</span> <span class="cn">NA_character_</span>,
    <span class="cn">TRUE</span>                                       <span class="op">~</span> <span class="st">"Check me"</span><span class="op">)</span><span class="op">)</span>  </code></pre></div>
</div>
<div id="orden-de-valores-por-defecto" class="section level4 unnumbered">
<h4>Orden de valores por defecto<a class="anchor" aria-label="anchor" href="#orden-de-valores-por-defecto"><i class="fas fa-link"></i></a>
</h4>
<p>Tal y como se creó con <code>case_when()</code>, la nueva columna <code>delay_cat</code> es una columna categórica de tipo Character - aún <em>no</em> es un factor. Así, en una tabla de frecuencias, vemos que los valores únicos aparecen en un orden alfanumérico por defecto - un orden que no tiene mucho sentido intuitivo:</p>
<div class="sourceCode" id="cb543"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">delay_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##  &lt;2 days  &gt;5 days 2-5 days     &lt;NA&gt; 
##     2990      602     2040      256</code></pre>
<p>Del mismo modo, si hacemos un gráfico de barras, los valores también aparecen en este orden en el eje x (ver la página de <a href="ggplot-basics.html#ggplot-basics">conceptos básicos de ggplot</a> para más información sobre <strong>ggplot2</strong> - el paquete de visualización más común en R).</p>
<div class="sourceCode" id="cb545"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">delay_cat</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-376-1.png" width="672"></div>
</div>
</div>
</div>
<div id="convert-to-factor" class="section level2" number="10.11">
<h2>
<span class="header-section-number">10.11</span> Convertir en factor<a class="anchor" aria-label="anchor" href="#convert-to-factor"><i class="fas fa-link"></i></a>
</h2>
<p>Para convertir una columna numérica o de caracteres en una de <em>tipo factor</em>, puedes utilizar cualquier función del paquete <strong>forcats</strong> (muchas se detallan <a href="characters-and-strings.html#fct_adjust">a continuación</a>). Las convertirán en otra de tipo factor y luego también realizarán o permitirán cierto ordenamiento de los niveles - por ejemplo usando <code>fct_relevel()</code> permite especificar manualmente el orden de los niveles. La función <code>as_factor()</code> simplemente convierte el tipo sin ninguna otra capacidad.</p>
<p>La función <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code> de R <strong>base</strong> convierte una columna en factor y permite especificar manualmente el orden de los niveles, como un vector de caracteres a su argumento <code>levels =</code>.</p>
<p>A continuación utilizamos <code>mutate()</code> y <code>fct_relevel()</code> para convertir la columna delay_cat de tipo carácter a tipo factor. La columna <code>delay_cat</code> se crea en la sección de <a href="characters-and-strings.html#fct_newcat">preparación</a> anterior.</p>
<div class="sourceCode" id="cb546"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>delay_cat <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">delay_cat</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><em>Los “valores” únicos de esta columna se consideran ahora “niveles” del factor.</em> Los niveles tienen un <em>orden</em>, que puede imprimirse con la función de <code><a href="https://rdrr.io/r/base/levels.html">levels()</a></code>, o alternativamente verse en una tabla de recuento mediante <code><a href="https://rdrr.io/r/base/table.html">table()</a></code> de R <strong>base</strong> o <code>tabyl()</code> de <strong>janitor</strong>. Por defecto, el orden de los niveles será alfanumérico, como antes. Ten en cuenta que <code>NA</code> no es un nivel de factor.</p>
<div class="sourceCode" id="cb547"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">delay_cat</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "&lt;2 days"  "&gt;5 days"  "2-5 days"</code></pre>
<p>La función <code>fct_relevel()</code> tiene la utilidad adicional de permitir especificar manualmente el orden de los niveles. Simplemente escribe los valores de nivel en orden, entre comillas, separados por comas, como se muestra a continuación. Ten en cuenta que la ortografía debe coincidir exactamente con los valores. Si deseas crear niveles que no existen en los datos, utiliza <a href="characters-and-strings.html#fct_add">fct_expand() en su lugar</a>).</p>
<div class="sourceCode" id="cb549"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>delay_cat <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">delay_cat</span>, <span class="st">"&lt;2 days"</span>, <span class="st">"2-5 days"</span>, <span class="st">"&gt;5 days"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Ahora podemos ver que los niveles están ordenados, como se especificó en el comando anterior, en un orden sensato.</p>
<div class="sourceCode" id="cb550"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">delay_cat</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "&lt;2 days"  "2-5 days" "&gt;5 days"</code></pre>
<p>Ahora el orden de la gráfica también tiene un sentido más intuitivo.</p>
<div class="sourceCode" id="cb552"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">delay_cat</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-381-1.png" width="672"></div>
</div>
<div id="add-or-drop-levels" class="section level2" number="10.12">
<h2>
<span class="header-section-number">10.12</span> Añadir o quitar niveles<a class="anchor" aria-label="anchor" href="#add-or-drop-levels"><i class="fas fa-link"></i></a>
</h2>
<div id="fct_add" class="section level3 unnumbered">
<h3>Añadir<a class="anchor" aria-label="anchor" href="#fct_add"><i class="fas fa-link"></i></a>
</h3>
<p>Si necesitas añadir niveles a un factor, puedes hacerlo con <code>fct_expand()</code>. Basta con escribir el nombre de la columna seguido de los nuevos niveles (separados por comas). Al tabular los valores, podemos ver los nuevos niveles y los recuentos de cero. Puedes utilizar <code><a href="https://rdrr.io/r/base/table.html">table()</a></code> de R <strong>base</strong>, o <code>tabyl()</code> de <strong>janitor</strong>:</p>
<div class="sourceCode" id="cb553"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>delay_cat <span class="op">=</span> <span class="fu">fct_expand</span><span class="op">(</span><span class="va">delay_cat</span>, <span class="st">"Not admitted to hospital"</span>, <span class="st">"Transfer to other jurisdiction"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tabyl</span><span class="op">(</span><span class="va">delay_cat</span><span class="op">)</span>   <span class="co"># print table</span></code></pre></div>
<pre><code>##                       delay_cat    n    percent valid_percent
##                         &lt;2 days 2990 0.50781250     0.5308949
##                        2-5 days 2040 0.34646739     0.3622159
##                         &gt;5 days  602 0.10224185     0.1068892
##        Not admitted to hospital    0 0.00000000     0.0000000
##  Transfer to other jurisdiction    0 0.00000000     0.0000000
##                            &lt;NA&gt;  256 0.04347826            NA</code></pre>
<p>Nota: existe una función especial de <strong>forcats</strong> para añadir fácilmente valores faltantes (<code>NA</code>) como nivel. Véase la sección sobre <a href="characters-and-strings.html#fct_missing">valores faltantes</a> más adelante.</p>
</div>
<div id="quitar" class="section level3 unnumbered">
<h3>Quitar<a class="anchor" aria-label="anchor" href="#quitar"><i class="fas fa-link"></i></a>
</h3>
<p>Si utilizas <code>fct_drop()</code>, los niveles “no utilizados” con recuento cero se eliminarán del conjunto de niveles. Los niveles que hemos añadido anteriormente (“No admitido en un hospital”) existen como nivel, pero ninguna fila tiene realmente esos valores. Por tanto, se eliminarán aplicando <code>fct_drop()</code> a nuestra columna de factores:</p>
<div class="sourceCode" id="cb555"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>delay_cat <span class="op">=</span> <span class="fu">fct_drop</span><span class="op">(</span><span class="va">delay_cat</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tabyl</span><span class="op">(</span><span class="va">delay_cat</span><span class="op">)</span></code></pre></div>
<pre><code>##  delay_cat    n    percent valid_percent
##    &lt;2 days 2990 0.50781250     0.5308949
##   2-5 days 2040 0.34646739     0.3622159
##    &gt;5 days  602 0.10224185     0.1068892
##       &lt;NA&gt;  256 0.04347826            NA</code></pre>
</div>
</div>
<div id="fct_adjust" class="section level2" number="10.13">
<h2>
<span class="header-section-number">10.13</span> Ajustar el orden de los niveles<a class="anchor" aria-label="anchor" href="#fct_adjust"><i class="fas fa-link"></i></a>
</h2>
<p>El paquete <strong>forcats</strong> ofrece funciones útiles para ajustar fácilmente el orden de los niveles de un factor (después de haber definido una columna como de tipo factor):</p>
<p>Estas funciones pueden aplicarse a una columna de factores en dos contextos:</p>
<ol style="list-style-type: decimal">
<li>A la columna del dataframe, como es habitual, para que la transformación esté disponible para cualquier uso posterior de los datos</li>
<li>
<em>Dentro de un gráfico</em>, para que el cambio se aplique sólo dentro del gráfico</li>
</ol>
<div id="manualmente-1" class="section level3 unnumbered">
<h3>Manualmente<a class="anchor" aria-label="anchor" href="#manualmente-1"><i class="fas fa-link"></i></a>
</h3>
<p>Esta función se utiliza para ordenar manualmente los niveles de los factores. Si se utiliza en una columna no factorial, la columna se convertirá primero en de tipo factor.</p>
<p>Dentro del paréntesis, indica primero el nombre de la columna del factor y, a continuación, escribe</p>
<ul>
<li>Todos los niveles en el orden deseado (como un vector de caracteres <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>), o</li>
<li>Un nivel y se corrige la colocación utilizando el argumento <code>after =</code>
</li>
</ul>
<p>He aquí un ejemplo de redefinición de la columna <code>delay_cat</code> (que ya es de tipo Factor) y especificando todo el orden de niveles deseado.</p>
<div class="sourceCode" id="cb557"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># re-define level order</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>delay_cat <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">delay_cat</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;2 days"</span>, <span class="st">"2-5 days"</span>, <span class="st">"&gt;5 days"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Si sólo quieres mover un nivel, puedes especificarlo sólo en <code>fct_relevel()</code> y dar un número al argumento <code>after =</code>para indicar en qué lugar del orden debe estar. Por ejemplo, el comando siguiente desplaza “&lt;2 días” a la segunda posición:</p>
<div class="sourceCode" id="cb558"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># re-define level order</span>
<span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>delay_cat <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">delay_cat</span>, <span class="st">"&lt;2 days"</span>, after <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tabyl</span><span class="op">(</span><span class="va">delay_cat</span><span class="op">)</span></code></pre></div>
</div>
<div id="dentro-de-un-gráfico" class="section level3 unnumbered">
<h3>Dentro de un gráfico<a class="anchor" aria-label="anchor" href="#dentro-de-un-gr%C3%A1fico"><i class="fas fa-link"></i></a>
</h3>
<p>Los comandos <strong>forcats</strong> pueden utilizarse para establecer el orden de los niveles en el dataframe, o sólo dentro de un gráfico. Al utilizar el comando para “envolver” el nombre de la columna <em>dentro</em> del comando <code>ggplot()</code>, puedes invertir/nivelar/etc. la transformación sólo se aplicará dentro de ese gráfico.</p>
<p>A continuación, se crean dos gráficos con <code>ggplot()</code> (véase la página de <a href="ggplot-basics.html#ggplot-basics">conceptos básicos de ggplot</a>). En el primero, la columna delay_cat se asigna al eje x del gráfico, con su orden de nivel por defecto como en linelist de datos. En el segundo ejemplo se envuelve dentro de <code>fct_relevel()</code> y se cambia el orden en el gráfico.</p>
<div class="sourceCode" id="cb559"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Alpha-numeric default order - no adjustment within ggplot</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>
    <span class="fu">geom_bar</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">delay_cat</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Factor level order adjusted within ggplot</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">delay_cat</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;2 days"</span>, <span class="st">"2-5 days"</span>, <span class="st">"&gt;5 days"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-387-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-387-2.png" width="50%"></p>
<p>Ten en cuenta que el título del eje x por defecto es ahora bastante complicado - puedes sobrescribir este título con el argumento de <strong>ggplot2</strong> <code>labs()</code>.</p>
</div>
<div id="invertir" class="section level3 unnumbered">
<h3>Invertir<a class="anchor" aria-label="anchor" href="#invertir"><i class="fas fa-link"></i></a>
</h3>
<p>Es bastante común que se quiera invertir el orden de los niveles. Basta con envolver el factor con <code>fct_rev()</code>.</p>
<p>Ten en cuenta que si deseas revertir <em>sólo</em> una leyenda del gráfico pero no los niveles reales del factor, puedes hacerlo con <code>guides()</code> (ver <a href="ggplot-tips.html#ggplot-tips">consejos de ggplot</a>).</p>
</div>
<div id="por-frecuencia" class="section level3 unnumbered">
<h3>Por frecuencia<a class="anchor" aria-label="anchor" href="#por-frecuencia"><i class="fas fa-link"></i></a>
</h3>
<p>Para ordenar por la frecuencia con que el valor aparece en los datos, utiliza <code>fct_infreq()</code>. Cualquier valor que falte (<code>NA</code>) se incluirá automáticamente al final, a menos que se convierta en un nivel explícito (véase <a href="characters-and-strings.html#fct_missing">esta sección</a>). Puedes invertir el orden envolviendo más con <code>fct_rev()</code>.</p>
<p>Esta función puede utilizarse dentro de <code>ggplot()</code>, como se muestra a continuación.</p>
<div class="sourceCode" id="cb560"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># ordered by frequency</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_infreq</span><span class="op">(</span><span class="va">delay_cat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Delay onset to admission (days)"</span>,
       title <span class="op">=</span> <span class="st">"Ordered by frequency"</span><span class="op">)</span>

<span class="co"># reversed frequency</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="fu">fct_infreq</span><span class="op">(</span><span class="va">delay_cat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Delay onset to admission (days)"</span>,
       title <span class="op">=</span> <span class="st">"Reverse of order by frequency"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-388-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-388-2.png" width="50%"></p>
</div>
<div id="por-apariencia" class="section level3 unnumbered">
<h3>Por apariencia<a class="anchor" aria-label="anchor" href="#por-apariencia"><i class="fas fa-link"></i></a>
</h3>
<p>Utiliza <code>fct_inorder()</code> para establecer el orden de los niveles para que coincida con el orden de aparición en los datos, empezando por la primera fila. Esto puede ser útil si primero organizas cuidadosamente <code>arrange()</code> los datos en el dataframe, y luego utiliza esto para establecer el orden de los factores.</p>
</div>
<div id="por-estadística-resumida-de-otra-columna" class="section level3 unnumbered">
<h3>Por estadística resumida de otra columna<a class="anchor" aria-label="anchor" href="#por-estad%C3%ADstica-resumida-de-otra-columna"><i class="fas fa-link"></i></a>
</h3>
<p>Puedes utilizar <code>fct_reorder()</code> para ordenar los niveles de una columna <em>por una estadística de resumen de otra columna</em>. Visualmente, esto puede dar lugar a gráficos agradables en los que las barras/puntos ascienden o descienden de forma constante a través del gráfico.</p>
<p>En los ejemplos siguientes, el eje x es <code>delay_cat</code>, y el eje y es la columna numérica <code>ct_blood</code> (valor de umbral de ciclo). Los gráficos de caja muestran la distribución del valor CT por grupo <code>delay_cat</code>. Queremos ordenar los gráficos de caja en orden ascendente por mediana del grupo CT.</p>
<p>En el primer ejemplo de abajo, se utiliza el orden por defecto de los niveles alfa-numéricos. Se puede ver que las alturas de los gráficos de caja están mezcladas y no en ningún orden particular. En el segundo ejemplo, la columna <code>delay_cat</code> (asignada al eje x) se ha envuelto en <code>fct_reorder()</code>, la columna <code>ct_blood</code> se da como segundo argumento, y la “mediana” se da como tercer argumento (también podría usar “max”, “mean”, “min”, etc). Por lo tanto, el orden de los niveles de <code>delay_cat</code> reflejará ahora los valores ascendentes de la mediana del CT de cada grupo de <code>delay_cat</code>. Esto se refleja en el segundo gráfico: los gráficos de caja se han reordenado de forma ascendente. Observa cómo <code>NA</code> (missing) aparecerá al final, a menos que se convierta en un nivel explícito.</p>
<div class="sourceCode" id="cb561"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># boxplots ordered by original factor levels</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_boxplot</span><span class="op">(</span>
    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">delay_cat</span>,
        y <span class="op">=</span> <span class="va">ct_blood</span>, 
        fill <span class="op">=</span> <span class="va">delay_cat</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Delay onset to admission (days)"</span>,
       title <span class="op">=</span> <span class="st">"Ordered by original alpha-numeric levels"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>


<span class="co"># boxplots ordered by median CT value</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_boxplot</span><span class="op">(</span>
    <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_reorder</span><span class="op">(</span><span class="va">delay_cat</span>, <span class="va">ct_blood</span>, <span class="st">"median"</span><span class="op">)</span>,
        y <span class="op">=</span> <span class="va">ct_blood</span>,
        fill <span class="op">=</span> <span class="va">delay_cat</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Delay onset to admission (days)"</span>,
       title <span class="op">=</span> <span class="st">"Ordered by median CT value in group"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-389-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-389-2.png" width="50%"></p>
<p>Observa que en este ejemplo no se requieren pasos previos a la llamada a <code>ggplot()</code> - la agrupación y los cálculos se realizan internamente en el comando ggplot.</p>
</div>
<div id="por-valor-final" class="section level3 unnumbered">
<h3>Por valor “final”<a class="anchor" aria-label="anchor" href="#por-valor-final"><i class="fas fa-link"></i></a>
</h3>
<p>Utiliza <code>fct_reorder2()</code> para los gráficos de líneas agrupadas. Ordena los niveles (y, por tanto, la <em>leyenda</em>) para que se alineen con la ordenación vertical de las líneas en el “final” del gráfico. Técnicamente hablando, “ordena por los valores-y asociados a los valores-x más grandes”.</p>
<p>Por ejemplo, si tienes líneas que muestran los recuentos de casos por hospital a lo largo del tiempo, puedes aplicar <code>fct_reorder2()</code> al argumento <code>color =</code>dentro de <code>aes()</code>, de forma que el orden vertical de los hospitales que aparecen en la leyenda se alinee con el orden de las líneas en el extremo terminal del gráfico. Lee más en la <a href="https://forcats.tidyverse.org/reference/fct_reorder.html">documentación en línea</a>.</p>
<div class="sourceCode" id="cb562"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">epidemic_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>         <span class="co"># begin with the linelist   </span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">date_onset</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2014-09-21"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>    <span class="co"># cut-off date, for visual clarity</span>
    <span class="fu">count</span><span class="op">(</span>                                            <span class="co"># get case counts per week and by hospital</span>
      epiweek <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>, <span class="st">"week"</span><span class="op">)</span>,  
      <span class="va">hospital</span>                                            
    <span class="op">)</span> 
  
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">epidemic_data</span><span class="op">)</span><span class="op">+</span>                       <span class="co"># start plot</span>
  <span class="fu">geom_line</span><span class="op">(</span>                                        <span class="co"># make lines</span>
    <span class="fu">aes</span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">epiweek</span>,                                  <span class="co"># x-axis epiweek</span>
      y <span class="op">=</span> <span class="va">n</span>,                                        <span class="co"># height is number of cases per week</span>
      color <span class="op">=</span> <span class="fu">fct_reorder2</span><span class="op">(</span><span class="va">hospital</span>, <span class="va">epiweek</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># data grouped and colored by hospital, with factor order by height at end of plot</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Factor levels (and legend display) by line height at end of plot"</span>,
       color <span class="op">=</span> <span class="st">"Hospital"</span><span class="op">)</span>                          <span class="co"># change legend title</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-390-1.png" width="672"></div>
</div>
</div>
<div id="fct_missing" class="section level2" number="10.14">
<h2>
<span class="header-section-number">10.14</span> Valores faltantes<a class="anchor" aria-label="anchor" href="#fct_missing"><i class="fas fa-link"></i></a>
</h2>
<p>Si hay valores <code>NA</code> en lu columna de factores, puede convertirlos fácilmente a un nivel con nombre como “Missing” con <code>fct_explicit_na()</code>. Los valores <code>NA</code> se convierten por defecto en “(Missing)” al final del orden de los niveles. Puedes ajustar el nombre del nivel con el argumento <code>na_level =</code>.</p>
<p>A continuación, esta operación se realiza en la columna <code>delay_cat</code> y se imprime una tabla con <code>tabyl()</code> con <code>NA</code> convertido en “Missing delay”.</p>
<div class="sourceCode" id="cb563"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>delay_cat <span class="op">=</span> <span class="fu">fct_explicit_na</span><span class="op">(</span><span class="va">delay_cat</span>, na_level <span class="op">=</span> <span class="st">"Missing delay"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tabyl</span><span class="op">(</span><span class="va">delay_cat</span><span class="op">)</span></code></pre></div>
<pre><code>##      delay_cat    n    percent
##       2-5 days 2040 0.34646739
##        &lt;2 days 2990 0.50781250
##        &gt;5 days  602 0.10224185
##  Missing delay  256 0.04347826</code></pre>
</div>
<div id="combine-levels" class="section level2" number="10.15">
<h2>
<span class="header-section-number">10.15</span> Combinar niveles<a class="anchor" aria-label="anchor" href="#combine-levels"><i class="fas fa-link"></i></a>
</h2>
<div id="manualmente-2" class="section level3 unnumbered">
<h3>Manualmente<a class="anchor" aria-label="anchor" href="#manualmente-2"><i class="fas fa-link"></i></a>
</h3>
<p>Puedes ajustar las visualizaciones de los niveles manualmente con <code>fct_recode()</code>. Es como la función <code>recode()</code> de <strong>dplyr</strong> (véase <a href="cleaning-data-and-core-functions.html#cleaning-data-and-core-functions">Limpieza de datos y funciones básicas</a>), pero permite la creación de nuevos niveles de factores. Si utilizas la función simple <code>recode()</code> en un factor, los nuevos valores recodificados serán rechazados a menos que ya hayan sido establecidos como niveles permitidos.</p>
<p>Esta herramienta también puede utilizarse para “combinar” niveles, asignando a varios niveles el mismo valor recodificado. Sólo hay que tener cuidado de no perder información. Considere la posibilidad de realizar estos pasos de combinación en una nueva columna (sin sobreescribir la columna existente).</p>
<p><code>fct_recode()</code> tiene una sintaxis diferente a la de <code>recode()</code>. <code>recode()</code> utiliza <code>OLD = NEW</code>, mientras que <code>fct_recode()</code> utiliza <code>NEW = OLD</code>.</p>
<p>Los niveles actuales de <code>delay_cat</code> son:</p>
<div class="sourceCode" id="cb565"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">delay_cat</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "&lt;2 days"  "2-5 days" "&gt;5 days"</code></pre>
<p>Los nuevos niveles se crean utilizando la sintaxis <code>fct_recode(column, "new" = "old", "new" = "old", "new" = "old")</code> y se imprimen:</p>
<div class="sourceCode" id="cb567"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>delay_cat <span class="op">=</span> <span class="fu">fct_recode</span><span class="op">(</span>
    <span class="va">delay_cat</span>,
    <span class="st">"Less than 2 days"</span> <span class="op">=</span> <span class="st">"&lt;2 days"</span>,
    <span class="st">"2 to 5 days"</span>      <span class="op">=</span> <span class="st">"2-5 days"</span>,
    <span class="st">"More than 5 days"</span> <span class="op">=</span> <span class="st">"&gt;5 days"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tabyl</span><span class="op">(</span><span class="va">delay_cat</span><span class="op">)</span></code></pre></div>
<pre><code>##         delay_cat    n    percent valid_percent
##  Less than 2 days 2990 0.50781250     0.5308949
##       2 to 5 days 2040 0.34646739     0.3622159
##  More than 5 days  602 0.10224185     0.1068892
##              &lt;NA&gt;  256 0.04347826            NA</code></pre>
<p>Aquí se combinan manualmente con <code>fct_recode()</code>. Obsérvese que no se produce ningún error en la creación de un nuevo nivel “Menos de 5 días”.</p>
<div class="sourceCode" id="cb569"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>delay_cat <span class="op">=</span> <span class="fu">fct_recode</span><span class="op">(</span>
    <span class="va">delay_cat</span>,
    <span class="st">"Less than 5 days"</span> <span class="op">=</span> <span class="st">"&lt;2 days"</span>,
    <span class="st">"Less than 5 days"</span> <span class="op">=</span> <span class="st">"2-5 days"</span>,
    <span class="st">"More than 5 days"</span> <span class="op">=</span> <span class="st">"&gt;5 days"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tabyl</span><span class="op">(</span><span class="va">delay_cat</span><span class="op">)</span></code></pre></div>
<pre><code>##         delay_cat    n    percent valid_percent
##  Less than 5 days 5030 0.85427989     0.8931108
##  More than 5 days  602 0.10224185     0.1068892
##              &lt;NA&gt;  256 0.04347826            NA</code></pre>
</div>
<div id="reducir-a-otros" class="section level3 unnumbered">
<h3>Reducir a “Otros”<a class="anchor" aria-label="anchor" href="#reducir-a-otros"><i class="fas fa-link"></i></a>
</h3>
<p>Puedes utilizar <code>fct_other()</code> para asignar manualmente niveles de factor a un nivel “Otro”. A continuación, todos los niveles de la columna <code>hospital</code>, aparte de “Port Hospital” y “Central Hospital”, se combinan en “Otros”. Puedes proporcionar el vector <code>keep =</code>, o <code>drop =</code> para mantener o eliminarlo. Puedes cambiar la visualización del nivel “Otro” con <code>other_level =</code>.</p>
<div class="sourceCode" id="cb571"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span>    
  <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">fct_other</span><span class="op">(</span>                      <span class="co"># adjust levels</span>
    <span class="va">hospital</span>,
    keep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Port Hospital"</span>, <span class="st">"Central Hospital"</span><span class="op">)</span>,  <span class="co"># keep these separate</span>
    other_level <span class="op">=</span> <span class="st">"Other Hospital"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>            <span class="co"># All others as "Other Hospital"</span>
  <span class="fu">tabyl</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span>                                   <span class="co"># print table</span></code></pre></div>
<pre><code>##          hospital    n    percent
##  Central Hospital  454 0.07710598
##     Port Hospital 1762 0.29925272
##    Other Hospital 3672 0.62364130</code></pre>
</div>
<div id="reducir-por-frecuencia" class="section level3 unnumbered">
<h3>Reducir por frecuencia<a class="anchor" aria-label="anchor" href="#reducir-por-frecuencia"><i class="fas fa-link"></i></a>
</h3>
<p>Puedes combinar los niveles del factor menos frecuente automáticamente utilizando <code>fct_lump()</code>.</p>
<p>Para “agrupar” muchos niveles de baja frecuencia en un grupo “Otros”, puedes hacer una de las siguientes cosas:</p>
<ul>
<li><p>Establecer con <code>n =</code> el número de grupos que deseas conservar. Los n niveles más frecuentes se mantendrán, y todos los demás se combinarán en “Otros”.</p></li>
<li><p>Fijar con <code>prop =</code> la proporción de frecuencia del umbral para los niveles por encima de los cuales deseas mantener. Todos los demás valores se combinarán en “Otros”.</p></li>
</ul>
<p>Puedes cambiar la visualización del nivel “Otros” con <code>other_level =</code>. A continuación, todos los hospitales excepto los dos más frecuentes se combinan en “Other hospitals”.</p>
<div class="sourceCode" id="cb573"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span>    
  <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">fct_lump</span><span class="op">(</span>                      <span class="co"># adjust levels</span>
    <span class="va">hospital</span>,
    n <span class="op">=</span> <span class="fl">2</span>,                                          <span class="co"># keep top 2 levels</span>
    other_level <span class="op">=</span> <span class="st">"Other Hospital"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>            <span class="co"># all others as "Other Hospital"</span>
  <span class="fu">tabyl</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span>                                   <span class="co"># print table</span></code></pre></div>
<pre><code>##        hospital    n   percent
##         Missing 1469 0.2494905
##   Port Hospital 1762 0.2992527
##  Other Hospital 2657 0.4512568</code></pre>
</div>
</div>
<div id="show-all-levels" class="section level2" number="10.16">
<h2>
<span class="header-section-number">10.16</span> Mostrar todos los niveles<a class="anchor" aria-label="anchor" href="#show-all-levels"><i class="fas fa-link"></i></a>
</h2>
<p>Una de las ventajas del uso de factores es la estandarización del aspecto de las leyendas de los gráficos y de las tablas, independientemente de los valores que estén realmente presentes en unos datos.</p>
<p>Si estás preparando muchas figuras (por ejemplo, para varias jurisdicciones), querrás que las leyendas y las tablas aparezcan de forma idéntica incluso con distintos niveles de cumplimentación o de composición de los datos.</p>
<div id="en-los-gráficos" class="section level3 unnumbered">
<h3>En los gráficos<a class="anchor" aria-label="anchor" href="#en-los-gr%C3%A1ficos"><i class="fas fa-link"></i></a>
</h3>
<p>En una figura <code>ggplot()</code>, basta con añadir el argumento <code>drop = FALSE</code> en la función <code>scale_xxxx()</code> correspondiente. Se mostrarán todos los niveles de los factores, independientemente de si están presentes en los datos. Si sus niveles de columna de factores se muestran con <code>fill =</code>, entonces en <code>scale_fill_discrete()</code> incluye <code>drop = FALSE,</code> como se muestra a continuación. Si sus niveles se muestran con <code>x =</code> (al eje-x) <code>color =</code> o <code>size =</code>, deberás establecer esto con <code>scale_color_discrete()</code> o <code>scale_size_discrete()</code> según corresponda.</p>
<p>Este ejemplo es un gráfico de barras apiladas de la categoría de edad, por hospital. Añadiendo <code>scale_fill_discrete(drop = FALSE)</code> se garantiza que todos los grupos de edad aparezcan en la leyenda, aunque no estén presentes en los datos.</p>
<div class="sourceCode" id="cb575"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">hospital</span>, fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_discrete</span><span class="op">(</span>drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span>                        <span class="co"># show all age groups in the legend, even those not present</span>
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"All age groups will appear in legend, even if not present in data"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-398-1.png" width="672"></div>
</div>
<div id="en-tablas" class="section level3 unnumbered">
<h3>En tablas<a class="anchor" aria-label="anchor" href="#en-tablas"><i class="fas fa-link"></i></a>
</h3>
<p>Tanto <code><a href="https://rdrr.io/r/base/table.html">table()</a></code> de R <strong>base</strong> como <code>tabyl()</code> de <strong>janitor</strong> mostrarán todos los niveles de los factores (incluso los no utilizados).</p>
<p>Si utilizas <code>count()</code> o <code>summarise()</code> de <strong>dplyr</strong> para hacer una tabla, añade el argumento <code>.drop = FALSE</code> para incluir los recuentos de todos los niveles del factor, incluso los no utilizados.</p>
<p>Puedes leer más en la página de <a href="descriptive-tables.html#descriptive-tables">tablas descriptivas</a>, o en la <a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">documentación de scale_discrete</a>, o en la <a href="https://dplyr.tidyverse.org/reference/count.html">documentación de <code>count()</code></a>. Puedes ver otro ejemplo en la página de <a href="contact-tracing-1.html#contact-tracing-1">rastreo de contactos</a>.</p>
</div>
</div>
<div id="epiweeks" class="section level2" number="10.17">
<h2>
<span class="header-section-number">10.17</span> Epiweeks<a class="anchor" aria-label="anchor" href="#epiweeks"><i class="fas fa-link"></i></a>
</h2>
<p>Por favor, consulta la extensa discusión sobre cómo crear semanas epidemiológicas en la página de <a href="grouping-data.html#grouping-data">Agrupar datos</a>. Consulta también la página <a href="working-with-dates.html#working-with-dates-1">Trabajar con fechas</a> para obtener consejos sobre cómo crear y dar formato a las semanas epidemiológicas.</p>
<div id="epiweeks-en-un-gráfico" class="section level3 unnumbered">
<h3>Epiweeks en un gráfico<a class="anchor" aria-label="anchor" href="#epiweeks-en-un-gr%C3%A1fico"><i class="fas fa-link"></i></a>
</h3>
<p>Si tu objetivo es crear epiweeks para mostrarlos en un gráfico, puedes hacerlo simplemente con <code>floor_date()</code> de <strong>lubridate</strong>, como se explica en la página de <a href="grouping-data.html#grouping-data">Agrupar datos</a>. Los valores devueltos serán del tipo Date con el formato YYYY-MM-DD. Si utilizas esta columna en un gráfico, las fechas se ordenarán correctamente de forma natural, y no tendrá que preocuparse de los niveles o de la conversión al tipo Factor. Mira el histograma <code>ggplot()</code> de las fechas de inicio más abajo.</p>
<p>En este enfoque, se puede ajustar la <em>visualización</em> de las fechas en un eje con <code>scale_x_date()</code>. Consulta la página sobre <a href="epidemic-curves.html#epidemic-curves">curvas epidémicas</a> para obtener más información. Puedes especificar un formato de visualización “strptime” al argumento <code>date_labels =</code> de <code>scale_x_date()</code>. Estos formatos utilizan marcadores de posición “%” y se tratan en la página <a href="working-with-dates.html#working-with-dates-1">Trabajar con fechas</a>. Utiliza “%Y” para representar un año de 4 dígitos, y “%W” o “%U” para representar el número de la semana (semana del lunes o del domingo respectivamente).</p>
<div class="sourceCode" id="cb576"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>epiweek_date <span class="op">=</span> <span class="fu">floor_date</span><span class="op">(</span><span class="va">date_onset</span>, <span class="st">"week"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># create week column</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                                  <span class="co"># begin ggplot</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">epiweek_date</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>           <span class="co"># histogram of date of onset</span>
  <span class="fu">scale_x_date</span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%Y-W%W"</span><span class="op">)</span>                       <span class="co"># adjust disply of dates to be YYYY-WWw</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-399-1.png" width="672"></div>
</div>
<div id="epiweeks-en-los-datos" class="section level3 unnumbered">
<h3>Epiweeks en los datos<a class="anchor" aria-label="anchor" href="#epiweeks-en-los-datos"><i class="fas fa-link"></i></a>
</h3>
<p>Sin embargo, si tu propósito al factorizar <em>no es</em> hacer gráficos, puedes enfocar esto de dos maneras:</p>
<ol style="list-style-type: decimal">
<li>
<em>Para un control preciso de la visualización</em>, convierte la columna de la semana-epi <strong>lubrificada</strong> (AAAA-MM-DD) al formato de visualización deseado (AAAA-WWw) <em>dentro del propio dataframe,</em> y luego conviértala en tipo Factor.</li>
</ol>
<p>En primer lugar, utiliza <code><a href="https://rdrr.io/r/base/format.html">format()</a></code> para convertir la visualización de la fecha de YYYY-MM-DD a YYYY-Www (consulta la página <a href="working-with-dates.html#working-with-dates-1">Trabajar con fechas</a>). En este proceso el tipo será convertida a carácter. A continuación, convierta de carácter a tipo Factor con <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code>.</p>
<div class="sourceCode" id="cb577"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>epiweek_date <span class="op">=</span> <span class="fu">floor_date</span><span class="op">(</span><span class="va">date_onset</span>, <span class="st">"week"</span><span class="op">)</span>,       <span class="co"># create epiweeks (YYYY-MM-DD)</span>
         epiweek_formatted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">epiweek_date</span>, <span class="st">"%Y-W%W"</span><span class="op">)</span>,  <span class="co"># Convert to display (YYYY-WWw)</span>
         epiweek_formatted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">epiweek_formatted</span><span class="op">)</span><span class="op">)</span>       <span class="co"># Convert to factor</span>

<span class="co"># Display levels</span>
<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">epiweek_formatted</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "2014-W13" "2014-W14" "2014-W15" "2014-W16" "2014-W17" "2014-W18"
##  [7] "2014-W19" "2014-W20" "2014-W21" "2014-W22" "2014-W23" "2014-W24"
## [13] "2014-W25" "2014-W26" "2014-W27" "2014-W28" "2014-W29" "2014-W30"
## [19] "2014-W31" "2014-W32" "2014-W33" "2014-W34" "2014-W35" "2014-W36"
## [25] "2014-W37" "2014-W38" "2014-W39" "2014-W40" "2014-W41" "2014-W42"
## [31] "2014-W43" "2014-W44" "2014-W45" "2014-W46" "2014-W47" "2014-W48"
## [37] "2014-W49" "2014-W50" "2014-W51" "2015-W00" "2015-W01" "2015-W02"
## [43] "2015-W03" "2015-W04" "2015-W05" "2015-W06" "2015-W07" "2015-W08"
## [49] "2015-W09" "2015-W10" "2015-W11" "2015-W12" "2015-W13" "2015-W14"
## [55] "2015-W15" "2015-W16"</code></pre>
<p><span style="color: red;"><strong><em>PELIGRO:</em></strong> Si colocas las semanas por delante de los años (“Www-YYY”) (“%W-%Y”), la ordenación por defecto del nivel alfanumérico será incorrecta (por ejemplo, 01-2015 estará antes que 35-2014). Podría ser necesario ajustar manualmente el orden, lo que sería un proceso largo y doloroso. </span></p>
<ol start="2" style="list-style-type: decimal">
<li>
<em>Para una visualización rápida por defecto</em>, utiliza el paquete <strong>aweek</strong> y su función <code>date2week()</code>. Puedes establecer el día de comienzo con <code>week_start =</code>, y si estableces <code>factor = TRUE</code> entonces la columna de salida es un factor ordenado. Como ventaja, el factor incluye niveles para <em>todas las</em> semanas posibles en el lapso - incluso si no hay casos esa semana.</li>
</ol>
<div class="sourceCode" id="cb579"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>epiweek <span class="op">=</span> <span class="fu">date2week</span><span class="op">(</span><span class="va">date_onset</span>, week_start <span class="op">=</span> <span class="st">"Monday"</span>, factor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">epiweek</span><span class="op">)</span></code></pre></div>
<p>Consulta la página <a href="working-with-dates.html#working-with-dates-1">Trabajar con fechas</a> para obtener más información sobre <strong>aweek</strong>. También ofrece la función inversa <code>week2date()</code>.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="resources-4" class="section level2" number="10.18">
<h2>
<span class="header-section-number">10.18</span> Recursos<a class="anchor" aria-label="anchor" href="#resources-4"><i class="fas fa-link"></i></a>
</h2>
<p>Página de R for Data Science en español sobre <a href="https://es.r4ds.hadley.nz/factores.html">factores</a>
<a href="https://cran.r-project.org/web/packages/aweek/vignettes/introduction.html">viñeta del paquete aweek</a></p>

<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="working-with-dates.html"><span class="header-section-number">9</span> Borrador. Trabajando con Fechas</a></div>
<div class="next"><a href="pivoting-data.html"><span class="header-section-number">11</span> Pivotar datos</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#characters-and-strings"><span class="header-section-number">10</span> Caracteres y cadenas</a></li>
<li>
<a class="nav-link" href="#preparation-1"><span class="header-section-number">10.1</span> Preparación</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#cargar-paquetes-1">Cargar paquetes</a></li>
<li><a class="nav-link" href="#importar-datos-1">Importar datos</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#unite-split-and-arrange"><span class="header-section-number">10.2</span> Unir, dividir y ordenar</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#combinar-cadenas">Combinar cadenas</a></li>
<li><a class="nav-link" href="#cadenas-din%C3%A1micas">Cadenas dinámicas</a></li>
<li><a class="nav-link" href="#str_unite">Unir columnas</a></li>
<li><a class="nav-link" href="#dividir">Dividir</a></li>
<li><a class="nav-link" href="#dividir-columnas">Dividir columnas</a></li>
<li><a class="nav-link" href="#ordenar-alfab%C3%A9ticamente">Ordenar alfabéticamente</a></li>
<li><a class="nav-link" href="#funciones-r-base">funciones R base</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#clean-and-standardise"><span class="header-section-number">10.3</span> Limpiar y normalizar</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#cambiar-may%C3%BAsculas">Cambiar mayúsculas</a></li>
<li><a class="nav-link" href="#str_pad">Longitud de la cadena</a></li>
<li><a class="nav-link" href="#truncar">Truncar</a></li>
<li><a class="nav-link" href="#normalizar-la-longitud">Normalizar la longitud</a></li>
<li><a class="nav-link" href="#eliminar-los-espacios-en-blanco-iniciales-y-finales">Eliminar los espacios en blanco iniciales y finales</a></li>
<li><a class="nav-link" href="#eliminar-los-espacios-en-blanco-repetidos-en-una-cadena">Eliminar los espacios en blanco repetidos en una cadena</a></li>
<li><a class="nav-link" href="#convertir-en-p%C3%A1rrafos">convertir en párrafos</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#handle-by-position"><span class="header-section-number">10.4</span> Manipular por posición</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#extraer-por-posici%C3%B3n-de-car%C3%A1cter">Extraer por posición de carácter</a></li>
<li><a class="nav-link" href="#extraer-por-posici%C3%B3n-de-palabra">Extraer por posición de palabra</a></li>
<li><a class="nav-link" href="#sustituir-por-posici%C3%B3n-de-car%C3%A1cter">Sustituir por posición de carácter</a></li>
<li><a class="nav-link" href="#evaluar-la-longitud">Evaluar la longitud</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#patterns"><span class="header-section-number">10.5</span> Patrones</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#detectar-un-patr%C3%B3n">Detectar un patrón</a></li>
<li><a class="nav-link" href="#sustituir-todo">Sustituir todo</a></li>
<li><a class="nav-link" href="#detectar-con-l%C3%B3gica">Detectar con lógica</a></li>
<li><a class="nav-link" href="#localizar-la-posici%C3%B3n-de-un-patr%C3%B3n">Localizar la posición de un patrón</a></li>
<li><a class="nav-link" href="#extraer-una-coincidencia">Extraer una coincidencia</a></li>
<li><a class="nav-link" href="#subconjunto-y-recuento">Subconjunto y recuento</a></li>
<li><a class="nav-link" href="#grupos-regex">Grupos Regex</a></li>
</ul>
</li>
<li><a class="nav-link" href="#special-characters"><span class="header-section-number">10.6</span> Caracteres especiales</a></li>
<li><a class="nav-link" href="#regular-expressions-regex"><span class="header-section-number">10.7</span> Expresiones regulares (regex)</a></li>
<li><a class="nav-link" href="#regex-and-special-characters"><span class="header-section-number">10.8</span> Regex y caracteres especiales</a></li>
<li><a class="nav-link" href="#resources-3"><span class="header-section-number">10.9</span> Recursos</a></li>
<li>
<a class="nav-link" href="#preparation-2"><span class="header-section-number">10.10</span> Preparación</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#cargar-paquetes-2">Cargar paquetes</a></li>
<li><a class="nav-link" href="#importar-datos-2">Importar datos</a></li>
<li><a class="nav-link" href="#fct_newcat">Nueva variable categórica</a></li>
</ul>
</li>
<li><a class="nav-link" href="#convert-to-factor"><span class="header-section-number">10.11</span> Convertir en factor</a></li>
<li>
<a class="nav-link" href="#add-or-drop-levels"><span class="header-section-number">10.12</span> Añadir o quitar niveles</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#fct_add">Añadir</a></li>
<li><a class="nav-link" href="#quitar">Quitar</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#fct_adjust"><span class="header-section-number">10.13</span> Ajustar el orden de los niveles</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#manualmente-1">Manualmente</a></li>
<li><a class="nav-link" href="#dentro-de-un-gr%C3%A1fico">Dentro de un gráfico</a></li>
<li><a class="nav-link" href="#invertir">Invertir</a></li>
<li><a class="nav-link" href="#por-frecuencia">Por frecuencia</a></li>
<li><a class="nav-link" href="#por-apariencia">Por apariencia</a></li>
<li><a class="nav-link" href="#por-estad%C3%ADstica-resumida-de-otra-columna">Por estadística resumida de otra columna</a></li>
<li><a class="nav-link" href="#por-valor-final">Por valor “final”</a></li>
</ul>
</li>
<li><a class="nav-link" href="#fct_missing"><span class="header-section-number">10.14</span> Valores faltantes</a></li>
<li>
<a class="nav-link" href="#combine-levels"><span class="header-section-number">10.15</span> Combinar niveles</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#manualmente-2">Manualmente</a></li>
<li><a class="nav-link" href="#reducir-a-otros">Reducir a “Otros”</a></li>
<li><a class="nav-link" href="#reducir-por-frecuencia">Reducir por frecuencia</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#show-all-levels"><span class="header-section-number">10.16</span> Mostrar todos los niveles</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#en-los-gr%C3%A1ficos">En los gráficos</a></li>
<li><a class="nav-link" href="#en-tablas">En tablas</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#epiweeks"><span class="header-section-number">10.17</span> Epiweeks</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#epiweeks-en-un-gr%C3%A1fico">Epiweeks en un gráfico</a></li>
<li><a class="nav-link" href="#epiweeks-en-los-datos">Epiweeks en los datos</a></li>
</ul>
</li>
<li><a class="nav-link" href="#resources-4"><span class="header-section-number">10.18</span> Recursos</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>El manual de R para Epi’s</strong>" was written by El equipo del manual. It was last built on 2022-10-18.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
