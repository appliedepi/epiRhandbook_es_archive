<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>8 Limpieza de datos y funciones básicas | El manual de R para la Epidemiología</title>
<meta name="author" content="El equipo del manual">
<meta name="description" content="Esta página muestra los pasos más utilizados en el proceso de “limpieza” de datos, y también explica el uso de muchas funciones esenciales de gestión de datos en R. Para explicarlo, esta página...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="8 Limpieza de datos y funciones básicas | El manual de R para la Epidemiología">
<meta property="og:type" content="book">
<meta property="og:description" content="Esta página muestra los pasos más utilizados en el proceso de “limpieza” de datos, y también explica el uso de muchas funciones esenciales de gestión de datos en R. Para explicarlo, esta página...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="8 Limpieza de datos y funciones básicas | El manual de R para la Epidemiología">
<meta name="twitter:description" content="Esta página muestra los pasos más utilizados en el proceso de “limpieza” de datos, y también explica el uso de muchas funciones esenciales de gestión de datos en R. Para explicarlo, esta página...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.20/datatables.js"></script><link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.7/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.0/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.5.1/plotly-basic-2.5.1.min.js"></script><script src="libs/plotly-cartesian-2.5.1/plotly-cartesian-2.5.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">El manual de R para la Epidemiología</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">Acerca de este libro</li>
<li><a class="" href="editorial-and-technical-notes.html"><span class="header-section-number">1</span> Notas editoriales y técnicas</a></li>
<li><a class="" href="download-handbook-and-data.html"><span class="header-section-number">2</span> Descargando el manual y los datos</a></li>
<li class="book-part">Aspectos básicos</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">3</span> Fundamentos de R</a></li>
<li><a class="" href="transition-to-r.html"><span class="header-section-number">4</span> Transición a R</a></li>
<li><a class="" href="suggested-packages-1.html"><span class="header-section-number">5</span> Paquetes recomendados</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> Proyectos en R</a></li>
<li><a class="" href="import-and-export.html"><span class="header-section-number">7</span> Importación y exportación</a></li>
<li class="book-part">Gestión de datos</li>
<li><a class="active" href="cleaning-data-and-core-functions.html"><span class="header-section-number">8</span> Limpieza de datos y funciones básicas</a></li>
<li><a class="" href="working-with-dates.html"><span class="header-section-number">9</span> Borrador. Trabajando con Fechas</a></li>
<li><a class="" href="characters-and-strings.html"><span class="header-section-number">10</span> Borrador. Caracteres y cadenas</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> Borrador. Factores</a></li>
<li><a class="" href="pivoting-data.html"><span class="header-section-number">12</span> Borrador. Pivotar datos</a></li>
<li><a class="" href="borrador.-agrupar-datos-grouping-data.html"><span class="header-section-number">13</span> Borrador. Agrupar datos {grouping-data}</a></li>
<li><a class="" href="joining-data.html"><span class="header-section-number">14</span> Borrador. Unir datos</a></li>
<li><a class="" href="de-duplication.html"><span class="header-section-number">15</span> Borrador. De-duplicación</a></li>
<li><a class="" href="iteration-loops-and-lists.html"><span class="header-section-number">16</span> Borrador. Iteración, bucles y listas</a></li>
<li class="book-part">Análisis</li>
<li><a class="" href="descriptive-tables.html"><span class="header-section-number">17</span> Borrador. Tablas descriptivas</a></li>
<li><a class="" href="simple-statistical-tests.html"><span class="header-section-number">18</span> Borrador. Tests estadísticos sencillos</a></li>
<li><a class="" href="univariate-and-multivariable-regression.html"><span class="header-section-number">19</span> Borrador. Regresión univariante y multivariable</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> Borrador. Valores faltantes</a></li>
<li><a class="" href="standardised-rates.html"><span class="header-section-number">21</span> Borrador. Tasas estandarizadas</a></li>
<li><a class="" href="moving-averages.html"><span class="header-section-number">22</span> Borrador. Medias Móviles</a></li>
<li><a class="" href="time-series-and-outbreak-detection.html"><span class="header-section-number">23</span> Borrador. Series temporales y detección de brotes</a></li>
<li><a class="" href="epidemic-modeling.html"><span class="header-section-number">24</span> Borrador. Modelización de epidemias</a></li>
<li><a class="" href="contact-tracing-1.html"><span class="header-section-number">25</span> Borrador. Rastreo de contactos</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">26</span> Borrador. Análisis de encuestas</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">27</span> Borrador. Análisis de supervivencia</a></li>
<li><a class="" href="gis-basics.html"><span class="header-section-number">28</span> Conceptos básicos de los SIG</a></li>
<li class="book-part">Visualización de datos</li>
<li><a class="" href="tables-for-presentation.html"><span class="header-section-number">29</span> Borrador. Tablas para presentaciones</a></li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">30</span> Conceptos básicos de ggplot</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">31</span> Consejos de ggplot</a></li>
<li><a class="" href="epidemic-curves.html"><span class="header-section-number">32</span> Curvas epidémicas</a></li>
<li><a class="" href="demographic-pyramids-and-likert-scales.html"><span class="header-section-number">33</span> Pirámides de población y escalas de Likert</a></li>
<li><a class="" href="heat-plots.html"><span class="header-section-number">34</span> Gráficos de calor</a></li>
<li><a class="" href="diagrams-and-charts.html"><span class="header-section-number">35</span> Diagramas y gráficos</a></li>
<li><a class="" href="combinations-analysis.html"><span class="header-section-number">36</span> Borrador. Análisis de combinaciones</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">37</span> Borrador. Cadenas de transmisión</a></li>
<li><a class="" href="phylogenetic-trees-1.html"><span class="header-section-number">38</span> Árboles filogenéticos</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">39</span> Gráficos interactivos</a></li>
<li class="book-part">Informes y Dashboards</li>
<li><a class="" href="reports-with-r-markdown.html"><span class="header-section-number">40</span> Informes con R Markdown</a></li>
<li><a class="" href="organizing-routine-reports.html"><span class="header-section-number">41</span> Organización de informes rutinarios</a></li>
<li><a class="" href="dashboards-with-r-markdown.html"><span class="header-section-number">42</span> Borrador. Dashboards con R Markdown</a></li>
<li><a class="" href="dashboards-with-shiny.html"><span class="header-section-number">43</span> Borrador. Dashboards con Shiny</a></li>
<li class="book-part">Miscelánea</li>
<li><a class="" href="writing-functions-1.html"><span class="header-section-number">44</span> Escribir funciones</a></li>
<li><a class="" href="directory-interactions.html"><span class="header-section-number">45</span> Borrador. Interacciones con directorios</a></li>
<li><a class="" href="version-control-and-collaboration-with-git-and-github.html"><span class="header-section-number">46</span> Control de versiones y colaboración con Git y Github</a></li>
<li><a class="" href="common-errors.html"><span class="header-section-number">47</span> Errores comunes</a></li>
<li><a class="" href="getting-help.html"><span class="header-section-number">48</span> Cómo obtener ayuda</a></li>
<li><a class="" href="r-on-network-drives.html"><span class="header-section-number">49</span> Borrador. R en redes locales</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">50</span> Borrador. data.table</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="cleaning-data-and-core-functions" class="section level1" number="8">
<h1>
<span class="header-section-number">8</span> Limpieza de datos y funciones básicas<a class="anchor" aria-label="anchor" href="#cleaning-data-and-core-functions"><i class="fas fa-link"></i></a>
</h1>
<div class="inline-figure"><img src="images/cleaning.png" width="265" height="10%" style="display: block; margin: auto;"></div>
<p>Esta página muestra los pasos más utilizados en el proceso de “limpieza” de datos, y también explica el uso de muchas funciones esenciales de gestión de datos en R.</p>
<p>Para explicarlo, esta página comienza importando datos de un listado de casos crudo, y se avanza paso a paso a través del proceso de limpieza. En el código R, esto se manifiesta como una cadena de “tuberías”, que hacen referencia al operador “tuberías” <code>%&gt;%</code> que pasa unos datos de una operación a la siguiente.</p>
<div id="funciones-principales" class="section level2 unnumbered">
<h2>Funciones principales<a class="anchor" aria-label="anchor" href="#funciones-principales"><i class="fas fa-link"></i></a>
</h2>
<p>Este manual hace hincapié en el uso de las funciones de la familia de paquetes de R <a href="https://www.tidyverse.org/"><strong>tidyverse</strong></a>. Las funciones esenciales que se muestran en esta página se enumeran a continuación.</p>
<p>Muchas de estas funciones pertenecen al paquete <a href="https://dplyr.tidyverse.org/"><strong>dplyr</strong></a>, que proporciona funciones “verbales” para resolver los retos de la manipulación de datos (el nombre hace una referencia a unos alicates - <a href="https://www.thefreedictionary.com/plier#:~:text=also%20ply%C2%B7er%20(pl%C4%AB%E2%80%B2,holding%2C%20bending%2C%20or%20cutting.)">plier</a> - de dataframes). <strong>dplyr</strong> forma parte de la familia de paquetes de R <strong>tidyverse</strong> (que también incluye <strong>ggplot2</strong>, <strong>tidyr</strong>, <strong>stringr</strong>, <strong>tibble</strong>, <strong>purrr</strong>, <strong>magrittr</strong> y <strong>forcats</strong>, entre otros).</p>
<div class="inline-table"><table style="width:100%;" class="table table-sm">
<colgroup>
<col width="16%">
<col width="46%">
<col width="37%">
</colgroup>
<thead><tr class="header">
<th>Función</th>
<th>Utilidad</th>
<th>Paquete</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></td>
<td>“canalizar” (pasar) datos de una función a la siguiente</td>
<td><strong>magrittr</strong></td>
</tr>
<tr class="even">
<td><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></td>
<td>crear, transformar y redefinir columnas</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="odd">
<td><a href="https://dplyr.tidyverse.org/reference/select.html">selecct()</a></td>
<td>mantener, eliminar, seleccionar o renombrar columnas</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></td>
<td>cambiar el nombre de las columnas</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="odd">
<td>clean_names()</td>
<td>estandarizar la sintaxis de los nombres de las columnas</td>
<td><strong>janitor</strong></td>
</tr>
<tr class="even">
<td>
<a href="https://rdrr.io/r/base/character.html">as.character()</a>, <a href="https://rdrr.io/r/base/numeric.html">as.numeric()</a>, <a href="https://rdrr.io/r/base/as.Date.html">as.Date()</a>, etc.</td>
<td>convertir el tipo de una columna</td>
<td>R <strong>base</strong>
</td>
</tr>
<tr class="odd">
<td>across()</td>
<td>transformar varias columnas a la vez</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td>funciones <strong>tidyselect</strong>
</td>
<td>utilizar la lógica para seleccionar las columnas</td>
<td><strong>tidyselect</strong></td>
</tr>
<tr class="odd">
<td><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></td>
<td>mantener ciertas filas</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></td>
<td>de-duplicar filas</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="odd">
<td>rowwise()</td>
<td>operaciones por/en cada fila</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td>add_row()</td>
<td>añadir filas manualmente</td>
<td><strong>tiblle</strong></td>
</tr>
<tr class="odd">
<td><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></td>
<td>ordenar las filas</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td>recode()</td>
<td>recodificar los valores de una columna</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="odd">
<td>case_when()</td>
<td>recodificar los valores de una columna con criterios lógicos más complejos</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td>replace_na(), na_if(), coalesce()</td>
<td>funciones especiales de recodificación</td>
<td><strong>tidyr</strong></td>
</tr>
<tr class="odd">
<td>age_categories() y <a href="https://rdrr.io/r/base/cut.html">cut()</a>
</td>
<td>crear grupos categóricos a partir de una columna numérica</td>
<td>
<strong>epikit</strong> y R <strong>base</strong>
</td>
</tr>
<tr class="even">
<td>clean_variable_spelling()</td>
<td>recodificación/limpieza de valores mediante un diccionario de datos</td>
<td><strong>lista de líneas</strong></td>
</tr>
<tr class="odd">
<td><a href="https://rdrr.io/r/base/which.html">which()</a></td>
<td>aplicar los criterios lógicos; devolver los índices</td>
<td>R <strong>base</strong>
</td>
</tr>
</tbody>
</table></div>
<p>Si quieres ver cómo se comparan estas funciones con los comandos de Stata o SAS, consulta la página sobre la <a href="transition-to-r.html#transition-to-r">transición a R</a>.</p>
<p>Puedes encontrar una gestión de datos alternativa en el paquete R <strong>data.table</strong> con operadores como <code>:=</code> y el uso frecuente de corchetes <code>[ ]</code>. Este enfoque y la sintaxis se explican brevemente en la página <a href="https://epirhandbook.com/data-table.html#data-table">Data.Table</a>.</p>
<div id="nomenclatura-1" class="section level3 unnumbered">
<h3>Nomenclatura<a class="anchor" aria-label="anchor" href="#nomenclatura-1"><i class="fas fa-link"></i></a>
</h3>
<p>En este manual, generalmente hacemos referencia a “columnas” y “filas” en lugar de “variables” y “observaciones”. Como se explica en este manual sobre <a href="https://tidyr.tidyverse.org/articles/tidy-data.html">“datos ordenados”</a>, la mayoría de los conjuntos de datos estadísticos epidemiológicos se componen estructuralmente de filas, columnas y valores.</p>
<p>Las <em>variables</em> contienen los valores que miden el mismo atributo subyacente (como el grupo de edad, el resultado o la fecha de inicio). Las <em>observaciones</em> contienen todos los valores medidos en la misma unidad (por ejemplo, una persona, un lugar o una muestra de laboratorio). Por lo tanto, estos aspectos pueden ser más difíciles de definir de forma tangible.</p>
<p>En los conjuntos de datos “ordenados”, cada columna es una variable, cada fila es una observación y cada celda es un único valor. Sin embargo, algunos conjuntos de datos que se encuentran no se ajustan a este molde: unos datos de formato “amplio” pueden tener una variable dividida en varias columnas (véase un ejemplo en la página <a href="pivoting-data.html#pivoting-data">Pivotar datos</a>). Del mismo modo, las observaciones pueden estar divididas en varias filas.</p>
<p>La mayor parte de este manual trata sobre la gestión y la transformación de datos, por lo que las referencias a las estructuras de datos concretas de filas y columnas son más relevantes que las observaciones y las variables más abstractas. Las excepciones se dan sobre todo en las páginas sobre análisis de datos, en las que verás más referencias a las variables y las observaciones.</p>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
<div id="limpieza-de-tuberías" class="section level2" number="8.1">
<h2>
<span class="header-section-number">8.1</span> Limpieza de tuberías<a class="anchor" aria-label="anchor" href="#limpieza-de-tuber%C3%ADas"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Esta página recorre los pasos típicos de limpieza, añadiéndolos secuencialmente a una cadena de tuberías de limpieza.</strong></p>
<p>En el análisis epidemiológico y el procesamiento de datos, los pasos de limpieza se realizan a menudo de forma secuencial, enlazados entre sí. En R, esto se manifiesta a menudo como una “tubería” de limpieza, en la que <em>los datos en bruto se pasan o se “canalizan” de un paso de limpieza a otro</em>.</p>
<p>Estas cadenas utilizan las funciones de <strong>dplyr</strong> y el operador <code>%&gt;%</code> de <strong>magrittr</strong>. Esta tubería comienza con los datos “en bruto” (“linelist_raw.xlsx”) y termina con un dataframe de R “limpio” (<code>linelist</code>) que se puede utilizar, guardar, exportar, etc.</p>
<p>En un proceso de limpieza, el orden de los pasos es importante. Los pasos de limpieza pueden incluir:</p>
<ul>
<li><p>Importación de datos</p></li>
<li><p>Limpieza o cambio de los nombres de las columnas</p></li>
<li><p>de-duplicación</p></li>
<li><p>Creación y transformación de columnas (por ejemplo, recodificación o normalización de valores)</p></li>
<li><p>Filtrado o añadido de filas</p></li>
</ul>
<!-- ======================================================= --><!-- ======================================================= --><!-- ======================================================= -->
</div>
<div id="carga-de-paquetes" class="section level2" number="8.2">
<h2>
<span class="header-section-number">8.2</span> Carga de paquetes<a class="anchor" aria-label="anchor" href="#carga-de-paquetes"><i class="fas fa-link"></i></a>
</h2>
<p>Este trozo de código muestra la carga de los paquetes necesarios para el análisis. En este manual destacamos <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> de <strong>pacman</strong>, que instala el paquete si es necesario <em>y</em> lo carga para su uso. También puedes cargar los paquetes instalados con <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> de R <strong>base.</strong> Consulta la página sobre <a href="r-basics.html#r-basics">Aspectos generales de R</a> para obtener más información sobre los paquetes de R.</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
  <span class="va">rio</span>,        <span class="co"># importing data  </span>
  <span class="va">here</span>,       <span class="co"># relative file pathways  </span>
  <span class="va">janitor</span>,    <span class="co"># data cleaning and tables</span>
  <span class="va">lubridate</span>,  <span class="co"># working with dates</span>
  <span class="va">epikit</span>,     <span class="co"># age_categories() function</span>
  <span class="va">tidyverse</span>   <span class="co"># data management and visualization</span>
<span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
<div id="importar-datos" class="section level2" number="8.3">
<h2>
<span class="header-section-number">8.3</span> Importar datos<a class="anchor" aria-label="anchor" href="#importar-datos"><i class="fas fa-link"></i></a>
</h2>
<div id="importar" class="section level3 unnumbered">
<h3>Importar<a class="anchor" aria-label="anchor" href="#importar"><i class="fas fa-link"></i></a>
</h3>
<p>Aquí importamos el archivo Excel de la lista de casos “en bruto” utilizando la función <code>import()</code> del paquete <strong>rio</strong>. El paquete <strong>rio</strong> maneja con flexibilidad muchos tipos de archivos (por ejemplo, .xlsx, .csv, .tsv, .rds. Consulta la página sobre <a href="import-and-export.html#import-and-export">importación y exportación</a> para obtener más información y consejos sobre situaciones inusuales (por ejemplo, omitir filas, establecer valores que faltan, importar hojas de Google, etc).</p>
<p>Para continuar, <a href="https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/case_linelists/linelist_raw.xlsx">cliquea para descargar linelist “en crudo”</a> (como archivo .xlsx).</p>
<p>Si tu conjunto de datos es grande y tarda mucho en importarse, puede ser útil que el comando de importación esté separado de la cadena de tuberías y que el “crudo” se guarde como un archivo distinto. Esto también permite comparar fácilmente las versiones original y limpia.</p>
<p>A continuación, importamos el archivo de Excel sin procesar y lo guardamos como el dataframe <code>linelist_raw</code>. Suponemos que el archivo se encuentra en tu directorio de trabajo o en la raíz del proyecto R, por lo que no se especifican subcarpetas en la ruta del archivo.</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_raw</span> <span class="op">&lt;-</span> <span class="fu">import</span><span class="op">(</span><span class="st">"linelist_raw.xlsx"</span><span class="op">)</span></code></pre></div>
<p>Puedes ver las primeras 50 filas del dataframe a continuación. Nota: la función <strong>base</strong> de R <code>head(n)</code> te permite ver sólo las primeras n filas en la consola de R.</p>
<div id="htmlwidget-4fd6b9970f82029860b4" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-4fd6b9970f82029860b4">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08T00:00:00Z",null,null,"2014-05-04T00:00:00Z","2014-05-18T00:00:00Z","2014-05-03T00:00:00Z","2014-05-22T00:00:00Z","2014-05-28T00:00:00Z",null,null,"2014-05-30T00:00:00Z","2014-05-28T00:00:00Z","2014-06-14T00:00:00Z","2014-06-07T00:00:00Z","2014-06-09T00:00:00Z",null,null,null,"2014-06-23T00:00:00Z","2014-06-18T00:00:00Z","2014-06-24T00:00:00Z",null,null,"2014-07-03T00:00:00Z",null,"2014-07-10T00:00:00Z","2014-06-14T00:00:00Z",null,"2014-06-18T00:00:00Z","2014-06-29T00:00:00Z","2014-07-02T00:00:00Z","2014-07-12T00:00:00Z","2014-07-12T00:00:00Z","2014-06-13T00:00:00Z","2014-07-15T00:00:00Z","2014-06-20T00:00:00Z",null,null,"2014-07-20T00:00:00Z",null,"2014-07-12T00:00:00Z","2014-07-19T00:00:00Z","2014-07-18T00:00:00Z","2014-07-18T00:00:00Z","2014-07-27T00:00:00Z",null,"2014-07-19T00:00:00Z","2014-07-26T00:00:00Z","2014-07-24T00:00:00Z",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15T00:00:00Z","2014-05-14T00:00:00Z","2014-05-18T00:00:00Z","2014-05-20T00:00:00Z","2014-05-22T00:00:00Z","2014-05-23T00:00:00Z","2014-05-29T00:00:00Z","2014-06-03T00:00:00Z","2014-06-06T00:00:00Z","2014-06-07T00:00:00Z","2014-06-08T00:00:00Z","2014-06-15T00:00:00Z","2014-06-17T00:00:00Z","2014-06-17T00:00:00Z","2014-06-20T00:00:00Z","2014-06-19T00:00:00Z","2014-06-23T00:00:00Z","2014-06-24T00:00:00Z","2014-06-27T00:00:00Z","2014-06-28T00:00:00Z","2014-06-29T00:00:00Z","2014-07-03T00:00:00Z","2014-07-09T00:00:00Z","2014-07-09T00:00:00Z","2014-07-11T00:00:00Z","2014-07-11T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-14T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-17T00:00:00Z","2014-07-17T00:00:00Z","2014-07-18T00:00:00Z","2014-07-19T00:00:00Z","2014-07-20T00:00:00Z","2014-07-20T00:00:00Z","2014-07-22T00:00:00Z","2014-07-24T00:00:00Z","2014-07-26T00:00:00Z","2014-07-24T00:00:00Z","2014-07-27T00:00:00Z","2014-07-25T00:00:00Z","2014-07-27T00:00:00Z","2014-07-31T00:00:00Z","2014-08-01T00:00:00Z","2014-08-03T00:00:00Z","2014-08-02T00:00:00Z","2014-08-02T00:00:00Z","2014-08-04T00:00:00Z"],[null,"2014-05-18T00:00:00Z","2014-05-30T00:00:00Z",null,"2014-05-29T00:00:00Z","2014-05-24T00:00:00Z","2014-06-01T00:00:00Z","2014-06-07T00:00:00Z","2014-06-18T00:00:00Z","2014-06-09T00:00:00Z","2014-06-15T00:00:00Z",null,"2014-07-09T00:00:00Z",null,"2014-06-30T00:00:00Z","2014-07-11T00:00:00Z","2014-07-01T00:00:00Z","2014-06-25T00:00:00Z","2014-07-06T00:00:00Z","2014-07-02T00:00:00Z","2014-07-09T00:00:00Z","2014-07-07T00:00:00Z","2014-07-20T00:00:00Z",null,"2014-07-22T00:00:00Z","2014-07-16T00:00:00Z","2014-07-14T00:00:00Z","2014-07-20T00:00:00Z","2014-07-16T00:00:00Z","2014-07-19T00:00:00Z","2014-07-27T00:00:00Z","2014-07-19T00:00:00Z",null,"2014-07-26T00:00:00Z","2014-08-14T00:00:00Z","2014-08-01T00:00:00Z","2014-07-23T00:00:00Z","2014-08-28T00:00:00Z","2014-07-28T00:00:00Z","2014-07-19T00:00:00Z",null,"2014-08-03T00:00:00Z",null,null,null,"2014-08-06T00:00:00Z","2014-08-21T00:00:00Z","2014-09-13T00:00:00Z","2014-08-04T00:00:00Z",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],["Other",null,"St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital",null,null,null,null,"Port Hospital","Military Hospital",null,null,"Other","Port Hospital","Port Hospital","Port Hospital",null,"Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)",null,"Other",null,"St. Marks Maternity Hopital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital",null,"Military Hospital","Other",null,null,"Port Hospital","Port Hospital","Port Hospital",null,"Central Hospital","Military Hospital","Other","Other","Other",null,"St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)",null],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],["2","3","56","18","3","16","16","0","61","27","12","42","19","7","7","13","35","17","11","11","19","54","14","28","6","3","31","6","67","14","10","21","20","45","1","12","3","15","20","36","7","13","14","3","10","1","0","20","26","14"],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],["a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a"],["b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>infection date<\/th>\n      <th>date onset<\/th>\n      <th>hosp date<\/th>\n      <th>date_of_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>row_num<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>merged_header<\/th>\n      <th>...28<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,9,10,15,16,17,18,24]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="revisar" class="section level2 unnumbered">
<h2>Revisar<a class="anchor" aria-label="anchor" href="#revisar"><i class="fas fa-link"></i></a>
</h2>
<p>Puedes utilizar la función <code>skim()</code> del paquete <strong>skimr</strong> para obtener una visión general de todo el dataframe (véase la página sobre <a href="descriptive-tables.html#descriptive-tables">tablas descriptivas</a> para más información). Las columnas se resumen por clase o tipo, como, por ejemplo, carácter, numérico. Nota: “POSIXct” es un tipo de fecha cruda (ver <a href="working-with-dates.html#working-with-dates-1">Trabajar con fechas</a>.</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">skimr</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/skimr/reference/skim.html">skim</a></span><span class="op">(</span><span class="va">linelist_raw</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:unnamed-chunk-158">Table 8.1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">linelist_raw</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">6611</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">28</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">17</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">8</td>
</tr>
<tr class="even">
<td align="left">POSIXct</td>
<td align="left">3</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table></div>
<p><strong>Variable type: character</strong></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">case_id</td>
<td align="right">137</td>
<td align="right">0.98</td>
<td align="right">6</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">5888</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">date onset</td>
<td align="right">293</td>
<td align="right">0.96</td>
<td align="right">10</td>
<td align="right">10</td>
<td align="right">0</td>
<td align="right">580</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">outcome</td>
<td align="right">1500</td>
<td align="right">0.77</td>
<td align="right">5</td>
<td align="right">7</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">gender</td>
<td align="right">324</td>
<td align="right">0.95</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">hospital</td>
<td align="right">1512</td>
<td align="right">0.77</td>
<td align="right">5</td>
<td align="right">36</td>
<td align="right">0</td>
<td align="right">13</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">infector</td>
<td align="right">2323</td>
<td align="right">0.65</td>
<td align="right">6</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">2697</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">source</td>
<td align="right">2323</td>
<td align="right">0.65</td>
<td align="right">5</td>
<td align="right">7</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">107</td>
<td align="right">0.98</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">75</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">age_unit</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">5</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">fever</td>
<td align="right">258</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">chills</td>
<td align="right">258</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">cough</td>
<td align="right">258</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">aches</td>
<td align="right">258</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">vomit</td>
<td align="right">258</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">time_admission</td>
<td align="right">844</td>
<td align="right">0.87</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="right">0</td>
<td align="right">1091</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">merged_header</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">…28</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table></div>
<p><strong>Variable type: numeric</strong></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">generation</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">16.60</td>
<td align="right">5.71</td>
<td align="right">0.00</td>
<td align="right">13.00</td>
<td align="right">16.00</td>
<td align="right">20.00</td>
<td align="right">37.00</td>
</tr>
<tr class="even">
<td align="left">lon</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">-13.23</td>
<td align="right">0.02</td>
<td align="right">-13.27</td>
<td align="right">-13.25</td>
<td align="right">-13.23</td>
<td align="right">-13.22</td>
<td align="right">-13.21</td>
</tr>
<tr class="odd">
<td align="left">lat</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">8.47</td>
<td align="right">0.01</td>
<td align="right">8.45</td>
<td align="right">8.46</td>
<td align="right">8.47</td>
<td align="right">8.48</td>
<td align="right">8.49</td>
</tr>
<tr class="even">
<td align="left">row_num</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">3240.91</td>
<td align="right">1857.83</td>
<td align="right">1.00</td>
<td align="right">1647.50</td>
<td align="right">3241.00</td>
<td align="right">4836.50</td>
<td align="right">6481.00</td>
</tr>
<tr class="odd">
<td align="left">wt_kg</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">52.69</td>
<td align="right">18.59</td>
<td align="right">-11.00</td>
<td align="right">41.00</td>
<td align="right">54.00</td>
<td align="right">66.00</td>
<td align="right">111.00</td>
</tr>
<tr class="even">
<td align="left">ht_cm</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">125.25</td>
<td align="right">49.57</td>
<td align="right">4.00</td>
<td align="right">91.00</td>
<td align="right">130.00</td>
<td align="right">159.00</td>
<td align="right">295.00</td>
</tr>
<tr class="odd">
<td align="left">ct_blood</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">21.26</td>
<td align="right">1.67</td>
<td align="right">16.00</td>
<td align="right">20.00</td>
<td align="right">22.00</td>
<td align="right">22.00</td>
<td align="right">26.00</td>
</tr>
<tr class="even">
<td align="left">temp</td>
<td align="right">158</td>
<td align="right">0.98</td>
<td align="right">38.60</td>
<td align="right">0.95</td>
<td align="right">35.20</td>
<td align="right">38.30</td>
<td align="right">38.80</td>
<td align="right">39.20</td>
<td align="right">40.80</td>
</tr>
</tbody>
</table></div>
<p><strong>Variable type: POSIXct</strong></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">min</th>
<th align="left">max</th>
<th align="left">median</th>
<th align="right">n_unique</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">infection date</td>
<td align="right">2322</td>
<td align="right">0.65</td>
<td align="left">2012-04-09</td>
<td align="left">2015-04-27</td>
<td align="left">2014-10-04</td>
<td align="right">538</td>
</tr>
<tr class="even">
<td align="left">hosp date</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="left">2012-04-20</td>
<td align="left">2015-04-30</td>
<td align="left">2014-10-15</td>
<td align="right">570</td>
</tr>
<tr class="odd">
<td align="left">date_of_outcome</td>
<td align="right">1068</td>
<td align="right">0.84</td>
<td align="left">2012-05-14</td>
<td align="left">2015-06-04</td>
<td align="left">2014-10-26</td>
<td align="right">575</td>
</tr>
</tbody>
</table></div>
<!-- ======================================================= --><!-- ======================================================= --><!-- ======================================================= -->
</div>
<div id="nombres-de-columnas" class="section level2" number="8.4">
<h2>
<span class="header-section-number">8.4</span> Nombres de columnas<a class="anchor" aria-label="anchor" href="#nombres-de-columnas"><i class="fas fa-link"></i></a>
</h2>
<p>En R, los <em>nombres</em> de las columnas son la “cabecera” o el valor “superior” de una columna. Se utilizan para referirse a las columnas en el código, y sirven como etiqueta por defecto en las figuras.</p>
<p>Otros programas estadísticos, como SAS y STATA, utilizan <em>“etiquetas”</em> que coexisten como versiones impresas más largas de los nombres de columna más cortos. Aunque R ofrece la posibilidad de añadir etiquetas de columna a los datos, no es una práctica que sea muy utilizada. Para hacer que los nombres de las columnas sean “fáciles de imprimir” para las figuras, normalmente se ajusta su visualización dentro de los comandos de gráficas que crean las salidas (por ejemplo, los títulos de los ejes o de las leyendas de una gráfica, o las cabeceras de las columnas en una tabla impresa - véase la <a href="ggplot-tips.html#ggplot_tips_scales">sección de escalas de la página de consejos de ggplot</a> y las páginas de <a href="tables-for-presentation.html#tables-for-presentation">Tablas para la presentación</a>). Si deseas asignar etiquetas de columna en los datos, lee más online <a href="https://cran.r-project.org/web/packages/expss/vignettes/labels-support.html">aquí</a> y <a href="https://cran.r-project.org/web/packages/labelled/vignettes/intro_labelled.html">aquí</a>.</p>
<p>Como los nombres de las columnas de R se utilizan con mucha frecuencia, deben tener una sintaxis “limpia”. Sugerimos lo siguiente:</p>
<ul>
<li>Nombres cortos</li>
<li>Sin espacios (sustituir por barras bajas _ )</li>
<li>Sin caracteres inusuales (&amp;, #, &lt;, &gt;, …)</li>
<li>Nomenclatura de estilo similar (por ejemplo, todas las columnas de fecha nombradas como <strong>date</strong>_onset, <strong>date</strong>_report, <strong>date</strong>_death…)</li>
</ul>
<p>Los nombres de las columnas de <code>linelist_raw</code> se muestran a continuación utilizando <code><a href="https://rdrr.io/r/base/names.html">names()</a></code> de R <strong>base</strong>. Podemos ver que inicialmente</p>
<ul>
<li><p>Algunos nombres contienen espacios (por ejemplo, <code>infection date</code>)</p></li>
<li><p>Se utilizan diferentes patrones de nomenclatura para las fechas (<code>date onset</code> vs. <code>infection date</code>)</p></li>
<li><p>Debe haber habido una <em>cabecera fusionada</em> en las dos últimas columnas del .xlsx. Lo sabemos porque el nombre de dos columnas fusionadas (“merged_header”) fue asignado por R a la primera columna, y a la segunda columna se le asignó un nombre de marcador de posición “…28” (ya que entonces estaba vacía y es la columna 28).</p></li>
</ul>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">linelist_raw</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "case_id"         "generation"      "infection date"  "date onset"      "hosp date"       "date_of_outcome"
##  [7] "outcome"         "gender"          "hospital"        "lon"             "lat"             "infector"       
## [13] "source"          "age"             "age_unit"        "row_num"         "wt_kg"           "ht_cm"          
## [19] "ct_blood"        "fever"           "chills"          "cough"           "aches"           "vomit"          
## [25] "temp"            "time_admission"  "merged_header"   "...28"</code></pre>
<p><span style="color: black;"><strong><em>NOTA:</em></strong> Para hacer referencia a un nombre de columna que incluya espacios, rodee el nombre con tildes, por ejemplo: linelist<code>$\` '\x60infection date\x60'</code>. Ten en cuenta que, en tu teclado, la tilde (`) es diferente de la comilla simple (’). </span></p>
<div id="etiquetas" class="section level3 unnumbered">
<h3>Etiquetas<a class="anchor" aria-label="anchor" href="#etiquetas"><i class="fas fa-link"></i></a>
</h3>
<p>Algunos otros programas estadísticos, como SAS, tienen <em>etiquetas</em> de variables</p>
</div>
<div id="limpieza-automática" class="section level3 unnumbered">
<h3>Limpieza automática<a class="anchor" aria-label="anchor" href="#limpieza-autom%C3%A1tica"><i class="fas fa-link"></i></a>
</h3>
<p>La función <code>clean_names()</code> del paquete <strong>janitor</strong> estandariza los nombres de las columnas y los hace únicos haciendo lo siguiente:</p>
<ul>
<li><p>Convierte todos los nombres para que estén compuestos sólo por barras bajas, números y letras</p></li>
<li><p>Los caracteres acentuados se transliteran a ASCII (por ejemplo, la o alemana con diéresis se convierte en “o”, la “ñ” española se convierte en “n”)</p></li>
<li><p>Se puede especificar la preferencia de mayúsculas para los nuevos nombres de columna utilizando <code>case =</code> argumento (“snake” es el valor por defecto, las alternativas incluyen “sentence”, “title”, “small_camel”…)</p></li>
<li><p>Puedes especificar sustituciones de nombres concretos proporcionando un vector <code>replace =</code> argumento (por ejemplo, <code>replace = c(onset = "date_of_onset")</code>)</p></li>
<li><p>Aquí puedes encontrar una <a href="https://cran.r-project.org/web/packages/janitor/vignettes/janitor.html#cleaning">viñeta</a> en línea sobre dicho paquete.</p></li>
</ul>
<p>A continuación, el proceso de limpieza comienza utilizando <code>clean_names()</code> sobre linelist_raw.</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># pipe the raw dataset through the function clean_names(), assign result as "linelist"  </span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op">%&gt;%</span> 
  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># see the new column names</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "case_id"         "generation"      "infection_date"  "date_onset"      "hosp_date"       "date_of_outcome"
##  [7] "outcome"         "gender"          "hospital"        "lon"             "lat"             "infector"       
## [13] "source"          "age"             "age_unit"        "row_num"         "wt_kg"           "ht_cm"          
## [19] "ct_blood"        "fever"           "chills"          "cough"           "aches"           "vomit"          
## [25] "temp"            "time_admission"  "merged_header"   "x28"</code></pre>
<p><span style="color: black;"><strong><em>NOTA:</em></strong> El nombre de la última columna “…28” se ha cambiado por “x28”. </span></p>
</div>
<div id="limpieza-manual-de-nombres" class="section level3 unnumbered">
<h3>Limpieza manual de nombres<a class="anchor" aria-label="anchor" href="#limpieza-manual-de-nombres"><i class="fas fa-link"></i></a>
</h3>
<p>A menudo es necesario renombrar las columnas manualmente, incluso después del paso de estandarización anterior. A continuación, el renombramiento se realiza utilizando la función <code>rename()</code> del paquete <strong>dplyr</strong>, como parte de una cadena de tuberías. <code>rename()</code> utiliza el estilo <code>NUEVO = ANTIGUO</code> - el nombre nuevo de la columna se escribe antes que el antiguo.</p>
<p>A continuación, se añade un comando de renombramiento a la tubería de limpieza. Se han añadido espacios estratégicamente para alinear el código y facilitar la lectura.</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># CLEANING 'PIPE' CHAIN (starts with raw data and pipes it through cleaning steps)</span>
<span class="co">##################################################################################</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op">%&gt;%</span>
    
    <span class="co"># standardize column name syntax</span>
    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># manually re-name columns</span>
           <span class="co"># NEW name             # OLD name</span>
    <span class="fu">rename</span><span class="op">(</span>date_infection       <span class="op">=</span> <span class="va">infection_date</span>,
           date_hospitalisation <span class="op">=</span> <span class="va">hosp_date</span>,
           date_outcome         <span class="op">=</span> <span class="va">date_of_outcome</span><span class="op">)</span></code></pre></div>
<p>Ahora puedes ver que los nombres de las columnas han cambiado:</p>
<pre><code>##  [1] "case_id"              "generation"           "date_infection"       "date_onset"           "date_hospitalisation"
##  [6] "date_outcome"         "outcome"              "gender"               "hospital"             "lon"                 
## [11] "lat"                  "infector"             "source"               "age"                  "age_unit"            
## [16] "row_num"              "wt_kg"                "ht_cm"                "ct_blood"             "fever"               
## [21] "chills"               "cough"                "aches"                "vomit"                "temp"                
## [26] "time_admission"       "merged_header"        "x28"</code></pre>
<div id="renombrar-por-posición-de-columna" class="section level4 unnumbered">
<h4>Renombrar por posición de columna<a class="anchor" aria-label="anchor" href="#renombrar-por-posici%C3%B3n-de-columna"><i class="fas fa-link"></i></a>
</h4>
<p>También puedes renombrar por la posición de la columna, en lugar del nombre de la columna, por ejemplo:</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rename</span><span class="op">(</span>newNameForFirstColumn  <span class="op">=</span> <span class="fl">1</span>,
       newNameForSecondColumn <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
</div>
<div id="renombrar-mediante-select-y-summarise" class="section level4 unnumbered">
<h4>Renombrar mediante <code>select()</code> y <code>summarise()</code><a class="anchor" aria-label="anchor" href="#renombrar-mediante-select-y-summarise"><i class="fas fa-link"></i></a>
</h4>
<p>Como método abreviado, también puedes cambiar el nombre de las columnas dentro de las funciones de <strong>dplyr</strong> <code>select()</code> y <code>summarise()</code>. <code>select()</code> se utiliza para mantener sólo ciertas columnas (y se muestra más adelante en esta página). <code>summarise()</code> se muestra en las páginas <a href="#grouping-data">Agrupar datos</a> y <a href="descriptive-tables.html#descriptive-tables">Tablas descriptivas</a>. Estas funciones también utilizan el formato <code>nombre_nuevo = nombre_antiguo</code>. He aquí un ejemplo:</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_raw</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="co"># NEW name             # OLD name</span>
         date_infection       <span class="op">=</span> <span class="va">`infection date`</span>,    <span class="co"># rename and KEEP ONLY these columns</span>
         date_hospitalisation <span class="op">=</span> <span class="va">`hosp date`</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="otros-retos" class="section level3 unnumbered">
<h3>Otros retos<a class="anchor" aria-label="anchor" href="#otros-retos"><i class="fas fa-link"></i></a>
</h3>
<div id="nombres-de-columnas-de-excel-vacíos" class="section level4 unnumbered">
<h4>Nombres de columnas de Excel vacíos<a class="anchor" aria-label="anchor" href="#nombres-de-columnas-de-excel-vac%C3%ADos"><i class="fas fa-link"></i></a>
</h4>
<p>R no puede tener columnas de conjuntos de datos que no tengan nombres de columnas (cabeceras). Así, si importa unos datos de Excel con datos pero sin cabeceras de columna, R rellenará las cabeceras con nombres como “…1” o “…2”. El nombre asignado representa el número de la columna (por ejemplo, si la cuarta columna de los datos no tiene cabecera, R la nombrará “…4”).</p>
<p>Puedes limpiar estos nombres manualmente haciendo referencia a su número de posición (véase el ejemplo anterior), o a su nombre asignado (<code>linelist_raw$...1</code>).</p>
</div>
<div id="nombres-de-columnas-y-celdas-fusionadas-de-excel" class="section level4 unnumbered">
<h4>Nombres de columnas y celdas fusionadas de Excel<a class="anchor" aria-label="anchor" href="#nombres-de-columnas-y-celdas-fusionadas-de-excel"><i class="fas fa-link"></i></a>
</h4>
<p>Las celdas combinadas en un archivo de Excel son una ocurrencia común cuando se reciben datos. Como se explica en <a href="transition-to-r.html#transition-to-r">Transición a R</a>, las celdas combinadas pueden ser agradables para la lectura humana de los datos, pero no son “datos ordenados” y causan muchos problemas para la lectura de los datos por parte de las máquinas. R no puede ajustar las celdas combinadas.</p>
<p>Recuerda a las personas que introducen los datos que <strong>los datos legibles para el ser humano no son lo mismo que los datos legibles para la máquina</strong>. Esfuérzate en formar a los usuarios sobre los principios de los [<a href="https://r4ds.had.co.nz/tidy-data.html"><strong>datos ordenados</strong></a>. Si es posible, intenta cambiar los procedimientos para que los datos lleguen en un formato ordenado y sin celdas fusionadas. ]“, which means A is not included but B is. <strong>Reverse this behavior by providing the <code>right = TRUE</code> argument</strong>.</p>
<p>Thus, by default, “0” values are excluded from the lowest group, and categorized as <code>NA</code>! “0” values could be infants coded as age 0 so be careful! To change this, add the argument <code>include.lowest = TRUE</code> so that any “0” values will be included in the lowest group. The automatically-generated label for the lowest category will then be “[A],B]”. Note that if you include the <code>include.lowest = TRUE</code> argument <strong>and</strong> <code>right = TRUE</code>, the extreme inclusion will now apply to the <em>highest</em> break point value and category, not the lowest.</p>
<p>You can provide a vector of customized labels using the <code>labels =</code> argument. As these are manually written, be very careful to ensure they are accurate! Check your work using cross-tabulation, as described below.</p>
<p>An example of <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> applied to <code>age_years</code> to make the new variable <code>age_cat</code> is below:</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create new variable, by cutting the numeric age variable</span>
<span class="co"># lower break is excluded but upper break is included in each category</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    age_cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span>
      <span class="va">age_years</span>,
      breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>,
                 <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">70</span>, <span class="fl">100</span><span class="op">)</span>,
      include.lowest <span class="op">=</span> <span class="cn">TRUE</span>         <span class="co"># include 0 in lowest group</span>
      <span class="op">)</span><span class="op">)</span>

<span class="co"># tabulate the number of observations per group</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##    [0,5]   (5,10]  (10,15]  (15,20]  (20,30]  (30,50]  (50,70] (70,100]     &lt;NA&gt; 
##     1469     1195     1040      770     1149      778       94        6      107</code></pre>
<p><strong>Check your work!!!</strong> Verify that each age value was assigned to the correct category by cross-tabulating the numeric and category columns. Examine assignment of boundary values (e.g. 15, if neighboring categories are 10-15 and 16-20).</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Cross tabulation of the numeric and category columns. </span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="st">"Numeric Values"</span> <span class="op">=</span> <span class="va">linelist</span><span class="op">$</span><span class="va">age_years</span>,   <span class="co"># names specified in table for clarity.</span>
      <span class="st">"Categories"</span>     <span class="op">=</span> <span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>,
      useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span>                        <span class="co"># don't forget to examine NA values</span></code></pre></div>
<pre><code>##                     Categories
## Numeric Values       [0,5] (5,10] (10,15] (15,20] (20,30] (30,50] (50,70] (70,100] &lt;NA&gt;
##   0                    136      0       0       0       0       0       0        0    0
##   0.0833333333333333     1      0       0       0       0       0       0        0    0
##   0.25                   2      0       0       0       0       0       0        0    0
##   0.333333333333333      6      0       0       0       0       0       0        0    0
##   0.416666666666667      1      0       0       0       0       0       0        0    0
##   0.5                    6      0       0       0       0       0       0        0    0
##   0.583333333333333      3      0       0       0       0       0       0        0    0
##   0.666666666666667      3      0       0       0       0       0       0        0    0
##   0.75                   3      0       0       0       0       0       0        0    0
##   0.833333333333333      1      0       0       0       0       0       0        0    0
##   0.916666666666667      1      0       0       0       0       0       0        0    0
##   1                    275      0       0       0       0       0       0        0    0
##   1.5                    2      0       0       0       0       0       0        0    0
##   2                    308      0       0       0       0       0       0        0    0
##   3                    246      0       0       0       0       0       0        0    0
##   4                    233      0       0       0       0       0       0        0    0
##   5                    242      0       0       0       0       0       0        0    0
##   6                      0    241       0       0       0       0       0        0    0
##   7                      0    256       0       0       0       0       0        0    0
##   8                      0    239       0       0       0       0       0        0    0
##   9                      0    245       0       0       0       0       0        0    0
##   10                     0    214       0       0       0       0       0        0    0
##   11                     0      0     220       0       0       0       0        0    0
##   12                     0      0     224       0       0       0       0        0    0
##   13                     0      0     191       0       0       0       0        0    0
##   14                     0      0     199       0       0       0       0        0    0
##   15                     0      0     206       0       0       0       0        0    0
##   16                     0      0       0     186       0       0       0        0    0
##   17                     0      0       0     164       0       0       0        0    0
##   18                     0      0       0     141       0       0       0        0    0
##   19                     0      0       0     130       0       0       0        0    0
##   20                     0      0       0     149       0       0       0        0    0
##   21                     0      0       0       0     158       0       0        0    0
##   22                     0      0       0       0     149       0       0        0    0
##   23                     0      0       0       0     125       0       0        0    0
##   24                     0      0       0       0     144       0       0        0    0
##   25                     0      0       0       0     107       0       0        0    0
##   26                     0      0       0       0     100       0       0        0    0
##   27                     0      0       0       0     117       0       0        0    0
##   28                     0      0       0       0      85       0       0        0    0
##   29                     0      0       0       0      82       0       0        0    0
##   30                     0      0       0       0      82       0       0        0    0
##   31                     0      0       0       0       0      68       0        0    0
##   32                     0      0       0       0       0      84       0        0    0
##   33                     0      0       0       0       0      78       0        0    0
##   34                     0      0       0       0       0      58       0        0    0
##   35                     0      0       0       0       0      58       0        0    0
##   36                     0      0       0       0       0      33       0        0    0
##   37                     0      0       0       0       0      46       0        0    0
##   38                     0      0       0       0       0      45       0        0    0
##   39                     0      0       0       0       0      45       0        0    0
##   40                     0      0       0       0       0      32       0        0    0
##   41                     0      0       0       0       0      34       0        0    0
##   42                     0      0       0       0       0      26       0        0    0
##   43                     0      0       0       0       0      31       0        0    0
##   44                     0      0       0       0       0      24       0        0    0
##   45                     0      0       0       0       0      27       0        0    0
##   46                     0      0       0       0       0      25       0        0    0
##   47                     0      0       0       0       0      16       0        0    0
##   48                     0      0       0       0       0      21       0        0    0
##   49                     0      0       0       0       0      15       0        0    0
##   50                     0      0       0       0       0      12       0        0    0
##   51                     0      0       0       0       0       0      13        0    0
##   52                     0      0       0       0       0       0       7        0    0
##   53                     0      0       0       0       0       0       4        0    0
##   54                     0      0       0       0       0       0       6        0    0
##   55                     0      0       0       0       0       0       9        0    0
##   56                     0      0       0       0       0       0       7        0    0
##   57                     0      0       0       0       0       0       9        0    0
##   58                     0      0       0       0       0       0       6        0    0
##   59                     0      0       0       0       0       0       5        0    0
##   60                     0      0       0       0       0       0       4        0    0
##   61                     0      0       0       0       0       0       2        0    0
##   62                     0      0       0       0       0       0       1        0    0
##   63                     0      0       0       0       0       0       5        0    0
##   64                     0      0       0       0       0       0       1        0    0
##   65                     0      0       0       0       0       0       5        0    0
##   66                     0      0       0       0       0       0       3        0    0
##   67                     0      0       0       0       0       0       2        0    0
##   68                     0      0       0       0       0       0       1        0    0
##   69                     0      0       0       0       0       0       3        0    0
##   70                     0      0       0       0       0       0       1        0    0
##   72                     0      0       0       0       0       0       0        1    0
##   73                     0      0       0       0       0       0       0        3    0
##   76                     0      0       0       0       0       0       0        1    0
##   84                     0      0       0       0       0       0       0        1    0
##   &lt;NA&gt;                   0      0       0       0       0       0       0        0  107</code></pre>
<p><strong>Re-labeling <code>NA</code> values</strong></p>
<p>You may want to assign <code>NA</code> values a label such as “Missing”. Because the new column is class Factor (restricted values), you cannot simply mutate it with <code>replace_na()</code>, as this value will be rejected. Instead, use <code>fct_explicit_na()</code> from <strong>forcats</strong> as explained in the [Factors] page.</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  
  <span class="co"># cut() creates age_cat, automatically of class Factor      </span>
  <span class="fu">mutate</span><span class="op">(</span>age_cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span>
    <span class="va">age_years</span>,
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">70</span>, <span class="fl">100</span><span class="op">)</span>,          
    right <span class="op">=</span> <span class="cn">FALSE</span>,
    include.lowest <span class="op">=</span> <span class="cn">TRUE</span>,        
    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0-4"</span>, <span class="st">"5-9"</span>, <span class="st">"10-14"</span>, <span class="st">"15-19"</span>, <span class="st">"20-29"</span>, <span class="st">"30-49"</span>, <span class="st">"50-69"</span>, <span class="st">"70-100"</span><span class="op">)</span><span class="op">)</span>,
         
    <span class="co"># make missing values explicit</span>
    age_cat <span class="op">=</span> <span class="fu">fct_explicit_na</span><span class="op">(</span>
      <span class="va">age_cat</span>,
      na_level <span class="op">=</span> <span class="st">"Missing age"</span><span class="op">)</span>  <span class="co"># you can specify the label</span>
  <span class="op">)</span>    

<span class="co"># table to view counts</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##         0-4         5-9       10-14       15-19       20-29       30-49       50-69      70-100 Missing age        &lt;NA&gt; 
##        1227        1223        1048         827        1216         848         105           7         107           0</code></pre>
<p><strong>Quickly make breaks and labels</strong></p>
<p>For a fast way to make breaks and label vectors, use something like below. See the [R basics] page for references on <code><a href="https://rdrr.io/r/base/seq.html">seq()</a></code> and <code><a href="https://rdrr.io/r/base/rep.html">rep()</a></code>.</p>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make break points from 0 to 90 by 5</span>
<span class="va">age_seq</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">90</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="va">age_seq</span>

<span class="co"># Make labels for the above categories, assuming default cut() settings</span>
<span class="va">age_labels</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">age_seq</span> <span class="op">+</span> <span class="fl">1</span>, <span class="st">"-"</span>, <span class="va">age_seq</span> <span class="op">+</span> <span class="fl">5</span><span class="op">)</span>
<span class="va">age_labels</span>

<span class="co"># check that both vectors are the same length</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">age_seq</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">age_labels</span><span class="op">)</span></code></pre></div>
<p>Read more about <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> in its Help page by entering <code><a href="https://rdrr.io/r/base/cut.html">?cut</a></code> in the R console.</p>
</div>
</div>
<div id="quantile-breaks" class="section level3 unnumbered">
<h3>Quantile breaks<a class="anchor" aria-label="anchor" href="#quantile-breaks"><i class="fas fa-link"></i></a>
</h3>
<p>In common understanding, “quantiles” or “percentiles” typically refer to a value below which a proportion of values fall. For example, the 95th percentile of ages in <code>linelist</code> would be the age below which 95% of the age fall.</p>
<p>However in common speech, “quartiles” and “deciles” can also refer to the <em>groups of data</em> as equally divided into 4, or 10 groups (note there will be one more break point than group).</p>
<p>To get quantile break points, you can use <code><a href="https://rdrr.io/r/stats/quantile.html">quantile()</a></code> from the <strong>stats</strong> package from <strong>base</strong> R. You provide a numeric vector (e.g. a column in a dataset) and vector of numeric probability values ranging from 0 to 1.0. The break points are returned as a numeric vector. Explore the details of the statistical methodologies by entering <code><a href="https://rdrr.io/r/stats/quantile.html">?quantile</a></code>.</p>
<ul>
<li>If your input numeric vector has any missing values it is best to set <code>na.rm = TRUE</code><br>
</li>
<li>Set <code>names = FALSE</code> to get an un-named numeric vector</li>
</ul>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_years</span>,               <span class="co"># specify numeric vector to work on</span>
  probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.25</span>, <span class="fl">.50</span>, <span class="fl">.75</span>, <span class="fl">.90</span>, <span class="fl">.95</span><span class="op">)</span>,   <span class="co"># specify the percentiles you want</span>
  na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>                            <span class="co"># ignore missing values </span></code></pre></div>
<pre><code>##  0% 25% 50% 75% 90% 95% 
##   0   6  13  23  33  41</code></pre>
<p>You can use the results of <code><a href="https://rdrr.io/r/stats/quantile.html">quantile()</a></code> as break points in <code>age_categories()</code> or <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code>. Below we create a new column <code>deciles</code> using <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> where the breaks are defined using <code>quantiles()</code> on <code>age_years</code>. Below, we display the results using <code>tabyl()</code> from <strong>janitor</strong> so you can see the percentages (see the [Descriptive tables] page). Note how they are not exactly 10% in each group.</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span>                                <span class="co"># begin with linelist</span>
  <span class="fu">mutate</span><span class="op">(</span>deciles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">age_years</span>,           <span class="co"># create new column decile as cut() on column age_years</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span>                      <span class="co"># define cut breaks using quantile()</span>
      <span class="va">age_years</span>,                               <span class="co"># operate on age_years</span>
      probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,             <span class="co"># 0.0 to 1.0 by 0.1</span>
      na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,                           <span class="co"># ignore missing values</span>
    include.lowest <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>             <span class="co"># for cut() include age 0</span>
  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/tabyl.html">tabyl</a></span><span class="op">(</span><span class="va">deciles</span><span class="op">)</span>                   <span class="co"># pipe to table to display</span></code></pre></div>
<pre><code>##  deciles   n    percent valid_percent
##    [0,2] 748 0.11319613    0.11505922
##    (2,5] 721 0.10911017    0.11090601
##    (5,7] 497 0.07521186    0.07644978
##   (7,10] 698 0.10562954    0.10736810
##  (10,13] 635 0.09609564    0.09767728
##  (13,17] 755 0.11425545    0.11613598
##  (17,21] 578 0.08746973    0.08890940
##  (21,26] 625 0.09458232    0.09613906
##  (26,33] 596 0.09019370    0.09167820
##  (33,84] 648 0.09806295    0.09967697
##     &lt;NA&gt; 107 0.01619249            NA</code></pre>
</div>
<div id="evenly-sized-groups" class="section level3 unnumbered">
<h3>Evenly-sized groups<a class="anchor" aria-label="anchor" href="#evenly-sized-groups"><i class="fas fa-link"></i></a>
</h3>
<p>Another tool to make numeric groups is the the <strong>dplyr</strong> function <code>ntile()</code>, which attempts to break your data into n <em>evenly-sized groups</em> - <em>but be aware that unlike with <code><a href="https://rdrr.io/r/stats/quantile.html">quantile()</a></code> the same value could appear in more than one group.</em> Provide the numeric vector and then the number of groups. The values in the new column created is just group “numbers” (e.g. 1 to 10), not the range of values themselves as when using <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code>.</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make groups with ntile()</span>
<span class="va">ntile_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>even_groups <span class="op">=</span> <span class="fu">ntile</span><span class="op">(</span><span class="va">age_years</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>

<span class="co"># make table of counts and proportions by group</span>
<span class="va">ntile_table</span> <span class="op">&lt;-</span> <span class="va">ntile_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/tabyl.html">tabyl</a></span><span class="op">(</span><span class="va">even_groups</span><span class="op">)</span>
  
<span class="co"># attach min/max values to demonstrate ranges</span>
<span class="va">ntile_ranges</span> <span class="op">&lt;-</span> <span class="va">ntile_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">even_groups</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarise</span><span class="op">(</span>
    min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">age_years</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
    max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">age_years</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## Warning in min(age_years, na.rm = T): no non-missing arguments to min; returning Inf</code></pre>
<pre><code>## Warning in max(age_years, na.rm = T): no non-missing arguments to max; returning -Inf</code></pre>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># combine and print - note that values are present in multiple groups</span>
<span class="fu">left_join</span><span class="op">(</span><span class="va">ntile_table</span>, <span class="va">ntile_ranges</span>, by <span class="op">=</span> <span class="st">"even_groups"</span><span class="op">)</span></code></pre></div>
<pre><code>##  even_groups   n    percent valid_percent min  max
##            1 651 0.09851695    0.10013844   0    2
##            2 650 0.09836562    0.09998462   2    5
##            3 650 0.09836562    0.09998462   5    7
##            4 650 0.09836562    0.09998462   7   10
##            5 650 0.09836562    0.09998462  10   13
##            6 650 0.09836562    0.09998462  13   17
##            7 650 0.09836562    0.09998462  17   21
##            8 650 0.09836562    0.09998462  21   26
##            9 650 0.09836562    0.09998462  26   33
##           10 650 0.09836562    0.09998462  33   84
##           NA 107 0.01619249            NA Inf -Inf</code></pre>
<!-- ======================================================= -->
</div>
<div id="case_when" class="section level3 unnumbered">
<h3>
<code>case_when()</code><a class="anchor" aria-label="anchor" href="#case_when"><i class="fas fa-link"></i></a>
</h3>
<p>It is possible to use the <strong>dplyr</strong> function <code>case_when()</code> to create categories from a numeric column, but it is easier to use <code>age_categories()</code> from <strong>epikit</strong> or <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> because these will create an ordered factor automatically.</p>
<p>If using <code>case_when()</code>, please review the proper use as described earlier in the Re-code values section of this page. Also be aware that all right-hand side values must be of the same class. Thus, if you want <code>NA</code> on the right-side you should either write “Missing” or use the special <code>NA</code> value <code>NA_character_</code>.</p>
</div>
<div id="add-to-pipe-chain" class="section level3 unnumbered">
<h3>Add to pipe chain<a class="anchor" aria-label="anchor" href="#add-to-pipe-chain"><i class="fas fa-link"></i></a>
</h3>
<p>Below, code to create two categorical age columns is added to the cleaning pipe chain:</p>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># CLEANING 'PIPE' CHAIN (starts with raw data and pipes it through cleaning steps)</span>
<span class="co">##################################################################################</span>

<span class="co"># begin cleaning pipe chain</span>
<span class="co">###########################</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op">%&gt;%</span>
    
    <span class="co"># standardize column name syntax</span>
    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># manually re-name columns</span>
           <span class="co"># NEW name             # OLD name</span>
    <span class="fu">rename</span><span class="op">(</span>date_infection       <span class="op">=</span> <span class="va">infection_date</span>,
           date_hospitalisation <span class="op">=</span> <span class="va">hosp_date</span>,
           date_outcome         <span class="op">=</span> <span class="va">date_of_outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># remove column</span>
    <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">row_num</span>, <span class="va">merged_header</span>, <span class="va">x28</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
    <span class="co"># de-duplicate</span>
    <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 

    <span class="co"># add column</span>
    <span class="fu">mutate</span><span class="op">(</span>bmi <span class="op">=</span> <span class="va">wt_kg</span> <span class="op">/</span> <span class="op">(</span><span class="va">ht_cm</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>     

    <span class="co"># convert class of columns</span>
    <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">contains</span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span>, <span class="va">as.Date</span><span class="op">)</span>, 
           generation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">generation</span><span class="op">)</span>,
           age        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># add column: delay to hospitalisation</span>
    <span class="fu">mutate</span><span class="op">(</span>days_onset_hosp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">date_hospitalisation</span> <span class="op">-</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># clean values of hospital column</span>
    <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span><span class="va">hospital</span>,
                      <span class="co"># OLD = NEW</span>
                      <span class="st">"Mitylira Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Mitylira Hospital"</span> <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Military Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Port Hopital"</span>      <span class="op">=</span> <span class="st">"Port Hospital"</span>,
                      <span class="st">"Central Hopital"</span>   <span class="op">=</span> <span class="st">"Central Hospital"</span>,
                      <span class="st">"other"</span>             <span class="op">=</span> <span class="st">"Other"</span>,
                      <span class="st">"St. Marks Maternity Hopital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span>
                      <span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 

    <span class="co"># create age_years column (from age and age_unit)</span>
    <span class="fu">mutate</span><span class="op">(</span>age_years <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span>
          <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"years"</span> <span class="op">~</span> <span class="va">age</span>,
          <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"months"</span> <span class="op">~</span> <span class="va">age</span><span class="op">/</span><span class="fl">12</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">age_unit</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span>,
          <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_real_</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
    <span class="co"># ABOVE ARE UPSTREAM CLEANING STEPS ALREADY DISCUSSED</span>
    <span class="co">###################################################   </span>
    <span class="fu">mutate</span><span class="op">(</span>
          <span class="co"># age categories: custom</span>
          age_cat <span class="op">=</span> <span class="fu">epikit</span><span class="fu">::</span><span class="fu"><a href="https://r4epi.github.io/epikit/reference/age_categories.html">age_categories</a></span><span class="op">(</span><span class="va">age_years</span>, breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">70</span><span class="op">)</span><span class="op">)</span>,
        
          <span class="co"># age categories: 0 to 85 by 5s</span>
          age_cat5 <span class="op">=</span> <span class="fu">epikit</span><span class="fu">::</span><span class="fu"><a href="https://r4epi.github.io/epikit/reference/age_categories.html">age_categories</a></span><span class="op">(</span><span class="va">age_years</span>, breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">85</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="add-rows" class="section level2" number="8.5">
<h2>
<span class="header-section-number">8.5</span> Add rows<a class="anchor" aria-label="anchor" href="#add-rows"><i class="fas fa-link"></i></a>
</h2>
<div id="one-by-one" class="section level3 unnumbered">
<h3>One-by-one<a class="anchor" aria-label="anchor" href="#one-by-one"><i class="fas fa-link"></i></a>
</h3>
<p>Adding rows one-by-one manually is tedious but can be done with <code>add_row()</code> from <strong>dplyr</strong>. Remember that each column must contain values of only one class (either character, numeric, logical, etc.). So adding a row requires nuance to maintain this.</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">add_row</span><span class="op">(</span>row_num <span class="op">=</span> <span class="fl">666</span>,
          case_id <span class="op">=</span> <span class="st">"abc"</span>,
          generation <span class="op">=</span> <span class="fl">4</span>,
          `infection date` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2020-10-10"</span><span class="op">)</span>,
          .before <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>Use <code>.before</code> and <code>.after.</code> to specify the placement of the row you want to add. <code>.before = 3</code> will put the new row before the current 3rd row. The default behavior is to add the row to the end. Columns not specified will be left empty (<code>NA</code>).</p>
<p>The new <em>row number</em> may look strange (“…23”) but the row numbers in the pre-existing rows <em>have</em> changed. So if using the command twice, examine/test the insertion carefully.</p>
<p>If a class you provide is off you will see an error like this:</p>
<pre><code>Error: Can't combine ..1$infection date &lt;date&gt; and ..2$infection date &lt;character&gt;.</code></pre>
<p>(when inserting a row with a date value, remember to wrap the date in the function <code><a href="https://rdrr.io/r/base/as.Date.html">as.Date()</a></code> like <code>as.Date("2020-10-10")</code>).</p>
</div>
<div id="bind-rows" class="section level3 unnumbered">
<h3>Bind rows<a class="anchor" aria-label="anchor" href="#bind-rows"><i class="fas fa-link"></i></a>
</h3>
<p>To combine datasets together by binding the rows of one dataframe to the bottom of another data frame, you can use <code>bind_rows()</code> from <strong>dplyr</strong>. This is explained in more detail in the page [Joining data].</p>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
<div id="filter-rows" class="section level2" number="8.6">
<h2>
<span class="header-section-number">8.6</span> Filter rows<a class="anchor" aria-label="anchor" href="#filter-rows"><i class="fas fa-link"></i></a>
</h2>
<p>A typical cleaning step after you have cleaned the columns and re-coded values is to <em>filter</em> the data frame for specific rows using the <strong>dplyr</strong> verb <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code>.</p>
<p>Within <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code>, specify the logic that must be <code>TRUE</code> for a row in the dataset to be kept. Below we show how to filter rows based on simple and complex logical conditions.</p>
<!-- ======================================================= -->
<div id="simple-filter" class="section level3 unnumbered">
<h3>Simple filter<a class="anchor" aria-label="anchor" href="#simple-filter"><i class="fas fa-link"></i></a>
</h3>
<p>This simple example re-defines the dataframe <code>linelist</code> as itself, having filtered the rows to meet a logical condition. <strong>Only the rows where the logical statement within the parentheses evaluates to <code>TRUE</code> are kept.</strong></p>
<p>In this example, the logical statement is <code>gender == "f"</code>, which is asking whether the value in the column <code>gender</code> is equal to “f” (case sensitive).</p>
<p>Before the filter is applied, the number of rows in <code>linelist</code> is <code>nrow(linelist)</code>.</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">gender</span> <span class="op">==</span> <span class="st">"f"</span><span class="op">)</span>   <span class="co"># keep only rows where gender is equal to "f"</span></code></pre></div>
<p>After the filter is applied, the number of rows in <code>linelist</code> is <code>linelist %&gt;% filter(gender == "f") %&gt;% nrow()</code>.</p>
</div>
<div id="filter-out-missing-values" class="section level3 unnumbered">
<h3>Filter out missing values<a class="anchor" aria-label="anchor" href="#filter-out-missing-values"><i class="fas fa-link"></i></a>
</h3>
<p>It is fairly common to want to filter out rows that have missing values. Resist the urge to write <code>filter(!is.na(column) &amp; !is.na(column))</code> and instead use the <strong>tidyr</strong> function that is custom-built for this purpose: <code>drop_na()</code>. If run with empty parentheses, it removes rows with <em>any</em> missing values. Alternatively, you can provide names of specific columns to be evaluated for missingness, or use the “tidyselect” helper functions described <a href="#clean_tidyselect">above</a>.</p>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">drop_na</span><span class="op">(</span><span class="va">case_id</span>, <span class="va">age_years</span><span class="op">)</span>  <span class="co"># drop rows with missing values for case_id or age_years</span></code></pre></div>
<p>See the page on [Missing data] for many techniques to analyse and manage missingness in your data.</p>
</div>
<div id="filter-by-row-number" class="section level3 unnumbered">
<h3>Filter by row number<a class="anchor" aria-label="anchor" href="#filter-by-row-number"><i class="fas fa-link"></i></a>
</h3>
<p>In a data frame or tibble, each row will usually have a “row number” that (when seen in R Viewer) appears to the left of the first column. It is not itself a true column in the data, but it can be used in a <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> statement.</p>
<p>To filter based on “row number”, you can use the <strong>dplyr</strong> function <code>row_number()</code> with open parentheses as part of a logical filtering statement. Often you will use the <code>%in%</code> operator and a range of numbers as part of that logical statement, as shown below. To see the <em>first</em> N rows, you can also use the special <strong>dplyr</strong> function <code><a href="https://rdrr.io/r/utils/head.html">head()</a></code>.</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># View first 100 rows</span>
<span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>     <span class="co"># or use tail() to see the n last rows</span>

<span class="co"># Show row 5 only</span>
<span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">row_number</span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span>

<span class="co"># View rows 2 through 20, and three specific columns</span>
<span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">row_number</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fl">2</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">date_onset</span>, <span class="va">outcome</span>, <span class="va">age</span><span class="op">)</span></code></pre></div>
<p>You can also convert the row numbers to a true column by piping your data frame to the <strong>tibble</strong> function <code>rownames_to_column()</code> (do not put anything in the parentheses).</p>
<!-- ======================================================= -->
</div>
<div id="complex-filter" class="section level3 unnumbered">
<h3>Complex filter<a class="anchor" aria-label="anchor" href="#complex-filter"><i class="fas fa-link"></i></a>
</h3>
<p>More complex logical statements can be constructed using parentheses <code>( )</code>, OR <code>|</code>, negate <code>!</code>, <code>%in%</code>, and AND <code>&amp;</code> operators. An example is below:</p>
<p>Note: You can use the <code>!</code> operator in front of a logical criteria to negate it. For example, <code>!is.na(column)</code> evaluates to true if the column value is <em>not</em> missing. Likewise <code>!column %in% c("a", "b", "c")</code> evaluates to true if the column value is <em>not</em> in the vector.</p>
<div id="examine-the-data" class="section level4 unnumbered">
<h4>Examine the data<a class="anchor" aria-label="anchor" href="#examine-the-data"><i class="fas fa-link"></i></a>
</h4>
<p>Below is a simple one-line command to create a histogram of onset dates. See that a second smaller outbreak from 2012-2013 is also included in this raw dataset. <strong>For our analyses, we want to remove entries from this earlier outbreak.</strong></p>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>, breaks <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-237-1.png" width="50%"></div>
</div>
<div id="how-filters-handle-missing-numeric-and-date-values" class="section level4 unnumbered">
<h4>How filters handle missing numeric and date values<a class="anchor" aria-label="anchor" href="#how-filters-handle-missing-numeric-and-date-values"><i class="fas fa-link"></i></a>
</h4>
<p>Can we just filter by <code>date_onset</code> to rows after June 2013? <strong>Caution! Applying the code <code>filter(date_onset &gt; as.Date("2013-06-01")))</code> would remove any rows in the later epidemic with a missing date of onset!</strong></p>
<p><span style="color: red;"><strong><em>DANGER:</em></strong> Filtering to greater than (&gt;) or less than (&lt;) a date or number can remove any rows with missing values (<code>NA</code>)! This is because <code>NA</code> is treated as infinitely large and small.</span></p>
<p><em>(See the page on [Working with dates] for more information on working with dates and the package <strong>lubridate</strong>)</em></p>
</div>
<div id="design-the-filter" class="section level4 unnumbered">
<h4>Design the filter<a class="anchor" aria-label="anchor" href="#design-the-filter"><i class="fas fa-link"></i></a>
</h4>
<p>Examine a cross-tabulation to make sure we exclude only the correct rows:</p>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span>Hospital  <span class="op">=</span> <span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span>,                     <span class="co"># hospital name</span>
      YearOnset <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span><span class="op">)</span>,  <span class="co"># year of date_onset</span>
      useNA     <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span>                              <span class="co"># show missing values</span></code></pre></div>
<pre><code>##                                       YearOnset
## Hospital                               2012 2013 2014 2015 &lt;NA&gt;
##   Central Hospital                        0    0  351   99   18
##   Hospital A                            229   46    0    0   15
##   Hospital B                            227   47    0    0   15
##   Military Hospital                       0    0  676  200   34
##   Missing                                 0    0 1117  318   77
##   Other                                   0    0  684  177   46
##   Port Hospital                           9    1 1372  347   75
##   St. Mark's Maternity Hospital (SMMH)    0    0  322   93   13
##   &lt;NA&gt;                                    0    0    0    0    0</code></pre>
<p>What other criteria can we filter on to remove the first outbreak (in 2012 &amp; 2013) from the dataset? We see that:</p>
<ul>
<li>The first epidemic in 2012 &amp; 2013 occurred at Hospital A, Hospital B, and that there were also 10 cases at Port Hospital.<br>
</li>
<li>Hospitals A &amp; B did <em>not</em> have cases in the second epidemic, but Port Hospital did.</li>
</ul>
<p>We want to exclude:</p>
<ul>
<li>The <code>nrow(linelist %&gt;% filter(hospital %in% c("Hospital A", "Hospital B") | date_onset &lt; as.Date("2013-06-01")))</code> rows with onset in 2012 and 2013 at either hospital A, B, or Port:
<ul>
<li>Exclude <code>nrow(linelist %&gt;% filter(date_onset &lt; as.Date("2013-06-01")))</code> rows with onset in 2012 and 2013</li>
<li>Exclude <code>nrow(linelist %&gt;% filter(hospital %in% c('Hospital A', 'Hospital B') &amp; is.na(date_onset)))</code> rows from Hospitals A &amp; B with missing onset dates<br>
</li>
<li>Do <strong>not</strong> exclude <code>nrow(linelist %&gt;% filter(!hospital %in% c('Hospital A', 'Hospital B') &amp; is.na(date_onset)))</code> other rows with missing onset dates.</li>
</ul>
</li>
</ul>
<p>We start with a linelist of <code></code>nrow(linelist)`. Here is our filter statement:</p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="co"># keep rows where onset is after 1 June 2013 OR where onset is missing and it was a hospital OTHER than Hospital A or B</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">date_onset</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2013-06-01"</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">hospital</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Hospital A"</span>, <span class="st">"Hospital B"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 6019</code></pre>
<p>When we re-make the cross-tabulation, we see that Hospitals A &amp; B are removed completely, and the 10 Port Hospital cases from 2012 &amp; 2013 are removed, and all other values are the same - just as we wanted.</p>
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span>Hospital  <span class="op">=</span> <span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span>,                     <span class="co"># hospital name</span>
      YearOnset <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span><span class="op">)</span>,  <span class="co"># year of date_onset</span>
      useNA     <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span>                              <span class="co"># show missing values</span></code></pre></div>
<pre><code>##                                       YearOnset
## Hospital                               2014 2015 &lt;NA&gt;
##   Central Hospital                      351   99   18
##   Military Hospital                     676  200   34
##   Missing                              1117  318   77
##   Other                                 684  177   46
##   Port Hospital                        1372  347   75
##   St. Mark's Maternity Hospital (SMMH)  322   93   13
##   &lt;NA&gt;                                    0    0    0</code></pre>
<p>Multiple statements can be included within one filter command (separated by commas), or you can always pipe to a separate filter() command for clarity.</p>
<p><em>Note: some readers may notice that it would be easier to just filter by <code>date_hospitalisation</code> because it is 100% complete with no missing values. This is true. But <code>date_onset</code> is used for purposes of demonstrating a complex filter.</em></p>
</div>
</div>
<div id="standalone" class="section level3 unnumbered">
<h3>Standalone<a class="anchor" aria-label="anchor" href="#standalone"><i class="fas fa-link"></i></a>
</h3>
<p>Filtering can also be done as a stand-alone command (not part of a pipe chain). Like other <strong>dplyr</strong> verbs, in this case the first argument must be the dataset itself.</p>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># dataframe &lt;- filter(dataframe, condition(s) for rows to keep)</span>

<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">linelist</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">case_id</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>You can also use <strong>base</strong> R to subset using square brackets which reflect the [rows, columns] that you want to retain.</p>
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># dataframe &lt;- dataframe[row conditions, column conditions] (blank means keep all)</span>

<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">case_id</span><span class="op">)</span>, <span class="op">]</span></code></pre></div>
</div>
<div id="quickly-review-records" class="section level3 unnumbered">
<h3>Quickly review records<a class="anchor" aria-label="anchor" href="#quickly-review-records"><i class="fas fa-link"></i></a>
</h3>
<p>Often you want to quickly review a few records, for only a few columns. The <strong>base</strong> R function <code><a href="https://rdrr.io/r/utils/View.html">View()</a></code> will print a data frame for viewing in your RStudio.</p>
<p>View the linelist in RStudio:</p>
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span></code></pre></div>
<p>Here are two examples of viewing specific cells (specific rows, and specific columns):</p>
<p><strong>With dplyr functions <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> and <code>select()</code>:</strong></p>
<p>Within <code><a href="https://rdrr.io/r/utils/View.html">View()</a></code>, pipe the dataset to <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> to keep certain rows, and then to <code>select()</code> to keep certain columns. For example, to review onset and hospitalization dates of 3 specific cases:</p>
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op">(</span><span class="va">linelist</span> <span class="op">%&gt;%</span>
       <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">case_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"11f8ea"</span>, <span class="st">"76b97a"</span>, <span class="st">"47a5f5"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
       <span class="fu">select</span><span class="op">(</span><span class="va">date_onset</span>, <span class="va">date_hospitalisation</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>You can achieve the same with <strong>base</strong> R syntax, using brackets <code>[ ]</code> to subset you want to see.</p>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">[</span><span class="va">linelist</span><span class="op">$</span><span class="va">case_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"11f8ea"</span>, <span class="st">"76b97a"</span>, <span class="st">"47a5f5"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"date_onset"</span>, <span class="st">"date_hospitalisation"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<div id="add-to-pipe-chain-1" class="section level4 unnumbered">
<h4>Add to pipe chain<a class="anchor" aria-label="anchor" href="#add-to-pipe-chain-1"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># CLEANING 'PIPE' CHAIN (starts with raw data and pipes it through cleaning steps)</span>
<span class="co">##################################################################################</span>

<span class="co"># begin cleaning pipe chain</span>
<span class="co">###########################</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op">%&gt;%</span>
    
    <span class="co"># standardize column name syntax</span>
    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># manually re-name columns</span>
           <span class="co"># NEW name             # OLD name</span>
    <span class="fu">rename</span><span class="op">(</span>date_infection       <span class="op">=</span> <span class="va">infection_date</span>,
           date_hospitalisation <span class="op">=</span> <span class="va">hosp_date</span>,
           date_outcome         <span class="op">=</span> <span class="va">date_of_outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># remove column</span>
    <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">row_num</span>, <span class="va">merged_header</span>, <span class="va">x28</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
    <span class="co"># de-duplicate</span>
    <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 

    <span class="co"># add column</span>
    <span class="fu">mutate</span><span class="op">(</span>bmi <span class="op">=</span> <span class="va">wt_kg</span> <span class="op">/</span> <span class="op">(</span><span class="va">ht_cm</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>     

    <span class="co"># convert class of columns</span>
    <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">contains</span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span>, <span class="va">as.Date</span><span class="op">)</span>, 
           generation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">generation</span><span class="op">)</span>,
           age        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># add column: delay to hospitalisation</span>
    <span class="fu">mutate</span><span class="op">(</span>days_onset_hosp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">date_hospitalisation</span> <span class="op">-</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># clean values of hospital column</span>
    <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span><span class="va">hospital</span>,
                      <span class="co"># OLD = NEW</span>
                      <span class="st">"Mitylira Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Mitylira Hospital"</span> <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Military Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Port Hopital"</span>      <span class="op">=</span> <span class="st">"Port Hospital"</span>,
                      <span class="st">"Central Hopital"</span>   <span class="op">=</span> <span class="st">"Central Hospital"</span>,
                      <span class="st">"other"</span>             <span class="op">=</span> <span class="st">"Other"</span>,
                      <span class="st">"St. Marks Maternity Hopital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span>
                      <span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 

    <span class="co"># create age_years column (from age and age_unit)</span>
    <span class="fu">mutate</span><span class="op">(</span>age_years <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span>
          <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"years"</span> <span class="op">~</span> <span class="va">age</span>,
          <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"months"</span> <span class="op">~</span> <span class="va">age</span><span class="op">/</span><span class="fl">12</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">age_unit</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span>,
          <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_real_</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
    <span class="fu">mutate</span><span class="op">(</span>
          <span class="co"># age categories: custom</span>
          age_cat <span class="op">=</span> <span class="fu">epikit</span><span class="fu">::</span><span class="fu"><a href="https://r4epi.github.io/epikit/reference/age_categories.html">age_categories</a></span><span class="op">(</span><span class="va">age_years</span>, breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">70</span><span class="op">)</span><span class="op">)</span>,
        
          <span class="co"># age categories: 0 to 85 by 5s</span>
          age_cat5 <span class="op">=</span> <span class="fu">epikit</span><span class="fu">::</span><span class="fu"><a href="https://r4epi.github.io/epikit/reference/age_categories.html">age_categories</a></span><span class="op">(</span><span class="va">age_years</span>, breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">85</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># ABOVE ARE UPSTREAM CLEANING STEPS ALREADY DISCUSSED</span>
    <span class="co">###################################################</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span>
          <span class="co"># keep only rows where case_id is not missing</span>
          <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">case_id</span><span class="op">)</span>,  
          
          <span class="co"># also filter to keep only the second outbreak</span>
          <span class="va">date_onset</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2013-06-01"</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">hospital</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Hospital A"</span>, <span class="st">"Hospital B"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="row-wise-calculations" class="section level2" number="8.7">
<h2>
<span class="header-section-number">8.7</span> Row-wise calculations<a class="anchor" aria-label="anchor" href="#row-wise-calculations"><i class="fas fa-link"></i></a>
</h2>
<p>If you want to perform a calculation within a row, you can use <code>rowwise()</code> from <strong>dplyr</strong>. See this online vignette on <a href="https://cran.r-project.org/web/packages/dplyr/vignettes/rowwise.html">row-wise calculations</a>.<br>
For example, this code applies <code>rowwise()</code> and then creates a new column that sums the number of the specified symptom columns that have value “yes”, for each row in the linelist. The columns are specified within <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> by name within a vector <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>. <code>rowwise()</code> is essentially a special kind of <code>group_by()</code>, so it is best to use <code>ungroup()</code> when you are done (page on [Grouping data]).</p>
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span>
  <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>num_symptoms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">fever</span>, <span class="va">chills</span>, <span class="va">cough</span>, <span class="va">aches</span>, <span class="va">vomit</span><span class="op">)</span> <span class="op">==</span> <span class="st">"yes"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">fever</span>, <span class="va">chills</span>, <span class="va">cough</span>, <span class="va">aches</span>, <span class="va">vomit</span>, <span class="va">num_symptoms</span><span class="op">)</span> <span class="co"># for display</span></code></pre></div>
<pre><code>## # A tibble: 5,888 x 6
##    fever chills cough aches vomit num_symptoms
##    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;        &lt;int&gt;
##  1 no    no     yes   no    yes              2
##  2 &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;            NA
##  3 &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;            NA
##  4 no    no     no    no    no               0
##  5 no    no     yes   no    yes              2
##  6 no    no     yes   no    yes              2
##  7 &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;            NA
##  8 no    no     yes   no    yes              2
##  9 no    no     yes   no    yes              2
## 10 no    no     yes   no    no               1
## # ... with 5,878 more rows</code></pre>
<p>As you specify the column to evaluate, you may want to use the “tidyselect” helper functions described in the <code>select()</code> section of this page. You just have to make one adjustment (because you are not using them within a <strong>dplyr</strong> function like <code>select()</code> or <code>summarise()</code>).</p>
<p>Put the column-specification criteria within the <strong>dplyr</strong> function <code>c_across()</code>. This is because <code>c_across</code> (<a href="https://dplyr.tidyverse.org/reference/c_across.html">documentation</a>) is designed to work with <code>rowwise()</code> specifically. For example, the following code:</p>
<ul>
<li>Applies <code>rowwise()</code> so the following operation (<code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code>) is applied within each row (not summing entire columns)<br>
</li>
<li>Creates new column <code>num_NA_dates</code>, defined for each row as the number of columns (with name containing “date”) for which <code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code> evaluated to TRUE (they are missing data).<br>
</li>
<li>
<code>ungroup()</code> to remove the effects of <code>rowwise()</code> for subsequent steps</li>
</ul>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span>
  <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>num_NA_dates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="fu">c_across</span><span class="op">(</span><span class="fu">contains</span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">num_NA_dates</span>, <span class="fu">contains</span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span><span class="op">)</span> <span class="co"># for display</span></code></pre></div>
<pre><code>## # A tibble: 5,888 x 5
##    num_NA_dates date_infection date_onset date_hospitalisation date_outcome
##           &lt;int&gt; &lt;date&gt;         &lt;date&gt;     &lt;date&gt;               &lt;date&gt;      
##  1            1 2014-05-08     2014-05-13 2014-05-15           NA          
##  2            1 NA             2014-05-13 2014-05-14           2014-05-18  
##  3            1 NA             2014-05-16 2014-05-18           2014-05-30  
##  4            1 2014-05-04     2014-05-18 2014-05-20           NA          
##  5            0 2014-05-18     2014-05-21 2014-05-22           2014-05-29  
##  6            0 2014-05-03     2014-05-22 2014-05-23           2014-05-24  
##  7            0 2014-05-22     2014-05-27 2014-05-29           2014-06-01  
##  8            0 2014-05-28     2014-06-02 2014-06-03           2014-06-07  
##  9            1 NA             2014-06-05 2014-06-06           2014-06-18  
## 10            1 NA             2014-06-05 2014-06-07           2014-06-09  
## # ... with 5,878 more rows</code></pre>
<p>You could also provide other functions, such as <code><a href="https://rdrr.io/r/base/Extremes.html">max()</a></code> to get the latest or most recent date for each row:</p>
<div class="sourceCode" id="cb143"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span>
  <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>latest_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu">c_across</span><span class="op">(</span><span class="fu">contains</span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">latest_date</span>, <span class="fu">contains</span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># for display</span></code></pre></div>
<pre><code>## # A tibble: 5,888 x 5
##    latest_date date_infection date_onset date_hospitalisation date_outcome
##    &lt;date&gt;      &lt;date&gt;         &lt;date&gt;     &lt;date&gt;               &lt;date&gt;      
##  1 2014-05-15  2014-05-08     2014-05-13 2014-05-15           NA          
##  2 2014-05-18  NA             2014-05-13 2014-05-14           2014-05-18  
##  3 2014-05-30  NA             2014-05-16 2014-05-18           2014-05-30  
##  4 2014-05-20  2014-05-04     2014-05-18 2014-05-20           NA          
##  5 2014-05-29  2014-05-18     2014-05-21 2014-05-22           2014-05-29  
##  6 2014-05-24  2014-05-03     2014-05-22 2014-05-23           2014-05-24  
##  7 2014-06-01  2014-05-22     2014-05-27 2014-05-29           2014-06-01  
##  8 2014-06-07  2014-05-28     2014-06-02 2014-06-03           2014-06-07  
##  9 2014-06-18  NA             2014-06-05 2014-06-06           2014-06-18  
## 10 2014-06-09  NA             2014-06-05 2014-06-07           2014-06-09  
## # ... with 5,878 more rows</code></pre>
</div>
<div id="arrange-and-sort" class="section level2" number="8.8">
<h2>
<span class="header-section-number">8.8</span> Arrange and sort<a class="anchor" aria-label="anchor" href="#arrange-and-sort"><i class="fas fa-link"></i></a>
</h2>
<p>Use the <strong>dplyr</strong> function <code>arrange()</code> to sort or order the rows by column values.</p>
<p>Simple list the columns in the order they should be sorted on. Specify <code>.by_group = TRUE</code> if you want the sorting to to first occur by any <em>groupings</em> applied to the data (see page on [Grouping data]).</p>
<p>By default, column will be sorted in “ascending” order (which applies to numeric and also to character columns). You can sort a variable in “descending” order by wrapping it with <code>desc()</code>.</p>
<p>Sorting data with <code>arrange()</code> is particularly useful when making [Tables for presentation], using <code>slice()</code> to take the “top” rows per group, or setting factor level order by order of appearance.</p>
<p>For example, to sort the our linelist rows by <code>hospital</code>, then by <code>date_onset</code> in descending order, we would use:</p>
<div class="sourceCode" id="cb145"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span> 
   <span class="fu">arrange</span><span class="op">(</span><span class="va">hospital</span>, <span class="fu">desc</span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span><span class="op">)</span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="import-and-export.html"><span class="header-section-number">7</span> Importación y exportación</a></div>
<div class="next"><a href="working-with-dates.html"><span class="header-section-number">9</span> Borrador. Trabajando con Fechas</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#cleaning-data-and-core-functions"><span class="header-section-number">8</span> Limpieza de datos y funciones básicas</a></li>
<li>
<a class="nav-link" href="#funciones-principales">Funciones principales</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#nomenclatura-1">Nomenclatura</a></li></ul>
</li>
<li><a class="nav-link" href="#limpieza-de-tuber%C3%ADas"><span class="header-section-number">8.1</span> Limpieza de tuberías</a></li>
<li><a class="nav-link" href="#carga-de-paquetes"><span class="header-section-number">8.2</span> Carga de paquetes</a></li>
<li>
<a class="nav-link" href="#importar-datos"><span class="header-section-number">8.3</span> Importar datos</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#importar">Importar</a></li></ul>
</li>
<li><a class="nav-link" href="#revisar">Revisar</a></li>
<li>
<a class="nav-link" href="#nombres-de-columnas"><span class="header-section-number">8.4</span> Nombres de columnas</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#etiquetas">Etiquetas</a></li>
<li><a class="nav-link" href="#limpieza-autom%C3%A1tica">Limpieza automática</a></li>
<li><a class="nav-link" href="#limpieza-manual-de-nombres">Limpieza manual de nombres</a></li>
<li><a class="nav-link" href="#otros-retos">Otros retos</a></li>
<li><a class="nav-link" href="#quantile-breaks">Quantile breaks</a></li>
<li><a class="nav-link" href="#evenly-sized-groups">Evenly-sized groups</a></li>
<li><a class="nav-link" href="#case_when">case_when()</a></li>
<li><a class="nav-link" href="#add-to-pipe-chain">Add to pipe chain</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#add-rows"><span class="header-section-number">8.5</span> Add rows</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#one-by-one">One-by-one</a></li>
<li><a class="nav-link" href="#bind-rows">Bind rows</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#filter-rows"><span class="header-section-number">8.6</span> Filter rows</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#simple-filter">Simple filter</a></li>
<li><a class="nav-link" href="#filter-out-missing-values">Filter out missing values</a></li>
<li><a class="nav-link" href="#filter-by-row-number">Filter by row number</a></li>
<li><a class="nav-link" href="#complex-filter">Complex filter</a></li>
<li><a class="nav-link" href="#standalone">Standalone</a></li>
<li><a class="nav-link" href="#quickly-review-records">Quickly review records</a></li>
</ul>
</li>
<li><a class="nav-link" href="#row-wise-calculations"><span class="header-section-number">8.7</span> Row-wise calculations</a></li>
<li><a class="nav-link" href="#arrange-and-sort"><span class="header-section-number">8.8</span> Arrange and sort</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>El manual de R para la Epidemiología</strong>" was written by El equipo del manual. It was last built on 2022-01-18.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
