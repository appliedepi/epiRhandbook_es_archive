<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>30 Conceptos básicos de ggplot | EpiRhandbook en español</title>
<meta name="author" content="El equipo del manual">
<meta name="description" content="ggplot2 es el paquete de R más popular para la visualización de datos. Su función ggplot() es el núcleo de este paquete, y todo este enfoque se conoce coloquialmente como “ggplot”, con las figuras...">
<meta name="generator" content="bookdown 0.29 with bs4_book()">
<meta property="og:title" content="30 Conceptos básicos de ggplot | EpiRhandbook en español">
<meta property="og:type" content="book">
<meta property="og:description" content="ggplot2 es el paquete de R más popular para la visualización de datos. Su función ggplot() es el núcleo de este paquete, y todo este enfoque se conoce coloquialmente como “ggplot”, con las figuras...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="30 Conceptos básicos de ggplot | EpiRhandbook en español">
<meta name="twitter:description" content="ggplot2 es el paquete de R más popular para la visualización de datos. Su función ggplot() es el núcleo de este paquete, y todo este enfoque se conoce coloquialmente como “ggplot”, con las figuras...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.25/datatables.js"></script><link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/tabwid.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/scrool.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.9/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.5.1/plotly-basic-2.5.1.min.js"></script><script src="libs/plotly-cartesian-2.5.1/plotly-cartesian-2.5.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">EpiRhandbook en español</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Buscar" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Tabla de contenidos</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">Acerca de este libro</li>
<li><a class="" href="editorial-and-technical-notes.html"><span class="header-section-number">1</span> Notas editoriales y técnicas</a></li>
<li><a class="" href="download-handbook-and-data.html"><span class="header-section-number">2</span> Descargando el manual y los datos</a></li>
<li class="book-part">Aspectos básicos</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">3</span> Fundamentos de R</a></li>
<li><a class="" href="transition-to-r.html"><span class="header-section-number">4</span> Transición a R</a></li>
<li><a class="" href="suggested-packages-1.html"><span class="header-section-number">5</span> Paquetes recomendados</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> Proyectos en R</a></li>
<li><a class="" href="import-and-export.html"><span class="header-section-number">7</span> Importación y exportación</a></li>
<li class="book-part">Gestión de datos</li>
<li><a class="" href="cleaning-data-and-core-functions.html"><span class="header-section-number">8</span> Limpieza de datos y funciones básicas</a></li>
<li><a class="" href="working-with-dates.html"><span class="header-section-number">9</span> Trabajando con Fechas</a></li>
<li><a class="" href="characters-and-strings.html"><span class="header-section-number">10</span> Caracteres y cadenas</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> Factores</a></li>
<li><a class="" href="pivoting-data.html"><span class="header-section-number">12</span> Pivotar datos</a></li>
<li><a class="" href="grouping-data.html"><span class="header-section-number">13</span> Agrupar datos</a></li>
<li><a class="" href="joining-data.html"><span class="header-section-number">14</span> Unir datos</a></li>
<li><a class="" href="de-duplication.html"><span class="header-section-number">15</span> Borrador. De-duplicación</a></li>
<li><a class="" href="iteration-loops-and-lists.html"><span class="header-section-number">16</span> Borrador. Iteración, bucles y listas</a></li>
<li class="book-part">Análisis</li>
<li><a class="" href="descriptive-tables.html"><span class="header-section-number">17</span> Tablas descriptivas</a></li>
<li><a class="" href="simple-statistical-tests.html"><span class="header-section-number">18</span> Tests estadísticos sencillos</a></li>
<li><a class="" href="univariate-and-multivariable-regression.html"><span class="header-section-number">19</span> Borrador. Regresión univariante y multivariable</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> Borrador. Valores faltantes</a></li>
<li><a class="" href="standardised-rates.html"><span class="header-section-number">21</span> Borrador. Tasas estandarizadas</a></li>
<li><a class="" href="moving-averages.html"><span class="header-section-number">22</span> Borrador. Medias Móviles</a></li>
<li><a class="" href="time-series-and-outbreak-detection.html"><span class="header-section-number">23</span> Borrador. Series temporales y detección de brotes</a></li>
<li><a class="" href="epidemic-modeling.html"><span class="header-section-number">24</span> Borrador. Modelización de epidemias</a></li>
<li><a class="" href="contact-tracing-1.html"><span class="header-section-number">25</span> Borrador. Rastreo de contactos</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">26</span> Borrador. Análisis de encuestas</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">27</span> Borrador. Análisis de supervivencia</a></li>
<li><a class="" href="gis-basics.html"><span class="header-section-number">28</span> Conceptos básicos de los SIG</a></li>
<li class="book-part">Visualización de datos</li>
<li><a class="" href="tables-for-presentation.html"><span class="header-section-number">29</span> Tablas para presentaciones</a></li>
<li><a class="active" href="ggplot-basics.html"><span class="header-section-number">30</span> Conceptos básicos de ggplot</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">31</span> Consejos de ggplot</a></li>
<li><a class="" href="epidemic-curves.html"><span class="header-section-number">32</span> Curvas epidémicas</a></li>
<li><a class="" href="demographic-pyramids-and-likert-scales.html"><span class="header-section-number">33</span> Pirámides de población y escalas de Likert</a></li>
<li><a class="" href="heat-plots.html"><span class="header-section-number">34</span> Gráficos de calor</a></li>
<li><a class="" href="diagrams-and-charts.html"><span class="header-section-number">35</span> Diagramas y gráficos</a></li>
<li><a class="" href="combinations-analysis.html"><span class="header-section-number">36</span> Borrador. Análisis de combinaciones</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">37</span> Borrador. Cadenas de transmisión</a></li>
<li><a class="" href="phylogenetic-trees-1.html"><span class="header-section-number">38</span> Árboles filogenéticos</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">39</span> Gráficos interactivos</a></li>
<li class="book-part">Informes y Dashboards</li>
<li><a class="" href="reports-with-r-markdown.html"><span class="header-section-number">40</span> Informes con R Markdown</a></li>
<li><a class="" href="organizing-routine-reports.html"><span class="header-section-number">41</span> Organización de informes rutinarios</a></li>
<li><a class="" href="dashboards-with-r-markdown.html"><span class="header-section-number">42</span> Borrador. Dashboards con R Markdown</a></li>
<li><a class="" href="dashboards-with-shiny.html"><span class="header-section-number">43</span> Borrador. Dashboards con Shiny</a></li>
<li class="book-part">Miscelánea</li>
<li><a class="" href="writing-functions-1.html"><span class="header-section-number">44</span> Escribir funciones</a></li>
<li><a class="" href="directory-interactions.html"><span class="header-section-number">45</span> Interacciones con directorios</a></li>
<li><a class="" href="version-control-and-collaboration-with-git-and-github.html"><span class="header-section-number">46</span> Control de versiones y colaboración con Git y Github</a></li>
<li><a class="" href="common-errors.html"><span class="header-section-number">47</span> Errores comunes</a></li>
<li><a class="" href="getting-help.html"><span class="header-section-number">48</span> Cómo obtener ayuda</a></li>
<li><a class="" href="r-on-network-drives.html"><span class="header-section-number">49</span> R en redes locales</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">50</span> data.table</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="ggplot-basics" class="section level1" number="30">
<h1>
<span class="header-section-number">30</span> Conceptos básicos de ggplot<a class="anchor" aria-label="anchor" href="#ggplot-basics"><i class="fas fa-link"></i></a>
</h1>
<div class="inline-figure"><img src="images/ggplot_basics_top.png" width="100%" style="display: block; margin: auto;"></div>
<p><strong>ggplot2</strong> es el paquete de R más popular para la visualización de datos. Su función <code>ggplot()</code> es el núcleo de este paquete, y todo este enfoque se conoce coloquialmente como <em>“ggplot”</em>, con las figuras resultantes a veces llamadas afectuosamente “ggplots”. El “gg” en estos nombres se refiere a la “<strong>g</strong>ramática de los <strong>g</strong>ráficos” utilizada para construir las figuras. <strong>ggplot2</strong> se beneficia de una amplia variedad de paquetes de R complementarios que mejoran aún más su funcionalidad.</p>
<p>La sintaxis es significativamente diferente de los dibujos de <code>R</code> <strong>base</strong>, y tiene una curva de aprendizaje asociada. El uso de <strong>ggplot2</strong> generalmente requiere que el usuario formatee sus datos de una manera que sea altamente compatible con <strong>tidyverse</strong>, lo que en última instancia hace que el uso conjunto de estos paquetes sea muy eficaz.</p>
<p>En esta página cubriremos los fundamentos de la creación de gráficos con <strong>ggplot2</strong>. Consulta la página <a href="ggplot-tips.html#ggplot-tips">Consejos de ggplot</a> para sugerencias y técnicas avanzadas para lograr que sus gráficos se vean realmente bien.</p>
<p>Hay varios tutoriales extensos de <strong>ggplot2</strong> enlazados en la sección de recursos. También puede descargar esta <a href="https://github.com/rstudio/cheatsheets/blob/main/data-visualization-2.1.pdf">hoja de trucos de visualización de datos con ggplot</a> desde el sitio web de RStudio. Si quieres inspirarte en formas de visualizar tus datos de forma creativa, te sugerimos que revises sitios web como la <a href="https://www.r-graph-gallery.com/">galería de gráficos de R</a> y <a href="https://www.data-to-viz.com/caveats.html">Data-to-viz</a>.</p>
<!-- ======================================================= -->
<div id="preparation-21" class="section level2" number="30.1">
<h2>
<span class="header-section-number">30.1</span> Preparación<a class="anchor" aria-label="anchor" href="#preparation-21"><i class="fas fa-link"></i></a>
</h2>
<div id="cargar-paquetes-19" class="section level3 unnumbered">
<h3>Cargar paquetes<a class="anchor" aria-label="anchor" href="#cargar-paquetes-19"><i class="fas fa-link"></i></a>
</h3>
<p>Este trozo de código muestra la carga de los paquetes necesarios para los análisis. En este manual destacamos <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> de <strong>pacman</strong>, que instala el paquete si es necesario <em>y</em> lo carga para su uso. También podes cargar los paquetes instalados con <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> de R <strong>base.</strong> Consulta la página sobre los <a href="r-basics.html#r-basics">fundamentos de R</a> para obtener más información sobre los paquetes de R.</p>
<div class="sourceCode" id="cb1433"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
  <span class="va">tidyverse</span>,      <span class="co"># incluye ggplot2 y otras herramientas de gestión de datos</span>
  <span class="va">rio</span>,            <span class="co"># importación/exportación</span>
  <span class="va">here</span>,           <span class="co"># rutas d elos archivos</span>
  <span class="va">stringr</span>         <span class="co"># trabajar con caracteres    </span>
<span class="op">)</span></code></pre></div>
</div>
<div id="importar-datos-15" class="section level3 unnumbered">
<h3>Importar datos<a class="anchor" aria-label="anchor" href="#importar-datos-15"><i class="fas fa-link"></i></a>
</h3>
<p>Importamos el conjunto de datos de casos de una epidemia de Ebola simulada. Si quieres seguir el proceso, <a href="https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/case_linelists/linelist_cleaned.rds">cliquea para descargar linelist “limpia”</a> (como archivo .rds). Para importar sus datos utilizando la función <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> del paquete <strong>rio</strong> (acepta muchos tipos de archivos como .xlsx, .rds, .csv - consulta la página de <a href="import-and-export.html#import-and-export">importación y exportación</a> para más detalles).</p>
<div class="sourceCode" id="cb1434"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.rds"</span><span class="op">)</span></code></pre></div>
<p>A continuación se muestran las primeras 50 filas del listado. Nos centraremos en las variables continuas <code>age</code>, <code>wt_kg</code> (peso en kilos), <code>ct_blood</code> (valores de CT, cycle threshold, umbral de ciclo del test de PCR) y <code>days_onset_hosp</code> (diferencia entre la fecha de inicio de síntomas y la hospitalización).</p>
<div id="htmlwidget-c9d33573b90429280c2a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-c9d33573b90429280c2a">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399939200000\" data-max=\"1407024000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-29&quot;,&quot;30-49&quot;,&quot;50-69&quot;,&quot;70+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.8184429761563,16.0652496292635,22.4965706447188,71.4144019043841,41.6171224732461,62.0953890870657,0,16.8376536925366,22.7903289734443,53.4119897959184,24.2802636142907,22.4600343506408,54.320987654321,41.0578432556455,28.5664819944598,17.0320552013276,25.0412914912888,38.7172182043977,27.3876813705495,31.5555555555556,14.8069075945662,30.8839811199813,26.6193433895297,59.375,96.6183574879227,19.2394748755093,84.9403122130395,18.4199377406104,27.7722674072605,41.3223140495868,17.2080666586161,24.1671624033314,15.7218971089178,428.994082840237,27.9930220292912,243.261012491782,20.2395007589813,30.527446435638,25.15589569161,47,39.04,31.0661643201798,77.9683671196257,29.5165961238583,166.493236212279,100.308641975309,37.76,20.6037803457852,23.458562375267],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="limpieza-general" class="section level3 unnumbered">
<h3>Limpieza general<a class="anchor" aria-label="anchor" href="#limpieza-general"><i class="fas fa-link"></i></a>
</h3>
<p>Cuando se preparan los datos para trazarlos (graficarlos), lo mejor es hacer que los datos se adhieran a <a href="https://es.r4ds.hadley.nz/datos-ordenados.html">los estándares de datos “ordenados” tanto como</a> sea posible. En las páginas de este manual, sobre <a href="cleaning-data-and-core-functions.html#cleaning-data-and-core-functions">Limpieza de datos y funciones básicas</a>, se explica cómo conseguirlo.</p>
<p>Algunas formas sencillas de preparar nuestros datos para que sea mas fáciles trazarlos pueden incluir la mejora del contenido de los datos para su visualización, lo que no equivale necesariamente a una manipulación de los datos mas sencilla. Por ejemplo:</p>
<ul>
<li>Sustituye los valores <code>NA</code> de una columna de caracteres por la cadena de caracteres “Unknown” (Desconocido)</li>
<li>Considera la posibilidad de convertir la columna en <em>de tipo factor</em> para que sus valores tengan niveles ordinales prescritos</li>
<li>Limpia los valores de algunas columnas para cambiar texto “amigable con los datos” con barra baja, etc. a texto normal o a mayúsculas y minúsculas (ver <a href="characters-and-strings.html#characters-and-strings">Caracteres y cadenas</a>)</li>
</ul>
<p>He aquí algunos ejemplos de esto en acción:</p>
<div class="sourceCode" id="cb1435"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># hace la versión de visualización de las columnas con nombres más amigables</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>
    gender_disp <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span><span class="va">gender</span> <span class="op">==</span> <span class="st">"m"</span> <span class="op">~</span> <span class="st">"Male"</span>,        <span class="co"># m a Masculino </span>
                            <span class="va">gender</span> <span class="op">==</span> <span class="st">"f"</span> <span class="op">~</span> <span class="st">"Female"</span>,      <span class="co"># f a Femenino,</span>
                            <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">gender</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Unknown"</span><span class="op">)</span>,    <span class="co"># NA a Desconocido</span>
    
    outcome_disp <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">outcome</span>, <span class="st">"Unknown"</span><span class="op">)</span>          <span class="co"># sustituye el resultado NA por "unknown"</span>
  <span class="op">)</span></code></pre></div>
</div>
<div id="pivotar-a-lo-largo" class="section level3 unnumbered">
<h3>Pivotar a lo largo<a class="anchor" aria-label="anchor" href="#pivotar-a-lo-largo"><i class="fas fa-link"></i></a>
</h3>
<p>Como una cuestión de estructura de datos, para <strong>ggplot2</strong> a menudo queremos pivotar nuestros datos en formatos <em>largos</em>. Lee más sobre esto en la página de <a href="pivoting-data.html#pivoting-data">Pivoteo de datos</a>.</p>
<div class="inline-figure"><img src="images/pivoting/pivot_longer_new.png" width="100%" style="display: block; margin: auto;"></div>
<p>Por ejemplo, digamos que queremos trazar datos que están en un formato “a lo ancho”, como por ejemplo para cada caso en <code>linelist</code> y sus síntomas. A continuación creamos una minilista llamada <code>symptoms_data</code> que contiene sólo las columnas <code>case_id</code> y symptoms.</p>
<div class="sourceCode" id="cb1436"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">symptoms_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">case_id</span>, <span class="va">fever</span>, <span class="va">chills</span>, <span class="va">cough</span>, <span class="va">aches</span>, <span class="va">vomit</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Así es como se ven las primeras 50 filas de esta minilista - ¿ves cómo están formateadas “a lo ancho” con cada síntoma como una columna?</p>
<div id="htmlwidget-978077d98c18e5945d9c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-978077d98c18e5945d9c">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Si quisiéramos trazar el número de casos con síntomas específicos, estamos limitados por el hecho de que cada síntoma es una columna específica. Sin embargo, podemos <em>hacer pivotar</em> las columnas de síntomas a un formato más largo como este:</p>
<div class="sourceCode" id="cb1437"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">symptoms_data_long</span> <span class="op">&lt;-</span> <span class="va">symptoms_data</span> <span class="op">%&gt;%</span>    <span class="co"># comienza con una "mini" lista de líneas llamada symptoms_data</span>
  
  <span class="fu">pivot_longer</span><span class="op">(</span>
    cols <span class="op">=</span> <span class="op">-</span><span class="va">case_id</span>,                       <span class="co"># pivotea todas las columnas excepto case_id (todas las de síntomas)</span>
    names_to <span class="op">=</span> <span class="st">"symptom_name"</span>,             <span class="co"># se asigna un nombre a la nueva columna que contiene los síntomas</span>
    values_to <span class="op">=</span> <span class="st">"symptom_is_present"</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># se asigna un nombre a la nueva columna que contiene los valores (yes/no)</span>
  
  <span class="fu">mutate</span><span class="op">(</span>symptom_is_present <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">symptom_is_present</span>, <span class="st">"unknown"</span><span class="op">)</span><span class="op">)</span> <span class="co"># convierte NA en "unknown"</span></code></pre></div>
<p>Aquí están las primeras 50 filas. Observa que cada caso tiene 5 filas - una para cada síntoma posible. Las nuevas columnas <code>symptom_name</code> y <code>symptom_is_present</code> son el resultado del pivote. Ten en cuenta que este formato puede no ser muy útil para otras operaciones, pero es útil para trazar.</p>
<div id="htmlwidget-602d0ec43e5376cde99d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-602d0ec43e5376cde99d">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","5fe599","5fe599","5fe599","5fe599","8689b7","8689b7","8689b7","8689b7","8689b7","11f8ea","11f8ea","11f8ea","11f8ea","11f8ea","b8812a","b8812a","b8812a","b8812a","b8812a","893f25","893f25","893f25","893f25","893f25","be99c8","be99c8","be99c8","be99c8","be99c8","07e3e8","07e3e8","07e3e8","07e3e8","07e3e8","369449","369449","369449","369449","369449","f393b4","f393b4","f393b4","f393b4","f393b4","1389ca","1389ca","1389ca","1389ca","1389ca"],["fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit","fever","chills","cough","aches","vomit"],["no","no","yes","no","yes","unknown","unknown","unknown","unknown","unknown","unknown","unknown","unknown","unknown","unknown","no","no","no","no","no","no","no","yes","no","yes","no","no","yes","no","yes","unknown","unknown","unknown","unknown","unknown","no","no","yes","no","yes","no","no","yes","no","yes","no","no","yes","no","no"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>symptom_name<\/th>\n      <th>symptom_is_present<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
</div>
<div id="basics-of-ggplot" class="section level2" number="30.2">
<h2>
<span class="header-section-number">30.2</span> Fundamentos de ggplot<a class="anchor" aria-label="anchor" href="#basics-of-ggplot"><i class="fas fa-link"></i></a>
</h2>
<p><strong>“Gramática de los gráficos” - ggplot2</strong></p>
<p>El trazado con <strong>ggplot2</strong> se basa en “añadir” capas de trazado y elementos de diseño unos sobre otros, añadiendo cada comando a los anteriores con un símbolo de suma (<code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>). El resultado es un objeto de trazado multicapa que se puede guardar, modificar, imprimir, exportar, etc.</p>
<p>Los objetos ggplot pueden ser muy complejos, pero el orden básico de las capas suele ser el siguiente:</p>
<ol style="list-style-type: decimal">
<li>Comienza con el comando <code>ggplot()</code> como punto de partida - esto “abre” el ggplot y permite agregar las funciones subsecuentes con <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>. Normalmente, el conjunto de datos también se especifica en este comando</li>
<li>Añadí capas “geom” - estas funciones visualizan los datos como <em>geometrías</em> (<em>formas</em>), por ejemplo, como un gráfico de barras, un gráfico de líneas, un gráfico de dispersión, un histograma (¡o una combinación!). Todas estas funciones comienzan con <code>geom_</code> como prefijo.</li>
<li>Añadí elementos de diseño al gráfico, como etiquetas de ejes, título, fuentes, tamaños, esquemas de color, leyendas o rotación de ejes.</li>
</ol>
<p>Un ejemplo sencillo del esqueleto del código es el siguiente. Explicaremos cada componente en las secciones siguientes.</p>
<div class="sourceCode" id="cb1438"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Traza los datos de las columnas de my_data como puntos rojos</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">my_data</span><span class="op">)</span><span class="op">+</span>                   <span class="co"># Usa el conjunto de datos my_data"</span>
  <span class="fu">geom_point</span><span class="op">(</span>                             <span class="co"># añade una capa de puntos</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">col1</span>, y <span class="op">=</span> <span class="va">col2</span><span class="op">)</span>,    <span class="co"># "asigna" la columna de datos a los ejes</span>
    color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span>                       <span class="co"># otras especificaciones para el geom</span>
  <span class="fu">labs</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                 <span class="co"># aquí se añaden los títulos, las etiquetas de los ejes, etc.</span>
  <span class="fu">theme</span><span class="op">(</span><span class="op">)</span>                                 <span class="co"># aquí se ajusta el color, la fuente, el tamaño, etc. de los elementos de trazado no relacionados con los datos (ejes, título, etc.) </span></code></pre></div>
</div>
<div id="ggplot" class="section level2" number="30.3">
<h2>
<span class="header-section-number">30.3</span> <code>ggplot()</code><a class="anchor" aria-label="anchor" href="#ggplot"><i class="fas fa-link"></i></a>
</h2>
<p>El comando de apertura de cualquier gráfico ggplot2 es <code>ggplot()</code>. Este comando simplemente crea un lienzo en blanco sobre el que añadir capas. Se “abre” el camino para añadir más capas con un símbolo <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>.</p>
<p>Normalmente, el comando <code>ggplot()</code> incluye el argumento <code>data =</code> para el gráfico. Esto establece el conjunto de datos que se utilizará de manera predeterminada para las capas posteriores del gráfico.</p>
<p>Este comando terminará con un <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> después de su paréntesis de cierre. Esto deja el comando “abierto”. El ggplot sólo se ejecutará/aparecerá cuando el comando completo incluya una capa final <em>sin</em> un <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> al final.</p>
<div class="sourceCode" id="cb1439"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Esto creará un lienzo en blanco</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span></code></pre></div>
</div>
<div id="geoms" class="section level2" number="30.4">
<h2>
<span class="header-section-number">30.4</span> Geoms<a class="anchor" aria-label="anchor" href="#geoms"><i class="fas fa-link"></i></a>
</h2>
<p>Un lienzo en blanco no es suficiente: necesitamos crear geometrías (formas o tipos de gráfico) a partir de nuestros datos (por ejemplo, gráficos de barras, histogramas, gráficos de dispersión, gráficos de caja).</p>
<p>Esto se hace añadiendo capas “geoms” al comando inicial <code>ggplot()</code>. Hay muchas funciones de <strong>ggplot2</strong> que crean “geoms”. Cada una de estas funciones comienza con “geom_”, por lo que nos referiremos a ellas genéricamente como <code>geom_XXXX()</code>. Hay más de 40 geoms disponibles en <strong>ggplot2</strong> y muchos otros creados por fans. Míralos en la <a href="https://exts.ggplot2.tidyverse.org/gallery/">galería de ggplot2</a>. Algunos geoms de uso común se enumeran a continuación:</p>
<ul>
<li>Histogramas - <code>geom_histogram()</code>
</li>
<li>Gráficos de barras - <code>geom_bar()</code> o <code>geom_col()</code> (véase <a href="ggplot-basics.html#ggplot_basics_bars">la sección “Gráfico de barras”</a>)</li>
<li>Gráficos de caja - <code>geom_boxplot()</code>
</li>
<li>Puntos (por ejemplo, gráficos de dispersión) - <code>geom_point()</code>
</li>
<li>Gráficos de líneas - <code>geom_line()</code> o <code>geom_path()</code>
</li>
<li>Líneas de tendencia - <code>geom_smooth()</code>
</li>
</ul>
<p>En un gráfico se pueden exponer uno o varios geoms. Cada uno se añade a los comandos anteriores de <strong>ggplot2</strong> con un <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>, y se agregan secuencialmente de manera que los geoms posteriores se trazan encima de los anteriores.</p>
</div>
<div id="ggplot_basics_mapping" class="section level2" number="30.5">
<h2>
<span class="header-section-number">30.5</span> Asignación de datos al gráfico<a class="anchor" aria-label="anchor" href="#ggplot_basics_mapping"><i class="fas fa-link"></i></a>
</h2>
<p>A la mayoría de las funciones geom hay que darle instrucciones sobre <em>qué elementos utilizar</em> para crear sus formas, por lo que hay que indicarles cómo se deben asignar las <em>columnas de los datos</em> a los distintos componentes del gráfico, como los ejes, los colores de las formas, los tamaños de las formas, etc. Para la mayoría de las funciones geom, los componentes <em>esenciales</em> que deben asignarse a las columnas de los datos son el eje-x y (si es necesario) el eje-y.</p>
<p>Este “mapeo” (o asignación) se produce con el argumento mapping <code><a href="https://rdrr.io/r/base/assignOps.html">=</a></code>. Los mapeos que proporciones a <strong>mapping</strong> deben estar envueltos en la función <code>aes()</code>, por lo que hay que escribir algo como <code>mapping = aes(x = col1, y = col2)</code>, como se muestra a continuación.</p>
<p>A continuación, en el comando <code>ggplot()</code> los datos se identifican utilizando el termino <code>linelist</code> . En el argumento <code>mapping = aes()</code> la columna <code>age</code> se asigna al eje-x, y la columna <code>wt_kg</code> se asigna al eje-y.</p>
<p>Después de agregar un <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>, los comandos de trazado pueden continuar. Se crea una forma o tipo de gráfico con la función de “geom” denominada <code>geom_point()</code>. Este geom <em>hereda</em> los mapeos del comando <code>ggplot()</code> anterior - conoce las asignaciones eje-columna y procede a visualizar esas relaciones como <em>puntos</em> en el lienzo.</p>
<div class="sourceCode" id="cb1440"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1032-1.png" width="672"></div>
<p>Otro ejemplo que presentamos a continuación demuestra el uso de los mismos datos pero con un mapeo ligeramente diferente y utilizando un geom diferente. Ahora utilizamos la función <code>geom_histogram()</code> que sólo requiere una columna mapeada en el eje-x, ya que el eje-y de conteo de casos (‘count’) se genera automáticamente.</p>
<div class="sourceCode" id="cb1441"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1033-1.png" width="672"></div>
<div id="estética-del-gráfico" class="section level3 unnumbered">
<h3>Estética del gráfico<a class="anchor" aria-label="anchor" href="#est%C3%A9tica-del-gr%C3%A1fico"><i class="fas fa-link"></i></a>
</h3>
<p>En la terminología de ggplot, la “estética” de un gráfico tiene un significado específico. Se refiere a una propiedad visual de <em>los datos trazados</em>. Ten en cuenta que “estética” aquí se refiere a los <em>datos que se trazan en geoms / formas</em> - no a lo que aparece en la periferia, tales como títulos, etiquetas de los ejes, el color de fondo, como podría comúnmente asociarse con la palabra “estética”. En ggplot esos detalles se llaman “temas” y se ajustan dentro de un comando denominado <code>theme()</code> (ver <a href="ggplot-basics.html#ggplot_basics_themes">esta sección</a>).</p>
<p>Por lo tanto, la <em>estética</em> de los objetos de ploteo puede ser colores, tamaños, transparencias, colocación, etc. <em>de los datos ploteados</em>. No todos los geoms tendrán las mismas opciones estéticas, pero muchas pueden ser utilizadas por la mayoría de los geoms. He aquí algunos ejemplos:</p>
<ul>
<li>
<code>shape =</code> Representar un punto con <code>geom_point()</code> con forma de punto, estrella, triángulo o cuadrado…</li>
<li>
<code>fill =</code> El color interior (por ejemplo, de una barra o boxplot)</li>
<li>
<code>color =</code> El color de la línea exterior o borde de una barra, boxplot, etc., o el color del perimetro del punto si se utiliza <code>geom_point()</code>
</li>
<li>
<code>size =</code> El tamaño (por ejemplo, grosor de línea, tamaño de punto)</li>
<li>
<code>alpha =</code> Transparencia (1 = opaco, 0 = invisible)</li>
<li>
<code>binwidth =</code> Ancho de los bins (o cubos) del histograma</li>
<li>
<code>width =</code> Ancho de las columnas del “diagrama de barras”</li>
<li>
<code>linetype =</code> Tipo de línea (por ejemplo, sólida, discontinua, punteada)</li>
</ul>
<p>A esta estética de los objetos del gráfico se le pueden asignar valores de dos maneras:</p>
<ol style="list-style-type: decimal">
<li><p>Se asigna un valor estático (por ejemplo, <code>color = "blue"</code>) que se aplica a todas las observaciones trazadas</p></li>
<li><p>Se asigna a una columna de los datos (por ejemplo, <code>color = hospital</code>) de manera que la visualización de cada observación depende de su valor en esa columna</p></li>
</ol>
<!-- *These non-axis aesthetics can be assigned static values (e.g. `size = 1`) or can be mapped to a column (e.g. `size = age`).* If you want the aesthetic to be assigned a static value, the assignment is placed *outside* the `mapping = aes()`. If you want the aesthetic to be scaled/depend on the value in each row of data, the assignment is made *inside* the `mapping = aes()`.   -->
</div>
<div id="asignar-un-valor-estático" class="section level3 unnumbered">
<h3>Asignar un valor estático<a class="anchor" aria-label="anchor" href="#asignar-un-valor-est%C3%A1tico"><i class="fas fa-link"></i></a>
</h3>
<p>Si se desea que la estética del objeto de trazado sea estática, es decir, que sea la misma para cada observación de los datos, se escribe su asignación dentro del geom pero <em>fuera</em> del comando <code>mapping = aes()</code>. Estas asignaciones podrían escribirse como <code>size = 1</code> o <code>color = "blue"</code>. Aquí hay dos ejemplos:</p>
<ul>
<li><p>En el primer ejemplo, el <code>mapping = aes()</code> está en el comando <code>ggplot()</code> y los ejes se asignan a las columnas de edad (age) y peso (wt_kg) en los datos. La estética del gráfico <code>color =</code>, <code>size =</code>, y <code>alpha =</code> (transparencia) se asignan a valores estáticos. Aclaramos que la asignación de valores estéticos de naturaleza estática se hace en la función <code>geom_point()</code>, ya que se pueden añadir otros geoms después que tomarían valores estéticos diferentes</p></li>
<li><p>En el segundo ejemplo, el histograma requiere sólo el eje-x mapeado a una columna. El <code>binwidth =</code> (el ancho de los cubos), el <code>color =</code> (el color del borde de los cubos), el <code>fill =</code> (color interno o color de relleno de los cubos), y el <code>alpha =</code> (la transparencia del color de los cubos) se establecen dentro del geom como valores estáticos.</p></li>
</ul>
<div class="sourceCode" id="cb1442"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># scatterplot</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># establecer datos y ejes de mapeo</span>
  <span class="fu">geom_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgreen"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>         <span class="co"># establecer la estética de los puntos estáticos</span>

<span class="co"># histogram</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>       <span class="co"># establecer datos y ejes</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>              <span class="co"># mostrar histograma</span>
    binwidth <span class="op">=</span> <span class="fl">7</span>,                <span class="co"># anchura de los bins (cuadrados)</span>
    color <span class="op">=</span> <span class="st">"red"</span>,               <span class="co"># color de la línea del bin</span>
    fill <span class="op">=</span> <span class="st">"blue"</span>,               <span class="co"># color del interior del bin</span>
    alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>                 <span class="co"># transparencia del bin</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1034-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1034-2.png" width="50%"></p>
</div>
<div id="escalado-a-los-valores-de-la-columna" class="section level3 unnumbered">
<h3>Escalado a los valores de la columna<a class="anchor" aria-label="anchor" href="#escalado-a-los-valores-de-la-columna"><i class="fas fa-link"></i></a>
</h3>
<p>Como alternativa al uso de estéticas de naturaleza estática, se pueden graficar objetos con tamaños proporcionales a sus valores como aparecen en su respectiva columna. Con este enfoque, la visualización de esta estética dependerá del valor de esa observación en la columna de datos correspondiente. Si los valores de la columna son continuos, la escala de visualización (en la leyenda) para esa estética será continua. Si los valores de la columna son discretos, la leyenda mostrará cada valor y los datos trazados aparecerán claramente “agrupados” (lea más en la sección de <a href="ggplot-basics.html#ggplotgroups">agrupación</a> de esta página).</p>
<p>Para conseguir esto, se asigna esa estética de gráfico a un <em>nombre de columna</em> o variable (sin utilizar comillas). Esto debe hacerse <em>dentro del comando <code>mapping = aes()</code></em>(nota: hay varios lugares en el código donde puedes hacer estas asignaciones de mapeo, como se discute <a href="ggplot-basics.html#ggplot_basics_map_loc">a continuación</a>).</p>
<p>Presentamos dos ejemplos a continuación.</p>
<ul>
<li>En el primer ejemplo, la estética d <code>color =</code> (de cada punto) está mapeada a la columna <code>age</code> - ¡y ha aparecido una escala en una leyenda! Por ahora sólo hay que tener en cuenta que la escala existe - mostraremos cómo modificarla en secciones posteriores.</li>
<li>En el segundo ejemplo, dos nuevas estéticas de trazado se asignan a columnas (<code>color =</code> y <code>size =</code>), mientras que las estéticas de trazado <code>shape =</code> y <code>alpha =</code> se asignan a valores estáticos fuera de cualquier función de <code>mapping = aes()</code>.</li>
</ul>
<div class="sourceCode" id="cb1443"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># scatterplot</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>,   <span class="co"># establecer los datos</span>
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>     <span class="co"># asignar la estética a los valores de la columna</span>
         x <span class="op">=</span> <span class="va">age</span>,           <span class="co"># asigna el eje-x a la edad             </span>
         y <span class="op">=</span> <span class="va">wt_kg</span>,         <span class="co"># asignar el eje-y al peso</span>
         color <span class="op">=</span> <span class="va">age</span><span class="op">)</span>     <span class="co"># asignar el color a la edad</span>
       <span class="op">)</span><span class="op">+</span>     
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span>         <span class="co"># mostrar los datos como puntos </span>

<span class="co"># scatterplot</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>,   <span class="co"># establecer los datos</span>
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>     <span class="co"># asignar la estética a los valores de la columna</span>
         x <span class="op">=</span> <span class="va">age</span>,           <span class="co"># asigna el eje-x a la edad            </span>
         y <span class="op">=</span> <span class="va">wt_kg</span>,         <span class="co"># asignar el eje-y al peso</span>
         color <span class="op">=</span> <span class="va">age</span>,       <span class="co"># asignar el color a la edad</span>
         size <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>      <span class="co"># asignar el tamaño a la edad</span>
  <span class="fu">geom_point</span><span class="op">(</span>             <span class="co"># mostrar los datos como puntos</span>
    shape <span class="op">=</span> <span class="st">"diamond"</span>,      <span class="co"># los puntos se muestran como diamantes</span>
    alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span>            <span class="co"># transparencia de los puntos al 30%</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1035-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1035-2.png" width="50%"></p>
<p>Nota: Los ejes siempre se asignan a las columnas de los datos o variables (no a los valores estáticos), y esto se hace siempre dentro de <code>mapping = aes()</code>.</p>
<p>Es importante mantener un seguimiento de las capas y las estéticas se hacen gráficos más complejos, por ejemplo, gráficos con múltiples geom. En el ejemplo siguiente, la estetica <code>size =</code> se asigna dos veces - una para <code>geom_point()</code> y otra para <code>geom_smooth()</code> - ambas veces como un valor estático.</p>
<div class="sourceCode" id="cb1444"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>,
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>           <span class="co"># asignar la estética a las columnas</span>
         x <span class="op">=</span> <span class="va">age</span>,
         y <span class="op">=</span> <span class="va">wt_kg</span>,
         color <span class="op">=</span> <span class="va">age_years</span><span class="op">)</span>
       <span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span>                   <span class="co"># añadir puntos para cada fila de datos</span>
    size <span class="op">=</span> <span class="fl">1</span>,
    alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>  
  <span class="fu">geom_smooth</span><span class="op">(</span>                  <span class="co"># añadir una línea de tendencia  </span>
    method <span class="op">=</span> <span class="st">"lm"</span>,             <span class="co"># con método lineal</span>
    size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>                   <span class="co"># tamaño (ancho de la línea) de 2</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1036-1.png" width="672"></div>
</div>
<div id="ggplot_basics_map_loc" class="section level3 unnumbered">
<h3>Dónde hacer las asignaciones<a class="anchor" aria-label="anchor" href="#ggplot_basics_map_loc"><i class="fas fa-link"></i></a>
</h3>
<p>La asignación de estéticas dentro de <code>mapping = aes()</code> puede hacerse en varios lugares en sus comandos e incluso puede escribirse más de una vez. Esto puede ser escrito en el comando <code>ggplot()</code> inicial, y/o en cada geom individual debajo. Los matices incluyen:</p>
<ul>
<li><p>Las asignaciones de estéticas realizadas en el comando <code>ggplot()</code> inicial se heredarán por defecto en cualquier geom a continuación, al igual que se heredan <code>x =</code> e <code>y =</code></p></li>
<li><p>Las asignaciones realizadas dentro de un geom se aplican sólo a ese geom</p></li>
</ul>
<p>Del mismo modo, el comando <code>data =</code> especificado en el <code>ggplot()</code> inicial se aplicará por defecto a cualquier geom que se agregue a continuación, pero también se podrían especificar datos para cada geom (pero esto es más difícil).</p>
<p>Así, cada uno de los siguientes comandos creará el mismo gráfico:</p>
<div class="sourceCode" id="cb1445"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Estos comandos producirán exactamente el mismo gráfico</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="ggplotgroups" class="section level3 unnumbered">
<h3>Grupos<a class="anchor" aria-label="anchor" href="#ggplotgroups"><i class="fas fa-link"></i></a>
</h3>
<p>Puedes agrupar fácilmente los datos y “graficar por grupo”. De hecho, ¡ya lo has hecho!</p>
<p>Asigna la columna que quieres agrupar a la estética adecuada, dentro del comando <code>mapping = aes()</code>. Más arriba hemos mostrado esto usando valores continuos cuando asignamos el tamaño del punto usando <code>size =</code> a la columna <code>age</code>. Sin embargo, esto funciona de la misma manera con columnas o variables discretas/categóricas.</p>
<p>Por ejemplo, si quieres agrupar los puntos por género asignándole un color distinto a cada genero, deberás establecer <code>mapping = aes(color = gender)</code>. Automáticamente aparecerá una leyenda. Esta asignación puede hacerse dentro de <code>mapping = aes()</code> en el comando <code>ggplot()</code> inicial (y ser heredado por el geom), o podría asignarse dentro de <code>mapping = aes()</code> escrito dentro del comando de geom. Ambos enfoques se muestran a continuación:</p>
<div class="sourceCode" id="cb1446"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>,
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span>, color <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1038-1.png" width="672"></div>
<div class="sourceCode" id="cb1447"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Este código alternativo produce el mísmo gráfico</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>,
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">gender</span><span class="op">)</span>,
    alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<p>Tené en cuenta que dependiendo del tipo de geom, tendrás que utilizar diferentes argumentos para agrupar los datos. Para <code>geom_point()</code> lo más probable es que tengas que utilizar <code>color =</code>, <code>shape =</code> o <code>size =</code>. Mientras que para <code>geom_bar()</code> es más probable que utilices <code>fill =</code>. Esto dependerá del tipo de geom y de la estética del gráfico que deses usar para reflejar las agrupaciones.</p>
<p>Para tu información - la forma más básica de agrupar los datos es utilizando sólo el argumento <code>group =</code> dentro de <code>mapping = aes()</code>. Sin embargo, esto por sí mismo no cambiará los colores, el relleno o las formas. Tampoco creará una leyenda. Sin embargo, los datos están agrupados, por lo que las visualizaciones estadísticas pueden verse afectadas.</p>
<p>Para ajustar el orden de los grupos en un gráfico, consulta la página de <a href="ggplot-tips.html#ggplot-tips">Consejos de ggplot</a> o la página sobre <a href="factors.html#factors">Factores</a>. Hay muchos ejemplos de gráficos agrupados en las secciones siguientes sobre el trazado de datos continuos y categóricos.</p>
</div>
</div>
<div id="ggplot_basics_facet" class="section level2" number="30.6">
<h2>
<span class="header-section-number">30.6</span> Facetas / Múltiplos pequeños<a class="anchor" aria-label="anchor" href="#ggplot_basics_facet"><i class="fas fa-link"></i></a>
</h2>
<p>Las facetas, o “pequeños gráficos múltiples”, se utilizan para dividir un gráfico en una figura de varios paneles, con un panel (“faceta”) representando un grupo de datos. El mismo tipo de gráfico se crea varias veces, cada vez utilizando un subgrupo del mismo conjunto de datos.</p>
<p>El facetado es una funcionalidad que viene con <strong>ggplot2</strong>, por lo que las leyendas y los ejes de los <code>paneles</code> facetados se alinean automáticamente. Hay otros paquetes que abordamos en la página de <a href="ggplot-tips.html#ggplot-tips">Consejos de ggplot</a> que se utilizan para combinar gráficos representando conjuntos de datos completamente diferentes (<strong>cowplot</strong> y <strong>patchwork</strong>) en una figura.</p>
<p>El facetado se realiza con una de las siguientes funciones de <strong>ggplot2</strong>:</p>
<ol style="list-style-type: decimal">
<li>
<code>facet_wrap()</code> Para mostrar un panel diferente para cada nivel de una <em>unica</em> variable. Un ejemplo de esto podría ser mostrar una curva de epidemia diferente para cada hospital de una región. Las facetas se ordenan alfabéticamente, a menos que la variable sea un factor con otro orden definido.</li>
</ol>
<ul>
<li>Puedes invocar ciertas opciones para determinar la disposición de las facetas, por ejemplo, <code>nrow = 1</code> o <code>ncol = 1</code> para controlar el número de filas o columnas en las que se organizan los gráficos con facetas.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>
<code>facet_grid()</code> Se utiliza cuando se quiere introducir una segunda variable en la disposición de las facetas. Aquí cada panel de una cuadrícula muestra la intersección entre los valores de <em>dos columnas</em>. Por ejemplo, las curvas epidémicas para cada combinación hospital-grupo de edad con los hospitales en la parte superior (columnas) y los grupos de edad en los lados (filas).</li>
</ol>
<ul>
<li>
<code>nrow</code> y <code>ncol</code> no son relevantes, ya que los subgrupos se presentan en una cuadrícula</li>
</ul>
<p>Cada una de estas funciones acepta una sintaxis de fórmula para especificar la(s) columna(s) para el facetado. Ambas aceptan hasta dos columnas, una a cada lado de la tilde <code><a href="https://rdrr.io/r/base/tilde.html">~</a></code>.</p>
<ul>
<li><p>Para <code>facet_wrap()</code> lo más frecuente es escribir una sola columna precedida de una tilde <code><a href="https://rdrr.io/r/base/tilde.html">~</a></code> como <code>facet_wrap(~hospital)</code>. Sin embargo, puedes escribir dos columnas <code>facet_wrap(outcome~hospital)</code> - cada combinación única se mostrará en un panel separado, pero no se organizarán en una cuadrícula. Los encabezados mostrarán los términos combinados y éstos no tendrán una lógica específica para las columnas frente a las filas. Si quieres proporcionar una sóla variable de facetado, debes utilizar un punto <code>.</code> como marcador de posición en el otro lado de la fórmula - mira los ejemplos de código.</p></li>
<li><p>Para <code>facet_grid()</code> también puedes especificar una o dos columnas en la fórmula (<code>rows</code> ~ <code>columns</code>). Si sólo quieres especificar una, puedes colocar un punto <code>.</code> al otro lado de la tilde como <code>facet_grid(. ~ hospital)</code> o <code>facet_grid(hospital ~ .)</code>.</p></li>
</ul>
<p>Las facetas pueden contener rápidamente una cantidad abrumadora de información, por lo que conviene asegurarse de no tener demasiados niveles de cada variable por la que se elija hacer la faceta. He aquí algunos ejemplos rápidos con el conjunto de datos sobre la malaria (véase <a href="download-handbook-and-data.html#download-handbook-and-data">Descargar el manual y los datos</a>), que consiste en el recuento diario de casos de malaria en los centros, por grupos de edad.</p>
<p>A continuación importamos y hacemos algunas modificaciones rápidas para simplificar la tarea:</p>
<div class="sourceCode" id="cb1448"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Estos datos son recuentos diarios de casos de paludismo, por centro-día</span>
<span class="va">malaria_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"malaria_facility_count_data.rds"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># importa</span>
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">submitted_date</span>, <span class="op">-</span><span class="va">Province</span>, <span class="op">-</span><span class="va">newid</span><span class="op">)</span>                                 <span class="co"># elimina columnas innecesarias</span></code></pre></div>
<p>A continuación se muestran las primeras 50 filas de los datos sobre la malaria. Observa que hay una columna <code>malaria_tot</code>, pero también columnas para los recuentos por grupo de edad (que se utilizarán en el segundo ejemplo de <code>facet_grid()</code>).</p>
<div id="htmlwidget-32a7a61af8b1f6700e3c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-32a7a61af8b1f6700e3c">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1596499200000\" data-max=\"1597190400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"81\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"56\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"96\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"233\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["Facility 1","Facility 2","Facility 3","Facility 4","Facility 5","Facility 6","Facility 6","Facility 5","Facility 5","Facility 5","Facility 7","Facility 8","Facility 9","Facility 10","Facility 11","Facility 12","Facility 13","Facility 14","Facility 15","Facility 16","Facility 17","Facility 18","Facility 19","Facility 19","Facility 20","Facility 21","Facility 19","Facility 22","Facility 23","Facility 23","Facility 24","Facility 25","Facility 26","Facility 27","Facility 28","Facility 29","Facility 30","Facility 30","Facility 31","Facility 31","Facility 32","Facility 33","Facility 33","Facility 7","Facility 30","Facility 30","Facility 30","Facility 30","Facility 34","Facility 35"],["2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-10","2020-08-10","2020-08-09","2020-08-08","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-10","2020-08-11","2020-08-11","2020-08-09","2020-08-11","2020-08-11","2020-08-12","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-06","2020-08-04","2020-08-11","2020-08-10","2020-08-11","2020-08-11","2020-08-10","2020-08-10","2020-08-07","2020-08-09","2020-08-10","2020-08-11","2020-08-11","2020-08-10"],["Spring","Bolo","Dingo","Bolo","Bolo","Dingo","Dingo","Bolo","Bolo","Bolo","Spring","Bolo","Spring","Bolo","Spring","Dingo","Bolo","Dingo","Barnard","Barnard","Barnard","Bolo","Bolo","Bolo","Barnard","Bolo","Bolo","Bolo","Dingo","Dingo","Bolo","Bolo","Bolo","Spring","Spring","Dingo","Bolo","Bolo","Dingo","Dingo","Spring","Barnard","Barnard","Spring","Bolo","Bolo","Bolo","Bolo","Dingo","Spring"],[11,11,8,16,9,3,4,15,11,19,12,7,27,0,17,36,0,5,6,9,4,7,12,4,14,28,5,11,8,8,21,7,3,7,9,19,28,9,11,7,26,0,4,8,5,25,21,9,4,81],[12,10,5,16,2,1,0,14,11,15,7,1,8,10,15,36,0,1,3,9,4,0,2,7,9,18,3,4,7,7,0,3,2,4,7,4,14,8,2,10,35,2,4,9,9,14,25,20,9,56],[23,5,5,17,6,4,3,13,13,15,13,20,18,24,28,62,0,10,2,16,1,6,18,41,14,5,24,13,16,16,41,13,5,11,33,23,54,10,11,16,30,8,2,11,29,31,38,26,17,96],[46,26,18,49,17,8,7,42,35,49,32,28,53,34,60,134,0,16,11,34,9,13,32,52,37,51,32,28,31,31,62,23,10,22,49,46,96,27,24,33,91,10,10,28,43,70,84,55,30,233]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>location_name<\/th>\n      <th>data_date<\/th>\n      <th>District<\/th>\n      <th>malaria_rdt_0-4<\/th>\n      <th>malaria_rdt_5-14<\/th>\n      <th>malaria_rdt_15<\/th>\n      <th>malaria_tot<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[3,4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><div id="facet_wrap" class="section level3 unnumbered">
<h3>
<code>facet_wrap()</code><a class="anchor" aria-label="anchor" href="#facet_wrap"><i class="fas fa-link"></i></a>
</h3>
<p>Por el momento, vamos a centrarnos en las columnas <code>malaria_tot</code> y <code>District</code>. Ignoremos por ahora las columnas de recuento por edad. Trazaremos las curvas epidémicas con <code>geom_col()</code>, que produce una columna para cada día a la altura del eje-y especificada en la columna <code>malaria_tot</code> (los datos ya son recuentos diarios, por lo que utilizamos <code>geom_col()</code> - véase más adelante la sección <a href="ggplot-basics.html#ggplot_basics_bars">“Diagrama de barras”</a>).</p>
<p>Cuando añadimos el comando <code>facet_wrap()</code>, especificamos una tilde y a continuación la columna sobre la que hacer la faceta (<code>District</code> en este caso). Podés colocar otra columna a la izquierda de la tilde, - esto creará una faceta para cada combinación - pero te recomendamos que lo hagas con <code>facet_grid()</code> en su lugar. En este caso, se crea una faceta para cada valor único de <code>District</code>.</p>
<div class="sourceCode" id="cb1449"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Un gráfico con facetas por distrito</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">malaria_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_date</span>, y <span class="op">=</span> <span class="va">malaria_tot</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_col</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="st">"darkred"</span><span class="op">)</span> <span class="op">+</span>       <span class="co"># graficar los datos de recuento en forma de columnas</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                              <span class="co"># simplificar los paneles de fondo</span>
  <span class="fu">labs</span><span class="op">(</span>                                         <span class="co"># añadir al gráfico etiquetas, título, etc.</span>
    x <span class="op">=</span> <span class="st">"Date of report"</span>,
    y <span class="op">=</span> <span class="st">"Malaria cases"</span>,
    title <span class="op">=</span> <span class="st">"Malaria cases by district"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">District</span><span class="op">)</span>                       <span class="co"># se crean las facetas</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1042-1.png" width="672"></div>
</div>
<div id="facet_grid" class="section level3 unnumbered">
<h3>
<code>facet_grid()</code><a class="anchor" aria-label="anchor" href="#facet_grid"><i class="fas fa-link"></i></a>
</h3>
<p>Podemos utilizar un enfoque de <code>facet_grid()</code> para cruzar dos variables. Digamos que queremos cruzar <code>District</code> y edad. Bien, necesitamos hacer algunas transformaciones de datos en las columnas de edad para poner estos datos en el formato “largo” preferido por ggplot. Los grupos de edad tienen sus propias columnas - los queremos en una sola columna llamada <code>age_group</code> y otra llamada <code>num_cases</code>. Consulta la página sobre <a href="pivoting-data.html#pivoting-data">Pivoteo de datos</a> para obtener más información sobre este proceso.</p>
<div class="sourceCode" id="cb1450"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">malaria_age</span> <span class="op">&lt;-</span> <span class="va">malaria_data</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">malaria_tot</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span>
    cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"malaria_rdt_"</span><span class="op">)</span><span class="op">)</span>,  <span class="co"># elegir columnas para pivotar más largo</span>
    names_to <span class="op">=</span> <span class="st">"age_group"</span>,      <span class="co"># los nombres de las columnas se convierten en grupos de edad</span>
    values_to <span class="op">=</span> <span class="st">"num_cases"</span>      <span class="co"># valores a una sola columna (num_cases)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>
    age_group <span class="op">=</span> <span class="fu">str_replace</span><span class="op">(</span><span class="va">age_group</span>, <span class="st">"malaria_rdt_"</span>, <span class="st">""</span><span class="op">)</span>,
    age_group <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">age_group</span>, <span class="st">"5-14"</span>, after <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Ahora las primeras 50 filas de datos tienen este aspecto:</p>
<div id="htmlwidget-89f0baf010fd65eec20a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-89f0baf010fd65eec20a">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1596844800000\" data-max=\"1597104000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-14&quot;,&quot;15&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"62\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["Facility 1","Facility 1","Facility 1","Facility 2","Facility 2","Facility 2","Facility 3","Facility 3","Facility 3","Facility 4","Facility 4","Facility 4","Facility 5","Facility 5","Facility 5","Facility 6","Facility 6","Facility 6","Facility 6","Facility 6","Facility 6","Facility 5","Facility 5","Facility 5","Facility 5","Facility 5","Facility 5","Facility 5","Facility 5","Facility 5","Facility 7","Facility 7","Facility 7","Facility 8","Facility 8","Facility 8","Facility 9","Facility 9","Facility 9","Facility 10","Facility 10","Facility 10","Facility 11","Facility 11","Facility 11","Facility 12","Facility 12","Facility 12","Facility 13","Facility 13"],["2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-10","2020-08-10","2020-08-10","2020-08-10","2020-08-10","2020-08-10","2020-08-09","2020-08-09","2020-08-09","2020-08-08","2020-08-08","2020-08-08","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11","2020-08-11"],["Spring","Spring","Spring","Bolo","Bolo","Bolo","Dingo","Dingo","Dingo","Bolo","Bolo","Bolo","Bolo","Bolo","Bolo","Dingo","Dingo","Dingo","Dingo","Dingo","Dingo","Bolo","Bolo","Bolo","Bolo","Bolo","Bolo","Bolo","Bolo","Bolo","Spring","Spring","Spring","Bolo","Bolo","Bolo","Spring","Spring","Spring","Bolo","Bolo","Bolo","Spring","Spring","Spring","Dingo","Dingo","Dingo","Bolo","Bolo"],["0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14","15","0-4","5-14"],[11,12,23,11,10,5,8,5,5,16,16,17,9,2,6,3,1,4,4,0,3,15,14,13,11,11,13,19,15,15,12,7,13,7,1,20,27,8,18,0,10,24,17,15,28,36,36,62,0,0]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>location_name<\/th>\n      <th>data_date<\/th>\n      <th>District<\/th>\n      <th>age_group<\/th>\n      <th>num_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Cuando se asignan las dos variables a <code>facet_grid()</code>, lo más fácil es utilizar la notación de fórmula (por ejemplo, <code>x ~  y</code>) donde x son filas e y son columnas. Aquí está el gráfico, utilizando <code>facet_grid()</code> que muestra los gráficos para cada combinación de las columnas <code>age_group</code> y <code>District</code>.</p>
<div class="sourceCode" id="cb1451"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">malaria_age</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_date</span>, y <span class="op">=</span> <span class="va">num_cases</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_col</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"darkred"</span>, width <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Date of report"</span>,
    y <span class="op">=</span> <span class="st">"Malaria cases"</span>,
    title <span class="op">=</span> <span class="st">"Casos de malaria por distrito y grupo de edad"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">District</span> <span class="op">~</span> <span class="va">age_group</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1045-1.png" width="672"></div>
</div>
<div id="ejes-libres-o-fijos" class="section level3 unnumbered">
<h3>Ejes libres o fijos<a class="anchor" aria-label="anchor" href="#ejes-libres-o-fijos"><i class="fas fa-link"></i></a>
</h3>
<p>Las escalas de los ejes que se muestran en gráficos facetados son, por defecto, las mismas (fijas) en todas las facetas. Esto es útil para las comparaciones cruzadas, pero no siempre es apropiado.</p>
<p>Al utilizar <code>facet_wrap()</code> o <code>facet_grid()</code>, podemos añadir <code>scales = "free_y"</code> para “liberar” los ejes-y de los paneles para que se ajuste la escala adecuadamente en relación a su subconjunto de datos. Esto es particularmente útil si los recuentos reales son pequeños para una de las subcategorías y las tendencias son difíciles de ver. En lugar de “free_y” también podemos escribir “free_x” para hacer lo mismo con el eje-x (por ejemplo, para las fechas) o “free” para liberar ambos ejes. Ten en cuenta que en <code>facet_grid</code>, las escalas de y serán las mismas para las facetas en la misma fila, y las escalas de x serán las mismas para las facetas en la misma columna.</p>
<p>Cuando se utiliza <code>facet_grid</code> solamente, podemos añadir <code>space = "free_y"</code> o <code>space = "free_x"</code> para que la altura o el ancho de la faceta sea ponderada en relación a los valores de la figura en su interior. Esto sólo funciona si ya se ha asignado <code>scale = "free"</code> (y o x).</p>
<div class="sourceCode" id="cb1452"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Free y-axis</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">malaria_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">data_date</span>, y <span class="op">=</span> <span class="va">malaria_tot</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_col</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span>, fill <span class="op">=</span> <span class="st">"darkred"</span><span class="op">)</span> <span class="op">+</span>       <span class="co"># graficar los datos de recuento en forma de columnas</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                              <span class="co"># simplificar los paneles de fondo</span>
  <span class="fu">labs</span><span class="op">(</span>                                         <span class="co"># añadir al gráfico etiquetas, título, etc..</span>
    x <span class="op">=</span> <span class="st">"Date of report"</span>,
    y <span class="op">=</span> <span class="st">"Malaria cases"</span>,
    title <span class="op">=</span> <span class="st">"Malaria cases by district - 'free' x and y axes"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">District</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span>        <span class="co"># se crean las facetas</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1046-1.png" width="672"></div>
<!-- ```{r fig.show='hold', message=FALSE, warning=FALSE, out.width=c('50%', '50%')} -->
<!-- # A) Facet hospitalsation date by hospital, free y axis -->
<!-- ggplot(data = linelist %>% filter(hospital != "Missing"), # filter removes unknown hospital -->
<!--        aes(x = date_hospitalisation ))+ -->
<!--   geom_histogram(binwidth=7) + # Bindwidth = 7 days -->
<!--   labs(title = "A) Histogram with free y axis scales")+ -->
<!--   facet_grid(hospital~., # Facet with hospital as the row  -->
<!--              scales = "free_y") # Free the y scale of each facet -->
<!-- # B) Facet hospitalisation date by hospital, free y axis and vertical spacing -->
<!-- ggplot(data = linelist %>% filter(hospital != "Missing"), # filter removes unknown hospital -->
<!--        aes(x = date_hospitalisation ))+ -->
<!--   geom_histogram(binwidth=7) + # Bindwidth = 7 days -->
<!--   labs(title = "B) Histogram with free y axis scales and spacing")+ -->
<!--   facet_grid(hospital~., # Facet with hospital as the row  -->
<!--              scales = "free_y", # Free the y scale of each facet -->
<!--              space = "free_y") # Free the vertical spacing of each facet to optimise space -->
<!-- ``` -->
</div>
<div id="orden-del-nivel-de-los-factores-en-las-facetas" class="section level3 unnumbered">
<h3>Orden del nivel de los factores en las facetas<a class="anchor" aria-label="anchor" href="#orden-del-nivel-de-los-factores-en-las-facetas"><i class="fas fa-link"></i></a>
</h3>
<p>Consulta esta <a href="https://juliasilge.com/blog/reorder-within/">entrada</a> sobre cómo reordenar los niveles de los factores <em>dentro</em> de las facetas.</p>
</div>
</div>
<div id="storing-plots" class="section level2" number="30.7">
<h2>
<span class="header-section-number">30.7</span> Almacenamiento de gráficos<a class="anchor" aria-label="anchor" href="#storing-plots"><i class="fas fa-link"></i></a>
</h2>
<div id="guardar-los-gráficos" class="section level3 unnumbered">
<h3>Guardar los gráficos<a class="anchor" aria-label="anchor" href="#guardar-los-gr%C3%A1ficos"><i class="fas fa-link"></i></a>
</h3>
<p>Cuando se ejecuta un comando <code>ggplot()</code>, el gráfico se mostrará en el panel de Plots RStudio de manera predeterminada. Sin embargo, también podés guardar el gráfico como un objeto utilizando el operador de asignación <code><a href="https://rdrr.io/r/base/assignOps.html">&lt;-</a></code> y asignandole un nombre. Entonces el gráfico no se mostrará a menos que se ejecute el nombre del objeto mismo. También podés mostrarlo envolviendo el nombre del gráfico con <code><a href="https://rdrr.io/r/base/print.html">print()</a></code>, pero esto sólo es necesario en ciertas circunstancias, como cuando el gráfico se crea dentro de un <em>loop for</em> o bucle utilizado para imprimir múltiples gráficos a la vez (véase la página <a href="iteration-loops-and-lists.html#iteration-loops-and-lists">Iteración, bucles y listas</a> ).</p>
<div class="sourceCode" id="cb1453"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># define plot</span>
<span class="va">age_by_wt</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age_years</span>, y <span class="op">=</span> <span class="va">wt_kg</span>, color <span class="op">=</span> <span class="va">age_years</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>

<span class="co"># print</span>
<span class="va">age_by_wt</span>    </code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1047-1.png" width="672"></div>
</div>
<div id="modificación-de-gráficos-guardados" class="section level3 unnumbered">
<h3>Modificación de gráficos guardados<a class="anchor" aria-label="anchor" href="#modificaci%C3%B3n-de-gr%C3%A1ficos-guardados"><i class="fas fa-link"></i></a>
</h3>
<p>Una gran ventaja de <strong>ggplot2</strong> es que podés definir un gráfico (como se ve arriba), y luego añadirle capas empezando por su nombre sin necesidad de repetir todos los comandos que crearon el gráfico original.</p>
<p>Por ejemplo, si se desea modificar el gráfico <code>age_by_wt</code> que se definió anteriormente, para incluir una línea vertical a la edad de 50 años, sólo tendríamos que añadir un <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> y empezar a añadir capas adicionales al gráfico.</p>
<div class="sourceCode" id="cb1454"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">age_by_wt</span><span class="op">+</span>
  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1048-1.png" width="672"></div>
</div>
<div id="exportación-de-gráficos" class="section level3 unnumbered">
<h3>Exportación de gráficos<a class="anchor" aria-label="anchor" href="#exportaci%C3%B3n-de-gr%C3%A1ficos"><i class="fas fa-link"></i></a>
</h3>
<p>La exportación de ggplots es fácil con la función <code>ggsave()</code> de <strong>ggplot2</strong>. Puede funcionar de dos maneras, ya sea:</p>
<ul>
<li>Especifica el nombre del objeto del gráfico, a continuación, la ruta del archivo y el nombre del archivo incluyendo la extensión
<ul>
<li>Por ejemplo: <code>ggsave(my_plot, here("plots", "my_plot.png"))</code>
</li>
</ul>
</li>
<li>Ejecuta el comando con sólo una ruta de archivo, para guardar el último gráfico que se imprimió en pantalla
<ul>
<li>Por ejemplo: <code>ggsave(here("plots", "my_plot.png"))</code>
</li>
</ul>
</li>
</ul>
<p>Puedes exportar como png, pdf, jpeg, tiff, bmp, svg, o varios otros tipos de archivos, especificando la extensión del archivo en la ruta del mismo.</p>
<p>También puedes especificar los argumentos <code>width =</code>, <code>height =</code> y <code>units =</code> (ya sea “in”, “cm” o “mm”). Asimismo podés especificar <code>dpi =</code> asignando un número para la resolución del trazado (por ejemplo, 300). Consulta los detalles de la función ejecutando <code>?ggsave</code> o leyendo la <a href="https://ggplot2.tidyverse.org/reference/ggsave.html">documentación en línea</a>.</p>
<p>Recuerda que podés utilizar la sintaxis <code><a href="https://here.r-lib.org//reference/here.html">here()</a></code> para proporcionar la ruta de archivo deseada. Consulta la página de <a href="import-and-export.html#import-and-export">importación y exportación</a> para obtener más información.</p>
</div>
</div>
<div id="labels" class="section level2" number="30.8">
<h2>
<span class="header-section-number">30.8</span> Etiquetas<a class="anchor" aria-label="anchor" href="#labels"><i class="fas fa-link"></i></a>
</h2>
<p>Seguramente querrás añadir o ajustar las etiquetas del gráfico. Esto se hace más fácilmente dentro de la función <code>labs()</code> que se añade al gráfico con <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> al igual que los geoms.</p>
<p>Dentro de <code>labs()</code> podes proporcionar cadenas de caracteres a estos argumentos:</p>
<ul>
<li>
<code>x =</code> e <code>y =</code> El título del eje-x y del eje-y (etiquetas)</li>
<li>
<code>title =</code> El título del gráfico principal</li>
<li>
<code>subtitle =</code> El subtítulo del gráfico, en texto más pequeño debajo del título</li>
<li>
<code>caption</code> <code><a href="https://rdrr.io/r/base/assignOps.html">=</a></code> El pie del gráfico, que aparecerá en la parte inferior derecha de manera predeterminada</li>
</ul>
<p>Aquí está el mismo gráfico que hicimos antes, pero con etiquetas más bonitas:</p>
<div class="sourceCode" id="cb1455"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">age_by_wt</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">linelist</span>,   <span class="co"># establecer los datos</span>
  mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>     <span class="co"># asignar la estética a los valores de la columna</span>
         x <span class="op">=</span> <span class="va">age</span>,           <span class="co"># asigna el eje-x a la edad             </span>
         y <span class="op">=</span> <span class="va">wt_kg</span>,         <span class="co"># asignar el eje-y al peso</span>
         color <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>     <span class="co"># asignar el color a la edad</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>           <span class="co"># mostrar los datos como puntos </span>
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"Age and weight distribution"</span>,
    subtitle <span class="op">=</span> <span class="st">"Fictional Ebola outbreak, 2014"</span>,
    x <span class="op">=</span> <span class="st">"Age in years"</span>,
    y <span class="op">=</span> <span class="st">"Weight in kilos"</span>,
    color <span class="op">=</span> <span class="st">"Age"</span>,
    caption <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"Data as of {max(linelist$date_hospitalisation, na.rm=T)}"</span><span class="op">)</span><span class="op">)</span>

<span class="va">age_by_wt</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1049-1.png" width="672"></div>
<p>Observa cómo en la asignación del pie del gráfico hemos utilizado <code>str_glue()</code> del paquete <strong>stringr</strong> para integrar código R dinámico dentro del texto de la cadena. El pie del gráfico mostrará la fecha “Datos a partir de:” que refleja la fecha máxima de hospitalización en el listado de datos. Puedes leer más sobre esto en la página sobre <a href="characters-and-strings.html#characters-and-strings">Caracteres y cadenas</a>.</p>
<p>Una nota sobre la especificación del título de la <em>leyenda</em>: No hay un argumento “título de la leyenda”, ya que podrías tener múltiples escalas en tu leyenda. Dentro de <code>labs()</code>, podes escribir el argumento de la estética del gráfico utilizado para crear la leyenda, y proporcionar el título de esta manera. Por ejemplo, arriba asignamos <code>color = age</code> para crear la leyenda. Por lo tanto, proporcionamos <code>color</code> <code><a href="https://rdrr.io/r/base/assignOps.html">=</a></code> a <code>labs()</code> y asignamos el título de la leyenda deseado (“Age” con A mayúscula). Si se crea la leyenda con <code>aes(fill = COLUMN)</code>, entonces en <code>labs()</code> se escribiría <code>fill =</code> para ajustar el título de esa leyenda. La sección sobre escalas de color en la página <a href="ggplot-tips.html#ggplot-tips">Consejos de ggplot</a> proporciona más detalles sobre la edición de leyendas, y un enfoque alternativo utilizando las funciones <code>scales_()</code>.</p>
</div>
<div id="ggplot_basics_themes" class="section level2" number="30.9">
<h2>
<span class="header-section-number">30.9</span> Temas<a class="anchor" aria-label="anchor" href="#ggplot_basics_themes"><i class="fas fa-link"></i></a>
</h2>
<p>Una de las mejores partes de <strong>ggplot2</strong> es el nivel de control que tienes sobre el gráfico - ¡puedes definir lo que quieras! Como se mencionó anteriormente, los aspectos de diseño del gráfico que <em>no están</em> relacionados con las formas/geometrías de los datos se ajustan dentro de la función <code>theme()</code>. Por ejemplo, el color de fondo del gráfico, la presencia/ausencia de líneas de cuadrícula, y la fuente/tamaño/color/alineación del texto (títulos, subtítulos, pie de gráfico, texto de los ejes…). Estos ajustes pueden realizarse de dos maneras:</p>
<ul>
<li><p>Añadiendo una función <code>theme_()</code> <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html"><em>completa</em></a> para realizar ajustes de barrido – estas funciones de tema completo incluyen <code>theme_classic()</code>, <code>theme_minimal()</code>, <code>theme_dark()</code>, <code>theme_light() theme_grey()</code>, <code>theme_bw()</code> entre otras</p></li>
<li><p>Ajustando cada pequeño aspecto del gráfico individualmente dentro de <code>theme()</code></p></li>
</ul>
<div id="temas-completos" class="section level3 unnumbered">
<h3>Temas completos<a class="anchor" aria-label="anchor" href="#temas-completos"><i class="fas fa-link"></i></a>
</h3>
<p>Como son bastante sencillas, demostraremos las funciones del tema completo a continuación y no las describiremos más aquí. Ten en cuenta que cualquier microajuste con <code>theme()</code> debe hacerse <em>después de</em> utilizar un tema completo.</p>
<p>Escribílos con paréntesis vacíos.</p>
<div class="sourceCode" id="cb1456"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  
  <span class="fu">geom_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgreen"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Theme classic"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  
  <span class="fu">geom_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgreen"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Theme bw"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  
  <span class="fu">geom_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgreen"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Theme minimal"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">wt_kg</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  
  <span class="fu">geom_point</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"darkgreen"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Theme gray"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_gray</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1050-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1050-2.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1050-3.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1050-4.png" width="50%"></p>
</div>
<div id="modificar-el-tema" class="section level3 unnumbered">
<h3>Modificar el tema<a class="anchor" aria-label="anchor" href="#modificar-el-tema"><i class="fas fa-link"></i></a>
</h3>
<p>La función <code>theme()</code> puede tomar un gran número de argumentos, cada uno de los cuales edita un aspecto específico del gráfico. No hay manera de que podamos cubrir todos los argumentos, pero describiremos el patrón general para ellos y te mostraremos cómo encontrar el nombre del argumento que necesitas. La sintaxis básica es esta:</p>
<ol style="list-style-type: decimal">
<li>Dentro de <code>theme()</code> escribe el nombre del argumento del elemento del gráfico que queres editar, como <code>plot.title =</code>
</li>
<li>Proporciona una función <code>element_()</code> al argumento
<ul>
<li>Lo más habitual es utilizar <code>element_text()</code>, pero también <code>element_rect()</code> para los colores de fondo del lienzo, o <code>element_blank()</code> para eliminar los elementos del gráfico</li>
</ul>
</li>
<li>Dentro de la función <code>element_()</code>, escribí las asignaciones de argumentos para realizar los ajustes finos que desees</li>
</ol>
<p>Esa descripción es bastante abstracta, así que aquí hay algunos ejemplos.</p>
<p>El siguiente gráfico parece tonto, pero sirve para mostrarte una variedad de formas en las que podés ajustar su gráfico.</p>
<ul>
<li>Comenzamos con el gráfico <code>age_by_wt</code> definido anteriormente y añadimos <code>theme_classic()</code>
</li>
<li>Para realizar ajustes más finos, añadimos <code>theme()</code> e incluimos un argumento por cada elemento del gráfico que queremos ajustar</li>
</ul>
<p>Puede ser util organizar los argumentos en secciones lógicas. A continuación se describen algunos argumentos utilizados:</p>
<ul>
<li>
<code>legend.position =</code> es el único argumento que acepta valores simples como “bottom”, “top”, “left”, y “right” (abajo, arriba, izquierda y derecha). Por lo general, los argumentos relacionados con el texto requieren que se coloquen los detalles <em>dentro de</em> <code>element_text()</code>.</li>
<li>Tamaño del título se ajusta con <code>element_text(size = 30)</code>
</li>
<li>La alineación horizontal del pie del gráfico se logra con el argumento <code>element_text(hjust = 0)</code> (de derecha a izquierda)</li>
<li>El subtítulo aparece en cursiva gracias al argumento <code>element_text(face = "italic")</code>
</li>
</ul>
<div class="sourceCode" id="cb1457"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">age_by_wt</span> <span class="op">+</span> 
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                 <span class="co"># ajustes temáticos predefinidos</span>
  <span class="fu">theme</span><span class="op">(</span>
    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,                    <span class="co"># mover la leyenda a la parte inferior</span>
    
    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,          <span class="co"># tamaño del título a 30</span>
    plot.caption <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,        <span class="co"># alinear el título a la izquierda</span>
    plot.subtitle <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>face <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span>, <span class="co"># poner en cursiva el subtítulo</span>
    
    axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">15</span>, angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>, <span class="co"># ajustar sólo el texto del eje-x</span>
    axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,         <span class="co"># ajustar sólo el texto del eje-y</span>
    
    axis.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>           <span class="co"># ajusta los títulos de ambos ejes</span>
    <span class="op">)</span>     </code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1051-1.png" width="672"></div>
<p>Aquí hay algunos argumentos de <code>theme()</code> especialmente comunes. Reconocerás algunos patrones, como añadir <code>.x</code> o <code>.y</code> para aplicar el cambio sólo a un eje.</p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="50%">
<col width="49%">
</colgroup>
<thead><tr class="header">
<th>argumento de <code>theme()</code> argument</th>
<th>Lo que ajusta</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>plot.title = element_text()</code></td>
<td>El título</td>
</tr>
<tr class="even">
<td><code>plot.subtitle = element_text()</code></td>
<td>El subtítulo</td>
</tr>
<tr class="odd">
<td><code>plot.caption = element_text()</code></td>
<td>La leyenda (familia, cara, color, tamaño, ángulo, vjust (justificación vertical), hjust (justificación horizontal)…)</td>
</tr>
<tr class="even">
<td><code>axis.title = element_text()</code></td>
<td>Títulos de los ejes (tanto x como y) (tamaño, cara, ángulo, color…)</td>
</tr>
<tr class="odd">
<td><code>axis.title.x = element_text()</code></td>
<td>Título del eje-x solamente (usar <code>.y</code> para el eje-y solamente)</td>
</tr>
<tr class="even">
<td><code>axis.text = element_text()</code></td>
<td>Texto de los ejes (x e y)</td>
</tr>
<tr class="odd">
<td><code>axis.text.x = element_text()</code></td>
<td>Texto del eje-x solamente (usar <code>.y</code> para el eje-y solamente)</td>
</tr>
<tr class="even">
<td><code>axis.ticks = element_blank()</code></td>
<td>Eliminar las marcas del eje</td>
</tr>
<tr class="odd">
<td><code>axis.line = element_line()</code></td>
<td>Líneas del eje (color, tamaño, tipo de línea: sólida, punteada, etc.)</td>
</tr>
<tr class="even">
<td><code>strip.text = element_text()</code></td>
<td>Texto de la tira de facetas (color, cara, tamaño, ángulo…)</td>
</tr>
<tr class="odd">
<td><code>strip.background = element_rect()</code></td>
<td>Tira de facetas (relleno, color, tamaño…)</td>
</tr>
</tbody>
</table></div>
<p>Pero ¡hay tantos argumentos de tema! ¿Cómo podría recordarlos todos? No te preocupes, es imposible recordarlos todos. Por suerte, hay algunas herramientas que te ayudarán:</p>
<p>La documentación de <strong>tidyverse</strong> sobre la <a href="https://ggplot2.tidyverse.org/reference/theme.html">modificación del tema</a>, tiene una lista completa.</p>
<p><span style="color: darkgreen;"><strong><em>CONSEJO:</em></strong> Ejecuta <code>theme_get()</code> de <strong>ggplot2</strong> para imprimir en pantalla una lista de los más de 90 argumentos de <code>theme()</code> en la consola.</span></p>
<p><span style="color: darkgreen;"><strong><em>CONSEJO:</em></strong> Si alguna vez quieres eliminar un elemento de un gráfico, también puedes hacerlo a través de <code>theme()</code>. Basta con pasar <code>element_blank()</code> a un argumento para que desaparezca por completo. Para eliminar leyendas, puedes asignar <code>legend.position = "none".</code></span></p>
</div>
</div>
<div id="colors" class="section level2" number="30.10">
<h2>
<span class="header-section-number">30.10</span> Colores<a class="anchor" aria-label="anchor" href="#colors"><i class="fas fa-link"></i></a>
</h2>
<p>Consulta esta <a href="ggplot-tips.html#ggplot_tips_colors">sección sobre las escalas de color de la página de consejos de ggplot</a>.</p>
</div>
<div id="piping-into-ggplot2" class="section level2" number="30.11">
<h2>
<span class="header-section-number">30.11</span> Pipes en <strong>ggplot2</strong><a class="anchor" aria-label="anchor" href="#piping-into-ggplot2"><i class="fas fa-link"></i></a>
</h2>
<p>Cuando se utilizan pipes para limpiar y transformar los datos, es fácil pasar los datos transformados a <code>ggplot()</code>.</p>
<p>Las pipes que pasan el conjunto de datos de función a función se convertiran a <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> una vez que se invoque a la función <code>ggplot()</code>. Ten en cuenta que, en este caso, no es necesario especificar el argumento <code>data =</code>, ya que éste se define automáticamente como el conjunto de datos canalizado.</p>
<p>Así es como podría verse:</p>
<div class="sourceCode" id="cb1458"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span>                                                     <span class="co"># begin with linelist</span>
  <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">case_id</span>, <span class="va">fever</span>, <span class="va">chills</span>, <span class="va">cough</span>, <span class="va">aches</span>, <span class="va">vomit</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>     <span class="co"># select columns</span>
  <span class="fu">pivot_longer</span><span class="op">(</span>                                                  <span class="co"># pivot longer</span>
    cols <span class="op">=</span> <span class="op">-</span><span class="va">case_id</span>,                                  
    names_to <span class="op">=</span> <span class="st">"symptom_name"</span>,
    values_to <span class="op">=</span> <span class="st">"symptom_is_present"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>                                                        <span class="co"># replace missing values</span>
    symptom_is_present <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">symptom_is_present</span>, <span class="st">"unknown"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
  <span class="fu">ggplot</span><span class="op">(</span>                                                        <span class="co"># begin ggplot!</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">symptom_name</span>, fill <span class="op">=</span> <span class="va">symptom_is_present</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span>position <span class="op">=</span> <span class="st">"fill"</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>                    
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Symptom"</span>,
    y <span class="op">=</span> <span class="st">"Symptom status (proportion)"</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1052-1.png" width="672"></div>
</div>
<div id="plot-continuous-data" class="section level2" number="30.12">
<h2>
<span class="header-section-number">30.12</span> Trazado de datos continuos<a class="anchor" aria-label="anchor" href="#plot-continuous-data"><i class="fas fa-link"></i></a>
</h2>
<p>A lo largo de esta página, ya has visto muchos ejemplos de trazado de datos continuos. Aquí los consolidamos brevemente y presentamos algunas variaciones. Las visualizaciones que aquí se cubren incluyen:</p>
<ul>
<li>Gráficos para una variable continua:
<ul>
<li>
<strong>Histogram</strong>, un gráfico clásico para presentar la distribución de una variable continua.</li>
<li>
<strong>Gráfico de caja</strong> (también llamado de caja y bigotes), para mostrar los percentiles 25, 50 y 75, los extremos de la cola de la distribución y los valores atípicos (<a href="https://www.data-to-viz.com/caveat/boxplot.html">limitaciones importantes</a>).</li>
<li>
<strong>Gráfico de fluctuación</strong>, para mostrar todos los valores como puntos que se “fluctúan” para que se puedan ver (casi) todos, incluso cuando dos tienen el mismo valor.</li>
<li>
<strong>Gráfico del violín</strong>, muestra la distribución de una variable continua en función del ancho simétrico del “violín”.</li>
<li>Los <strong>gráficos de Sina</strong>, son una combinación de los gráficos de jitter y de violín, donde se muestran los puntos individuales pero con la forma simétrica de la distribución (a través del paquete <strong>ggforce</strong>).</li>
<li>
<strong>Gráfico de dispersión</strong> para dos variables continuas.</li>
<li>
<strong>Gráficos de calor</strong> para tres variables continuas (enlazado a la página de <a href="heat-plots.html#heat-plots">gráficos de calor</a>)</li>
</ul>
</li>
</ul>
<div id="histogramas" class="section level3 unnumbered">
<h3>Histogramas<a class="anchor" aria-label="anchor" href="#histogramas"><i class="fas fa-link"></i></a>
</h3>
<p>Los histogramas pueden parecerse a los gráficos de barras, pero son distintos porque miden la distribución de una variable <em>continua</em>. No hay espacios entre las “barras”, y sólo se proporciona una columna a <code>geom_histogram()</code>.</p>
<p>A continuación se muestra el código para generar <strong>histogramas</strong>, que agrupan datos continuos en rangos y se muestran en barras adyacentes de altura variable. Esto se hace utilizando <code>geom_histogram()</code>. Consulta la <a href="ggplot-basics.html#ggplot_basics_bars">sección “Gráfico de barras”</a> de la página de fundamentos de ggplot para entender la diferencia entre <code>geom_histogram()</code>, <code>geom_bar()</code> y <code>geom_col()</code>.</p>
<p>Vamos a mostrar la distribución de las edades de los casos. Dentro de <code>mapping = aes()</code> especifique la columna de la que quiere ver la distribución. Puedes asignar esta columna al eje-x o al eje-y.</p>
<p>Las filas serán asignadas a “bins” basados en su edad numérica, y estos bins serán representados gráficamente por barras. Si se especifica un número de bins con la estética de gráfico <code>bins =</code>, los puntos de ruptura se espacian uniformemente entre los valores mínimos y máximos del histograma. Si no se especifica <code>bins =</code>, se adivinará un número apropiado de bins y aparecera este mensaje después del gráfico:</p>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p>Si no quieres especificar un número de bins a <code>bins =</code>, puedes especificar alternativamente <code>binwidth =</code> en las unidades del eje. Damos algunos ejemplos que muestran diferentes bins y anchos de bins:</p>
<div class="sourceCode" id="cb1460"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A) Regular histogram</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># provide x variable</span>
  <span class="fu">geom_histogram</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"A) Default histogram (30 bins)"</span><span class="op">)</span>

<span class="co"># B) More bins</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># provide x variable</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B) Set to 50 bins"</span><span class="op">)</span>

<span class="co"># C) Fewer bins</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># provide x variable</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"C) Set to 5 bins"</span><span class="op">)</span>


<span class="co"># D) More bins</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># provide x variable</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"D) binwidth of 1"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1053-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1053-2.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1053-3.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1053-4.png" width="50%"></p>
<p>Para obtener proporciones suavizadas, puede utilizar <code>geom_density()</code>:</p>
<div class="sourceCode" id="cb1461"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Frequency with proportion axis, smoothed</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Proportional density"</span><span class="op">)</span>

<span class="co"># Stacked frequency with proportion axis, smoothed</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.2</span>, position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"'Stacked' proportional densities"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1054-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1054-2.png" width="50%"></p>
<p>To get a “stacked” histogram (of a continuous column of data), you can do one of the following:</p>
<ol style="list-style-type: decimal">
<li>Use <code>geom_histogram()</code> with the <code>fill =</code> argument within <code>aes()</code> and assigned to the grouping column, or<br>
</li>
<li>Use <code>geom_freqpoly()</code>, which is likely easier to read (you can still set <code>binwidth =</code>)<br>
</li>
<li>To see proportions of all values, set the <code>y = after_stat(density)</code> (use this syntax exactly - not changed for your data). Note: these proportions will show <em>per group</em>.</li>
</ol>
<p>Cada uno se muestra a continuación (*nótese el uso de <code>color =</code> versus <code>fill =</code> en cada uno):</p>
<div class="sourceCode" id="cb1462"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># "Stacked" histogram</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"'Stacked' histogram"</span><span class="op">)</span>

<span class="co"># Frequency </span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, color <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_freqpoly</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">2</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Freqpoly"</span><span class="op">)</span>

<span class="co"># Frequency with proportion axis</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="fu">after_stat</span><span class="op">(</span><span class="va">density</span><span class="op">)</span>, color <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_freqpoly</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">5</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Proportional freqpoly"</span><span class="op">)</span>

<span class="co"># Frequency with proportion axis, smoothed</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="fu">after_stat</span><span class="op">(</span><span class="va">density</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_density</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Proportional, smoothed with geom_density()"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1055-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1055-2.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1055-3.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1055-4.png" width="50%"></p>
<p>Si quieres divertirte un poco, prueba con <code>geom_density_ridges</code> del paquete <strong>ggridges</strong> <a href="https://cran.r-project.org/web/packages/ggridges/vignettes/introduction.html">vignette aquí</a>.</p>
<p>Lee más en detalle sobre los histogramas en la <a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">página de <strong>tidyverse</strong> sobre geom_histogram()</a></p>
</div>
<div id="gráficos-de-caja" class="section level3 unnumbered">
<h3>Gráficos de caja<a class="anchor" aria-label="anchor" href="#gr%C3%A1ficos-de-caja"><i class="fas fa-link"></i></a>
</h3>
<p>Los gráficos de caja (Boxplot) son habituales, pero tienen limitaciones importantes. Pueden ocultar la distribución real - por ejemplo, una distribución bimodal. Consulta esta <a href="https://www.r-graph-gallery.com/boxplot.html">galería de gráficos de R</a> y este <a href="https://www.data-to-viz.com/caveat/boxplot.html">artículo sobre la visualización de datos</a> para obtener más detalles. Sin embargo, muestran muy bien el rango intercuartil y los valores atípicos, por lo que pueden superponerse a otros tipos de gráficos que muestran la distribución con más detalle.</p>
<p>A continuación te recordamos los distintos componentes de un boxplot:</p>
<div class="inline-figure"><img src="images/boxplot.png" width="100%" style="display: block; margin: auto;"></div>
<p>Cuando se utiliza <code>geom_boxplot()</code> para crear un gráfico de caja, generalmente se asigna sólo un eje (x o y) dentro de <code>aes()</code>. El eje especificado determina si los gráficos son horizontales o verticales.</p>
<p>En la mayoría de los geoms, se crea un gráfico por grupo asignando una estética como <code>color =</code> o <code>fill =</code> a una columna dentro de <code>aes()</code>. Sin embargo, en el caso de los gráficos de caja, esto se consigue asignando la columna de agrupación al eje no asignado (x o y). A continuación se muestra el código para un diagrama de caja de <em>todos los</em> valores de edad en el conjunto de datos, y un segundo trozo de código para mostrar un diagrama de caja para cada género (no ausente) en el conjunto de datos. Ten en cuenta que los valores <code>NA</code> (valores faltantes) aparecerán como un gráfico de caja separado a menos que se eliminen. En este ejemplo, también hemos asignado el <code>fill</code> de la columna <code>outcome</code> para que cada gráfico tenga un color diferente, pero esto no es necesario.</p>
<div class="sourceCode" id="cb1463"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A) Overall boxplot</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span>  
  <span class="fu">geom_boxplot</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>   <span class="co"># only y axis mapped (not x)</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"A) Overall boxplot"</span><span class="op">)</span>

<span class="co"># B) Box plot by group</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">age</span>, x <span class="op">=</span> <span class="va">gender</span>, fill <span class="op">=</span> <span class="va">gender</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                     
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span><span class="op">+</span>   <span class="co"># remove legend (redundant)</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B) Boxplot by gender"</span><span class="op">)</span>      </code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1057-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1057-2.png" width="50%"></p>
<p>Para ver el código para añadir un gráfico de caja a los bordes de un gráfico de dispersión (gráficos “marginales”), consulta la página <a href="ggplot-tips.html#ggplot-tips">Consejos de ggplot</a>.</p>
</div>
<div id="gráficos-de-violín-fluctuación-y-sina" class="section level3 unnumbered">
<h3>Gráficos de violín, fluctuación y sina<a class="anchor" aria-label="anchor" href="#gr%C3%A1ficos-de-viol%C3%ADn-fluctuaci%C3%B3n-y-sina"><i class="fas fa-link"></i></a>
</h3>
<p>A continuación se muestra el código para crear gráficos de <code>violín</code> (<code>geom_violin</code>) y <code>gráficos de fluctuación</code> (<code>geom_jitter</code>) para mostrar distribuciones. Se puede especificar que el relleno o el color también estén determinados por los datos, insertando estas opciones dentro de <code>aes()</code>.</p>
<div class="sourceCode" id="cb1464"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A) Jitter plot by group</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu">drop_na</span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span>,      <span class="co"># remove missing values</span>
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">age</span>,                     <span class="co"># Continuous variable</span>
           x <span class="op">=</span> <span class="va">outcome</span>,                           <span class="co"># Grouping variable</span>
           color <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                     <span class="co"># Color variable</span>
  <span class="fu">geom_jitter</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                  <span class="co"># Create the violin plot</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"A) jitter plot by gender"</span><span class="op">)</span>     



<span class="co"># B) Violin plot by group</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu">drop_na</span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span>,       <span class="co"># remove missing values</span>
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">age</span>,                      <span class="co"># Continuous variable</span>
           x <span class="op">=</span> <span class="va">outcome</span>,                            <span class="co"># Grouping variable</span>
           fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                       <span class="co"># fill variable (color)</span>
  <span class="fu">geom_violin</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                   <span class="co"># create the violin plot</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B) violin plot by gender"</span><span class="op">)</span>    </code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1058-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1058-2.png" width="50%"></p>
<p>Puedes combinar los dos tipos de gráfico usando la función <code>geom_sina()</code> del paquete <code>ggforce</code>. La sina traza los puntos de jitter en la forma del gráfico de violín. Cuando se superpone al gráfico de violín (ajustando las transparencias) puede ser más fácil de interpretar visualmente.</p>
<div class="sourceCode" id="cb1465"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A) Sina plot by group</span>
<span class="fu">ggplot</span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu">drop_na</span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span>, 
  <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">age</span>,           <span class="co"># numeric variable</span>
      x <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>    <span class="co"># group variable</span>
  <span class="fu">geom_violin</span><span class="op">(</span>
    <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span>, <span class="co"># fill (color of violin background)</span>
    color <span class="op">=</span> <span class="st">"white"</span>,     <span class="co"># white outline</span>
    alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">+</span>        <span class="co"># transparency</span>
<span class="co">### jcfernandezm</span>
<span class="co">#    geom_sina(</span>
<span class="co">#    size=1,                # Change the size of the jitter</span>
<span class="co">#    aes(color = outcome))+ # color (color of dots)</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>       <span class="co"># Define fill for violin background by death/recover</span>
    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Death"</span> <span class="op">=</span> <span class="st">"#bf5300"</span>, 
              <span class="st">"Recover"</span> <span class="op">=</span> <span class="st">"#11118c"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">scale_color_manual</span><span class="op">(</span>      <span class="co"># Define colours for points by death/recover</span>
    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Death"</span> <span class="op">=</span> <span class="st">"#bf5300"</span>, 
              <span class="st">"Recover"</span> <span class="op">=</span> <span class="st">"#11118c"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>                                <span class="co"># Remove the gray background</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>                <span class="co"># Remove unnecessary legend</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B) violin and sina plot by gender, with extra formatting"</span><span class="op">)</span>      </code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1059-1.png" width="672"></div>
</div>
<div id="dos-variables-continuas" class="section level3 unnumbered">
<h3>Dos variables continuas<a class="anchor" aria-label="anchor" href="#dos-variables-continuas"><i class="fas fa-link"></i></a>
</h3>
<p>Siguiendo una sintaxis similar, <code>geom_point()</code> te permitirá trazar dos variables continuas en un <strong>gráfico de dispersión</strong>. Esto es útil para mostrar los valores reales en lugar de sus distribuciones. En (A) se muestra un gráfico de dispersión simple de la edad frente al peso. En (B) volvemos a utilizar <code>facet_grid()</code> para mostrar la relación entre dos variables continuas.</p>
<div class="sourceCode" id="cb1466"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Basic scatter plot of weight and age</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, 
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">wt_kg</span>, x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"A) Scatter plot of weight and age"</span><span class="op">)</span>

<span class="co"># Scatter plot of weight and age by gender and Ebola outcome</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu">drop_na</span><span class="op">(</span><span class="va">gender</span>, <span class="va">outcome</span><span class="op">)</span>, <span class="co"># filter retains non-missing gender/outcome</span>
       mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">wt_kg</span>, x <span class="op">=</span> <span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B) Scatter plot of weight and age faceted by gender and outcome"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">gender</span> <span class="op">~</span> <span class="va">outcome</span><span class="op">)</span> </code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1060-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1060-2.png" width="50%"></p>
</div>
<div id="tres-variables-continuas" class="section level3 unnumbered">
<h3>Tres variables continuas<a class="anchor" aria-label="anchor" href="#tres-variables-continuas"><i class="fas fa-link"></i></a>
</h3>
<p>Puedes mostrar tres variables continuas utilizando el argumento <code>fill =</code> para crear <em>un gráfico de calor</em>. El color de cada “celda” reflejará el valor de la tercera columna continua de datos. Consulta la página <a href="ggplot-tips.html#ggplot-tips">Consejos de ggplot</a> y la página de <a href="heat-plots.html#heat-plots">gráficos de calor</a> para obtener más detalles y varios ejemplos.</p>
<p>Hay formas de hacer gráficos en 3D en R, pero para la epidemiología aplicada suelen ser difíciles de interpretar y, por tanto, menos útiles para la toma de decisiones.</p>
</div>
</div>
<div id="trazar-datos-categóricos" class="section level2 unnumbered">
<h2>Trazar datos categóricos<a class="anchor" aria-label="anchor" href="#trazar-datos-categ%C3%B3ricos"><i class="fas fa-link"></i></a>
</h2>
<p>Los datos categóricos pueden ser valores de carácter, pueden ser lógicos (TRUE/FALSE), o factores (ver la página de <a href="factors.html#factors">Factores</a>).</p>
<div id="preparación" class="section level3 unnumbered">
<h3>Preparación<a class="anchor" aria-label="anchor" href="#preparaci%C3%B3n"><i class="fas fa-link"></i></a>
</h3>
<div id="estructura-de-datos" class="section level4 unnumbered">
<h4>Estructura de datos<a class="anchor" aria-label="anchor" href="#estructura-de-datos"><i class="fas fa-link"></i></a>
</h4>
<p>Lo primero que hay que entender sobre tus datos categóricos es si existen como observaciones en bruto, como una lista de casos, o como un dataframe de resumen o agregado que contiene recuentos o proporciones. El estado de sus datos afectará a la función de trazado que utilice:</p>
<ul>
<li>Si tus datos son observaciones en bruto con una fila por observación, es probable que utilices <code>geom_bar()</code>
</li>
<li>Si sus datos ya están agregados en recuentos o proporciones, es probable que utilices <code>geom_col()</code>
</li>
</ul>
</div>
<div id="tipo-de-columna-y-ordenación-de-valores" class="section level4 unnumbered">
<h4>Tipo de columna y ordenación de valores<a class="anchor" aria-label="anchor" href="#tipo-de-columna-y-ordenaci%C3%B3n-de-valores"><i class="fas fa-link"></i></a>
</h4>
<p>A continuación, examina el tipo o clase de las columnas (variables) que desea trazar. Veamos <code>hospital</code>, primero usando <code><a href="https://rdrr.io/r/base/class.html">class()</a></code> de R <strong>base</strong>, y luego con <code>tabyl()</code> de <strong>janitor</strong>.</p>
<div class="sourceCode" id="cb1467"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># View class of hospital column - we can see it is a character</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "character"</code></pre>
<div class="sourceCode" id="cb1469"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Look at values and proportions within hospital column</span>
<span class="co">###jcfernandezm</span>
<span class="co">#linelist %&gt;% </span>
<span class="co">#  tabyl(hospital)</span></code></pre></div>
<p>Podemos ver que los valores de la variable hospital son caracteres, ya que son nombres de hospitales, y por defecto están ordenados alfabéticamente. Hay valores <code>otros</code> y `faltantes”, que preferiríamos que fueran las últimas subcategorías al presentar los desgloses. Así que convertimos esta columna a clase factor y la reordenamos. Esto se trata con más detalle en la página de <a href="factors.html#factors">Factores</a>.</p>
<div class="sourceCode" id="cb1470"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Convert to factor and define level order so "Other" and "Missing" are last</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    hospital <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">hospital</span>, 
      <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span>,
      <span class="st">"Port Hospital"</span>, 
      <span class="st">"Central Hospital"</span>,
      <span class="st">"Military Hospital"</span>,
      <span class="st">"Other"</span>,
      <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb1471"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "St. Mark's Maternity Hospital (SMMH)"
## [2] "Port Hospital"                       
## [3] "Central Hospital"                    
## [4] "Military Hospital"                   
## [5] "Other"                               
## [6] "Missing"</code></pre>
</div>
</div>
<div id="ggplot_basics_bars" class="section level3 unnumbered">
<h3>Gráfico de barras<a class="anchor" aria-label="anchor" href="#ggplot_basics_bars"><i class="fas fa-link"></i></a>
</h3>
<p>Utiliza <code>geom_bar()</code> si deseas que la altura de las barras (o la altura de los componentes de las barras apiladas) refleje <em>el número de filas relevantes de los datos</em>. Estas barras tendrán huecos entre ellas, a menos que se ajuste la estética de <code>width =</code>.</p>
<ul>
<li>Proporciona sólo una asignación de columna de eje (normalmente el eje-x). Si proporcionas x e y, obtendrás un <code>Error: stat_count() can only have an x or y aesthetic.</code>
</li>
<li>Puedes crear barras apiladas añadiendo una asignación de Columba usando <code>fill =</code> dentro de <code>mapping = aes()</code>
</li>
<li>El eje opuesto se llamará por defecto “count” (recuento), ya que representa el número de filas</li>
</ul>
<p>A continuación, hemos asignado el resultado (outcome) al eje-y, pero podría estar fácilmente asignarse al eje-x. Si tienes valores de caracteres más largos, a veces el gráfico se ve mejor si las barras se grafican de manera horizontal en vez de vertical ,poniendo la leyenda en la parte inferior del gráfico. Esto puede afectar el orden en el que aparecen los factores - en este caso los invertimos con <code>fct_rev()</code> para poner la categoría de “faltantes” y “otros” en la parte inferior.</p>
<div class="sourceCode" id="cb1473"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A) Outcomes in all cases</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu">drop_na</span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_bar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"A) Number of cases by hospital"</span>,
       y <span class="op">=</span> <span class="st">"Hospital"</span><span class="op">)</span>


<span class="co"># B) Outcomes in all cases by hosptial</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu">drop_na</span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_bar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"B) Number of recovered and dead Ebola cases, by hospital"</span>,
       y <span class="op">=</span> <span class="st">"Hospital"</span><span class="op">)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1064-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-1064-2.png" width="50%"></p>
</div>
<div id="geom_col" class="section level3 unnumbered">
<h3>
<code>geom_col()</code><a class="anchor" aria-label="anchor" href="#geom_col"><i class="fas fa-link"></i></a>
</h3>
<p>Utiliza <code>geom_col()</code> si deseas que la altura de las barras (o la altura de los componentes de las barras apiladas) refleje <em>valores</em> precalculados que existen en los datos. A menudo, se trata de recuentos sumarios o “agregados”, o de proporciones.</p>
<p>Proporciona las asignaciones de columna para <em>ambos</em> ejes a <code>geom_col()</code>. Normalmente la columna del eje-x es discreta y la del eje-y es numérica.</p>
<p>Digamos que tenemos los un conjunto de datos denominado <code>outcomes</code>:</p>
<pre><code>## # A tibble: 2 x 3
##   outcome     n proportion
##   &lt;chr&gt;   &lt;int&gt;      &lt;dbl&gt;
## 1 Death    1022       56.2
## 2 Recover   796       43.8</code></pre>
<p>A continuación se muestra un código que utiliza <code>geom_col()</code> para crear gráficos de barras sencillos que muestren la distribución de los resultados de los pacientes con Ebola. Con geom_col, es necesario especificar tanto x como y. Aquí x es la variable categórica a lo largo del eje-x, e y es la columna de proporciones precalculada denominada <code>proportion</code>.</p>
<div class="sourceCode" id="cb1475"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Outcomes in all cases</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">outcomes</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_col</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">outcome</span>, y <span class="op">=</span> <span class="va">proportion</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Number of recovered and dead Ebola cases"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1066-1.png" width="432"></div>
<p>Para mostrar los desgloses por hospital, necesitaríamos que nuestra tabla contuviera más información, y que estuviera en formato “largo”. Creamos esta tabla con las frecuencias de las categorías combinadas <code>outcome</code> y <code>hospital</code> (véase la página de <a href="grouping-data.html#grouping-data">Agrupar datos</a> para obtener consejos de agrupación).</p>
<div class="sourceCode" id="cb1476"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">outcomes2</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">drop_na</span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">count</span><span class="op">(</span><span class="va">hospital</span>, <span class="va">outcome</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># get counts by hospital and outcome</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span>        <span class="co"># Group so proportions are out of hospital total</span>
  <span class="fu">mutate</span><span class="op">(</span>proportion <span class="op">=</span> <span class="va">n</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span> <span class="co"># calculate proportions of hospital total</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">outcomes2</span><span class="op">)</span> <span class="co"># Preview data</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
## # Groups:   hospital [3]
##   hospital                           outcome     n propo~1
##   &lt;fct&gt;                              &lt;chr&gt;   &lt;int&gt;   &lt;dbl&gt;
## 1 St. Mark's Maternity Hospital (SM~ Death     199    61.2
## 2 St. Mark's Maternity Hospital (SM~ Recover   126    38.8
## 3 Port Hospital                      Death     785    57.6
## 4 Port Hospital                      Recover   579    42.4
## 5 Central Hospital                   Death     193    53.9
## 6 Central Hospital                   Recover   165    46.1
## # ... with abbreviated variable name 1: proportion</code></pre>
<p>A continuación, creamos el ggplot añadiendo algunas asignaciones de formato:</p>
<ul>
<li>
<strong>Cambio de posición del eje</strong>: Intercambiamos los ejes con <code>coord_flip()</code> para poder leer los nombres de los hospitales.</li>
<li>
<strong>Columnas de lado a lado</strong>: Se ha añadido un argumento de <code>position = "dodge"</code> para que las barras de muerte (Death) y recuperación (Recover) se presenten una al lado de la otra en lugar de apiladas. Ten en cuenta que las barras apiladas aparecen de manera predeterminada.</li>
<li>
<strong>Ancho de columna</strong>: Se especifica el “ancho”, para graficar las columnas a la mitad del ancho posible.</li>
<li>
<strong>Orden de las columnas</strong>: Se ha invertido el orden de las categorías en el eje-y para que “Otros” y “Faltantes” aparezcan últimos, con <code>scale_x_discrete(limits=rev)</code>. Ten en cuenta que usamos eso en lugar de <code>scale_y_discrete</code> porque la variable hospital se asigno al eje-x en el en el argumento de <code>aes()</code>, aunque visualmente se vea en el eje-y. Hacemos esto porque ggplot parece presentar las categorías al revés a menos que le digamos que no lo haga.</li>
<li>
<strong>Otros detalles</strong>: Añadimos etiquetas/títulos y colores dentro de las funciones de <code>labs</code> y <code>scale_fill_color</code> respectivamente.</li>
</ul>
<div class="sourceCode" id="cb1478"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Outcomes in all cases by hospital</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">outcomes2</span><span class="op">)</span> <span class="op">+</span>  
  <span class="fu">geom_col</span><span class="op">(</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">proportion</span>,                 <span class="co"># show pre-calculated proportion values</span>
      y <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span>,          <span class="co"># reverse level order so missing/other at bottom</span>
      fill <span class="op">=</span> <span class="va">outcome</span><span class="op">)</span>,                <span class="co"># stacked by outcome</span>
    width <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">+</span>                    <span class="co"># thinner bars (out of 1)</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>                  <span class="co"># Minimal theme </span>
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Number of recovered and dead Ebola cases, by hospital"</span>,
       fill <span class="op">=</span> <span class="st">"Outcome"</span>,             <span class="co"># legend title</span>
       y <span class="op">=</span> <span class="st">"Count"</span>,                  <span class="co"># y axis title</span>
       x <span class="op">=</span> <span class="st">"Hospital of admission"</span><span class="op">)</span><span class="op">+</span> <span class="co"># x axis title</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>                 <span class="co"># adding colors manually</span>
    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Death"</span><span class="op">=</span> <span class="st">"#3B1c8C"</span>,
               <span class="st">"Recover"</span> <span class="op">=</span> <span class="st">"#21908D"</span> <span class="op">)</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-1068-1.png" width="768"></div>
<p>Ten en cuenta que las proporciones son binarias, por lo que podemos preferir omitir <code>recuperar</code> y mostrar sólo la proporción que murió. Esto es sólo a título ilustrativo.</p>
<p>Si se utiliza <code>geom_col()</code> con datos de fechas (por ejemplo, una epicurva a partir de datos agregados) - querrá ajustar el argumento <code>width =</code> para eliminar los “huecos” entre las barras. Si se utilizan datos diarios (en días), ajuste <code>width= 1</code>. Si se trata de datos semanales, la anchura seria <code>width = 7</code>. Los meses no son posibles de representar porque cada mes tiene un número diferente de días.</p>
</div>
<div id="geom_histogram" class="section level3 unnumbered">
<h3>geom_histogram()<a class="anchor" aria-label="anchor" href="#geom_histogram"><i class="fas fa-link"></i></a>
</h3>
<p>Los histogramas pueden parecerse a los gráficos de barras, pero son distintos porque miden la distribución de una variable <em>continua</em>. No hay huecos o espacios entre las “barras” y sólo se asigna una columna a <code>geom_histogram()</code>. Hay argumentos específicos para los histogramas como <code>bin_width =</code> y <code>breaks =</code> para especificar cómo se deben dividir los datos. La sección anterior sobre datos continuos y la página sobre <a href="epidemic-curves.html#epidemic-curves">curvas epidémicas</a> proporcionan detalles adicionales.</p>
</div>
</div>
<div id="resources-23" class="section level2" number="30.13">
<h2>
<span class="header-section-number">30.13</span> Recursos<a class="anchor" aria-label="anchor" href="#resources-23"><i class="fas fa-link"></i></a>
</h2>
<p>Hay una gran cantidad de ayuda en línea, especialmente sobre ggplot. Consulta las siguietnes páginas con maerial en inglés:</p>
<ul>
<li><a href="http://r-statistics.co/ggplot2-cheatsheet.html">hoja de trucos de ggplot2</a></li>
<li><a href="https://biostats.w.uib.no/the-ggplot2-cheat-sheet-by-rstudio/">otra hoja de trucos</a></li>
<li><a href="https://ggplot2.tidyverse.org/reference/">página de fundamentos de tidyverse ggplot</a></li>
<li><a href="http://www.sthda.com/english/articles/32-r-graphics-essentials/131-plot-two-continuous-variables-scatter-graph-and-alternatives/">trazado de variables continuas</a></li>
<li>páginas de R for Data Science en español sobre <a href="https://es.r4ds.hadley.nz/visualizaci%C3%B3n-de-datos.html">visualización de datos</a>
</li>
<li><a href="https://es.r4ds.hadley.nz/comunicar-con-gr%C3%A1ficos.html">gráficos para la comunicación</a></li>
</ul>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="tables-for-presentation.html"><span class="header-section-number">29</span> Tablas para presentaciones</a></div>
<div class="next"><a href="ggplot-tips.html"><span class="header-section-number">31</span> Consejos de ggplot</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>En esta página</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#ggplot-basics"><span class="header-section-number">30</span> Conceptos básicos de ggplot</a></li>
<li>
<a class="nav-link" href="#preparation-21"><span class="header-section-number">30.1</span> Preparación</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#cargar-paquetes-19">Cargar paquetes</a></li>
<li><a class="nav-link" href="#importar-datos-15">Importar datos</a></li>
<li><a class="nav-link" href="#limpieza-general">Limpieza general</a></li>
<li><a class="nav-link" href="#pivotar-a-lo-largo">Pivotar a lo largo</a></li>
</ul>
</li>
<li><a class="nav-link" href="#basics-of-ggplot"><span class="header-section-number">30.2</span> Fundamentos de ggplot</a></li>
<li><a class="nav-link" href="#ggplot"><span class="header-section-number">30.3</span> ggplot()</a></li>
<li><a class="nav-link" href="#geoms"><span class="header-section-number">30.4</span> Geoms</a></li>
<li>
<a class="nav-link" href="#ggplot_basics_mapping"><span class="header-section-number">30.5</span> Asignación de datos al gráfico</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#est%C3%A9tica-del-gr%C3%A1fico">Estética del gráfico</a></li>
<li><a class="nav-link" href="#asignar-un-valor-est%C3%A1tico">Asignar un valor estático</a></li>
<li><a class="nav-link" href="#escalado-a-los-valores-de-la-columna">Escalado a los valores de la columna</a></li>
<li><a class="nav-link" href="#ggplot_basics_map_loc">Dónde hacer las asignaciones</a></li>
<li><a class="nav-link" href="#ggplotgroups">Grupos</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#ggplot_basics_facet"><span class="header-section-number">30.6</span> Facetas / Múltiplos pequeños</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#facet_wrap">facet_wrap()</a></li>
<li><a class="nav-link" href="#facet_grid">facet_grid()</a></li>
<li><a class="nav-link" href="#ejes-libres-o-fijos">Ejes libres o fijos</a></li>
<li><a class="nav-link" href="#orden-del-nivel-de-los-factores-en-las-facetas">Orden del nivel de los factores en las facetas</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#storing-plots"><span class="header-section-number">30.7</span> Almacenamiento de gráficos</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#guardar-los-gr%C3%A1ficos">Guardar los gráficos</a></li>
<li><a class="nav-link" href="#modificaci%C3%B3n-de-gr%C3%A1ficos-guardados">Modificación de gráficos guardados</a></li>
<li><a class="nav-link" href="#exportaci%C3%B3n-de-gr%C3%A1ficos">Exportación de gráficos</a></li>
</ul>
</li>
<li><a class="nav-link" href="#labels"><span class="header-section-number">30.8</span> Etiquetas</a></li>
<li>
<a class="nav-link" href="#ggplot_basics_themes"><span class="header-section-number">30.9</span> Temas</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#temas-completos">Temas completos</a></li>
<li><a class="nav-link" href="#modificar-el-tema">Modificar el tema</a></li>
</ul>
</li>
<li><a class="nav-link" href="#colors"><span class="header-section-number">30.10</span> Colores</a></li>
<li><a class="nav-link" href="#piping-into-ggplot2"><span class="header-section-number">30.11</span> Pipes en ggplot2</a></li>
<li>
<a class="nav-link" href="#plot-continuous-data"><span class="header-section-number">30.12</span> Trazado de datos continuos</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#histogramas">Histogramas</a></li>
<li><a class="nav-link" href="#gr%C3%A1ficos-de-caja">Gráficos de caja</a></li>
<li><a class="nav-link" href="#gr%C3%A1ficos-de-viol%C3%ADn-fluctuaci%C3%B3n-y-sina">Gráficos de violín, fluctuación y sina</a></li>
<li><a class="nav-link" href="#dos-variables-continuas">Dos variables continuas</a></li>
<li><a class="nav-link" href="#tres-variables-continuas">Tres variables continuas</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#trazar-datos-categ%C3%B3ricos">Trazar datos categóricos</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#preparaci%C3%B3n">Preparación</a></li>
<li><a class="nav-link" href="#ggplot_basics_bars">Gráfico de barras</a></li>
<li><a class="nav-link" href="#geom_col">geom_col()</a></li>
<li><a class="nav-link" href="#geom_histogram">geom_histogram()</a></li>
</ul>
</li>
<li><a class="nav-link" href="#resources-23"><span class="header-section-number">30.13</span> Recursos</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>EpiRhandbook en español</strong>" fué escrito por el equipo del manual. Compilado el 2022-10-27.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>Este libro fué construido con el paquete <a class="text-light" href="https://bookdown.org">bookdown</a> de R.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
