<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>25 Rastreo de contactos | EpiRhandbook en español</title>
<meta name="author" content="El equipo del manual">
<meta name="description" content="Esta página muestra el análisis descriptivo de los datos de rastreo de contactos, abordando algunas consideraciones clave y enfoques exclusivos de este tipo de datos. Esta página hace referencia a...">
<meta name="generator" content="bookdown 0.29 with bs4_book()">
<meta property="og:title" content="25 Rastreo de contactos | EpiRhandbook en español">
<meta property="og:type" content="book">
<meta property="og:description" content="Esta página muestra el análisis descriptivo de los datos de rastreo de contactos, abordando algunas consideraciones clave y enfoques exclusivos de este tipo de datos. Esta página hace referencia a...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="25 Rastreo de contactos | EpiRhandbook en español">
<meta name="twitter:description" content="Esta página muestra el análisis descriptivo de los datos de rastreo de contactos, abordando algunas consideraciones clave y enfoques exclusivos de este tipo de datos. Esta página hace referencia a...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.25/datatables.js"></script><link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/tabwid.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/scrool.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.9/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.5.1/plotly-basic-2.5.1.min.js"></script><script src="libs/plotly-cartesian-2.5.1/plotly-cartesian-2.5.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">EpiRhandbook en español</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Buscar" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Tabla de contenidos</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">Acerca de este libro</li>
<li><a class="" href="editorial-and-technical-notes.html"><span class="header-section-number">1</span> Notas editoriales y técnicas</a></li>
<li><a class="" href="download-handbook-and-data.html"><span class="header-section-number">2</span> Descargando el manual y los datos</a></li>
<li class="book-part">Aspectos básicos</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">3</span> Fundamentos de R</a></li>
<li><a class="" href="transition-to-r.html"><span class="header-section-number">4</span> Transición a R</a></li>
<li><a class="" href="suggested-packages-1.html"><span class="header-section-number">5</span> Paquetes recomendados</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> Proyectos en R</a></li>
<li><a class="" href="import-and-export.html"><span class="header-section-number">7</span> Importación y exportación</a></li>
<li class="book-part">Gestión de datos</li>
<li><a class="" href="cleaning-data-and-core-functions.html"><span class="header-section-number">8</span> Limpieza de datos y funciones básicas</a></li>
<li><a class="" href="working-with-dates.html"><span class="header-section-number">9</span> Trabajando con Fechas</a></li>
<li><a class="" href="characters-and-strings.html"><span class="header-section-number">10</span> Caracteres y cadenas</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> Factores</a></li>
<li><a class="" href="pivoting-data.html"><span class="header-section-number">12</span> Pivotar datos</a></li>
<li><a class="" href="grouping-data.html"><span class="header-section-number">13</span> Agrupar datos</a></li>
<li><a class="" href="joining-data.html"><span class="header-section-number">14</span> Unir datos</a></li>
<li><a class="" href="de-duplication.html"><span class="header-section-number">15</span> De-duplicación</a></li>
<li><a class="" href="iteration-loops-and-lists.html"><span class="header-section-number">16</span> Iteración, bucles y listas</a></li>
<li class="book-part">Análisis</li>
<li><a class="" href="descriptive-tables.html"><span class="header-section-number">17</span> Tablas descriptivas</a></li>
<li><a class="" href="simple-statistical-tests.html"><span class="header-section-number">18</span> Tests estadísticos sencillos</a></li>
<li><a class="" href="univariate-and-multivariable-regression.html"><span class="header-section-number">19</span> Regresión univariante y multivariable</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> Valores faltantes</a></li>
<li><a class="" href="standardised-rates.html"><span class="header-section-number">21</span> Tasas estandarizadas</a></li>
<li><a class="" href="moving-averages.html"><span class="header-section-number">22</span> Medias Móviles</a></li>
<li><a class="" href="time-series-and-outbreak-detection.html"><span class="header-section-number">23</span> Series temporales y detección de brotes</a></li>
<li><a class="" href="epidemic-modeling.html"><span class="header-section-number">24</span> Modelización de epidemias</a></li>
<li><a class="active" href="contact-tracing-1.html"><span class="header-section-number">25</span> Rastreo de contactos</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">26</span> Análisis de supervivencia</a></li>
<li><a class="" href="gis-basics.html"><span class="header-section-number">27</span> Conceptos básicos de los SIG</a></li>
<li class="book-part">Visualización de datos</li>
<li><a class="" href="tables-for-presentation.html"><span class="header-section-number">28</span> Tablas para presentaciones</a></li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">29</span> Conceptos básicos de ggplot</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">30</span> Consejos de ggplot</a></li>
<li><a class="" href="epidemic-curves.html"><span class="header-section-number">31</span> Curvas epidémicas</a></li>
<li><a class="" href="demographic-pyramids-and-likert-scales.html"><span class="header-section-number">32</span> Pirámides de población y escalas de Likert</a></li>
<li><a class="" href="heat-plots.html"><span class="header-section-number">33</span> Gráficos de calor</a></li>
<li><a class="" href="diagrams-and-charts.html"><span class="header-section-number">34</span> Diagramas y gráficos</a></li>
<li><a class="" href="combinations-analysis.html"><span class="header-section-number">35</span> Análisis de combinaciones</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">36</span> Cadenas de transmisión</a></li>
<li><a class="" href="phylogenetic-trees-1.html"><span class="header-section-number">37</span> Árboles filogenéticos</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">38</span> Gráficos interactivos</a></li>
<li class="book-part">Informes y Dashboards</li>
<li><a class="" href="reports-with-r-markdown.html"><span class="header-section-number">39</span> Informes con R Markdown</a></li>
<li><a class="" href="organizing-routine-reports.html"><span class="header-section-number">40</span> Organización de informes rutinarios</a></li>
<li><a class="" href="dashboards-with-r-markdown.html"><span class="header-section-number">41</span> Dashboards con R Markdown</a></li>
<li><a class="" href="dashboards-with-shiny.html"><span class="header-section-number">42</span> Dashboards con Shiny</a></li>
<li class="book-part">Miscelánea</li>
<li><a class="" href="writing-functions-1.html"><span class="header-section-number">43</span> Escribir funciones</a></li>
<li><a class="" href="directory-interactions.html"><span class="header-section-number">44</span> Interacciones con directorios</a></li>
<li><a class="" href="version-control-and-collaboration-with-git-and-github.html"><span class="header-section-number">45</span> Control de versiones y colaboración con Git y Github</a></li>
<li><a class="" href="common-errors.html"><span class="header-section-number">46</span> Errores comunes</a></li>
<li><a class="" href="getting-help.html"><span class="header-section-number">47</span> Cómo obtener ayuda</a></li>
<li><a class="" href="r-on-network-drives.html"><span class="header-section-number">48</span> R en redes locales</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">49</span> data.table</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="contact-tracing-1" class="section level1" number="25">
<h1>
<span class="header-section-number">25</span> Rastreo de contactos<a class="anchor" aria-label="anchor" href="#contact-tracing-1"><i class="fas fa-link"></i></a>
</h1>
<p>Esta página muestra el análisis descriptivo de los datos de rastreo de contactos, abordando algunas consideraciones clave y enfoques exclusivos de este tipo de datos.</p>
<p>Esta página hace referencia a muchas de las competencias básicas de gestión y visualización de datos de R tratadas en otras páginas (por ejemplo, limpieza de datos, pivoteo, tablas, análisis de series temporales), pero destacaremos ejemplos específicos del rastreo de contactos que han sido útiles para la toma de decisiones operativas. Por ejemplo, esto incluye la visualización de los datos de seguimiento del rastreo de contactos a lo largo del tiempo o a través de áreas geográficas, o la producción de tablas limpias de Indicadores Clave de Rendimiento (KPI) para los supervisores del rastreo de contactos.</p>
<p>Para la demostración utilizaremos datos de rastreo de contactos de la plataforma <a href="https://www.who.int/tools/godata">Go.Data</a>. Los principios que aquí se exponen son válidos para los datos de rastreo de contactos de otras plataformas, sólo que puede ser necesario realizar diferentes pasos de preprocesamiento de datos en función de la estructura de los mismos.</p>
<p>Puedes leer más sobre el proyecto Go.Data en el <a href="https://worldhealthorganization.github.io/godata/">sitio de documentación de Github</a> o en su <a href="https://community-godata.who.int/">Comunidad de Prácticas</a>.</p>
<div id="preparation-16" class="section level2" number="25.1">
<h2>
<span class="header-section-number">25.1</span> Preparation<a class="anchor" aria-label="anchor" href="#preparation-16"><i class="fas fa-link"></i></a>
</h2>
<div id="cargar-paquetes-15" class="section level3 unnumbered">
<h3>Cargar paquetes<a class="anchor" aria-label="anchor" href="#cargar-paquetes-15"><i class="fas fa-link"></i></a>
</h3>
<p>Este trozo de código muestra la carga de los paquetes necesarios para los análisis. En este manual destacamos <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> de <strong>pacman</strong>, que instala el paquete si es necesario <em>y</em> lo carga para su uso. También puedes cargar los paquetes instalados con <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> de R <strong>base</strong>. Consulta la página sobre <a href="r-basics.html#r-basics">fundamentos de R</a> para obtener más información sobre los paquetes de R.</p>
<div class="sourceCode" id="cb1216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
  <span class="va">rio</span>,          <span class="co"># importing data  </span>
  <span class="va">here</span>,         <span class="co"># relative file pathways  </span>
  <span class="va">janitor</span>,      <span class="co"># data cleaning and tables</span>
  <span class="va">lubridate</span>,    <span class="co"># working with dates</span>
  <span class="va">epikit</span>,       <span class="co"># age_categories() function</span>
  <span class="va">apyramid</span>,     <span class="co"># age pyramids</span>
  <span class="va">tidyverse</span>,    <span class="co"># data manipulation and visualization</span>
  <span class="va">RColorBrewer</span>, <span class="co"># color palettes</span>
  <span class="va">formattable</span>,  <span class="co"># fancy tables</span>
  <span class="va">kableExtra</span>    <span class="co"># table formatting</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="importar-datos-13" class="section level3 unnumbered">
<h3>Importar datos<a class="anchor" aria-label="anchor" href="#importar-datos-13"><i class="fas fa-link"></i></a>
</h3>
<p>Importaremos conjuntos de datos de muestra de contactos y de su “seguimiento”. Estos datos se han recuperado y desanidado de la API Go.Data y se han almacenado como archivos “.rds”.</p>
<p>Puedes descargar todos los datos de ejemplo de este manual en la página de <a href="download-handbook-and-data.html#download-handbook-and-data">descarga de manuales y datos</a>.</p>
<p>Si deseas descargar los datos de seguimiento de contactos de ejemplo específicos de esta página, utiliza los tres enlaces de descarga que aparecen a continuación:</p>
<p><a href="https://github.com/WorldHealthOrganization/godata/blob/master/analytics/r-reporting/data/cases_clean.rds?raw=true">Clica para descargar los datos de casos de la investigación (archivo .rds)</a></p>
<p><a href="https://github.com/WorldHealthOrganization/godata/blob/master/analytics/r-reporting/data/contacts_clean.rds?raw=true">Clica para descargar los datos del registro de contactos (archivo .rds)</a></p>
<p><a href="https://github.com/WorldHealthOrganization/godata/blob/master/analytics/r-reporting/data/followups_clean.rds?raw=true">Clica para descargar los datos de seguimiento de los contactos (archivo .rds)</a></p>
<!-- ```{r out.width = "100%", fig.align = "center", echo=F} -->
<!-- knitr::include_graphics(here::here("images", "godata_api_github.png")) -->
<!-- ``` -->
<p>En su formato original los archivos descargables, reflejan los datos proporcionados por la API de Go.Data (puedes aprender sobre las <a href="import-and-export.html#import_api">API aquí</a>). A modo de ejemplo, aquí limpiaremos los datos para que sean más fáciles de leer en esta página. Si estás utilizando una instancia de Go.Data, puedes ver las instrucciones completas sobre cómo recuperar sus datos <a href="https://github.com/WorldHealthOrganization/godata/tree/master/analytics/r-reporting">aquí</a>.</p>
<p>A continuación, los conjuntos de datos se importan utilizando la función <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> del paquete <strong>rio</strong>. Consulta la página sobre <a href="import-and-export.html#import-and-export">importación y exportación</a> para conocer las distintas formas de importar datos. Utilizamos <code><a href="https://here.r-lib.org//reference/here.html">here()</a></code> para especificar la ruta del archivo - debes escribir la ruta del archivo específica de tu ordenador. A continuación, utilizamos <code>select()</code> para seleccionar sólo ciertas columnas de los datos, para simplificar la demostración.</p>
<div id="datos-de-casos" class="section level4 unnumbered">
<h4>Datos de casos<a class="anchor" aria-label="anchor" href="#datos-de-casos"><i class="fas fa-link"></i></a>
</h4>
<p>Estos datos son una tabla de los casos, y la información sobre ellos.</p>
<div class="sourceCode" id="cb1217"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"godata"</span>, <span class="st">"cases_clean.rds"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">case_id</span>, <span class="va">firstName</span>, <span class="va">lastName</span>, <span class="va">gender</span>, <span class="va">age</span>, <span class="va">age_class</span>,
         <span class="va">occupation</span>, <span class="va">classification</span>, <span class="va">was_contact</span>, <span class="va">hospitalization_typeid</span><span class="op">)</span></code></pre></div>
<p>Aquí están los casos <code><a href="https://rdrr.io/r/base/nrow.html">nrow(cases)</a></code>:</p>
<div id="htmlwidget-33514f9f1e4ede048edb" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-33514f9f1e4ede048edb">{"x":{"filter":"none","vertical":false,"data":[["CASE-2020-0029","CASE-2020-0026","CASE-2020-0017","CASE-2020-0043","CASE-2020-0044","CASE-2020-0036","CASE-2020-0037","CASE-2020-0006","CASE-2020-0045","CASE-2020-0046","CASE-2020-0034","CASE-2020-0031","CASE-2020-0028","CASE-2020-0010","CASE-2020-0018","CASE-2020-0038","CASE-2020-0007","CASE-2020-0023","CONTACT-2020-0024","CASE-2020-0002","CASE-2020-0002","CASE-2020-0020","CASE-2020-0027","CASE-2020-0015","CASE-2020-0035","CASE-2020-0019","CASE-2020-0019",null,"CASE-2020-0040","CASE-2020-0004","CASE-2020-0014","CASE-2020-0009","CASE-2020-0009","CONTACT-2020-0002","CASE-2020-0039","CASE-2020-0025","CASE-2020-0022","CASE-2020-0008",null,"CASE-2020-0011","CASE-2020-0012","CASE-2020-0016","CASE-2020-0013","CASE-2020-0033","CASE-2020-0030","CASE-2020-0032","CASE-2020-0003",null,"CASE-2020-0024","CASE-2020-0005","CASE-2020-0021",null,null,null,"CASE-2020-0001",null],["Abdoulaye","Adama","Adama","Adama","Adji","Aida","Aissatou","Alassane","Alfa","Alfa","Alioune","Alioune","Amadou","Amy","Assane","Awa","Bassirou","Bineta","Birima","Charles","Charles","Demba","Edouard","Fatima","Fatou","Fatoumata","Fatoumata","Giovanna ","Ibrahima","Jean-Paul","Joseph","Khady","Khady","Malang","Mamadou","Mamoudou","Mariama","Mhustapha","Modified Case","Moussa","Odette","Odette","Omar","Ousmane","Ousseynou","Pape","Samba","Samba","Seynabou","Souleymane","Boubacar","Sara","Larry","Elisabeth","Elisabeth","Charles"],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"Diallo","Garcia","Hinkle","Hopkins","Hopkins","Williams"],["MALE","FEMALE","MALE","MALE","FEMALE","FEMALE","FEMALE","MALE","FEMALE","FEMALE","MALE","MALE","MALE","FEMALE","MALE","FEMALE","MALE","FEMALE","MALE",null,"MALE","MALE","MALE","FEMALE","FEMALE","FEMALE",null,null,"MALE","MALE","MALE","FEMALE",null,"FEMALE","MALE","MALE","FEMALE","MALE","MALE","MALE","FEMALE","FEMALE","MALE","MALE","MALE","MALE","MALE","FEMALE","FEMALE","MALE","MALE","FEMALE","MALE","FEMALE","FEMALE","MALE"],[46,61,8,null,25,40,80,47,34,34,20,20,45,37,25,57,75,43,3,43,52,43,38,38,35,45,61,null,23,43,54,57,52,54,0.916666666666667,63,51,7,null,31,80,80,52,5,52,31,58,45,56,23,46,55,34,43,49,43],["40-49","60-64","5-9","unknown","20-29","40-49","80+","40-49","30-39","30-39","20-29","20-29","40-49","30-39","20-29","50-59","75-79","40-49","0-4","40-49","50-59","40-49","30-39","30-39","30-39","40-49","60-64","unknown","20-29","40-49","50-59","50-59","50-59","50-59","0-4","60-64","50-59","5-9","unknown","30-39","80+","80+","50-59","5-9","50-59","30-39","50-59","40-49","50-59","20-29","40-49","50-59","30-39","40-49","40-49","40-49"],["WORKING_WITH_ANIMALS","FARMER","CHILD","HEALTH_CARE_WORKER",null,"WORKING_WITH_ANIMALS","FARMER","HEALTH_CARE_WORKER","BUTCHER","BUTCHER","STUDENT","STUDENT","HEALTH_CARE_WORKER","TEACHER","STUDENT","OTHER","OTHER","HEALTH_CARE_WORKER",null,"HEALTH_CARE_WORKER","FARMER","HEALTH_CARE_WORKER","OTHER","WORKING_WITH_ANIMALS","HEALTH_CARE_WORKER","TRADITIONAL_HEALER","FARMER",null,"STUDENT","HEALTH_CARE_WORKER","FARMER","OTHER","FARMER","FARMER","CHILD","FARMER","OTHER","CHILD",null,"OTHER","FARMER","FARMER","FARMER","CHILD","FARMER","OTHER","TRADITIONAL_HEALER","WORKING_WITH_ANIMALS","WORKING_WITH_ANIMALS","STUDENT","WORKING_WITH_ANIMALS","FARMER","HEALTH_CARE_WORKER","HEALTH_CARE_WORKER","FARMER","HEALTH_CARE_WORKER"],["CONFIRMED","PROBABLE","CONFIRMED","SUSPECT","CONFIRMED","CONFIRMED","PROBABLE","CONFIRMED","SUSPECT","SUSPECT","CONFIRMED","CONFIRMED","CONFIRMED","CONFIRMED","PROBABLE","CONFIRMED","CONFIRMED","CONFIRMED","SUSPECT","PROBABLE","CONFIRMED","PROBABLE","CONFIRMED","CONFIRMED","PROBABLE","CONFIRMED","PROBABLE","CONFIRMED","CONFIRMED","CONFIRMED","PROBABLE","CONFIRMED","SUSPECT","SUSPECT","SUSPECT","NOT_A_CASE_DISCARDED","SUSPECT","PROBABLE","CONFIRMED","PROBABLE","PROBABLE","PROBABLE","CONFIRMED","PROBABLE","SUSPECT","CONFIRMED","CONFIRMED","CONFIRMED","CONFIRMED","CONFIRMED","CONFIRMED","PROBABLE","CONFIRMED","CONFIRMED","CONFIRMED","PROBABLE"],[false,false,false,true,true,false,false,false,true,true,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,true,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],["HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION",null,null,"HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION",null,null,"HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION",null,null,"HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION",null,"HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION","HOSPITALIZATION",null,"HOSPITALIZATION","HOSPITALIZATION",null,null,null,null,"HOSPITALIZATION",null]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>firstName<\/th>\n      <th>lastName<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_class<\/th>\n      <th>occupation<\/th>\n      <th>classification<\/th>\n      <th>was_contact<\/th>\n      <th>hospitalization_typeid<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="datos-de-contactos" class="section level4 unnumbered">
<h4>Datos de contactos<a class="anchor" aria-label="anchor" href="#datos-de-contactos"><i class="fas fa-link"></i></a>
</h4>
<p>Estos datos son una tabla de todos los contactos e información sobre ellos. De nuevo, proporciona tu propia ruta de acceso al archivo. Después de la importación, realizamos algunos pasos preliminares de limpieza de datos que incluyen:</p>
<ul>
<li>Establecer age_class como factor e invertir el orden de los niveles para que las edades más jóvenes sean las primeras</li>
<li>Seleccionar sólo una columna determinada, renombrando una de ellas</li>
<li>Asignar artificialmente a “Djembe” las filas a las que les falta el nivel 2 de administración, para mejorar la claridad de algunas visualizaciones de ejemplo</li>
</ul>
<div class="sourceCode" id="cb1218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">contacts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"godata"</span>, <span class="st">"contacts_clean.rds"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>age_class <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op">(</span><span class="va">age_class</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">contact_id</span>, <span class="va">contact_status</span>, <span class="va">firstName</span>, <span class="va">lastName</span>, <span class="va">gender</span>, <span class="va">age</span>,
         <span class="va">age_class</span>, <span class="va">occupation</span>, <span class="va">date_of_reporting</span>, <span class="va">date_of_data_entry</span>,
         date_of_last_exposure <span class="op">=</span> <span class="va">date_of_last_contact</span>,
         <span class="va">date_of_followup_start</span>, <span class="va">date_of_followup_end</span>, <span class="va">risk_level</span>, <span class="va">was_case</span>, <span class="va">admin_2_name</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>admin_2_name <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">admin_2_name</span>, <span class="st">"Djembe"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Aquí están las filas de los datos de contactos (<code><a href="https://rdrr.io/r/base/nrow.html">nrow(contacts)</a></code>):</p>
<div id="htmlwidget-e0190a7c40979982e1ab" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-e0190a7c40979982e1ab">{"x":{"filter":"none","vertical":false,"data":[["CONTACT-2020-0046","CONTACT-2020-0015","CONTACT-2020-0043","CONTACT-2020-0012","CONTACT-2020-0054","CONTACT-2020-0056","CONTACT-2020-0030","CONTACT-2020-0060","CONTACT-2020-0021","CONTACT-2020-0059","CONTACT-2020-0005","CONTACT-2020-0053","CONTACT-2020-0058","CONTACT-2020-0011","CONTACT-2020-0001","CONTACT-2020-0003","CONTACT-2020-0029","CONTACT-2020-0042","CONTACT-2020-0055","CONTACT-2020-0036","CONTACT-2020-0032","CONTACT-2020-0019","CONTACT-2020-0025","CONTACT-2020-0040","CONTACT-2020-0045","CONTACT-2020-0004","CONTACT-2020-0020","CONTACT-2020-0016","CONTACT-2020-0031","CONTACT-2020-0014","CONTACT-2020-0037","CONTACT-2020-0007","CONTACT-2020-0051","CONTACT-2020-0008","CONTACT-2020-0048","CONTACT-2020-0038","CONTACT-2020-0010","CONTACT-2020-0006","CONTACT-2020-0034","CONTACT-2020-0052","CONTACT-2020-0044","CONTACT-2020-0009","CONTACT-2020-0047","CONTACT-2020-0022","CONTACT-2020-0013","CONTACT-2020-0023","CONTACT-2020-0041","CONTACT-2020-0028","CONTACT-2020-0017","CONTACT-2020-0027","CONTACT-2020-0035","CONTACT-2020-0026","CONTACT-2020-0033","CONTACT-2020-0050","CONTACT-2020-0057","CONTACT-2020-0018","CONTACT-2020-0049","CONTACT-2020-0039",null,null,"CASE-2020-0043","CASE-2020-0044","CASE-2020-0045","CASE-2020-0046","CONTACT-2020-0024","CONTACT-2020-0002"],["UNDER_FOLLOW_UP","LOST_TO_FOLLOW_UP","UNDER_FOLLOW_UP","LOST_TO_FOLLOW_UP","UNDER_FOLLOW_UP","FOLLOW_UP_COMPLETED","FOLLOW_UP_COMPLETED","LOST_TO_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","FOLLOW_UP_COMPLETED","FOLLOW_UP_COMPLETED","DIED","FOLLOW_UP_COMPLETED","DIED","UNDER_FOLLOW_UP","FOLLOW_UP_COMPLETED","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","FOLLOW_UP_COMPLETED","FOLLOW_UP_COMPLETED","FOLLOW_UP_COMPLETED","FOLLOW_UP_COMPLETED","UNDER_FOLLOW_UP","FOLLOW_UP_COMPLETED","UNDER_FOLLOW_UP","FOLLOW_UP_COMPLETED","FOLLOW_UP_COMPLETED","FOLLOW_UP_COMPLETED","FOLLOW_UP_COMPLETED","FOLLOW_UP_COMPLETED","FOLLOW_UP_COMPLETED","UNDER_FOLLOW_UP","FOLLOW_UP_COMPLETED","FOLLOW_UP_COMPLETED","UNDER_FOLLOW_UP","LOST_TO_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","FOLLOW_UP_COMPLETED","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","LOST_TO_FOLLOW_UP","FOLLOW_UP_COMPLETED","UNDER_FOLLOW_UP","LOST_TO_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","BECAME_CASE","BECAME_CASE","BECAME_CASE","BECAME_CASE","BECAME_CASE","BECAME_CASE"],["Abou","Adama","Adja","Alfa","Alimatou","Amath","Aminata","Binette","Binta","Bintou","Birima","Birima","Bransan  ","Cheik","Cheik","Cheik","Coura","Dicory","Djeynaba","Djiby","El Hadj","Kalidou","Khadija","Khary","Khary","Khary","Khary","Lamine","Lat","Madia","Maguette","Maguette","Maguette","Malamine","Malamine","Malamine","Malang","Malang","Malang","Mayatta","Mbagnick","Modou","Ndiankou","Ndiaya","Ndiogou","Oulimata","Oumou","Papis","Racine","Sadibou","Sofiatou","Thione","Thiony","Waly","Wasis","Yacouba","Youssouf","Abba","Mayatta","Jelani","Adama","Adji","Alfa","Alfa","Birima","Malang"],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"Abebe","Obi","Onai",null,null,null,null,null,null],["MALE","MALE","MALE","FEMALE","MALE","MALE","FEMALE","FEMALE","FEMALE","FEMALE","MALE","MALE","FEMALE","MALE","MALE","MALE","MALE","MALE","FEMALE","FEMALE","MALE","MALE","MALE","MALE","FEMALE","FEMALE","FEMALE","FEMALE","FEMALE","MALE","FEMALE","FEMALE","FEMALE","MALE","MALE","MALE","FEMALE","FEMALE","FEMALE","MALE","MALE","MALE","MALE","FEMALE","FEMALE","MALE","MALE","FEMALE","FEMALE","MALE","FEMALE","MALE","FEMALE","MALE","FEMALE","MALE","FEMALE","FEMALE","MALE","MALE","MALE","FEMALE","FEMALE","FEMALE","MALE","FEMALE"],[81,56,47,34,8,54,36,34,32,97,3,3,23,12,12,12,null,15,54,45,21,20,4,21,32,32,32,12,23,34,9,29,9,63,7,7,54,54,54,null,null,18,67,32,56,23,34,null,35,15,null,45,5,56,2,78,null,17,null,24,null,25,34,34,3,54],["80+","50-59","40-49","30-39","5-9","50-59","30-39","30-39","30-39","80+","0-4","0-4","20-29","10-14","10-14","10-14","unknown","15-19","50-59","40-49","20-29","20-29","0-4","20-29","30-39","30-39","30-39","10-14","20-29","30-39","5-9","20-29","5-9","60-64","5-9","5-9","50-59","50-59","50-59","unknown","unknown","15-19","65-69","30-39","50-59","20-29","30-39","unknown","30-39","15-19","unknown","40-49","5-9","50-59","0-4","75-79","unknown","15-19","unknown","20-29","unknown","20-29","30-39","30-39","0-4","50-59"],[null,null,null,null,null,null,null,null,null,null,"CHILD",null,null,null,"CHILD","CHILD",null,null,null,null,null,null,null,null,null,"FARMER",null,null,null,null,null,"OTHER",null,"FARMER",null,null,null,"FARMER",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"HEALTH_CARE_WORKER","STUDENT","HEALTH_CARE_WORKER",null,"BUTCHER","BUTCHER",null,"FARMER"],["2020-04-15","2020-04-16","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-05-25","2020-04-15","2020-05-01","2020-05-25","2020-04-15","2020-05-25","2020-03-22","2020-03-22","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-03-22","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-05-25","2020-03-22","2020-04-15","2020-04-15","2020-04-15","2020-05-25","2020-04-15","2020-05-25","2020-04-15","2020-05-25","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-09-02","2020-09-03","2020-07-08","2020-07-11","2020-07-16","2020-07-07","2020-04-15","2020-03-22"],["2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-09-03","2020-09-04","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08"],["2020-06-22","2020-08-13","2020-06-22","2020-06-15","2020-06-17","2020-09-02","2020-05-15","2020-06-16","2020-05-13","2020-06-20","2020-04-28","2020-04-26","2020-06-22","2020-04-26","2020-06-07","2020-06-07","2020-06-17","2020-06-16","2020-06-20","2020-06-19","2020-05-10","2020-06-24","2020-05-08","2020-06-15","2020-06-05","2020-06-07","2020-06-05","2020-06-22","2020-05-10","2020-06-15","2020-06-05","2020-06-07","2020-06-05","2020-04-28","2020-06-06","2020-06-05","2020-04-29","2020-06-07","2020-06-05","2020-06-17","2020-06-17","2020-05-15","2020-06-20","2020-05-10","2020-06-22","2020-05-13","2020-06-22","2020-06-17","2020-06-15","2020-06-24","2020-06-17","2020-06-22","2020-06-22","2020-06-17","2020-06-17","2020-06-15","2020-06-17","2020-06-24","2020-09-02","2020-09-01","2020-05-06","2020-05-10","2020-07-27","2020-05-06","2020-04-26","2020-04-28"],["2020-08-15","2020-08-14","2020-08-14","2020-06-16","2020-06-18","2020-09-03",null,"2020-06-17","2020-05-14","2020-06-21","2020-04-29","2020-04-27","2020-06-23","2020-04-27","2020-06-08","2020-06-08","2020-06-18","2020-06-17","2020-06-21","2020-06-20",null,"2020-06-25",null,"2020-06-16","2020-06-06","2020-06-08","2020-06-06","2020-06-23",null,"2020-06-16","2020-06-06","2020-06-08","2020-06-06",null,"2020-06-08","2020-06-06","2020-04-30","2020-06-08","2020-06-06","2020-06-18","2020-06-18","2020-05-16","2020-06-21","2020-05-11","2020-06-23","2020-05-14","2020-06-23","2020-06-18","2020-06-16","2020-06-25","2020-06-18","2020-06-23","2020-06-23","2020-06-18","2020-06-18","2020-06-16","2020-06-18","2020-06-25","2020-09-03","2020-09-02",null,null,null,null,"2020-06-06",null],["2020-08-28","2020-08-27","2020-08-27","2020-06-29","2020-07-01","2020-09-16",null,"2020-06-30","2020-05-27","2020-07-04","2020-05-12","2020-05-10","2020-07-06","2020-05-10","2020-06-21","2020-06-21","2020-07-01","2020-06-30","2020-07-04","2020-07-03",null,"2020-07-08",null,"2020-06-29","2020-06-19","2020-06-21","2020-06-19","2020-07-06",null,"2020-06-29","2020-06-19","2020-06-21","2020-06-19",null,"2020-06-21","2020-06-19","2020-05-13","2020-06-21","2020-06-19","2020-07-01","2020-07-01","2020-05-29","2020-07-04","2020-05-24","2020-07-06","2020-05-27","2020-07-06","2020-07-01","2020-06-29","2020-07-08","2020-07-01","2020-07-06","2020-07-06","2020-07-01","2020-07-01","2020-06-29","2020-07-01","2020-07-08","2020-09-16","2020-09-15",null,null,null,null,"2020-06-19",null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"1_LOW","3_HIGH","1_LOW",null,null,null,null],[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,null,null,null,null,null,null],["Djembe","Trumpet","Djembe","Djembe","Trumpet","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Trumpet","Djembe","Djembe","Congas","Venu","Cornet","Venu","Djembe","Djembe"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>contact_id<\/th>\n      <th>contact_status<\/th>\n      <th>firstName<\/th>\n      <th>lastName<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_class<\/th>\n      <th>occupation<\/th>\n      <th>date_of_reporting<\/th>\n      <th>date_of_data_entry<\/th>\n      <th>date_of_last_exposure<\/th>\n      <th>date_of_followup_start<\/th>\n      <th>date_of_followup_end<\/th>\n      <th>risk_level<\/th>\n      <th>was_case<\/th>\n      <th>admin_2_name<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":5}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="datos-de-seguimiento" class="section level4 unnumbered">
<h4>Datos de seguimiento<a class="anchor" aria-label="anchor" href="#datos-de-seguimiento"><i class="fas fa-link"></i></a>
</h4>
<p>Estos datos son registros de las interacciones de “seguimiento” con los contactos. Se supone que cada contacto tiene un encuentro diario durante los 14 días siguientes a su exposición.</p>
<p>Importamos y realizamos algunos pasos de limpieza. Seleccionamos ciertas columnas y también convertimos una columna de caracteres a todos los valores en minúsculas.</p>
<div class="sourceCode" id="cb1219"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">followups</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"godata"</span>, <span class="st">"followups_clean.rds"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">contact_id</span>, <span class="va">followup_status</span>, <span class="va">followup_number</span>,
         <span class="va">date_of_followup</span>, <span class="va">admin_2_name</span>, <span class="va">admin_1_name</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>followup_status <span class="op">=</span> <span class="fu">str_to_lower</span><span class="op">(</span><span class="va">followup_status</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Aquí están las primeras 50 filas de <code>followups</code> (cada fila es una interacción de seguimiento, con el estado del resultado en la columna <code>followup_status</code>):</p>
<div id="htmlwidget-5572e24f18ba29049629" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5572e24f18ba29049629">{"x":{"filter":"none","vertical":false,"data":[["CONTACT-2020-0012","CONTACT-2020-0015","CONTACT-2020-0015","CONTACT-2020-0015","CONTACT-2020-0015","CONTACT-2020-0043","CONTACT-2020-0046","CONTACT-2020-0012","CONTACT-2020-0046","CONTACT-2020-0043","CONTACT-2020-0056","CONTACT-2020-0054","CONTACT-2020-0012","CONTACT-2020-0054","CONTACT-2020-0054","CONTACT-2020-0012","CONTACT-2020-0056","CONTACT-2020-0054","CONTACT-2020-0056","CONTACT-2020-0056","CONTACT-2020-0060","CONTACT-2020-0059","CONTACT-2020-0060","CONTACT-2020-0060","CONTACT-2020-0060","CONTACT-2020-0059","CONTACT-2020-0059","CONTACT-2020-0059","CONTACT-2020-0005","CONTACT-2020-0058","CONTACT-2020-0029","CONTACT-2020-0029","CONTACT-2020-0029","CONTACT-2020-0042","CONTACT-2020-0058","CONTACT-2020-0003","CONTACT-2020-0001","CONTACT-2020-0029","CONTACT-2020-0042","CONTACT-2020-0036","CONTACT-2020-0042","CONTACT-2020-0036","CONTACT-2020-0036","CONTACT-2020-0042","CONTACT-2020-0004","CONTACT-2020-0036","CONTACT-2020-0040","CONTACT-2020-0040","CONTACT-2020-0040","CONTACT-2020-0014"],["seen_ok","not_attempted","seen_ok","seen_ok","seen_ok","seen_ok","seen_ok","seen_ok","seen_ok","seen_ok","not_performed","seen_ok","seen_ok","seen_not_ok","seen_ok","seen_ok","seen_ok","seen_ok","not_performed","seen_ok","seen_ok","seen_ok","not_attempted","seen_ok","missed","seen_ok","missed","seen_ok","seen_ok","seen_ok","seen_ok","missed","seen_ok","seen_not_ok","missed","seen_ok","missed","seen_ok","seen_ok","seen_ok","missed","seen_ok","seen_ok","seen_ok","seen_ok","seen_ok","seen_ok","seen_ok","seen_not_ok","seen_ok"],[7,8,6,9,7,1,2,6,1,2,9,6,8,7,5,9,7,4,6,8,5,4,6,8,7,3,1,2,14,1,7,5,4,5,2,14,14,6,6,4,7,3,5,8,14,2,6,9,7,8],["2020-06-02","2020-06-03","2020-06-01","2020-06-04","2020-06-02","2020-06-03","2020-06-05","2020-06-01","2020-06-04","2020-06-04","2020-06-04","2020-06-03","2020-06-03","2020-06-04","2020-06-02","2020-06-04","2020-06-02","2020-06-01","2020-06-01","2020-06-03","2020-06-01","2020-06-04","2020-06-02","2020-06-04","2020-06-03","2020-06-03","2020-06-01","2020-06-02","2020-06-01","2020-06-03","2020-06-04","2020-06-02","2020-06-01","2020-06-01","2020-06-04","2020-06-01","2020-06-01","2020-06-03","2020-06-02","2020-06-03","2020-06-03","2020-06-02","2020-06-04","2020-06-04","2020-06-01","2020-06-01","2020-06-01","2020-06-04","2020-06-02","2020-06-03"],["Djembe","Trumpet","Trumpet","Trumpet","Trumpet","Djembe",null,"Djembe",null,"Djembe",null,"Trumpet","Djembe","Trumpet","Trumpet","Djembe",null,"Trumpet",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],["Drums island","Brass island","Brass island","Brass island","Brass island","Drums island",null,"Drums island",null,"Drums island",null,"Brass island","Drums island","Brass island","Brass island","Drums island",null,"Brass island",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>contact_id<\/th>\n      <th>followup_status<\/th>\n      <th>followup_number<\/th>\n      <th>date_of_followup<\/th>\n      <th>admin_2_name<\/th>\n      <th>admin_1_name<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="datos-de-las-relaciones" class="section level4 unnumbered">
<h4>Datos de las relaciones<a class="anchor" aria-label="anchor" href="#datos-de-las-relaciones"><i class="fas fa-link"></i></a>
</h4>
<p>Aquí importamos datos que muestran la relación entre casos y contactos. Seleccionamos cierta columna para mostrarlos.</p>
<div class="sourceCode" id="cb1220"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">relationships</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"godata"</span>, <span class="st">"relationships_clean.rds"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">source_visualid</span>, <span class="va">source_gender</span>, <span class="va">source_age</span>, <span class="va">date_of_last_contact</span>,
         <span class="va">date_of_data_entry</span>, <span class="va">target_visualid</span>, <span class="va">target_gender</span>,
         <span class="va">target_age</span>, <span class="va">exposure_type</span><span class="op">)</span></code></pre></div>
<p>A continuación se muestran las primeras 50 filas de los datos de relaciones (<code>relationships</code>), cuyos registros son todas las relaciones entre casos y contactos.</p>
<div id="htmlwidget-3a8859ed7b5d918fdfb6" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3a8859ed7b5d918fdfb6">{"x":{"filter":"none","vertical":false,"data":[["CASE-2020-0016",null,null,"CASE-2020-0045","CASE-2020-0004","CASE-2020-0010",null,"CASE-2020-0034",null,"CASE-2020-0037","CASE-2020-0005",null,"CASE-2020-0002","CASE-2020-0001","CASE-2020-0005",null,"CASE-2020-0004","CASE-2020-0012","CASE-2020-0022","CASE-2020-0004","CASE-2020-0003","CASE-2020-0001","CASE-2020-0030","CASE-2020-0022","CASE-2020-0010","CASE-2020-0018","CASE-2020-0045","CASE-2020-0030","CASE-2020-0001","CASE-2020-0018","CASE-2020-0008","CASE-2020-0014",null,"CASE-2020-0002","CASE-2020-0030","CASE-2020-0031","CASE-2020-0009","CASE-2020-0031","CASE-2020-0002",null,"CASE-2020-0001","CASE-2020-0001","CASE-2020-0022","CASE-2020-0001","CASE-2020-0012","CASE-2020-0023","CASE-2020-0016","CASE-2020-0001",null,"CASE-2020-0023"],["Female",null,null,"Female","Male","Female",null,"Male",null,"Female","Male",null,"Male","Female","Male",null,"Male","Female","Female","Male","Male","Female","Male","Female","Female","Male","Female","Male","Female","Male","Male","Male",null,"Male","Male","Male","Female","Male","Male",null,"Female","Female","Female","Female","Female","Female","Female","Female","Female","Female"],[80,null,null,34,43,37,null,20,null,80,23,0,52,49,23,null,43,80,51,43,58,49,52,51,37,25,34,52,49,25,7,54,null,52,52,20,57,20,52,null,49,49,51,49,80,43,80,49,43,43],["2020-06-24","2020-05-02","2020-06-15","2020-07-27","2020-06-05","2020-06-05","2020-08-19","2020-06-20","2020-08-19","2020-09-02","2020-08-07","2020-08-13","2020-05-15","2020-07-17","2020-06-15","2020-08-07","2020-06-15","2020-06-17","2020-06-05","2020-06-24","2020-06-07","2020-08-15","2020-06-17","2020-06-22","2020-06-19","2020-06-17","2020-07-27","2020-06-16","2020-04-28","2020-04-26","2020-06-15","2020-06-05","2020-05-02","2020-04-29","2020-06-22","2020-06-06","2020-05-13","2020-06-17","2020-05-01","2020-06-15","2020-06-07","2020-08-14","2020-06-20","2020-09-02","2020-06-24","2020-07-28","2020-06-17","2020-08-14","2020-08-14","2020-07-28"],["2020-06-08","2020-06-08","2020-06-08","2020-06-10","2020-06-08","2020-06-08","2020-08-20","2020-06-08","2020-08-20","2020-09-03","2020-08-21","2020-08-20","2020-06-08","2020-06-08","2020-06-08","2020-08-20","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-10","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-08-27","2020-06-08","2020-09-03","2020-06-08","2020-06-10","2020-06-08","2020-08-27","2020-08-27","2020-06-10"],["CONTACT-2020-0027","CASE-2020-0014","CASE-2020-0031","CASE-2020-0021","CONTACT-2020-0020","CONTACT-2020-0038","CASE-2020-0036","CONTACT-2020-0059","CASE-2020-0037",null,"CASE-2020-0015","CONTACT-2020-0015","CONTACT-2020-0009","CASE-2020-0008",null,"CASE-2020-0010","CONTACT-2020-0018","CONTACT-2020-0029","CONTACT-2020-0045","CONTACT-2020-0019","CONTACT-2020-0007","CASE-2020-0004","CONTACT-2020-0044","CONTACT-2020-0046","CONTACT-2020-0036","CONTACT-2020-0052","CASE-2020-0023","CONTACT-2020-0042","CONTACT-2020-0005","CONTACT-2020-0053","CONTACT-2020-0017","CONTACT-2020-0034","CASE-2020-0012","CASE-2020-0008","CONTACT-2020-0043","CONTACT-2020-0048","CONTACT-2020-0023","CONTACT-2020-0049","CASE-2020-0006","CASE-2020-0018","CONTACT-2020-0003","CASE-2020-0017","CONTACT-2020-0047","CONTACT-2020-0056","CONTACT-2020-0027","CASE-2020-0029","CONTACT-2020-0028","CONTACT-2020-0046","CONTACT-2020-0046","CASE-2020-0027"],["Male","Male","Male","Male","Female","Male","Female","Female","Female","Male","Female","Male","Male","Male",null,"Female","Male","Male","Female","Male","Female","Male","Male","Male","Female","Male","Female","Male","Male","Male","Female","Female","Female","Male","Male","Male","Male","Female","Male","Male","Male","Male","Male","Male","Male","Male","Female","Male","Male","Male"],[15,54,20,46,32,7,40,97,80,0,38,56,18,7,null,37,78,null,32,20,29,43,null,81,45,null,43,15,3,3,35,54,80,7,47,7,23,null,47,25,12,8,67,54,15,46,null,81,81,38],["Direct physical contact ",null,null,null,"Indirect contact (touched contaminated surface/materials/fomites etc.)","Direct non-physical contact (within 1 meter) ",null,"Direct physical contact ",null,"Direct physical contact ","Direct non-physical contact (within 1 meter) ","Direct non-physical contact (within 1 meter) ","Direct non-physical contact (within 1 meter) ","Direct physical contact ",null,"Direct non-physical contact (within 1 meter) ","Indirect contact (touched contaminated surface/materials/fomites etc.)","Indirect contact (touched contaminated surface/materials/fomites etc.)","Direct physical contact ","Direct non-physical contact (within 1 meter) ",null,"Direct physical contact ","Indirect contact (touched contaminated surface/materials/fomites etc.)","Direct physical contact ","Direct physical contact ","Direct non-physical contact (within 1 meter) ",null,"Direct physical contact ",null,"Direct physical contact ","Indirect contact (touched contaminated surface/materials/fomites etc.)","Direct non-physical contact (within 1 meter) ",null,"Direct physical contact ","Direct non-physical contact (within 1 meter) ","Direct non-physical contact (within 1 meter) ","Direct physical contact ","Direct physical contact ",null,null,null,null,"Indirect contact (touched contaminated surface/materials/fomites etc.)","Direct physical contact ","Direct physical contact ",null,"Direct physical contact ",null,null,null]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>source_visualid<\/th>\n      <th>source_gender<\/th>\n      <th>source_age<\/th>\n      <th>date_of_last_contact<\/th>\n      <th>date_of_data_entry<\/th>\n      <th>target_visualid<\/th>\n      <th>target_gender<\/th>\n      <th>target_age<\/th>\n      <th>exposure_type<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,7]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div id="descriptive-analyses" class="section level2" number="25.2">
<h2>
<span class="header-section-number">25.2</span> Análisis descriptivo<a class="anchor" aria-label="anchor" href="#descriptive-analyses"><i class="fas fa-link"></i></a>
</h2>
<p>Puedes utilizar las técnicas tratadas en otras páginas de este manual para realizar análisis descriptivos de los casos, contactos y sus relaciones. A continuación se ofrecen algunos ejemplos.</p>
<div id="datos-demográficos" class="section level3 unnumbered">
<h3>Datos demográficos<a class="anchor" aria-label="anchor" href="#datos-demogr%C3%A1ficos"><i class="fas fa-link"></i></a>
</h3>
<p>Como se muestra en la página dedicada a las <a href="demographic-pyramids-and-likert-scales.html#demographic-pyramids-and-likert-scales">pirámides demográficas</a>, se puede visualizar la distribución por edades y por sexos (aquí utilizamos el paquete <strong>apyramid</strong>).</p>
<div id="edad-y-sexo-de-los-contactos" class="section level4 unnumbered">
<h4>Edad y sexo de los contactos<a class="anchor" aria-label="anchor" href="#edad-y-sexo-de-los-contactos"><i class="fas fa-link"></i></a>
</h4>
<p>La pirámide que se muestra a continuación compara la distribución de la edad de los contactos, por género. Observa que los contactos a los que les falta la edad se incluyen en su propia barra en la parte superior. Puedes cambiar este comportamiento por defecto, pero entonces considera listar el número que falta en una leyenda.</p>
<div class="sourceCode" id="cb1221"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">apyramid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/apyramid/man/age_pyramid.html">age_pyramid</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">contacts</span>,                                   <span class="co"># use contacts dataset</span>
  age_group <span class="op">=</span> <span class="st">"age_class"</span>,                           <span class="co"># categorical age column</span>
  split_by <span class="op">=</span> <span class="st">"gender"</span><span class="op">)</span> <span class="op">+</span>                             <span class="co"># gender for halfs of pyramid</span>
  <span class="fu">labs</span><span class="op">(</span>
    fill <span class="op">=</span> <span class="st">"Gender"</span>,                                 <span class="co"># title of legend</span>
    title <span class="op">=</span> <span class="st">"Age/Sex Pyramid of COVID-19 contacts"</span><span class="op">)</span><span class="op">+</span> <span class="co"># title of the plot</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span>                                    <span class="co"># simple background</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-873-1.png" width="672"></div>
<p>Con la estructura de datos Go.Data, los datos <code>relationships</code> contienen las edades tanto de los casos como de los contactos, por lo que podrías utilizar ese conjunto de datos y crear una pirámide de edades que muestre las diferencias entre estos dos grupos de personas. El dataframe <code>relationships</code> será mutado para transformar las columnas numéricas de edad en categorías (véase la página de <a href="cleaning-data-and-core-functions.html#cleaning-data-and-core-functions">limpieza de datos y funciones básicas</a>). También pivotamos el dataframe a largo para facilitar el trazado con <strong>ggplot2</strong> (ver <a href="pivoting-data.html#pivoting-data">Pivotar datos</a>).</p>
<div class="sourceCode" id="cb1222"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">relation_age</span> <span class="op">&lt;-</span> <span class="va">relationships</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">source_age</span>, <span class="va">target_age</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">transmute</span><span class="op">(</span>                              <span class="co"># transmute is like mutate() but removes all other columns not mentioned</span>
    source_age_class <span class="op">=</span> <span class="fu">epikit</span><span class="fu">::</span><span class="fu"><a href="https://r4epi.github.io/epikit/reference/age_categories.html">age_categories</a></span><span class="op">(</span><span class="va">source_age</span>, breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,
    target_age_class <span class="op">=</span> <span class="fu">epikit</span><span class="fu">::</span><span class="fu"><a href="https://r4epi.github.io/epikit/reference/age_categories.html">age_categories</a></span><span class="op">(</span><span class="va">target_age</span>, breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,
    <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">contains</span><span class="op">(</span><span class="st">"class"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"category"</span>, values_to <span class="op">=</span> <span class="st">"age_class"</span><span class="op">)</span>  <span class="co"># pivot longer</span>


<span class="va">relation_age</span></code></pre></div>
<pre><code>## # A tibble: 200 x 2
##    category         age_class
##    &lt;chr&gt;            &lt;fct&gt;    
##  1 source_age_class 80+      
##  2 target_age_class 15-19    
##  3 source_age_class &lt;NA&gt;     
##  4 target_age_class 50-54    
##  5 source_age_class &lt;NA&gt;     
##  6 target_age_class 20-24    
##  7 source_age_class 30-34    
##  8 target_age_class 45-49    
##  9 source_age_class 40-44    
## 10 target_age_class 30-34    
## # ... with 190 more rows</code></pre>
<p>Ahora podemos representar este conjunto de datos transformado con <code><a href="https://r4epi.github.io/sitrep/reference/apyramid.html">age_pyramid()</a></code> como antes, pero sustituyendo <code>gender</code> con la <code>category</code> (contacto, o caso).</p>
<div class="sourceCode" id="cb1224"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">apyramid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/apyramid/man/age_pyramid.html">age_pyramid</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">relation_age</span>,                               <span class="co"># use modified relationship dataset</span>
  age_group <span class="op">=</span> <span class="st">"age_class"</span>,                           <span class="co"># categorical age column</span>
  split_by <span class="op">=</span> <span class="st">"category"</span><span class="op">)</span> <span class="op">+</span>                           <span class="co"># by cases and contacts</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span>
    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"orange"</span>, <span class="st">"purple"</span><span class="op">)</span>,                  <span class="co"># to specify colors AND labels</span>
    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Case"</span>, <span class="st">"Contact"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    fill <span class="op">=</span> <span class="st">"Legend"</span>,                                           <span class="co"># title of legend</span>
    title <span class="op">=</span> <span class="st">"Age/Sex Pyramid of COVID-19 contacts and cases"</span><span class="op">)</span><span class="op">+</span> <span class="co"># title of the plot</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span>                                              <span class="co"># simple background</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-875-1.png" width="672"></div>
<p>También podemos ver otras características como el desglose profesional (por ejemplo, en forma de gráfico circular).</p>
<div class="sourceCode" id="cb1225"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Clean dataset and get counts by occupation</span>
<span class="va">occ_plot_data</span> <span class="op">&lt;-</span> <span class="va">cases</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>occupation <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_explicit_na.html">fct_explicit_na</a></span><span class="op">(</span><span class="va">occupation</span><span class="op">)</span>,  <span class="co"># make NA missing values a category</span>
         occupation <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_infreq</a></span><span class="op">(</span><span class="va">occupation</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co"># order factor levels in order of frequency</span>
  <span class="fu">count</span><span class="op">(</span><span class="va">occupation</span><span class="op">)</span>                                          <span class="co"># get counts by occupation</span>
  
<span class="co"># Make pie chart</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">occ_plot_data</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="va">n</span>, fill <span class="op">=</span> <span class="va">occupation</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_polar</span><span class="op">(</span><span class="st">"y"</span>, start <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    fill <span class="op">=</span> <span class="st">"Occupation"</span>,
    title <span class="op">=</span> <span class="st">"Known occupations of COVID-19 cases"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>                    
  <span class="fu">theme</span><span class="op">(</span>axis.line <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        axis.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
        axis.text <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-876-1.png" width="672"></div>
</div>
</div>
<div id="contactos-por-caso" class="section level3 unnumbered">
<h3>Contactos por caso<a class="anchor" aria-label="anchor" href="#contactos-por-caso"><i class="fas fa-link"></i></a>
</h3>
<p>El número de contactos por caso puede ser una métrica importante para evaluar la calidad de la enumeración de los contactos y la conformidad de la población con la respuesta de salud pública.</p>
<p>Dependiendo de la estructura de datos, esto puede evaluarse con un juego de datos que contenga todos los casos y contactos. En el conjunto de datos de Go.Data, los vínculos entre los casos (“fuentes”) y los contactos (“objetivos”) se almacenan en <code>relationships</code>.</p>
<p>En este conjunto de datos, cada fila es un contacto, y el caso de origen aparece en la fila. No hay contactos que tengan relaciones con múltiples casos, pero si esto existiese, puede ser necesario tenerlos en cuenta antes de representarlo (¡y explorarlos también!).</p>
<p>Comenzamos contando el número de filas (contactos) por caso de origen. Esto se guarda como un dataframe.</p>
<div class="sourceCode" id="cb1226"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">contacts_per_case</span> <span class="op">&lt;-</span> <span class="va">relationships</span> <span class="op">%&gt;%</span> 
  <span class="fu">count</span><span class="op">(</span><span class="va">source_visualid</span><span class="op">)</span>

<span class="va">contacts_per_case</span></code></pre></div>
<pre><code>## # A tibble: 23 x 2
##    source_visualid     n
##    &lt;chr&gt;           &lt;int&gt;
##  1 CASE-2020-0001     13
##  2 CASE-2020-0002      5
##  3 CASE-2020-0003      2
##  4 CASE-2020-0004      4
##  5 CASE-2020-0005      5
##  6 CASE-2020-0006      3
##  7 CASE-2020-0008      3
##  8 CASE-2020-0009      3
##  9 CASE-2020-0010      3
## 10 CASE-2020-0012      3
## # ... with 13 more rows</code></pre>
<p>Utilizamos <code>geom_histogram()</code> para trazar estos datos como un histograma.</p>
<div class="sourceCode" id="cb1228"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">contacts_per_case</span><span class="op">)</span><span class="op">+</span>        <span class="co"># begin with count data frame created above</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>  <span class="co"># print histogram of number of contacts per case</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>   <span class="co"># remove excess space below 0 on y-axis</span>
  <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                         <span class="co"># simplify background</span>
  <span class="fu">labs</span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"Number of contacts per case"</span>,
    y <span class="op">=</span> <span class="st">"Cases"</span>,
    x <span class="op">=</span> <span class="st">"Contacts per case"</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-878-1.png" width="672"></div>
</div>
</div>
<div id="contact-follow-up" class="section level2" number="25.3">
<h2>
<span class="header-section-number">25.3</span> Seguimiento de contactos<a class="anchor" aria-label="anchor" href="#contact-follow-up"><i class="fas fa-link"></i></a>
</h2>
<p>Los datos de rastreo de contactos suelen contener datos de “seguimiento”, que registran los resultados de los controles diarios de los síntomas de las personas en cuarentena. El análisis de estos datos puede servir de base para la estrategia de respuesta e identificar a los contactos con riesgo de pérdida de seguimiento o con riesgo de desarrollar la enfermedad.</p>
<div id="limpieza-de-datos" class="section level3 unnumbered">
<h3>Limpieza de datos<a class="anchor" aria-label="anchor" href="#limpieza-de-datos"><i class="fas fa-link"></i></a>
</h3>
<p>Estos datos pueden existir en una variedad de formatos. Pueden existir como una hoja de Excel de formato “ancho” con una fila por contacto y una columna por “día” de seguimiento. Consulta <a href="pivoting-data.html#pivoting-data">Pivotar datos</a> para ver las descripciones de los datos “largos” y “anchos” y cómo pivotar los datos anchos o largos.</p>
<p>En nuestro ejemplo de Go.Data, estos datos se almacenan en el dataframe <code>followups</code>, que tiene un formato “largo” con una fila por interacción de seguimiento. Las primeras 50 filas tienen este aspecto:</p>
<div id="htmlwidget-17d743bfa981a88cc194" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-17d743bfa981a88cc194">{"x":{"filter":"none","vertical":false,"data":[["CONTACT-2020-0012","CONTACT-2020-0015","CONTACT-2020-0015","CONTACT-2020-0015","CONTACT-2020-0015","CONTACT-2020-0043","CONTACT-2020-0046","CONTACT-2020-0012","CONTACT-2020-0046","CONTACT-2020-0043","CONTACT-2020-0056","CONTACT-2020-0054","CONTACT-2020-0012","CONTACT-2020-0054","CONTACT-2020-0054","CONTACT-2020-0012","CONTACT-2020-0056","CONTACT-2020-0054","CONTACT-2020-0056","CONTACT-2020-0056","CONTACT-2020-0060","CONTACT-2020-0059","CONTACT-2020-0060","CONTACT-2020-0060","CONTACT-2020-0060","CONTACT-2020-0059","CONTACT-2020-0059","CONTACT-2020-0059","CONTACT-2020-0005","CONTACT-2020-0058","CONTACT-2020-0029","CONTACT-2020-0029","CONTACT-2020-0029","CONTACT-2020-0042","CONTACT-2020-0058","CONTACT-2020-0003","CONTACT-2020-0001","CONTACT-2020-0029","CONTACT-2020-0042","CONTACT-2020-0036","CONTACT-2020-0042","CONTACT-2020-0036","CONTACT-2020-0036","CONTACT-2020-0042","CONTACT-2020-0004","CONTACT-2020-0036","CONTACT-2020-0040","CONTACT-2020-0040","CONTACT-2020-0040","CONTACT-2020-0014"],["seen_ok","not_attempted","seen_ok","seen_ok","seen_ok","seen_ok","seen_ok","seen_ok","seen_ok","seen_ok","not_performed","seen_ok","seen_ok","seen_not_ok","seen_ok","seen_ok","seen_ok","seen_ok","not_performed","seen_ok","seen_ok","seen_ok","not_attempted","seen_ok","missed","seen_ok","missed","seen_ok","seen_ok","seen_ok","seen_ok","missed","seen_ok","seen_not_ok","missed","seen_ok","missed","seen_ok","seen_ok","seen_ok","missed","seen_ok","seen_ok","seen_ok","seen_ok","seen_ok","seen_ok","seen_ok","seen_not_ok","seen_ok"],[7,8,6,9,7,1,2,6,1,2,9,6,8,7,5,9,7,4,6,8,5,4,6,8,7,3,1,2,14,1,7,5,4,5,2,14,14,6,6,4,7,3,5,8,14,2,6,9,7,8],["2020-06-02","2020-06-03","2020-06-01","2020-06-04","2020-06-02","2020-06-03","2020-06-05","2020-06-01","2020-06-04","2020-06-04","2020-06-04","2020-06-03","2020-06-03","2020-06-04","2020-06-02","2020-06-04","2020-06-02","2020-06-01","2020-06-01","2020-06-03","2020-06-01","2020-06-04","2020-06-02","2020-06-04","2020-06-03","2020-06-03","2020-06-01","2020-06-02","2020-06-01","2020-06-03","2020-06-04","2020-06-02","2020-06-01","2020-06-01","2020-06-04","2020-06-01","2020-06-01","2020-06-03","2020-06-02","2020-06-03","2020-06-03","2020-06-02","2020-06-04","2020-06-04","2020-06-01","2020-06-01","2020-06-01","2020-06-04","2020-06-02","2020-06-03"],["Djembe","Trumpet","Trumpet","Trumpet","Trumpet","Djembe",null,"Djembe",null,"Djembe",null,"Trumpet","Djembe","Trumpet","Trumpet","Djembe",null,"Trumpet",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],["Drums island","Brass island","Brass island","Brass island","Brass island","Drums island",null,"Drums island",null,"Drums island",null,"Brass island","Drums island","Brass island","Brass island","Drums island",null,"Brass island",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>contact_id<\/th>\n      <th>followup_status<\/th>\n      <th>followup_number<\/th>\n      <th>date_of_followup<\/th>\n      <th>admin_2_name<\/th>\n      <th>admin_1_name<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p><span style="color: orange;"><strong><em>PRECAUCIÓN:</em></strong> Ten cuidado con los duplicados al tratar los datos de seguimiento, ya que podría haber varios seguimientos erróneos en el mismo día para un contacto determinado. Tal vez parezca un error, pero refleja la realidad: por ejemplo, un rastreador de contactos podría enviar un formulario de seguimiento a primera hora del día cuando no pudo contactar con el contacto, y enviar un segundo formulario cuando se le pudo contactar más tarde. Dependerá del contexto operativo la forma en que desees gestionar los duplicados, pero asegúrate de documentar claramente tu enfoque. </span></p>
<p><em>Veamos</em> cuántos casos de filas “duplicadas” tenemos:</p>
<div class="sourceCode" id="cb1229"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">followups</span> <span class="op">%&gt;%</span> 
  <span class="fu">count</span><span class="op">(</span><span class="va">contact_id</span>, <span class="va">date_of_followup</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co"># get unique contact_days</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span>                             <span class="co"># view records where count is more than 1  </span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   contact_id date_of_followup     n
##   &lt;chr&gt;      &lt;date&gt;           &lt;int&gt;
## 1 &lt;NA&gt;       2020-09-03           2
## 2 &lt;NA&gt;       2020-09-04           2
## 3 &lt;NA&gt;       2020-09-05           2</code></pre>
<p>En nuestros datos de ejemplo, los únicos registros a los que se aplica esto son los que carecen de ID. Podemos eliminarlos. Pero, a efectos de demostración, mostraremos los pasos para la eliminación de la duplicación de modo que sólo haya un registro de seguimiento por persona y por día. Para más detalles, consulta la página de <a href="de-duplication.html#de-duplication">De-duplicación</a>. Asumiremos que el registro de encuentro más reciente es el correcto. También aprovechamos la oportunidad para limpiar la columna <code>followup_number</code> (el “día” de seguimiento que debe ir de 1 a 14).</p>
<div class="sourceCode" id="cb1231"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">followups_clean</span> <span class="op">&lt;-</span> <span class="va">followups</span> <span class="op">%&gt;%</span>
  
  <span class="co"># De-duplicate</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">contact_id</span>, <span class="va">date_of_followup</span><span class="op">)</span> <span class="op">%&gt;%</span>        <span class="co"># group rows per contact-day</span>
  <span class="fu">arrange</span><span class="op">(</span><span class="va">contact_id</span>, <span class="fu">desc</span><span class="op">(</span><span class="va">date_of_followup</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co"># arrange rows, per contact-day, by date of follow-up (most recent at top)</span>
  <span class="fu">slice_head</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>                                  <span class="co"># keep only the first row per unique contact id  </span>
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
  <span class="co"># Other cleaning</span>
  <span class="fu">mutate</span><span class="op">(</span>followup_number <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span><span class="op">(</span><span class="va">followup_number</span>, <span class="va">followup_number</span> <span class="op">&gt;</span> <span class="fl">14</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># clean erroneous data</span>
  <span class="fu">drop_na</span><span class="op">(</span><span class="va">contact_id</span><span class="op">)</span>                               <span class="co"># remove rows with missing contact_id</span></code></pre></div>
<p>Para cada encuentro de seguimiento, tenemos un estado de seguimiento (como si el encuentro se produjo y, si es así, el contacto tuvo síntomas o no). Para ver todos los valores podemos ejecutar un <code>tabyl()</code> rápido (de <strong>janitor</strong>) o <code><a href="https://rdrr.io/r/base/table.html">table()</a></code> (de R <strong>base</strong>) (ver <a href="descriptive-tables.html#descriptive-tables">Tablas descriptivas</a>) por <code>followup_status</code> para ver la frecuencia de cada uno de los resultados.</p>
<p>En este conjunto de datos, “seen_not_ok” significa “visto con síntomas”, y “seen_ok” significa “visto sin síntomas”.</p>
<div class="sourceCode" id="cb1232"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">followups_clean</span> <span class="op">%&gt;%</span> 
  <span class="fu">tabyl</span><span class="op">(</span><span class="va">followup_status</span><span class="op">)</span></code></pre></div>
<pre><code>##  followup_status   n    percent
##           missed  10 0.02325581
##    not_attempted   5 0.01162791
##    not_performed 319 0.74186047
##      seen_not_ok   6 0.01395349
##          seen_ok  90 0.20930233</code></pre>
</div>
<div id="gráfica-en-el-tiempo" class="section level3 unnumbered">
<h3>Gráfica en el tiempo<a class="anchor" aria-label="anchor" href="#gr%C3%A1fica-en-el-tiempo"><i class="fas fa-link"></i></a>
</h3>
<p>Como los datos de las fechas son continuos, utilizaremos un histograma para representarlos con <code>date_of_followup</code> asignado al eje-x. Podemos conseguir un histograma “apilado” especificando un argumento <code>fill =</code> dentro de <code>aes()</code>, que asignamos a la columna <code>followup_status</code>. En consecuencia, se puede establecer el título de la leyenda utilizando el argumento <code>fill =</code> de <code>labs()</code>.</p>
<p>Podemos ver que los contactos se identificaron en oleadas (presumiblemente correspondientes a las oleadas epidémicas de casos), y que la finalización del seguimiento no parece haber mejorado a lo largo de la epidemia.</p>
<div class="sourceCode" id="cb1234"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">followups_clean</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_of_followup</span>, fill <span class="op">=</span> <span class="va">followup_status</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_discrete</span><span class="op">(</span>drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span>   <span class="co"># show all factor levels (followup_status) in the legend, even those not used</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">""</span>,
    y <span class="op">=</span> <span class="st">"Number of contacts"</span>,
    title <span class="op">=</span> <span class="st">"Daily Contact Followup Status"</span>,
    fill <span class="op">=</span> <span class="st">"Followup Status"</span>,
    subtitle <span class="op">=</span> <span class="fu">str_glue</span><span class="op">(</span><span class="st">"Data as of {max(followups$date_of_followup, na.rm=T)}"</span><span class="op">)</span><span class="op">)</span>   <span class="co"># dynamic subtitle</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-883-1.png" width="672"></div>
<p><span style="color: orange;"><strong><em>PRECAUCIÓN:</em></strong> Si estás preparando muchos gráficos (por ejemplo, para múltiples jurisdicciones) querrás que las leyendas aparezcan de forma idéntica incluso con diferentes niveles de finalización o composición de los datos. Puede haber gráficos para los cuales no todos los estados de seguimiento están presentes, pero todavía quieres que esas categorías aparezcan en las leyendas. En ggplot (como arriba), puedes especificar el argumento <code>drop = FALSE</code> de <code>scale_fill_discrete()</code>. En las tablas, utiliza <code>tabyl()</code> que muestra los recuentos de todos los niveles de los factores, o si utilizas <code>count()</code> de <strong>dplyr</strong> añade el argumento <code>.drop = FALSE</code> para incluir los recuentos de todos los niveles de los factores.</span></p>
</div>
<div id="seguimiento-individual-diario" class="section level3 unnumbered">
<h3>Seguimiento individual diario<a class="anchor" aria-label="anchor" href="#seguimiento-individual-diario"><i class="fas fa-link"></i></a>
</h3>
<p>Si tu brote es lo suficientemente pequeño, es posible que quieras mirar cada contacto individualmente y ver su estado a lo largo del seguimiento. Afortunadamente, este conjunto de datos de seguimiento ya contiene una columna con el “número” de día de seguimiento (1-14). Si no existe en tus datos, puedes crearla calculando la diferencia entre la fecha de encuentro y la fecha en la que el seguimiento debía comenzar para el contacto.</p>
<p>Un mecanismo de visualización conveniente (si el número de casos no es demasiado grande) puede ser un gráfico de calor, hecho con <code>geom_tile()</code>. Mira más detalles en la página <a href="heat-plots.html#heat-plots">Gráficos de calor</a>.</p>
<div class="sourceCode" id="cb1235"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">followups_clean</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_tile</span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">followup_number</span>, y <span class="op">=</span> <span class="va">contact_id</span>, fill <span class="op">=</span> <span class="va">followup_status</span><span class="op">)</span>,
            color <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span><span class="op">+</span>       <span class="co"># grey gridlines</span>
  <span class="fu">scale_fill_manual</span><span class="op">(</span> values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yellow"</span>, <span class="st">"grey"</span>, <span class="st">"orange"</span>, <span class="st">"darkred"</span>, <span class="st">"darkgreen"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">1</span>, to <span class="op">=</span> <span class="fl">14</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-884-1.png" width="672"></div>
</div>
<div id="analizar-por-grupos" class="section level3 unnumbered">
<h3>Analizar por grupos<a class="anchor" aria-label="anchor" href="#analizar-por-grupos"><i class="fas fa-link"></i></a>
</h3>
<p>Tal vez estos datos de seguimiento se consulten diaria o semanalmente para la toma de decisiones operativas. Es posible que desees desgloses más significativos por zona geográfica o por equipo de seguimiento de contactos. Podemos hacerlo ajustando las columnas proporcionadas a <code>group_by()</code>.</p>
<div class="sourceCode" id="cb1236"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_by_region</span> <span class="op">&lt;-</span> <span class="va">followups_clean</span> <span class="op">%&gt;%</span>                                        <span class="co"># begin with follow-up dataset</span>
  <span class="fu">count</span><span class="op">(</span><span class="va">admin_1_name</span>, <span class="va">admin_2_name</span>, <span class="va">followup_status</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co"># get counts by unique region-status (creates column 'n' with counts)</span>
  
  <span class="co"># begin ggplot()</span>
  <span class="fu">ggplot</span><span class="op">(</span>                                         <span class="co"># begin ggplot</span>
    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">admin_2_name</span>, <span class="va">n</span><span class="op">)</span>,     <span class="co"># reorder admin factor levels by the numeric values in column 'n'</span>
                  y <span class="op">=</span> <span class="va">n</span>,                            <span class="co"># heights of bar from column 'n'</span>
                  fill <span class="op">=</span> <span class="va">followup_status</span>,           <span class="co"># color stacked bars by their status</span>
                  label <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>                      <span class="co"># to pass to geom_label()              </span>
  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                     <span class="co"># stacked bars, mapping inherited from above </span>
  <span class="fu">geom_text</span><span class="op">(</span>                                      <span class="co"># add text, mapping inherited from above</span>
    size <span class="op">=</span> <span class="fl">3</span>,                                         
    position <span class="op">=</span> <span class="fu">position_stack</span><span class="op">(</span>vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, 
    color <span class="op">=</span> <span class="st">"white"</span>,           
    check_overlap <span class="op">=</span> <span class="cn">TRUE</span>,
    fontface <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">""</span>,
    y <span class="op">=</span> <span class="st">"Number of contacts"</span>,
    title <span class="op">=</span> <span class="st">"Contact Followup Status, by Region"</span>,
    fill <span class="op">=</span> <span class="st">"Followup Status"</span>,
    subtitle <span class="op">=</span> <span class="fu">str_glue</span><span class="op">(</span><span class="st">"Data as of {max(followups_clean$date_of_followup, na.rm=T)}"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                                                      <span class="co"># Simplify background</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">admin_1_name</span>, strip.position <span class="op">=</span> <span class="st">"right"</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>      <span class="co"># introduce facets </span>

<span class="va">plot_by_region</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-885-1.png" width="672"></div>
<!-- If this was disaggregated by contact tracer, perhaps we would want to add a threshold line to display total # contacts that normally one person or area/team can handle, and how the current workload compares. We just do this by using `geom_hline()` function. -->
<!-- ```{r, warning=F, message=F} -->
<!-- plot_by_region +  -->
<!--      geom_hline(aes(yintercept=25), color="#C70039", linetype = "dashed") # fictitious threshold at 25 contacts -->
<!-- ``` -->
</div>
</div>
<div id="kpi-tables" class="section level2" number="25.4">
<h2>
<span class="header-section-number">25.4</span> Tablas KPI<a class="anchor" aria-label="anchor" href="#kpi-tables"><i class="fas fa-link"></i></a>
</h2>
<p>Hay una serie de Indicadores Clave de Rendimiento (KPI) que pueden calcularse y seguirse a distintos niveles de desagregación y a lo largo de diferentes períodos de tiempo para supervisar el rendimiento del rastreo de contactos. Una vez que se tienen los cálculos y el formato básico de la tabla, es bastante fácil cambiar los diferentes KPI.</p>
<p>Existen numerosas fuentes de KPI de rastreo de contactos, como ésta de <a href="https://contacttracingplaybook.resolvetosavelives.org/checklists/metrics">ResolveToSaveLives.org</a>. La mayor parte del trabajo consistirá en recorrer la estructura de datos y pensar en todos los criterios de inclusión/exclusión. A continuación mostramos algunos ejemplos, utilizando la estructura de metadatos de Go.Data:</p>
<div class="inline-table"><table style="width:100%;" class="table table-sm">
<colgroup>
<col width="19%">
<col width="28%">
<col width="29%">
<col width="21%">
</colgroup>
<thead><tr class="header">
<th>Categoría</th>
<th>Indicador</th>
<th>Numerador Go.Data</th>
<th>Denominador Go.Data</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Indicador de proceso - Velocidad de rastreo de contactos</td>
<td>% de casos entrevistados y aislados en las 24 horas siguientes a la notificación del caso</td>
<td>COUNT OF <code>case_id</code> WHERE (<code>date_of_reporting</code> - <code>date_of_data_entry</code>) &lt; 1 day AND (<code>isolation_startdate</code> - <code>date_of_data_entry</code>) &lt; 1 day</td>
<td>COUNT OF <code>case_id</code>
</td>
</tr>
<tr class="even">
<td>Indicador de proceso - Velocidad de rastreo de contactos</td>
<td>% de contactos notificados y puestos en cuarentena en las 24 horas siguientes a la solicitud</td>
<td>COUNT OF <code>contact_id</code> WHERE <code>followup_status</code> == “SEEN_NOT_OK” OR “SEEN_OK” AND <code>date_of_followup</code> - <code>date_of_reporting</code> &lt; 1 day</td>
<td>COUNT OF <code>contact_id</code>
</td>
</tr>
<tr class="odd">
<td>Indicador de proceso - Completitud de las pruebas</td>
<td>% de nuevos casos sintomáticos examinados y entrevistados en los 3 días siguientes al inicio de los síntomas</td>
<td>COUNT OF <code>case_id</code> WHERE (<code>date_of_reporting</code> - <code>date_of_onset</code>) &lt; =3 days</td>
<td>COUNT OF <code>case_id</code>
</td>
</tr>
<tr class="even">
<td>Indicador de resultado - Global</td>
<td>% de nuevos casos entre la lista de contactos existente</td>
<td>COUNT OF <code>case_id</code> WHERE <code>was_contact</code> == “TRUE”</td>
<td>COUNT OF <code>case_id</code>
</td>
</tr>
</tbody>
</table></div>
<p>A continuación veremos un ejercicio de ejemplo para crear una bonita tabla visual para mostrar el seguimiento de los contactos en las áreas de administración. Al final, lo haremos apto para la presentación con el paquete <strong>formattable</strong> (pero podrías usar otros paquetes como <strong>flextable</strong> - ver <a href="tables-for-presentation.html#tables-for-presentation">Tablas para presentaciones</a>).</p>
<p>La forma de crear una tabla como ésta dependerá de la estructura de los datos de seguimiento de contactos. Utiliza la página de <a href="descriptive-tables.html#descriptive-tables">tablas descriptivas</a> para aprender a resumir los datos utilizando las funciones de <strong>dplyr</strong>.</p>
<p>Crearemos una tabla que será dinámica y cambiará a medida que cambien los datos. Para que los resultados sean interesantes, estableceremos una <code>report_date</code> que nos permita simular la ejecución de la tabla en un día determinado (elegimos el 10 de junio de 2020). Los datos se filtran por esa fecha.</p>
<div class="sourceCode" id="cb1237"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Set "Report date" to simulate running the report with data "as of" this date</span>
<span class="va">report_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2020-06-10"</span><span class="op">)</span>

<span class="co"># Create follow-up data to reflect the report date.</span>
<span class="va">table_data</span> <span class="op">&lt;-</span> <span class="va">followups_clean</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">date_of_followup</span> <span class="op">&lt;=</span> <span class="va">report_date</span><span class="op">)</span></code></pre></div>
<p>Ahora, basándonos en nuestra estructura de datos, haremos lo siguiente:</p>
<ol style="list-style-type: decimal">
<li>Comienza con los datos de <code>followups</code> y resúmelos para contener, para cada contacto único:</li>
</ol>
<ul>
<li>La fecha del último registro (sin importar el estado del encuentro)</li>
<li>La fecha del último encuentro en el que el contacto fue “visto”</li>
<li>El estado del encuentro en ese último encuentro “visto” (por ejemplo, con síntomas, sin síntomas)</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Uniremos estos datos a los de los contactos, que contienen otra información como el estado general del contacto, la fecha de la última exposición a un caso, etc. También calcularemos las métricas de interés para cada contacto, como los días desde la última exposición</li>
<li>Agrupamos los datos de contacto mejorados por región geográfica (`admin_2_name) y calculamos las estadísticas resumidas por región</li>
<li>Por último, damos un buen formato a la tabla para su presentación</li>
</ol>
<p>Primero resumimos los datos de seguimiento para obtener la información de interés:</p>
<div class="sourceCode" id="cb1238"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">followup_info</span> <span class="op">&lt;-</span> <span class="va">table_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">contact_id</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarise</span><span class="op">(</span>
    date_last_record   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">date_of_followup</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
    date_last_seen     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">date_of_followup</span><span class="op">[</span><span class="va">followup_status</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"seen_ok"</span>, <span class="st">"seen_not_ok"</span><span class="op">)</span><span class="op">]</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
    status_last_record <span class="op">=</span> <span class="va">followup_status</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">date_of_followup</span> <span class="op">==</span> <span class="va">date_last_record</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Así es como se ven estos datos:</p>
<div id="htmlwidget-aad4d109cd9b9359b761" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-aad4d109cd9b9359b761">{"x":{"filter":"none","vertical":false,"data":[["CONTACT-2020-0001","CONTACT-2020-0003","CONTACT-2020-0004","CONTACT-2020-0005","CONTACT-2020-0006","CONTACT-2020-0007","CONTACT-2020-0012","CONTACT-2020-0013","CONTACT-2020-0014","CONTACT-2020-0015","CONTACT-2020-0016","CONTACT-2020-0017","CONTACT-2020-0018","CONTACT-2020-0019","CONTACT-2020-0026","CONTACT-2020-0027","CONTACT-2020-0028","CONTACT-2020-0029","CONTACT-2020-0033","CONTACT-2020-0035","CONTACT-2020-0036","CONTACT-2020-0039","CONTACT-2020-0040","CONTACT-2020-0041","CONTACT-2020-0042","CONTACT-2020-0043","CONTACT-2020-0044","CONTACT-2020-0046","CONTACT-2020-0047","CONTACT-2020-0048","CONTACT-2020-0049","CONTACT-2020-0050","CONTACT-2020-0052","CONTACT-2020-0054","CONTACT-2020-0055","CONTACT-2020-0056","CONTACT-2020-0057","CONTACT-2020-0058","CONTACT-2020-0059","CONTACT-2020-0060"],["2020-06-01","2020-06-01","2020-06-01","2020-06-01","2020-06-01","2020-06-01","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-06","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-06","2020-06-05","2020-06-01","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05"],[null,"2020-06-01","2020-06-01","2020-06-01","2020-06-01","2020-06-01","2020-06-04","2020-06-04","2020-06-04","2020-06-04","2020-06-04","2020-06-03","2020-06-03","2020-06-05","2020-06-03","2020-06-05","2020-06-05","2020-06-05",null,"2020-06-03","2020-06-05","2020-06-06","2020-06-04","2020-06-04","2020-06-05","2020-06-04","2020-06-05","2020-06-05","2020-06-04","2020-06-01","2020-06-05","2020-06-05","2020-06-05","2020-06-04","2020-06-05","2020-06-03","2020-06-02","2020-06-03","2020-06-05","2020-06-05"],["missed","seen_ok","seen_ok","seen_ok","seen_ok","seen_ok","not_performed","not_performed","not_performed","not_performed","not_performed","not_performed","not_performed","seen_ok","not_performed","seen_ok","seen_ok","seen_ok","not_performed","missed","seen_ok","seen_ok","not_performed","not_performed","seen_ok","not_performed","seen_not_ok","not_performed","not_performed","seen_ok","seen_ok","seen_ok","seen_ok","not_performed","seen_ok","not_performed","not_performed","not_performed","seen_ok","seen_ok"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>contact_id<\/th>\n      <th>date_last_record<\/th>\n      <th>date_last_seen<\/th>\n      <th>status_last_record<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":12,"scrollX":true,"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,12,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Ahora añadiremos esta información a los datos de <code>contacts</code> y calcularemos algunas columnas adicionales.</p>
<div class="sourceCode" id="cb1239"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">contacts_info</span> <span class="op">&lt;-</span> <span class="va">followup_info</span> <span class="op">%&gt;%</span> 
  <span class="fu">right_join</span><span class="op">(</span><span class="va">contacts</span>, by <span class="op">=</span> <span class="st">"contact_id"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    database_date       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">date_last_record</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
    days_since_seen     <span class="op">=</span> <span class="va">database_date</span> <span class="op">-</span> <span class="va">date_last_seen</span>,
    days_since_exposure <span class="op">=</span> <span class="va">database_date</span> <span class="op">-</span> <span class="va">date_of_last_exposure</span>
    <span class="op">)</span></code></pre></div>
<p>Así es como se ven estos datos. Observa la columna <code>contacts</code> a la derecha, y la nueva columna calculada en el extremo derecho.</p>
<div id="htmlwidget-fc5a724466578ac4bd35" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-fc5a724466578ac4bd35">{"x":{"filter":"none","vertical":false,"data":[["CONTACT-2020-0001","CONTACT-2020-0003","CONTACT-2020-0004","CONTACT-2020-0005","CONTACT-2020-0006","CONTACT-2020-0007","CONTACT-2020-0012","CONTACT-2020-0013","CONTACT-2020-0014","CONTACT-2020-0015","CONTACT-2020-0016","CONTACT-2020-0017","CONTACT-2020-0018","CONTACT-2020-0019","CONTACT-2020-0026","CONTACT-2020-0027","CONTACT-2020-0028","CONTACT-2020-0029","CONTACT-2020-0033","CONTACT-2020-0035","CONTACT-2020-0036","CONTACT-2020-0039","CONTACT-2020-0040","CONTACT-2020-0041","CONTACT-2020-0042","CONTACT-2020-0043","CONTACT-2020-0044","CONTACT-2020-0046","CONTACT-2020-0047","CONTACT-2020-0048","CONTACT-2020-0049","CONTACT-2020-0050","CONTACT-2020-0052","CONTACT-2020-0054","CONTACT-2020-0055","CONTACT-2020-0056","CONTACT-2020-0057","CONTACT-2020-0058","CONTACT-2020-0059","CONTACT-2020-0060","CONTACT-2020-0030","CONTACT-2020-0021","CONTACT-2020-0053","CONTACT-2020-0011","CONTACT-2020-0032","CONTACT-2020-0025","CONTACT-2020-0045","CONTACT-2020-0020","CONTACT-2020-0031","CONTACT-2020-0037","CONTACT-2020-0051","CONTACT-2020-0008","CONTACT-2020-0038","CONTACT-2020-0010","CONTACT-2020-0034","CONTACT-2020-0009","CONTACT-2020-0022","CONTACT-2020-0023",null,null,"CASE-2020-0043","CASE-2020-0044","CASE-2020-0045","CASE-2020-0046","CONTACT-2020-0024","CONTACT-2020-0002"],["2020-06-01","2020-06-01","2020-06-01","2020-06-01","2020-06-01","2020-06-01","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-06","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-06","2020-06-05","2020-06-01","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05","2020-06-05",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,"2020-06-01","2020-06-01","2020-06-01","2020-06-01","2020-06-01","2020-06-04","2020-06-04","2020-06-04","2020-06-04","2020-06-04","2020-06-03","2020-06-03","2020-06-05","2020-06-03","2020-06-05","2020-06-05","2020-06-05",null,"2020-06-03","2020-06-05","2020-06-06","2020-06-04","2020-06-04","2020-06-05","2020-06-04","2020-06-05","2020-06-05","2020-06-04","2020-06-01","2020-06-05","2020-06-05","2020-06-05","2020-06-04","2020-06-05","2020-06-03","2020-06-02","2020-06-03","2020-06-05","2020-06-05",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],["missed","seen_ok","seen_ok","seen_ok","seen_ok","seen_ok","not_performed","not_performed","not_performed","not_performed","not_performed","not_performed","not_performed","seen_ok","not_performed","seen_ok","seen_ok","seen_ok","not_performed","missed","seen_ok","seen_ok","not_performed","not_performed","seen_ok","not_performed","seen_not_ok","not_performed","not_performed","seen_ok","seen_ok","seen_ok","seen_ok","not_performed","seen_ok","not_performed","not_performed","not_performed","seen_ok","seen_ok",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],["FOLLOW_UP_COMPLETED","FOLLOW_UP_COMPLETED","FOLLOW_UP_COMPLETED","UNDER_FOLLOW_UP","FOLLOW_UP_COMPLETED","FOLLOW_UP_COMPLETED","LOST_TO_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","LOST_TO_FOLLOW_UP","UNDER_FOLLOW_UP","FOLLOW_UP_COMPLETED","FOLLOW_UP_COMPLETED","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","DIED","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","LOST_TO_FOLLOW_UP","FOLLOW_UP_COMPLETED","UNDER_FOLLOW_UP","FOLLOW_UP_COMPLETED","UNDER_FOLLOW_UP","LOST_TO_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","FOLLOW_UP_COMPLETED","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","DIED","FOLLOW_UP_COMPLETED","LOST_TO_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","LOST_TO_FOLLOW_UP","FOLLOW_UP_COMPLETED","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","FOLLOW_UP_COMPLETED","UNDER_FOLLOW_UP","FOLLOW_UP_COMPLETED","FOLLOW_UP_COMPLETED","FOLLOW_UP_COMPLETED","FOLLOW_UP_COMPLETED","FOLLOW_UP_COMPLETED","FOLLOW_UP_COMPLETED","FOLLOW_UP_COMPLETED","UNDER_FOLLOW_UP","FOLLOW_UP_COMPLETED","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","UNDER_FOLLOW_UP","BECAME_CASE","BECAME_CASE","BECAME_CASE","BECAME_CASE","BECAME_CASE","BECAME_CASE"],["Cheik","Cheik","Khary","Birima","Malang","Maguette","Alfa","Ndiogou","Madia","Adama","Lamine","Racine","Yacouba","Kalidou","Thione","Sadibou","Papis","Coura","Thiony","Sofiatou","Djiby","Abba","Khary","Oumou","Dicory","Adja","Mbagnick","Abou","Ndiankou","Malamine","Youssouf","Waly","Mayatta","Alimatou","Djeynaba","Amath","Wasis","Bransan  ","Bintou","Binette","Aminata","Binta","Birima","Cheik","El Hadj","Khadija","Khary","Khary","Lat","Maguette","Maguette","Malamine","Malamine","Malang","Malang","Modou","Ndiaya","Oulimata","Mayatta","Jelani","Adama","Adji","Alfa","Alfa","Birima","Malang"],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"Abebe",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"Obi","Onai",null,null,null,null,null,null],["MALE","MALE","FEMALE","MALE","FEMALE","FEMALE","FEMALE","FEMALE","MALE","MALE","FEMALE","FEMALE","MALE","MALE","MALE","MALE","FEMALE","MALE","FEMALE","FEMALE","FEMALE","FEMALE","MALE","MALE","MALE","MALE","MALE","MALE","MALE","MALE","FEMALE","MALE","MALE","MALE","FEMALE","MALE","FEMALE","FEMALE","FEMALE","FEMALE","FEMALE","FEMALE","MALE","MALE","MALE","MALE","FEMALE","FEMALE","FEMALE","FEMALE","FEMALE","MALE","MALE","FEMALE","FEMALE","MALE","FEMALE","MALE","MALE","MALE","MALE","FEMALE","FEMALE","FEMALE","MALE","FEMALE"],[12,12,32,3,54,29,34,56,34,56,12,35,78,20,45,15,null,null,5,null,45,17,21,34,15,47,null,81,67,7,null,56,null,8,54,54,2,23,97,34,36,32,3,12,21,4,32,32,23,9,9,63,7,54,54,18,32,23,null,24,null,25,34,34,3,54],["10-14","10-14","30-39","0-4","50-59","20-29","30-39","50-59","30-39","50-59","10-14","30-39","75-79","20-29","40-49","15-19","unknown","unknown","5-9","unknown","40-49","15-19","20-29","30-39","15-19","40-49","unknown","80+","65-69","5-9","unknown","50-59","unknown","5-9","50-59","50-59","0-4","20-29","80+","30-39","30-39","30-39","0-4","10-14","20-29","0-4","30-39","30-39","20-29","5-9","5-9","60-64","5-9","50-59","50-59","15-19","30-39","20-29","unknown","20-29","unknown","20-29","30-39","30-39","0-4","50-59"],["CHILD","CHILD","FARMER","CHILD","FARMER","OTHER",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"FARMER",null,null,null,null,null,null,"HEALTH_CARE_WORKER","STUDENT","HEALTH_CARE_WORKER",null,"BUTCHER","BUTCHER",null,"FARMER"],["2020-03-22","2020-03-22","2020-03-22","2020-05-01","2020-03-22","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-16","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-05-25","2020-05-25","2020-05-25","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-04-15","2020-05-25","2020-04-15","2020-05-25","2020-05-25","2020-05-25","2020-09-02","2020-09-03","2020-07-08","2020-07-11","2020-07-16","2020-07-07","2020-04-15","2020-03-22"],["2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-09-03","2020-09-04","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08"],["2020-06-07","2020-06-07","2020-06-07","2020-04-28","2020-06-07","2020-06-07","2020-06-15","2020-06-22","2020-06-15","2020-08-13","2020-06-22","2020-06-15","2020-06-15","2020-06-24","2020-06-22","2020-06-24","2020-06-17","2020-06-17","2020-06-22","2020-06-17","2020-06-19","2020-06-24","2020-06-15","2020-06-22","2020-06-16","2020-06-22","2020-06-17","2020-06-22","2020-06-20","2020-06-06","2020-06-17","2020-06-17","2020-06-17","2020-06-17","2020-06-20","2020-09-02","2020-06-17","2020-06-22","2020-06-20","2020-06-16","2020-05-15","2020-05-13","2020-04-26","2020-04-26","2020-05-10","2020-05-08","2020-06-05","2020-06-05","2020-05-10","2020-06-05","2020-06-05","2020-04-28","2020-06-05","2020-04-29","2020-06-05","2020-05-15","2020-05-10","2020-05-13","2020-09-02","2020-09-01","2020-05-06","2020-05-10","2020-07-27","2020-05-06","2020-04-26","2020-04-28"],["2020-06-08","2020-06-08","2020-06-08","2020-04-29","2020-06-08","2020-06-08","2020-06-16","2020-06-23","2020-06-16","2020-08-14","2020-06-23","2020-06-16","2020-06-16","2020-06-25","2020-06-23","2020-06-25","2020-06-18","2020-06-18","2020-06-23","2020-06-18","2020-06-20","2020-06-25","2020-06-16","2020-06-23","2020-06-17","2020-08-14","2020-06-18","2020-08-15","2020-06-21","2020-06-08","2020-06-18","2020-06-18","2020-06-18","2020-06-18","2020-06-21","2020-09-03","2020-06-18","2020-06-23","2020-06-21","2020-06-17",null,"2020-05-14","2020-04-27","2020-04-27",null,null,"2020-06-06","2020-06-06",null,"2020-06-06","2020-06-06",null,"2020-06-06","2020-04-30","2020-06-06","2020-05-16","2020-05-11","2020-05-14","2020-09-03","2020-09-02",null,null,null,null,"2020-06-06",null],["2020-06-21","2020-06-21","2020-06-21","2020-05-12","2020-06-21","2020-06-21","2020-06-29","2020-07-06","2020-06-29","2020-08-27","2020-07-06","2020-06-29","2020-06-29","2020-07-08","2020-07-06","2020-07-08","2020-07-01","2020-07-01","2020-07-06","2020-07-01","2020-07-03","2020-07-08","2020-06-29","2020-07-06","2020-06-30","2020-08-27","2020-07-01","2020-08-28","2020-07-04","2020-06-21","2020-07-01","2020-07-01","2020-07-01","2020-07-01","2020-07-04","2020-09-16","2020-07-01","2020-07-06","2020-07-04","2020-06-30",null,"2020-05-27","2020-05-10","2020-05-10",null,null,"2020-06-19","2020-06-19",null,"2020-06-19","2020-06-19",null,"2020-06-19","2020-05-13","2020-06-19","2020-05-29","2020-05-24","2020-05-27","2020-09-16","2020-09-15",null,null,null,null,"2020-06-19",null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"1_LOW","3_HIGH","1_LOW",null,null,null,null],[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,null,null,null,null,null,null],["Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Trumpet","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Trumpet","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Trumpet","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Djembe","Congas","Venu","Cornet","Venu","Djembe","Djembe"],["2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06","2020-06-06"],[null,5,5,5,5,5,2,2,2,2,2,3,3,1,3,1,1,1,null,3,1,0,2,2,1,2,1,1,2,5,1,1,1,2,1,3,4,3,1,1,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[-1,-1,-1,39,-1,-1,-9,-16,-9,-68,-16,-9,-9,-18,-16,-18,-11,-11,-16,-11,-13,-18,-9,-16,-10,-16,-11,-16,-14,0,-11,-11,-11,-11,-14,-88,-11,-16,-14,-10,22,24,41,41,27,29,1,1,27,1,1,39,1,38,1,22,27,24,-88,-87,31,27,-51,31,41,39]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>contact_id<\/th>\n      <th>date_last_record<\/th>\n      <th>date_last_seen<\/th>\n      <th>status_last_record<\/th>\n      <th>contact_status<\/th>\n      <th>firstName<\/th>\n      <th>lastName<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_class<\/th>\n      <th>occupation<\/th>\n      <th>date_of_reporting<\/th>\n      <th>date_of_data_entry<\/th>\n      <th>date_of_last_exposure<\/th>\n      <th>date_of_followup_start<\/th>\n      <th>date_of_followup_end<\/th>\n      <th>risk_level<\/th>\n      <th>was_case<\/th>\n      <th>admin_2_name<\/th>\n      <th>database_date<\/th>\n      <th>days_since_seen<\/th>\n      <th>days_since_exposure<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":12,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":8}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,12,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>A continuación, resumimos los datos de los contactos por región, para conseguir un dataframe conciso de columnas de estadísticas resumidas.</p>
<div class="sourceCode" id="cb1240"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">contacts_table</span> <span class="op">&lt;-</span> <span class="va">contacts_info</span> <span class="op">%&gt;%</span> 
  
  <span class="fu">group_by</span><span class="op">(</span>`Admin 2` <span class="op">=</span> <span class="va">admin_2_name</span><span class="op">)</span> <span class="op">%&gt;%</span>
  
  <span class="fu">summarise</span><span class="op">(</span>
    `Registered contacts` <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,
    `Active contacts`     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">contact_status</span> <span class="op">==</span> <span class="st">"UNDER_FOLLOW_UP"</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
    `In first week`       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">days_since_exposure</span> <span class="op">&lt;</span> <span class="fl">8</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
    `In second week`      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">days_since_exposure</span> <span class="op">&gt;=</span> <span class="fl">8</span> <span class="op">&amp;</span> <span class="va">days_since_exposure</span> <span class="op">&lt;</span> <span class="fl">15</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
    `Became case`         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">contact_status</span> <span class="op">==</span> <span class="st">"BECAME_CASE"</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
    `Lost to follow up`   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">days_since_seen</span> <span class="op">&gt;=</span> <span class="fl">3</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
    `Never seen`          <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">date_last_seen</span><span class="op">)</span><span class="op">)</span>,
    `Followed up - signs` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">status_last_record</span> <span class="op">==</span> <span class="st">"Seen_not_ok"</span> <span class="op">&amp;</span> <span class="va">date_last_record</span> <span class="op">==</span> <span class="va">database_date</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
    `Followed up - no signs` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">status_last_record</span> <span class="op">==</span> <span class="st">"Seen_ok"</span> <span class="op">&amp;</span> <span class="va">date_last_record</span> <span class="op">==</span> <span class="va">database_date</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
    `Not Followed up`     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span>
      <span class="op">(</span><span class="va">status_last_record</span> <span class="op">==</span> <span class="st">"NOT_ATTEMPTED"</span> <span class="op">|</span> <span class="va">status_last_record</span> <span class="op">==</span> <span class="st">"NOT_PERFORMED"</span><span class="op">)</span> <span class="op">&amp;</span>
        <span class="va">date_last_record</span> <span class="op">==</span> <span class="va">database_date</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">`Registered contacts`</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-0a0bceb8eeafaddfcd56" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-0a0bceb8eeafaddfcd56">{"x":{"filter":"none","vertical":false,"data":[["Djembe","Trumpet","Venu","Congas","Cornet"],[59,3,2,1,1],[30,1,0,0,0],[44,3,0,0,1],[0,0,0,0,0],[2,0,2,1,1],[15,0,0,0,0],[22,0,2,1,1],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Admin 2<\/th>\n      <th>Registered contacts<\/th>\n      <th>Active contacts<\/th>\n      <th>In first week<\/th>\n      <th>In second week<\/th>\n      <th>Became case<\/th>\n      <th>Lost to follow up<\/th>\n      <th>Never seen<\/th>\n      <th>Followed up - signs<\/th>\n      <th>Followed up - no signs<\/th>\n      <th>Not Followed up<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":12,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9,10]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,12,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Y ahora aplicamos el estilo de los paquetes <strong>formattable</strong> y <strong>knitr</strong>, incluyendo una nota a pie de página que muestra la fecha “a partir de”.</p>
<div class="sourceCode" id="cb1241"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">contacts_table</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>
    `Admin 2` <span class="op">=</span> <span class="fu">formatter</span><span class="op">(</span><span class="st">"span"</span>, style <span class="op">=</span> <span class="op">~</span> <span class="fu">formattable</span><span class="fu">::</span><span class="fu"><a href="https://renkun-ken.github.io/formattable/reference/style.html">style</a></span><span class="op">(</span>
      color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">`Admin 2`</span> <span class="op">==</span> <span class="cn">NA</span>, <span class="st">"red"</span>, <span class="st">"grey"</span><span class="op">)</span>,
      font.weight <span class="op">=</span> <span class="st">"bold"</span>,font.style <span class="op">=</span> <span class="st">"italic"</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="va">`Admin 2`</span><span class="op">)</span>,
    `Followed up - signs`<span class="op">=</span> <span class="fu">color_tile</span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"orange"</span><span class="op">)</span><span class="op">(</span><span class="va">`Followed up - signs`</span><span class="op">)</span>,
    `Followed up - no signs`<span class="op">=</span> <span class="fu">color_tile</span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"#A0E2BD"</span><span class="op">)</span><span class="op">(</span><span class="va">`Followed up - no signs`</span><span class="op">)</span>,
    `Became case`<span class="op">=</span> <span class="fu">color_tile</span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"grey"</span><span class="op">)</span><span class="op">(</span><span class="va">`Became case`</span><span class="op">)</span>,
    `Lost to follow up`<span class="op">=</span> <span class="fu">color_tile</span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"grey"</span><span class="op">)</span><span class="op">(</span><span class="va">`Lost to follow up`</span><span class="op">)</span>, 
    `Never seen`<span class="op">=</span> <span class="fu">color_tile</span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">(</span><span class="va">`Never seen`</span><span class="op">)</span>,
    `Active contacts` <span class="op">=</span> <span class="fu">color_tile</span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"#81A4CE"</span><span class="op">)</span><span class="op">(</span><span class="va">`Active contacts`</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">kable</span><span class="op">(</span><span class="st">"html"</span>, escape <span class="op">=</span> <span class="cn">F</span>, align <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"l"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span>,<span class="st">"c"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">kable_styling</span><span class="op">(</span><span class="st">"hover"</span>, full_width <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">add_header_above</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">" "</span> <span class="op">=</span> <span class="fl">3</span>, 
                     <span class="st">"Of contacts currently under follow up"</span> <span class="op">=</span> <span class="fl">5</span>,
                     <span class="st">"Status of last visit"</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/footnote.html">footnote</a></span><span class="op">(</span>general <span class="op">=</span> <span class="fu">str_glue</span><span class="op">(</span><span class="st">"Data are current to {format(report_date, '%b %d %Y')}"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-hover" style="width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;">
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="3">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="5">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Of contacts currently under follow up
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Status of last visit
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
Admin 2
</th>
<th style="text-align:center;">
Registered contacts
</th>
<th style="text-align:center;">
Active contacts
</th>
<th style="text-align:center;">
In first week
</th>
<th style="text-align:center;">
In second week
</th>
<th style="text-align:center;">
Became case
</th>
<th style="text-align:center;">
Lost to follow up
</th>
<th style="text-align:center;">
Never seen
</th>
<th style="text-align:center;">
Followed up - signs
</th>
<th style="text-align:center;">
Followed up - no signs
</th>
<th style="text-align:center;">
Not Followed up
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<span style="font-weight: bold; font-style: italic">Djembe </span>
</td>
<td style="text-align:center;">
59
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #81a4ce">30</span>
</td>
<td style="text-align:center;">
44
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #bebebe">2</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #bebebe">15</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ff0000">22</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">0</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">0</span>
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
<span style="font-weight: bold; font-style: italic">Trumpet</span>
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #fafbfd">1</span>
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">0</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">0</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">0</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">0</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">0</span>
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
<span style="font-weight: bold; font-style: italic">Venu </span>
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">0</span>
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #bebebe">2</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">0</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffe7e7">2</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">0</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">0</span>
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
<span style="font-weight: bold; font-style: italic">Congas </span>
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">0</span>
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #dedede">1</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">0</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #fff3f3">1</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">0</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">0</span>
</td>
<td style="text-align:center;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
<span style="font-weight: bold; font-style: italic">Cornet </span>
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">0</span>
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #dedede">1</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">0</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #fff3f3">1</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">0</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #ffffff">0</span>
</td>
<td style="text-align:center;">
0
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<span style="font-style: italic;">Note: </span>
</td>
</tr>
<tr>
<td style="padding: 0; " colspan="100%">
<sup></sup> Data are current to jun. 10 2020
</td>
</tr>
</tfoot>
</table></div>
</div>
<div id="transmission-matrices" class="section level2" number="25.5">
<h2>
<span class="header-section-number">25.5</span> Matrices de transmisión<a class="anchor" aria-label="anchor" href="#transmission-matrices"><i class="fas fa-link"></i></a>
</h2>
<p>Como se discutió en la página de <a href="heat-plots.html#heat-plots">Gráficos de calor</a>, puedes crear una matriz de “quién infectó a quién” utilizando <code>geom_tile()</code>.</p>
<p>Cuando se crean nuevos contactos, Go.Data almacena esta información de relación en el punto final de la API <code>relationships</code>; y podemos ver las primeras 50 filas de este conjunto de datos a continuación. Esto significa que podemos crear un gráfico de calor con relativamente pocos pasos, dado que cada contacto ya está unido a su caso de origen.</p>
<div id="htmlwidget-c0e3eb28477be5b935bc" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-c0e3eb28477be5b935bc">{"x":{"filter":"none","vertical":false,"data":[["CASE-2020-0016",null,null,"CASE-2020-0045","CASE-2020-0004","CASE-2020-0010",null,"CASE-2020-0034",null,"CASE-2020-0037","CASE-2020-0005",null,"CASE-2020-0002","CASE-2020-0001","CASE-2020-0005",null,"CASE-2020-0004","CASE-2020-0012","CASE-2020-0022","CASE-2020-0004","CASE-2020-0003","CASE-2020-0001","CASE-2020-0030","CASE-2020-0022","CASE-2020-0010","CASE-2020-0018","CASE-2020-0045","CASE-2020-0030","CASE-2020-0001","CASE-2020-0018","CASE-2020-0008","CASE-2020-0014",null,"CASE-2020-0002","CASE-2020-0030","CASE-2020-0031","CASE-2020-0009","CASE-2020-0031","CASE-2020-0002",null,"CASE-2020-0001","CASE-2020-0001","CASE-2020-0022","CASE-2020-0001","CASE-2020-0012","CASE-2020-0023","CASE-2020-0016","CASE-2020-0001",null,"CASE-2020-0023"],["Female",null,null,"Female","Male","Female",null,"Male",null,"Female","Male",null,"Male","Female","Male",null,"Male","Female","Female","Male","Male","Female","Male","Female","Female","Male","Female","Male","Female","Male","Male","Male",null,"Male","Male","Male","Female","Male","Male",null,"Female","Female","Female","Female","Female","Female","Female","Female","Female","Female"],[80,null,null,34,43,37,null,20,null,80,23,0,52,49,23,null,43,80,51,43,58,49,52,51,37,25,34,52,49,25,7,54,null,52,52,20,57,20,52,null,49,49,51,49,80,43,80,49,43,43],["2020-06-24","2020-05-02","2020-06-15","2020-07-27","2020-06-05","2020-06-05","2020-08-19","2020-06-20","2020-08-19","2020-09-02","2020-08-07","2020-08-13","2020-05-15","2020-07-17","2020-06-15","2020-08-07","2020-06-15","2020-06-17","2020-06-05","2020-06-24","2020-06-07","2020-08-15","2020-06-17","2020-06-22","2020-06-19","2020-06-17","2020-07-27","2020-06-16","2020-04-28","2020-04-26","2020-06-15","2020-06-05","2020-05-02","2020-04-29","2020-06-22","2020-06-06","2020-05-13","2020-06-17","2020-05-01","2020-06-15","2020-06-07","2020-08-14","2020-06-20","2020-09-02","2020-06-24","2020-07-28","2020-06-17","2020-08-14","2020-08-14","2020-07-28"],["2020-06-08","2020-06-08","2020-06-08","2020-06-10","2020-06-08","2020-06-08","2020-08-20","2020-06-08","2020-08-20","2020-09-03","2020-08-21","2020-08-20","2020-06-08","2020-06-08","2020-06-08","2020-08-20","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-10","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-06-08","2020-08-27","2020-06-08","2020-09-03","2020-06-08","2020-06-10","2020-06-08","2020-08-27","2020-08-27","2020-06-10"],["CONTACT-2020-0027","CASE-2020-0014","CASE-2020-0031","CASE-2020-0021","CONTACT-2020-0020","CONTACT-2020-0038","CASE-2020-0036","CONTACT-2020-0059","CASE-2020-0037",null,"CASE-2020-0015","CONTACT-2020-0015","CONTACT-2020-0009","CASE-2020-0008",null,"CASE-2020-0010","CONTACT-2020-0018","CONTACT-2020-0029","CONTACT-2020-0045","CONTACT-2020-0019","CONTACT-2020-0007","CASE-2020-0004","CONTACT-2020-0044","CONTACT-2020-0046","CONTACT-2020-0036","CONTACT-2020-0052","CASE-2020-0023","CONTACT-2020-0042","CONTACT-2020-0005","CONTACT-2020-0053","CONTACT-2020-0017","CONTACT-2020-0034","CASE-2020-0012","CASE-2020-0008","CONTACT-2020-0043","CONTACT-2020-0048","CONTACT-2020-0023","CONTACT-2020-0049","CASE-2020-0006","CASE-2020-0018","CONTACT-2020-0003","CASE-2020-0017","CONTACT-2020-0047","CONTACT-2020-0056","CONTACT-2020-0027","CASE-2020-0029","CONTACT-2020-0028","CONTACT-2020-0046","CONTACT-2020-0046","CASE-2020-0027"],["Male","Male","Male","Male","Female","Male","Female","Female","Female","Male","Female","Male","Male","Male",null,"Female","Male","Male","Female","Male","Female","Male","Male","Male","Female","Male","Female","Male","Male","Male","Female","Female","Female","Male","Male","Male","Male","Female","Male","Male","Male","Male","Male","Male","Male","Male","Female","Male","Male","Male"],[15,54,20,46,32,7,40,97,80,0,38,56,18,7,null,37,78,null,32,20,29,43,null,81,45,null,43,15,3,3,35,54,80,7,47,7,23,null,47,25,12,8,67,54,15,46,null,81,81,38],["Direct physical contact ",null,null,null,"Indirect contact (touched contaminated surface/materials/fomites etc.)","Direct non-physical contact (within 1 meter) ",null,"Direct physical contact ",null,"Direct physical contact ","Direct non-physical contact (within 1 meter) ","Direct non-physical contact (within 1 meter) ","Direct non-physical contact (within 1 meter) ","Direct physical contact ",null,"Direct non-physical contact (within 1 meter) ","Indirect contact (touched contaminated surface/materials/fomites etc.)","Indirect contact (touched contaminated surface/materials/fomites etc.)","Direct physical contact ","Direct non-physical contact (within 1 meter) ",null,"Direct physical contact ","Indirect contact (touched contaminated surface/materials/fomites etc.)","Direct physical contact ","Direct physical contact ","Direct non-physical contact (within 1 meter) ",null,"Direct physical contact ",null,"Direct physical contact ","Indirect contact (touched contaminated surface/materials/fomites etc.)","Direct non-physical contact (within 1 meter) ",null,"Direct physical contact ","Direct non-physical contact (within 1 meter) ","Direct non-physical contact (within 1 meter) ","Direct physical contact ","Direct physical contact ",null,null,null,null,"Indirect contact (touched contaminated surface/materials/fomites etc.)","Direct physical contact ","Direct physical contact ",null,"Direct physical contact ",null,null,null]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>source_visualid<\/th>\n      <th>source_gender<\/th>\n      <th>source_age<\/th>\n      <th>date_of_last_contact<\/th>\n      <th>date_of_data_entry<\/th>\n      <th>target_visualid<\/th>\n      <th>target_gender<\/th>\n      <th>target_age<\/th>\n      <th>exposure_type<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,7]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Al igual que en el caso de la pirámide de edad que compara casos y contactos, podemos seleccionar las pocas variables que necesitamos y crear columnas con agrupaciones categóricas de edad tanto para las fuentes (casos) como para los objetivos (contactos).</p>
<div class="sourceCode" id="cb1242"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">heatmap_ages</span> <span class="op">&lt;-</span> <span class="va">relationships</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">source_age</span>, <span class="va">target_age</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>                              <span class="co"># transmute is like mutate() but removes all other columns</span>
    source_age_class <span class="op">=</span> <span class="fu">epikit</span><span class="fu">::</span><span class="fu"><a href="https://r4epi.github.io/epikit/reference/age_categories.html">age_categories</a></span><span class="op">(</span><span class="va">source_age</span>, breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,
    target_age_class <span class="op">=</span> <span class="fu">epikit</span><span class="fu">::</span><span class="fu"><a href="https://r4epi.github.io/epikit/reference/age_categories.html">age_categories</a></span><span class="op">(</span><span class="va">target_age</span>, breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<p>Como se ha descrito anteriormente, creamos una tabulación cruzada;</p>
<div class="sourceCode" id="cb1243"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cross_tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span>
  source_cases <span class="op">=</span> <span class="va">heatmap_ages</span><span class="op">$</span><span class="va">source_age_class</span>,
  target_cases <span class="op">=</span> <span class="va">heatmap_ages</span><span class="op">$</span><span class="va">target_age_class</span><span class="op">)</span>

<span class="va">cross_tab</span></code></pre></div>
<pre><code>##             target_cases
## source_cases 0-4 5-9 10-14 15-19 20-24 25-29 30-34 35-39 40-44
##        0-4     0   0     0     0     0     0     0     0     0
##        5-9     0   0     1     0     0     0     0     1     0
##        10-14   0   0     0     0     0     0     0     0     0
##        15-19   0   0     0     0     0     0     0     0     0
##        20-24   1   1     0     1     2     0     2     1     0
##        25-29   1   2     0     0     0     0     0     0     0
##        30-34   0   0     0     0     0     0     0     0     1
##        35-39   0   2     0     0     0     0     0     0     0
##        40-44   0   0     0     0     1     0     2     1     0
##        45-49   1   2     2     0     0     0     3     0     1
##        50-54   1   2     1     2     0     0     1     0     0
##        55-59   0   1     0     0     1     1     2     0     0
##        60-64   0   0     0     0     0     0     0     0     0
##        65-69   0   0     0     0     0     0     0     0     0
##        70-74   0   0     0     0     0     0     0     0     0
##        75-79   0   0     0     0     0     0     0     0     0
##        80+     1   0     0     2     1     0     0     0     1
##             target_cases
## source_cases 45-49 50-54 55-59 60-64 65-69 70-74 75-79 80+
##        0-4       1     0     1     0     0     0     0   0
##        5-9       0     0     1     0     0     0     0   0
##        10-14     0     0     0     0     0     0     0   0
##        15-19     0     0     0     0     0     0     0   0
##        20-24     0     0     1     0     0     0     0   1
##        25-29     0     0     0     0     0     0     0   0
##        30-34     1     0     1     0     0     0     0   0
##        35-39     1     0     0     0     0     0     0   0
##        40-44     3     1     1     0     0     0     1   1
##        45-49     0     3     2     1     0     0     0   1
##        50-54     3     4     1     0     1     0     0   1
##        55-59     0     0     0     0     0     0     0   0
##        60-64     0     0     0     0     0     0     0   0
##        65-69     0     0     0     0     0     0     0   0
##        70-74     0     0     0     0     0     0     0   0
##        75-79     0     0     0     0     0     0     0   0
##        80+       0     0     0     0     0     0     0   0</code></pre>
<p>convertimos en formato largo con proporciones;</p>
<div class="sourceCode" id="cb1245"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">long_prop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/proportions.html">prop.table</a></span><span class="op">(</span><span class="va">cross_tab</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>y creamos un mapa de calor para la edad.</p>
<div class="sourceCode" id="cb1246"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">long_prop</span><span class="op">)</span><span class="op">+</span>       <span class="co"># use long data, with proportions as Freq</span>
  <span class="fu">geom_tile</span><span class="op">(</span>                    <span class="co"># visualize it in tiles</span>
    <span class="fu">aes</span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">target_cases</span>,         <span class="co"># x-axis is case age</span>
      y <span class="op">=</span> <span class="va">source_cases</span>,     <span class="co"># y-axis is infector age</span>
      fill <span class="op">=</span> <span class="va">Freq</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>            <span class="co"># color of the tile is the Freq column in the data</span>
  <span class="fu">scale_fill_gradient</span><span class="op">(</span>          <span class="co"># adjust the fill color of the tiles</span>
    low <span class="op">=</span> <span class="st">"blue"</span>,
    high <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>                         <span class="co"># labels</span>
    x <span class="op">=</span> <span class="st">"Target case age"</span>,
    y <span class="op">=</span> <span class="st">"Source case age"</span>,
    title <span class="op">=</span> <span class="st">"Who infected whom"</span>,
    subtitle <span class="op">=</span> <span class="st">"Frequency matrix of transmission events"</span>,
    fill <span class="op">=</span> <span class="st">"Proportion of all\ntranmsission events"</span>     <span class="co"># legend title</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-898-1.png" width="672"></div>
</div>
<div id="resources-18" class="section level2" number="25.6">
<h2>
<span class="header-section-number">25.6</span> Recursos<a class="anchor" aria-label="anchor" href="#resources-18"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://github.com/WorldHealthOrganization/godata/tree/master/analytics/r-reporting" class="uri">https://github.com/WorldHealthOrganization/godata/tree/master/analytics/r-reporting</a></p>
<p><a href="https://worldhealthorganization.github.io/godata/" class="uri">https://worldhealthorganization.github.io/godata/</a></p>
<p><a href="https://community-godata.who.int/" class="uri">https://community-godata.who.int/</a></p>

<p>Análisis de encuestas {#survey-analysis}</p>
<!-- ======================================================= -->
</div>
<div id="overview-4" class="section level2" number="25.7">
<h2>
<span class="header-section-number">25.7</span> Resumen<a class="anchor" aria-label="anchor" href="#overview-4"><i class="fas fa-link"></i></a>
</h2>
<p>Esta página muestra el uso de varios paquetes para el análisis de encuestas.</p>
<p>La mayoría de los paquetes R de encuestas se basan en el <a href="https://cran.r-project.org/web/packages/survey/index.html">paquete <strong>survey</strong></a> para realizar análisis ponderados. Utilizaremos <strong>survey</strong>, así como <a href="https://cran.r-project.org/web/packages/srvyr/index.html"><strong>srvyr</strong></a> (una envoltura para <strong>survey</strong> que permite la codificación al estilo tidyverse) y <a href="https://cran.r-project.org/web/packages/gtsummary/index.html"><strong>gtsummary</strong></a> (una envoltura para <strong>survey</strong> que permite obtener tablas listas para su publicación). Aunque el paquete original <strong>survey</strong> no permite la codificación al estilo tidyverse, tiene la ventaja añadida de permitir modelos lineales generalizados ponderados por la encuesta (que se añadirán a esta página más adelante). También demostraremos el uso de una función del paquete <a href="https://github.com/R4EPI/sitrep"><strong>sitrep</strong></a> para crear ponderaciones de muestreo (<em>n.b.</em> este paquete no está todavía en CRAN, pero se puede instalar desde github).</p>
<p>La mayor parte de esta página se basa en el trabajo realizado para el <a href="https://r4epis.netlify.app/">proyecto “R4Epis”</a>; para ver el código detallado y las plantillas R-markdown del mismo, consulta la <a href="https://github.com/R4EPI/sitrep">página github de “R4Epis”</a>. Parte del código basado en el paquete de encuestas se basa en las primeras versiones de los <a href="https://github.com/EPIET/RapidAssessmentSurveys">estudios de caso de EPIET</a>.</p>
<p>Actualmente, esta página no aborda el cálculo del tamaño de la muestra ni el muestreo. Para una calculadora del tamaño muestral fácil de usar, consulta <a href="https://www.openepi.com/Menu/OE_Menu.htm">OpenEpi</a>. La página de <a href="gis-basics.html#gis-basics">conceptos básicos de los SIG</a> del manual tendrá eventualmente una sección sobre muestreo aleatorio espacial, y esta página tendrá eventualmente una sección sobre marcos de muestreo así como cálculos del tamaño de la muestra.</p>
<ol style="list-style-type: decimal">
<li>Datos de encuestas</li>
<li>Tiempo de observación</li>
<li>Ponderación</li>
<li>Objetos de diseño de la encuesta</li>
<li>Análisis descriptivo</li>
<li>Proporciones ponderadas</li>
<li>Tasas ponderadas</li>
</ol>
<!-- ======================================================= -->
</div>
<div id="preparation-17" class="section level2" number="25.8">
<h2>
<span class="header-section-number">25.8</span> Preparación<a class="anchor" aria-label="anchor" href="#preparation-17"><i class="fas fa-link"></i></a>
</h2>
<div id="paquetes-2" class="section level3 unnumbered">
<h3>Paquetes<a class="anchor" aria-label="anchor" href="#paquetes-2"><i class="fas fa-link"></i></a>
</h3>
<p>Este trozo de código muestra la carga de los paquetes necesarios para los análisis. En este manual destacamos <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> de <strong>pacman</strong>, que instala el paquete si es necesario <em>y</em> lo carga para su uso. También se pueden cargar paquetes con <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> de R <strong>base .</strong> Consulta la página sobre <a href="r-basics.html#r-basics">fundamentos de R</a> para obtener más información sobre los paquetes de R.
Aquí también mostramos el uso de la función <code><a href="https://rdrr.io/pkg/pacman/man/p_load_gh.html">p_load_gh()</a></code> de <strong>pacman</strong> para instalar y cargar un paquete de github que aún no ha sido publicado en CRAN.</p>
<div class="sourceCode" id="cb1247"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## load packages from CRAN</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">rio</span>,          <span class="co"># File import</span>
               <span class="va">here</span>,         <span class="co"># File locator</span>
               <span class="va">tidyverse</span>,    <span class="co"># data management + ggplot2 graphics</span>
               <span class="va">tsibble</span>,      <span class="co"># handle time series datasets</span>
               <span class="va">survey</span>,       <span class="co"># for survey functions</span>
               <span class="va">srvyr</span>,        <span class="co"># dplyr wrapper for survey package</span>
               <span class="va">gtsummary</span>,    <span class="co"># wrapper for survey package to produce tables</span>
               <span class="va">apyramid</span>,     <span class="co"># a package dedicated to creating age pyramids</span>
               <span class="va">patchwork</span>,    <span class="co"># for combining ggplots</span>
               <span class="va">ggforce</span>       <span class="co"># for alluvial/sankey plots</span>
              
               <span class="op">)</span> 

<span class="co">## load packages from github</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load_gh.html">p_load_gh</a></span><span class="op">(</span>
  
  <span class="st">"r4epi/epikit"</span><span class="op">)</span> <span class="co"># jfmont</span>

<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load_gh.html">p_load_gh</a></span><span class="op">(</span>
  
  <span class="st">"r4epi/sitrep"</span><span class="op">)</span> <span class="co"># jfmont</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/R4EPI/sitrep">"sitrep"</a></span><span class="op">)</span> <span class="co"># jfmont (Normally p_load_gh approach fails with sitrep, therefore I switch to an old-school way)</span></code></pre></div>
</div>
<div id="carga-de-datos" class="section level3 unnumbered">
<h3>Carga de datos<a class="anchor" aria-label="anchor" href="#carga-de-datos"><i class="fas fa-link"></i></a>
</h3>
<p>El conjunto de datos de ejemplo utilizado en esta sección:</p>
<ul>
<li>datos de encuesta de mortalidad ficticia.</li>
<li>recuentos de población ficticios para la zona de la encuesta.</li>
<li>diccionario de datos para los datos de la encuesta de mortalidad ficticia.</li>
</ul>
<p>Se basa en la encuesta pre-aprobada por la junta de revisión ética de MSF OCA. Los datos ficticios se produjeron como parte del <a href="https://r4epis.netlify.app/">proyecto “R4Epis”</a>. Todo ello se basa en los datos recopilados mediante <a href="https://www.kobotoolbox.org/">KoboToolbox,</a> un software de recopilación de datos basado en <a href="https://opendatakit.org/">Open Data Kit</a>.</p>
<p>Kobo permite exportar tanto los datos recogidos como el diccionario de datos para ese conjunto de datos. Recomendamos encarecidamente hacer esto, ya que simplifica la limpieza de los datos y es útil para buscar variables/preguntas.</p>
<p><span style="color: darkgreen;"><strong><em>CONSEJO:</em></strong> El diccionario de datos de Kobo tiene nombres de variables en la columna “name” de la hoja de la encuesta. Los valores posibles para cada variable se especifican en la hoja de opciones. En la hoja de opciones, “name” tiene el valor acortado y las columnas “label::english” y “label::french” tienen las versiones largas correspondientes. Si utilizas la función <code><a href="https://r4epi.github.io/sitrep/reference/msf_dict.html">msf_dict_survey()</a></code> del paquete <strong>epidict</strong> para importar un archivo excel del diccionario Kobo, éste se reformulará para que pueda utilizarse fácilmente para recodificar. </span></p>
<p><span style="color: orange;"><strong><em>PRECAUCIÓN:</em></strong> El conjunto de datos de ejemplo no es lo mismo que una exportación (ya que en Kobo se exportan los diferentes niveles del cuestionario de forma individual) - Mira la sección de datos de la encuesta más abajo para fusionar los diferentes niveles.</span></p>
<p>Los datos se importan mediante la función <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> del paquete <strong>rio</strong>. Consulta la página sobre <a href="import-and-export.html#import-and-export">importación y exportación</a> para conocer las distintas formas de importar datos.</p>
<div class="sourceCode" id="cb1248"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># import the survey data</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"survey_data.xlsx"</span><span class="op">)</span>

<span class="co"># import the dictionary into R</span>
<span class="va">survey_dict</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"survey_dict.xlsx"</span><span class="op">)</span> </code></pre></div>
<p>Más abajo se muestran las primeras 10 filas de la encuesta</p>
<div id="htmlwidget-afcc7bf7fa18576171f1" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-afcc7bf7fa18576171f1">{"x":{"filter":"none","vertical":false,"data":[[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["2018-04-15T00:00:00Z","2018-03-04T00:00:00Z","2018-04-16T00:00:00Z","2018-01-23T00:00:00Z","2018-01-09T00:00:00Z","2018-03-07T00:00:00Z","2018-02-18T00:00:00Z","2018-04-12T00:00:00Z","2018-04-17T00:00:00Z","2018-01-05T00:00:00Z"],[null,null,null,null,null,null,null,null,null,null],["village_1","village_1","village_10","village_5","village_3","village_8","other","village_7","village_4","village_2"],[null,null,null,null,null,null,null,null,null,null],[1,1,10,5,3,8,11,7,4,2],[9,1,15,6,18,14,17,16,13,14],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["yes","no","no","yes","no","yes","no","yes","yes","yes"],[null,"no_benefit","neg_experience",null,"other",null,"no_benefit",null,null,null],[null,null,null,null,null,null,null,null,null,null],[6,null,null,8,null,5,null,6,5,5],["female",null,null,"female",null,"male",null,"male","male","female"],[26,null,null,3,null,22,null,33,96,18],[null,null,null,36,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["no",null,null,"no",null,"yes",null,"yes","yes","yes"],["yes",null,null,null,null,"yes",null,"no","no","no"],["secondary",null,null,null,null,"secondary",null,null,null,null],["no",null,null,"no",null,"yes",null,"no","yes","yes"],[null,null,null,null,null,"yes",null,null,"no","no"],["yes",null,null,null,null,null,null,null,null,"yes"],["no",null,null,"no",null,"yes",null,"yes","no","yes"],["yes",null,null,"no",null,"no",null,"no","yes","yes"],["no",null,null,null,null,null,null,null,"no","no"],[null,null,null,null,null,null,null,null,null,null],["yes",null,null,"no",null,"no",null,"yes","no","no"],["no",null,null,null,null,null,null,"no",null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["no","no","no","no","no","no","no","no","yes","no"],[null,null,null,null,null,null,null,null,"no",null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,"dont_know",null],[null,null,null,null,null,null,null,null,null,null],["yes",null,null,"yes",null,"no",null,"yes","no","no"],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["sexual",null,null,"sexual",null,null,null,"shot",null,null],["0",null,null,"0",null,null,null,"0",null,null],["1",null,null,"1",null,null,null,"0",null,null],["0",null,null,"0",null,null,null,"1",null,null],["0",null,null,"0",null,null,null,"0",null,null],["0",null,null,"0",null,null,null,"0",null,null],["0",null,null,"0",null,null,null,"0",null,null],[9,1,183,83,58,146,205,130,72,33],[1,1,1,1,1,1,1,1,1,1],["9_1","1_1","183_1","83_1","58_1","146_1","205_1","130_1","72_1","33_1"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>start<\/th>\n      <th>end<\/th>\n      <th>today<\/th>\n      <th>deviceid<\/th>\n      <th>date<\/th>\n      <th>team_number<\/th>\n      <th>village_name<\/th>\n      <th>village_other<\/th>\n      <th>cluster_number<\/th>\n      <th>household_number<\/th>\n      <th>households_building<\/th>\n      <th>random_hh<\/th>\n      <th>random_hh_note<\/th>\n      <th>consent<\/th>\n      <th>no_consent_reason<\/th>\n      <th>no_consent_other<\/th>\n      <th>member_number<\/th>\n      <th>sex<\/th>\n      <th>age_years<\/th>\n      <th>age_months_calc<\/th>\n      <th>age_months<\/th>\n      <th>bednet<\/th>\n      <th>read_write<\/th>\n      <th>education_level<\/th>\n      <th>measles_vaccination<\/th>\n      <th>vaccination_card<\/th>\n      <th>pregnant<\/th>\n      <th>malaria_treatment<\/th>\n      <th>arrived<\/th>\n      <th>remember_arrival<\/th>\n      <th>arrived_date<\/th>\n      <th>left<\/th>\n      <th>remember_departure<\/th>\n      <th>left_date<\/th>\n      <th>born<\/th>\n      <th>remember_dob<\/th>\n      <th>birthday_date<\/th>\n      <th>died<\/th>\n      <th>remember_death<\/th>\n      <th>death_date<\/th>\n      <th>cause<\/th>\n      <th>cause_other<\/th>\n      <th>violent_episode<\/th>\n      <th>violent_episodes_number<\/th>\n      <th>violence_nature_other<\/th>\n      <th>violence_nature<\/th>\n      <th>violence_nature/beaten<\/th>\n      <th>violence_nature/sexual<\/th>\n      <th>violence_nature/shot<\/th>\n      <th>violence_nature/detained_kidnapped<\/th>\n      <th>violence_nature/other<\/th>\n      <th>violence_nature/no_response<\/th>\n      <th>index<\/th>\n      <th>index_y<\/th>\n      <th>uid<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[8,9,16,18,19,20,52,53]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>También queremos importar los datos de la población de muestreo para poder elaborar las ponderaciones adecuadas. Estos datos pueden estar en diferentes formatos, sin embargo sugerimos tenerlos como se ve a continuación (esto puede ser simplemente escrito en un Excel).</p>
<div class="sourceCode" id="cb1249"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># import the population data</span>
<span class="va">population</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"population.xlsx"</span><span class="op">)</span></code></pre></div>
<p>A continuación se muestran las 10 primeras filas de la encuesta.</p>
<div id="htmlwidget-4944639e91c244d9d2a0" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-4944639e91c244d9d2a0">{"x":{"filter":"none","vertical":false,"data":[["0-2","3-14","15-29","30-44","45+","0-2","3-14","15-29","30-44","45+"],["male","male","male","male","male","female","female","female","female","female"],[0.034,0.1811,0.138,0.0808,0.0661,0.034,0.1811,0.138,0.0808,0.0661],[340,1811,1380,808,661,340,1811,1380,808,661],["district_a","district_a","district_a","district_a","district_a","district_a","district_a","district_a","district_a","district_a"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>age_group<\/th>\n      <th>sex<\/th>\n      <th>proportions<\/th>\n      <th>population<\/th>\n      <th>health_district<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>En el caso de las encuestas por conglomerados, es posible que desees añadir ponderaciones de la encuesta a nivel de conglomerado. Puedes introducir estos datos como se indica más arriba. Alternativamente, si sólo hay unos pocos recuentos, éstos podrían introducirse como se indica a continuación en un tibble. En cualquier caso, tendrá que tener una columna con un identificador de conglomerado que coincida con los datos de tu encuesta, y otra columna con el número de hogares en cada conglomerado.</p>
<div class="sourceCode" id="cb1250"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## define the number of households in each cluster</span>
<span class="va">cluster_counts</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>cluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"village_1"</span>, <span class="st">"village_2"</span>, <span class="st">"village_3"</span>, <span class="st">"village_4"</span>, 
                                     <span class="st">"village_5"</span>, <span class="st">"village_6"</span>, <span class="st">"village_7"</span>, <span class="st">"village_8"</span>,
                                     <span class="st">"village_9"</span>, <span class="st">"village_10"</span><span class="op">)</span>, 
                         households <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">700</span>, <span class="fl">400</span>, <span class="fl">600</span>, <span class="fl">500</span>, <span class="fl">300</span>, 
                                        <span class="fl">800</span>, <span class="fl">700</span>, <span class="fl">400</span>, <span class="fl">500</span>, <span class="fl">500</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="limpieza-de-datos-1" class="section level3 unnumbered">
<h3>Limpieza de datos<a class="anchor" aria-label="anchor" href="#limpieza-de-datos-1"><i class="fas fa-link"></i></a>
</h3>
<p>A continuación se asegura que la columna de fechas tenga el formato adecuado. Hay varias otras maneras de hacer esto (ver la página <a href="working-with-dates.html#working-with-dates">Trabajar con fechas</a> para más detalles), sin embargo, usar el diccionario para definir las fechas es rápido y fácil.</p>
<p>También creamos una variable de grupo de edad utilizando la función <code><a href="https://r4epi.github.io/sitrep/reference/epikit-exports.html">age_categories()</a></code> de <strong>epikit</strong> - véase la sección del manual de <a href="#cleaning-data-and-core-functions.html#num_cats">limpieza de datos</a> para más detalles. Además, creamos una variable de carácter que define en qué distrito se encuentran las distintas agrupaciones.</p>
<p>Por último, recodificamos todas las variables sí/no en variables VERDADERO/FALSO, ya que de lo contrario no pueden ser utilizadas por las funciones de proporción de <strong>survey</strong>.</p>
<div class="sourceCode" id="cb1251"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## select the date variable names from the dictionary </span>
<span class="va">DATEVARS</span> <span class="op">&lt;-</span> <span class="va">survey_dict</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"date"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">survey_data</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co">## filter to match the column names of your data</span>
  <span class="fu">pull</span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="co"># select date vars</span>
  
<span class="co">## change to dates </span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">all_of</span><span class="op">(</span><span class="va">DATEVARS</span><span class="op">)</span>, <span class="va">as.Date</span><span class="op">)</span><span class="op">)</span>


<span class="co">## add those with only age in months to the year variable (divide by twelve)</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>age_years <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">age_years</span><span class="op">)</span>, 
                             <span class="va">age_months</span> <span class="op">/</span> <span class="fl">12</span>, 
                             <span class="va">age_years</span><span class="op">)</span><span class="op">)</span>

<span class="co">## define age group variable</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span> 
     <span class="fu">mutate</span><span class="op">(</span>age_group <span class="op">=</span> <span class="fu"><a href="https://r4epi.github.io/sitrep/reference/epikit-exports.html">age_categories</a></span><span class="op">(</span><span class="va">age_years</span>, 
                                    breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">15</span>, <span class="fl">30</span>, <span class="fl">45</span><span class="op">)</span>
                                    <span class="op">)</span><span class="op">)</span>


<span class="co">## create a character variable based off groups of a different variable </span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>health_district <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span>
    <span class="va">cluster_number</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">~</span> <span class="st">"district_a"</span>, 
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"district_b"</span>
  <span class="op">)</span><span class="op">)</span>


<span class="co">## select the yes/no variable names from the dictionary </span>
<span class="va">YNVARS</span> <span class="op">&lt;-</span> <span class="va">survey_dict</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"yn"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">survey_data</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co">## filter to match the column names of your data</span>
  <span class="fu">pull</span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="co"># select yn vars</span>
  
<span class="co">## change to dates </span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">all_of</span><span class="op">(</span><span class="va">YNVARS</span><span class="op">)</span>, 
                <span class="va">str_detect</span>, 
                pattern <span class="op">=</span> <span class="st">"yes"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="survey-data" class="section level2" number="25.9">
<h2>
<span class="header-section-number">25.9</span> Datos de encuestas<a class="anchor" aria-label="anchor" href="#survey-data"><i class="fas fa-link"></i></a>
</h2>
<p>Existen numerosos diseños de muestreo que pueden utilizarse para las encuestas. Aquí mostraremos el código para:
- Estratificado
- Conglomerado
- Estratificado y conglomerado</p>
<p>Como se ha descrito anteriormente (dependiendo de cómo se diseñe el cuestionario) los datos de cada nivel se exportarían como unos datos separados desde Kobo. En nuestro ejemplo hay un nivel para los hogares y un nivel para los individuos dentro de esos hogares.</p>
<p>Estos dos niveles están vinculados por un identificador único. Para unos datos de Kobo, esta variable es “_index” en el nivel del hogar, que coincide con “_parent_index” en el nivel individual. Esto creará nuevas filas para el hogar con cada individuo que coincida, véase la sección del manual sobre <a href="joining-data.html#joining-data">unir datos</a> para más detalles.</p>
<div class="sourceCode" id="cb1252"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## join the individual and household data to form a complete data set</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">survey_data_hh</span>, 
                         <span class="va">survey_data_indiv</span>,
                         by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"_index"</span> <span class="op">=</span> <span class="st">"_parent_index"</span><span class="op">)</span><span class="op">)</span>


<span class="co">## create a unique identifier by combining indeces of the two levels </span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span> 
     <span class="fu">mutate</span><span class="op">(</span>uid <span class="op">=</span> <span class="fu">str_glue</span><span class="op">(</span><span class="st">"{index}_{index_y}"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="observation-time" class="section level2" number="25.10">
<h2>
<span class="header-section-number">25.10</span> Tiempo de observación<a class="anchor" aria-label="anchor" href="#observation-time"><i class="fas fa-link"></i></a>
</h2>
<p>En el caso de las encuestas de mortalidad, queremos saber cuánto tiempo ha estado presente cada individuo en el lugar para poder calcular una tasa de mortalidad adecuada para nuestro periodo de interés. Esto no es relevante para todas las encuestas, pero en particular para las encuestas de mortalidad es importante, ya que se realizan con frecuencia entre poblaciones móviles o desplazadas.</p>
<p>Para ello, primero definimos nuestro periodo de interés, también conocido como periodo de recuerdo (es decir, el tiempo sobre el que se pide a los participantes que informen al responder a las preguntas). A continuación, podemos utilizar este periodo para establecer las fechas inadecuadas como ausentes, es decir, si las muertes se notifican fuera del periodo de interés.</p>
<div class="sourceCode" id="cb1253"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## set the start/end of recall period</span>
<span class="co">## can be changed to date variables from dataset </span>
<span class="co">## (e.g. arrival date &amp; date questionnaire)</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>recall_start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2018-01-01"</span><span class="op">)</span>, 
         recall_end   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2018-05-01"</span><span class="op">)</span>
  <span class="op">)</span>


<span class="co"># set inappropriate dates to NA based on rules </span>
<span class="co">## e.g. arrivals before start, departures departures after end</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span>
      <span class="fu">mutate</span><span class="op">(</span>
           arrived_date <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">arrived_date</span> <span class="op">&lt;</span> <span class="va">recall_start</span>, 
                                 <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,
                                  <span class="va">arrived_date</span><span class="op">)</span>,
           birthday_date <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">birthday_date</span> <span class="op">&lt;</span> <span class="va">recall_start</span>,
                                  <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,
                                  <span class="va">birthday_date</span><span class="op">)</span>,
           left_date <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">left_date</span> <span class="op">&gt;</span> <span class="va">recall_end</span>,
                              <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,
                               <span class="va">left_date</span><span class="op">)</span>,
           death_date <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">death_date</span> <span class="op">&gt;</span> <span class="va">recall_end</span>,
                               <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>,
                               <span class="va">death_date</span><span class="op">)</span>
           <span class="op">)</span></code></pre></div>
<p>Entonces podemos utilizar nuestras variables de fecha para definir las fechas de inicio y fin de cada individuo. Podemos utilizar la función <code><a href="https://r4epi.github.io/sitrep/reference/epikit-exports.html">find_start_date()</a></code> de <strong>sitrep</strong> para afinar la elección de las fechas y luego utilizarla para calcular la diferencia entre días (persona-tiempo).</p>
<p>Fecha de inicio:
Evento de llegada más temprano dentro del período de recogida O bien el inicio del período de recogida (definidas de antemano), o una fecha posterior al inicio de la recogida, si procede (por ejemplo, llegadas o nacimientos)</p>
<p>Fecha de finalización:
Evento de salida más temprano dentro del periodo de recogida O bien el final del periodo de recogida, o una fecha anterior al final de la recogida si procede (por ejemplo, salidas, fallecimientos)</p>
<div class="sourceCode" id="cb1254"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## create new variables for start and end dates/causes</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span> 
     <span class="co">## choose earliest date entered in survey</span>
     <span class="co">## from births, household arrivals, and camp arrivals </span>
     <span class="fu"><a href="https://r4epi.github.io/sitrep/reference/epikit-exports.html">find_start_date</a></span><span class="op">(</span><span class="st">"birthday_date"</span>,
                  <span class="st">"arrived_date"</span>,
                  period_start <span class="op">=</span> <span class="st">"recall_start"</span>,
                  period_end   <span class="op">=</span> <span class="st">"recall_end"</span>,
                  datecol      <span class="op">=</span> <span class="st">"startdate"</span>,
                  datereason   <span class="op">=</span> <span class="st">"startcause"</span> 
                 <span class="op">)</span> <span class="op">%&gt;%</span>
     <span class="co">## choose earliest date entered in survey</span>
     <span class="co">## from camp departures, death and end of the study</span>
     <span class="fu"><a href="https://r4epi.github.io/sitrep/reference/epikit-exports.html">find_end_date</a></span><span class="op">(</span><span class="st">"left_date"</span>,
                <span class="st">"death_date"</span>,
                period_start <span class="op">=</span> <span class="st">"recall_start"</span>,
                period_end   <span class="op">=</span> <span class="st">"recall_end"</span>,
                datecol      <span class="op">=</span> <span class="st">"enddate"</span>,
                datereason   <span class="op">=</span> <span class="st">"endcause"</span> 
               <span class="op">)</span>


<span class="co">## label those that were present at the start/end (except births/deaths)</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span> 
     <span class="fu">mutate</span><span class="op">(</span>
       <span class="co">## fill in start date to be the beginning of recall period (for those empty) </span>
       startdate <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">startdate</span><span class="op">)</span>, <span class="va">recall_start</span>, <span class="va">startdate</span><span class="op">)</span>, 
       <span class="co">## set the start cause to present at start if equal to recall period </span>
       <span class="co">## unless it is equal to the birth date </span>
       startcause <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">startdate</span> <span class="op">==</span> <span class="va">recall_start</span> <span class="op">&amp;</span> <span class="va">startcause</span> <span class="op">!=</span> <span class="st">"birthday_date"</span>,
                              <span class="st">"Present at start"</span>, <span class="va">startcause</span><span class="op">)</span>, 
       <span class="co">## fill in end date to be end of recall period (for those empty) </span>
       enddate <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">enddate</span><span class="op">)</span>, <span class="va">recall_end</span>, <span class="va">enddate</span><span class="op">)</span>, 
       <span class="co">## set the end cause to present at end if equall to recall end </span>
       <span class="co">## unless it is equal to the death date</span>
       endcause <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">enddate</span> <span class="op">==</span> <span class="va">recall_end</span> <span class="op">&amp;</span> <span class="va">endcause</span> <span class="op">!=</span> <span class="st">"death_date"</span>, 
                            <span class="st">"Present at end"</span>, <span class="va">endcause</span><span class="op">)</span><span class="op">)</span>


<span class="co">## Define observation time in days</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>obstime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">enddate</span> <span class="op">-</span> <span class="va">startdate</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="weighting" class="section level2" number="25.11">
<h2>
<span class="header-section-number">25.11</span> Ponderación<a class="anchor" aria-label="anchor" href="#weighting"><i class="fas fa-link"></i></a>
</h2>
<p>Es importante que elimines las observaciones erróneas antes de añadir los pesos de la encuesta. Por ejemplo, si hay observaciones con tiempo de observación negativo, tendrás que comprobarlas (puedes hacerlo con la función <code><a href="https://r4epi.github.io/sitrep/reference/epikit-exports.html">assert_positive_timespan()</a></code> de <strong>sitrep</strong>. Otra cosa es si quieres eliminar las filas vacías (por ejemplo, con <code>drop_na(uid)</code>) o eliminar los duplicados (véase la sección del manual sobre <a href="de-duplication.html#de-duplication">De-duplicación</a> para más detalles). También hay que eliminar las que no tienen consentimiento.</p>
<p>En este ejemplo, filtramos los casos que queremos eliminar y los almacenamos en un dataframe separado, de forma que podamos describir los que fueron excluidos de la encuesta. A continuación, utilizamos la función <code>anti_join()</code> de <strong>dplyr</strong> para eliminar estos casos descartados de los datos de nuestra encuesta.</p>
<p><span style="color: red;"><strong><em>PELIGRO:</em></strong> No puede haber valores faltantes en la variable de peso, ni en ninguna de las variables relevantes para el diseño de la encuesta (por ejemplo, edad, sexo, estratos o variables de agrupación).</span></p>
<div class="sourceCode" id="cb1255"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## store the cases that you drop so you can describe them (e.g. non-consenting </span>
<span class="co">## or wrong village/cluster)</span>
<span class="va">dropped</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">consent</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">startdate</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">enddate</span><span class="op">)</span> <span class="op">|</span> <span class="va">village_name</span> <span class="op">==</span> <span class="st">"other"</span><span class="op">)</span>

<span class="co">## use the dropped cases to remove the unused rows from the survey data set  </span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="fu">anti_join</span><span class="op">(</span><span class="va">survey_data</span>, <span class="va">dropped</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">dropped</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Como se ha mencionado anteriormente, demostramos cómo añadir ponderaciones para tres diseños de estudio diferentes (estratificado, conglomerado y conglomerado estratificado). Estos requieren información sobre la población de origen y/o los conglomerados encuestados. Utilizaremos el código de conglomerado estratificado para este ejemplo, pero utiliza el que sea más apropiado para tu diseño de estudio.</p>
<div class="sourceCode" id="cb1256"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># stratified ------------------------------------------------------------------</span>
<span class="co"># create a variable called "surv_weight_strata"</span>
<span class="co"># contains weights for each individual - by age group, sex and health district</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r4epi.github.io/sitrep/reference/epikit-exports.html">add_weights_strata</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">survey_data</span>,
                                         p <span class="op">=</span> <span class="va">population</span>,
                                         surv_weight <span class="op">=</span> <span class="st">"surv_weight_strata"</span>,
                                         surv_weight_ID <span class="op">=</span> <span class="st">"surv_weight_ID_strata"</span>,
                                         <span class="va">age_group</span>, <span class="va">sex</span>, <span class="va">health_district</span><span class="op">)</span>

<span class="co">## cluster ---------------------------------------------------------------------</span>

<span class="co"># get the number of people of individuals interviewed per household</span>
<span class="co"># adds a variable with counts of the household (parent) index variable</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span>
  <span class="fu">add_count</span><span class="op">(</span><span class="va">index</span>, name <span class="op">=</span> <span class="st">"interviewed"</span><span class="op">)</span>


<span class="co">## create cluster weights</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r4epi.github.io/sitrep/reference/epikit-exports.html">add_weights_cluster</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">survey_data</span>,
                                          cl <span class="op">=</span> <span class="va">cluster_counts</span>,
                                          eligible <span class="op">=</span> <span class="va">member_number</span>,
                                          interviewed <span class="op">=</span> <span class="va">interviewed</span>,
                                          cluster_x <span class="op">=</span> <span class="va">village_name</span>,
                                          cluster_cl <span class="op">=</span> <span class="va">cluster</span>,
                                          household_x <span class="op">=</span> <span class="va">index</span>,
                                          household_cl <span class="op">=</span> <span class="va">households</span>,
                                          surv_weight <span class="op">=</span> <span class="st">"surv_weight_cluster"</span>,
                                          surv_weight_ID <span class="op">=</span> <span class="st">"surv_weight_ID_cluster"</span>,
                                          ignore_cluster <span class="op">=</span> <span class="cn">FALSE</span>,
                                          ignore_household <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>


<span class="co"># stratified and cluster ------------------------------------------------------</span>
<span class="co"># create a survey weight for cluster and strata</span>
<span class="va">survey_data</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>surv_weight_cluster_strata <span class="op">=</span> <span class="va">surv_weight_strata</span> <span class="op">*</span> <span class="va">surv_weight_cluster</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="survey-design-objects" class="section level2" number="25.12">
<h2>
<span class="header-section-number">25.12</span> Objetos de diseño de la encuesta<a class="anchor" aria-label="anchor" href="#survey-design-objects"><i class="fas fa-link"></i></a>
</h2>
<p>Crea un objeto de encuesta de acuerdo con el diseño de tu estudio. Se utiliza de la misma manera que los dataframes para calcular las proporciones ponderadas, etc. Asegúrate que todas las variables necesarias están creadas antes de esto.</p>
<p>Hay cuatro opciones, comenta las que no utilizas:
- Aleatorio simple
- Estratificado
- Conglomerado
- Conglomerado estratificado</p>
<p>Para esta plantilla, supondremos que agrupamos las encuestas en dos estratos distintos (distritos sanitarios A y B). Por lo tanto, para obtener las estimaciones globales necesitamos haber combinado las ponderaciones de los grupos y de los estratos.</p>
<p>Como se ha mencionado anteriormente, hay dos paquetes disponibles para hacer esto. El clásico es <strong>survey</strong> y luego hay un paquete envolvente llamado <strong>srvyr</strong> que hace objetos y funciones amigables con tidyverse. Mostraremos ambos, pero ten en cuenta que la mayor parte del código de este capítulo utilizará objetos basados en <strong>srvyr</strong>. La única excepción es que el paquete <strong>gtsummary</strong> sólo acepta objetos de <strong>survey</strong>.</p>
<div id="paquete-survey" class="section level3 unnumbered">
<h3>Paquete <strong>survey</strong><a class="anchor" aria-label="anchor" href="#paquete-survey"><i class="fas fa-link"></i></a>
</h3>
<p>El paquete <strong>survey</strong> utiliza efectivamente la codificación de R <strong>base</strong>, por lo que no es posible utilizar pipes (<code>%&gt;%</code>) u otra sintaxis de <strong>dplyr</strong>. Con el paquete de <strong>survey</strong> utilizamos la función <code>svydesign()</code> para definir un objeto de encuesta con clusters, pesos y estratos adecuados.</p>
<p><span style="color: black;"><strong><em>NOTA:</em></strong> necesitamos utilizar la tilde (<code><a href="https://rdrr.io/r/base/tilde.html">~</a></code>) delante de las variables, esto es porque el paquete utiliza la sintaxis de R <strong>base</strong> de asignación de variables basadas en fórmulas.</span></p>
<div class="sourceCode" id="cb1257"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># simple random ---------------------------------------------------------------</span>
<span class="va">base_survey_design_simple</span> <span class="op">&lt;-</span> <span class="fu">svydesign</span><span class="op">(</span>ids <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>, <span class="co"># 1 for no cluster ids</span>
                   weights <span class="op">=</span> <span class="cn">NULL</span>,               <span class="co"># No weight added</span>
                   strata <span class="op">=</span> <span class="cn">NULL</span>,                <span class="co"># sampling was simple (no strata)</span>
                   data <span class="op">=</span> <span class="va">survey_data</span>            <span class="co"># have to specify the dataset</span>
                  <span class="op">)</span>

<span class="co">## stratified ------------------------------------------------------------------</span>
<span class="va">base_survey_design_strata</span> <span class="op">&lt;-</span> <span class="fu">svydesign</span><span class="op">(</span>ids <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>,  <span class="co"># 1 for no cluster ids</span>
                   weights <span class="op">=</span> <span class="op">~</span><span class="va">surv_weight_strata</span>, <span class="co"># weight variable created above</span>
                   strata <span class="op">=</span> <span class="op">~</span><span class="va">health_district</span>,     <span class="co"># sampling was stratified by district</span>
                   data <span class="op">=</span> <span class="va">survey_data</span>             <span class="co"># have to specify the dataset</span>
                  <span class="op">)</span>

<span class="co"># cluster ---------------------------------------------------------------------</span>
<span class="va">base_survey_design_cluster</span> <span class="op">&lt;-</span> <span class="fu">svydesign</span><span class="op">(</span>ids <span class="op">=</span> <span class="op">~</span><span class="va">village_name</span>, <span class="co"># cluster ids</span>
                   weights <span class="op">=</span> <span class="op">~</span><span class="va">surv_weight_cluster</span>, <span class="co"># weight variable created above</span>
                   strata <span class="op">=</span> <span class="cn">NULL</span>,                 <span class="co"># sampling was simple (no strata)</span>
                   data <span class="op">=</span> <span class="va">survey_data</span>              <span class="co"># have to specify the dataset</span>
                  <span class="op">)</span>

<span class="co"># stratified cluster ----------------------------------------------------------</span>
<span class="va">base_survey_design</span> <span class="op">&lt;-</span> <span class="fu">svydesign</span><span class="op">(</span>ids <span class="op">=</span> <span class="op">~</span><span class="va">village_name</span>,      <span class="co"># cluster ids</span>
                   weights <span class="op">=</span> <span class="op">~</span><span class="va">surv_weight_cluster_strata</span>, <span class="co"># weight variable created above</span>
                   strata <span class="op">=</span> <span class="op">~</span><span class="va">health_district</span>,             <span class="co"># sampling was stratified by district</span>
                   data <span class="op">=</span> <span class="va">survey_data</span>                     <span class="co"># have to specify the dataset</span>
                  <span class="op">)</span></code></pre></div>
</div>
<div id="paquete-srvyr" class="section level3 unnumbered">
<h3>Paquete <strong>Srvyr</strong><a class="anchor" aria-label="anchor" href="#paquete-srvyr"><i class="fas fa-link"></i></a>
</h3>
<p>Con el paquete <strong>srvyr</strong> podemos utilizar la función <code>as_survey_design()</code>, que tiene los mismos argumentos que la anterior pero permite los pipes (<code>%&gt;%</code>), por lo que no es necesario utilizar la tilde (<code><a href="https://rdrr.io/r/base/tilde.html">~</a></code>).</p>
<div class="sourceCode" id="cb1258"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## simple random ---------------------------------------------------------------</span>
<span class="va">survey_design_simple</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">as_survey_design</span><span class="op">(</span>ids <span class="op">=</span> <span class="fl">1</span>, <span class="co"># 1 for no cluster ids </span>
                   weights <span class="op">=</span> <span class="cn">NULL</span>, <span class="co"># No weight added</span>
                   strata <span class="op">=</span> <span class="cn">NULL</span> <span class="co"># sampling was simple (no strata)</span>
                  <span class="op">)</span>
<span class="co">## stratified ------------------------------------------------------------------</span>
<span class="va">survey_design_strata</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span>
  <span class="fu">as_survey_design</span><span class="op">(</span>ids <span class="op">=</span> <span class="fl">1</span>, <span class="co"># 1 for no cluster ids</span>
                   weights <span class="op">=</span> <span class="va">surv_weight_strata</span>, <span class="co"># weight variable created above</span>
                   strata <span class="op">=</span> <span class="va">health_district</span> <span class="co"># sampling was stratified by district</span>
                  <span class="op">)</span>
<span class="co">## cluster ---------------------------------------------------------------------</span>
<span class="va">survey_design_cluster</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span>
  <span class="fu">as_survey_design</span><span class="op">(</span>ids <span class="op">=</span> <span class="va">village_name</span>, <span class="co"># cluster ids</span>
                   weights <span class="op">=</span> <span class="va">surv_weight_cluster</span>, <span class="co"># weight variable created above</span>
                   strata <span class="op">=</span> <span class="cn">NULL</span> <span class="co"># sampling was simple (no strata)</span>
                  <span class="op">)</span>

<span class="co">## stratified cluster ----------------------------------------------------------</span>
<span class="va">survey_design</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span>
  <span class="fu">as_survey_design</span><span class="op">(</span>ids <span class="op">=</span> <span class="va">village_name</span>, <span class="co"># cluster ids</span>
                   weights <span class="op">=</span> <span class="va">surv_weight_cluster_strata</span>, <span class="co"># weight variable created above</span>
                   strata <span class="op">=</span> <span class="va">health_district</span> <span class="co"># sampling was stratified by district</span>
                  <span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="descriptive-analysis-2" class="section level2" number="25.13">
<h2>
<span class="header-section-number">25.13</span> Análisis descriptivo<a class="anchor" aria-label="anchor" href="#descriptive-analysis-2"><i class="fas fa-link"></i></a>
</h2>
<p>El análisis descriptivo básico y la visualización se tratan extensamente en otros capítulos del manual, por lo que no nos detendremos en ellos aquí. Para más detalles, consulta los capítulos sobre <a href="descriptive-tables.html#descriptive-tables">tablas descriptivas</a>, <a href="simple-statistical-tests.html#simple-statistical-tests">pruebas estadísticas</a>, <a href="tables-for-presentation.html#tables-for-presentation">tablas para presentaciones</a>, <a href="ggplot-basics.html#ggplot-basics">conceptos básicos de ggplot</a> e <a href="reports-with-r-markdown.html#reports-with-r-markdown">informes con R markdown</a>.</p>
<p>En este apartado nos centraremos en cómo investigar el sesgo de la muestra y visualizarlo. También veremos cómo visualizar el flujo de la población en un entorno de encuesta utilizando diagramas aluviales/sankey.</p>
<p>En general, debes considerar incluir los siguientes análisis descriptivos:</p>
<ul>
<li>Número final de agrupaciones, hogares e individuos incluidos</li>
<li>Número de personas excluidas y motivos de la exclusión</li>
<li>Mediana (rango) del número de hogares por grupo y de individuos por hogar</li>
</ul>
<div id="sesgo-de-muestreo" class="section level3 unnumbered">
<h3>Sesgo de muestreo<a class="anchor" aria-label="anchor" href="#sesgo-de-muestreo"><i class="fas fa-link"></i></a>
</h3>
<p>Compara las proporciones de cada grupo de edad entre tu muestra y la población de origen. Esto es importante para poder resaltar el posible sesgo de muestreo. También puedes repetir esta operación para ver las distribuciones por sexo.</p>
<p>Ten en cuenta que estos valores-p son sólo indicativos, y que una discusión descriptiva (o la visualización con las pirámides de edad que aparecen a continuación) de las distribuciones en tu muestra de estudio en comparación con la población de origen es más importante que la prueba binomial en sí. Esto se debe a que el aumento del tamaño de la muestra suele dar lugar a diferencias que pueden ser irrelevantes después de ponderar los datos.</p>
<div class="sourceCode" id="cb1259"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## counts and props of the study population</span>
<span class="va">ag</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">drop_na</span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tally</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>proportion <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, 
         n_total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>

<span class="co">## counts and props of the source population</span>
<span class="va">propcount</span> <span class="op">&lt;-</span> <span class="va">population</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">tally</span><span class="op">(</span><span class="va">population</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>proportion <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>

<span class="co">## bind together the columns of two tables, group by age, and perform a </span>
<span class="co">## binomial test to see if n/total is significantly different from population</span>
<span class="co">## proportion.</span>
  <span class="co">## suffix here adds to text to the end of columns in each of the two datasets</span>
<span class="fu">left_join</span><span class="op">(</span><span class="va">ag</span>, <span class="va">propcount</span>, by <span class="op">=</span> <span class="st">"age_group"</span>, suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"_pop"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co">## broom::tidy(binom.test()) makes a data frame out of the binomial test and</span>
  <span class="co">## will add the variables p.value, parameter, conf.low, conf.high, method, and</span>
  <span class="co">## alternative. We will only use p.value here. You can include other</span>
  <span class="co">## columns if you want to report confidence intervals</span>
  <span class="fu">mutate</span><span class="op">(</span>binom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/binom.test.html">binom.test</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">n_total</span>, <span class="va">proportion_pop</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">unnest</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">binom</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># important for expanding the binom.test data frame</span>
  <span class="fu">mutate</span><span class="op">(</span>proportion_pop <span class="op">=</span> <span class="va">proportion_pop</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co">## Adjusting the p-values to correct for false positives </span>
  <span class="co">## (because testing multiple age groups). This will only make </span>
  <span class="co">## a difference if you have many age categories</span>
  <span class="fu">mutate</span><span class="op">(</span>p.value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust</a></span><span class="op">(</span><span class="va">p.value</span>, method <span class="op">=</span> <span class="st">"holm"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
                      
  <span class="co">## Only show p-values over 0.001 (those under report as &lt;0.001)</span>
  <span class="fu">mutate</span><span class="op">(</span>p.value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">p.value</span> <span class="op">&lt;</span> <span class="fl">0.001</span>, 
                          <span class="st">"&lt;0.001"</span>, 
                          <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">p.value</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
  <span class="co">## rename the columns appropriately</span>
  <span class="fu">select</span><span class="op">(</span>
    <span class="st">"Age group"</span> <span class="op">=</span> <span class="va">age_group</span>,
    <span class="st">"Study population (n)"</span> <span class="op">=</span> <span class="va">n</span>,
    <span class="st">"Study population (%)"</span> <span class="op">=</span> <span class="va">proportion</span>,
    <span class="st">"Source population (n)"</span> <span class="op">=</span> <span class="va">n_pop</span>,
    <span class="st">"Source population (%)"</span> <span class="op">=</span> <span class="va">proportion_pop</span>,
    <span class="st">"P-value"</span> <span class="op">=</span> <span class="va">p.value</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 6
## # Groups:   Age group [5]
##   `Age group` Study population (~1 Study~2 Sourc~3 Sourc~4 P-val~5
##   &lt;chr&gt;                      &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;  
## 1 0-2                           12  0.0256    1360     6.8 &lt;0.001 
## 2 3-14                          42  0.0896    7244    36.2 &lt;0.001 
## 3 15-29                         64  0.136     5520    27.6 &lt;0.001 
## 4 30-44                         52  0.111     3232    16.2 0.002  
## 5 45+                          299  0.638     2644    13.2 &lt;0.001 
## # ... with abbreviated variable names 1: `Study population (n)`,
## #   2: `Study population (%)`, 3: `Source population (n)`,
## #   4: `Source population (%)`, 5: `P-value`</code></pre>
</div>
<div id="pirámides-demográficas" class="section level3 unnumbered">
<h3>Pirámides demográficas<a class="anchor" aria-label="anchor" href="#pir%C3%A1mides-demogr%C3%A1ficas"><i class="fas fa-link"></i></a>
</h3>
<p>Las pirámides demográficas (o de edad y sexo) son una forma sencilla de visualizar la distribución de la población de la encuesta. También vale la pena considerar la creación de <a href="descriptive-tables.html#descriptive-tables">tablas descriptivas</a> de edad y sexo por estratos de la encuesta. Demostraremos el uso del paquete <strong>apyramid</strong>, ya que permite las proporciones ponderadas utilizando nuestro objeto de diseño de la encuesta creado anteriormente. Otras opciones para crear <a href="demographic-pyramids-and-likert-scales.html#demographic-pyramids-and-likert-scales">pirámides demográficas</a> se tratan ampliamente en ese capítulo del manual. También utilizaremos una función envolvente de <strong>sitrep</strong> llamada <code>plot_age_pyramid()</code> que ahorra algunas líneas de codificación para producir un gráfico con proporciones.</p>
<p>Al igual que con el test binomial formal de la diferencia, vista anteriormente en la sección de sesgo de muestreo, aquí estamos interesados en visualizar si nuestra población muestreada es sustancialmente diferente de la población de origen y si la ponderación corrige esta diferencia. Para ello, utilizaremos el paquete <strong>patchwork</strong> para mostrar nuestras visualizaciones <strong>ggplot</strong> una al lado de la otra; para más detalles, consulta la sección sobre la combinación de gráficos en el capítulo de <a href="ggplot-tips.html#combine-plots">consejos de ggplot</a> del manual. Visualizaremos nuestra población de origen, nuestra población de encuesta no ponderada y nuestra población de encuesta ponderada. También puedes considerar la posibilidad de visualizar por cada estrato de tu encuesta - en nuestro ejemplo aquí sería utilizando el argumento <code>stack_by = "health_district"</code> (ver <code>?plot_age_pyramid</code> para más detalles).</p>
<p><span style="color: black;"><strong><em>NOTA:</em></strong> Los ejes-x e y están invertidos en las pirámides</span></p>
<div class="sourceCode" id="cb1261"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## define x-axis limits and labels ---------------------------------------------</span>
<span class="co">## (update these numbers to be the values for your graph)</span>
<span class="va">max_prop</span> <span class="op">&lt;-</span> <span class="fl">35</span>      <span class="co"># choose the highest proportion you want to show </span>
<span class="va">step</span> <span class="op">&lt;-</span> <span class="fl">5</span>           <span class="co"># choose the space you want beween labels </span>

<span class="co">## this part defines vector using the above numbers with axis breaks</span>
<span class="va">breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">max_prop</span><span class="op">/</span><span class="fl">100</span> <span class="op">*</span> <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span> <span class="op">-</span> <span class="va">step</span><span class="op">/</span><span class="fl">100</span>, <span class="va">step</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span>, 
    <span class="fl">0</span>, 
    <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span> <span class="op">+</span> <span class="va">step</span> <span class="op">/</span> <span class="fl">100</span>, <span class="va">max_prop</span><span class="op">/</span><span class="fl">100</span>, <span class="va">step</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span>
    <span class="op">)</span>

<span class="co">## this part defines vector using the above numbers with axis limits</span>
<span class="va">limits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">max_prop</span><span class="op">/</span><span class="fl">100</span> <span class="op">*</span> <span class="op">-</span><span class="fl">1</span>, <span class="va">max_prop</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span>

<span class="co">## this part defines vector using the above numbers with axis labels</span>
<span class="va">labels</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">max_prop</span>, <span class="va">step</span>, <span class="op">-</span><span class="va">step</span><span class="op">)</span>, 
      <span class="fl">0</span>, 
      <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">step</span>, <span class="va">max_prop</span>, <span class="va">step</span><span class="op">)</span>
    <span class="op">)</span>


<span class="co">## create plots individually  --------------------------------------------------</span>

<span class="co">## plot the source population </span>
<span class="co">## nb: this needs to be collapsed for the overall population (i.e. removing health districts)</span>
<span class="va">source_population</span> <span class="op">&lt;-</span> <span class="va">population</span> <span class="op">%&gt;%</span>
  <span class="co">## ensure that age and sex are factors</span>
  <span class="fu">mutate</span><span class="op">(</span>age_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">age_group</span>, 
                            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0-2"</span>, 
                                       <span class="st">"3-14"</span>, 
                                       <span class="st">"15-29"</span>,
                                       <span class="st">"30-44"</span>, 
                                       <span class="st">"45+"</span><span class="op">)</span><span class="op">)</span>, 
         sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">age_group</span>, <span class="va">sex</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co">## add the counts for each health district together </span>
  <span class="fu">summarise</span><span class="op">(</span>population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co">## remove the grouping so can calculate overall proportion</span>
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>proportion <span class="op">=</span> <span class="va">population</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co">## plot pyramid </span>
  <span class="fu"><a href="https://r4epi.github.io/sitrep/reference/apyramid.html">age_pyramid</a></span><span class="op">(</span>
            age_group <span class="op">=</span> <span class="va">age_group</span>, 
            split_by <span class="op">=</span> <span class="va">sex</span>, 
            count <span class="op">=</span> <span class="va">proportion</span>, 
            proportional <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
  <span class="co">## only show the y axis label (otherwise repeated in all three plots)</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Source population"</span>, 
       y <span class="op">=</span> <span class="st">""</span>, 
       x <span class="op">=</span> <span class="st">"Age group (years)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="co">## make the x axis the same for all plots </span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">breaks</span>, 
    limits <span class="op">=</span> <span class="va">limits</span>, 
    labels <span class="op">=</span> <span class="va">labels</span><span class="op">)</span>
  
  
<span class="co">## plot the unweighted sample population </span>
<span class="va">sample_population</span> <span class="op">&lt;-</span> <span class="fu">apyramid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/apyramid/man/age_pyramid.html">age_pyramid</a></span><span class="op">(</span><span class="va">survey_data</span>, <span class="co">#jfmont</span>
                 age_group <span class="op">=</span> <span class="st">"age_group"</span>, 
                 split_by <span class="op">=</span> <span class="st">"sex"</span>,
                 proportion <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> 
  <span class="co">## only show the x axis label (otherwise repeated in all three plots)</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Unweighted sample population"</span>, 
       y <span class="op">=</span> <span class="st">"Proportion (%)"</span>, 
       x <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span> 
  <span class="co">## make the x axis the same for all plots </span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">breaks</span>, 
    limits <span class="op">=</span> <span class="va">limits</span>, 
    labels <span class="op">=</span> <span class="va">labels</span><span class="op">)</span>


<span class="co">## plot the weighted sample population </span>
<span class="va">weighted_population</span> <span class="op">&lt;-</span> <span class="va">survey_design</span> <span class="op">%&gt;%</span> 
  <span class="co">## make sure the variables are factors</span>
  <span class="fu">mutate</span><span class="op">(</span>age_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">age_group</span><span class="op">)</span>, 
         sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">apyramid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/apyramid/man/age_pyramid.html">age_pyramid</a></span><span class="op">(</span> <span class="co">#jfmont</span>
    age_group <span class="op">=</span> <span class="st">"age_group"</span>,
    split_by <span class="op">=</span> <span class="st">"sex"</span>, 
    proportion <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
  <span class="co">## only show the x axis label (otherwise repeated in all three plots)</span>
  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Weighted sample population"</span>, 
       y <span class="op">=</span> <span class="st">""</span>, 
       x <span class="op">=</span> <span class="st">""</span><span class="op">)</span>  <span class="op">+</span> 
  <span class="co">## make the x axis the same for all plots </span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">breaks</span>, 
    limits <span class="op">=</span> <span class="va">limits</span>, 
    labels <span class="op">=</span> <span class="va">labels</span><span class="op">)</span>

<span class="co">## combine all three plots  ----------------------------------------------------</span>
<span class="co">## combine three plots next to eachother using + </span>
<span class="va">source_population</span> <span class="op">+</span> <span class="va">sample_population</span> <span class="op">+</span> <span class="va">weighted_population</span> <span class="op">+</span> 
  <span class="co">## only show one legend and define theme </span>
  <span class="co">## note the use of &amp; for combining theme with plot_layout()</span>
  <span class="fu">plot_layout</span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span> <span class="op">&amp;</span> 
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,                    <span class="co"># move legend to bottom</span>
        legend.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,                <span class="co"># remove title</span>
        text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span>,                <span class="co"># change text size</span>
        axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span>, vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># turn x-axis text</span>
       <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/weighted_age_pyramid-1.png" width="1440"></div>
</div>
<div id="diagrama-aluvialsankey" class="section level3 unnumbered">
<h3>Diagrama aluvial/sankey<a class="anchor" aria-label="anchor" href="#diagrama-aluvialsankey"><i class="fas fa-link"></i></a>
</h3>
<p>Visualizar los puntos de partida y los resultados de los individuos puede ser muy útil para obtener una visión general. Su aplicación es bastante obvia en el caso de las poblaciones móviles, pero hay muchas otras aplicaciones, como las cohortes o cualquier otra situación en la que haya transiciones de estados para los individuos. Estos diagramas tienen varios nombres diferentes, como diagramas aluviales, de sankey y paralelos; los detalles se encuentran en el capítulo del manual sobre <a href="diagrams-and-charts.html#alluvialsankey-diagrams">diagramas y gráficos</a>.</p>
<div class="sourceCode" id="cb1262"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## summarize data</span>
<span class="va">flow_table</span> <span class="op">&lt;-</span> <span class="va">survey_data</span> <span class="op">%&gt;%</span>
  <span class="fu">count</span><span class="op">(</span><span class="va">startcause</span>, <span class="va">endcause</span>, <span class="va">sex</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># get counts </span>
  <span class="fu">gather_set_data</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"startcause"</span>, <span class="st">"endcause"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>     <span class="co"># change format for plotting</span>
  <span class="fu">mutate</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"startcause"</span>, <span class="st">"endcause"</span><span class="op">)</span><span class="op">)</span>,  <span class="co"># set startcause as first level</span>
         x <span class="op">=</span> <span class="fu">fct_recode</span><span class="op">(</span><span class="va">x</span>, 
                        <span class="st">"Start \n cause"</span> <span class="op">=</span> <span class="st">"startcause"</span>,   <span class="co"># add line break (\n) after start</span>
                        <span class="st">"End \n cause"</span>   <span class="op">=</span> <span class="st">"endcause"</span><span class="op">)</span>
        <span class="op">)</span>


<span class="co">## plot your dataset </span>
  <span class="co">## on the x axis is the start and end causes</span>
  <span class="co">## gather_set_data generates an ID for each possible combination</span>
  <span class="co">## splitting by y gives the possible start/end combos</span>
  <span class="co">## value as n gives it as counts (could also be changed to proportion)</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">flow_table</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">x</span>, id <span class="op">=</span> <span class="va">id</span>, split <span class="op">=</span> <span class="va">y</span>, value <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="co">## colour lines by sex </span>
  <span class="fu">geom_parallel_sets</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">sex</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, axis.width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="co">## fill in the label boxes grey</span>
  <span class="fu">geom_parallel_sets_axes</span><span class="op">(</span>axis.width <span class="op">=</span> <span class="fl">0.15</span>, fill <span class="op">=</span> <span class="st">"grey80"</span>, color <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span> <span class="op">+</span>
  <span class="co">## change text colour and angle (needs to be adjusted)</span>
  <span class="fu">geom_parallel_sets_labels</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, angle <span class="op">=</span> <span class="fl">0</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span>
  <span class="co">## adjusted y and x axes (probably needs more vertical space)</span>
  <span class="fu">scale_x_discrete</span><span class="op">(</span>name <span class="op">=</span> <span class="cn">NULL</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="co">## remove axis labels</span>
  <span class="fu">theme</span><span class="op">(</span>
    title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">26</span><span class="op">)</span>,
    text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">26</span><span class="op">)</span>,
    axis.line <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
    axis.ticks <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
    axis.text.y <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
    panel.background <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,
    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,                    <span class="co"># move legend to bottom</span>
    legend.title <span class="op">=</span> <span class="fu">element_blank</span><span class="op">(</span><span class="op">)</span>,                <span class="co"># remove title</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/visualise_population_flow-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
</div>
<div id="weighted-proportions" class="section level2" number="25.14">
<h2>
<span class="header-section-number">25.14</span> Proporciones ponderadas<a class="anchor" aria-label="anchor" href="#weighted-proportions"><i class="fas fa-link"></i></a>
</h2>
<p>Esta sección detallará cómo producir tablas para recuentos y proporciones ponderadas, con los intervalos de confianza asociados y el efecto del diseño. Hay cuatro opciones diferentes que utilizan funciones de los siguientes paquetes: <strong>survey</strong>, <strong>srvyr</strong>, <strong>sitrep</strong> y <strong>gtsummary</strong>. Para una codificación mínima que produzca una tabla de estilo epidemiológico estándar, recomendaríamos la función sitrep - que es una envoltura para el código <strong>srvyr</strong>; Ten en cuenta, sin embargo, que esto no está todavía en CRAN y puede cambiar en el futuro. Por lo demás, es probable que el código de <strong>survey</strong> sea el más estable a largo plazo, mientras que <strong>srvyr</strong> se adaptará mejor a los flujos de trabajo de tidyverse. Aunque las funciones de <strong>gtsummary</strong> tienen mucho potencial, parecen ser experimentales e incompletas en el momento de escribir este artículo.</p>
<div id="paquete-survey-1" class="section level3 unnumbered">
<h3>Paquete <strong>survey</strong><a class="anchor" aria-label="anchor" href="#paquete-survey-1"><i class="fas fa-link"></i></a>
</h3>
<p>Podemos utilizar la función <code>svyciprop()</code> de <strong>survey</strong> para obtener las proporciones ponderadas y los correspondientes intervalos de confianza del 95%. Se puede extraer un efecto de diseño apropiado utilizando la función <code>svymean()</code> en lugar de <code>svyprop()</code>. Cabe señalar que <code>svyprop()</code> sólo parece aceptar variables entre 0 y 1 (o TRUE/FALSE), por lo que las variables categóricas no funcionarán.</p>
<p><span style="color: black;"><strong><em>NOTA:</em></strong> Las funciones de <strong>survey</strong> también aceptan objetos de diseño <strong>srvyr</strong>, pero aquí hemos utilizado el objeto de diseño de <strong>survey</strong> sólo por coherencia</span></p>
<div class="sourceCode" id="cb1263"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## produce weighted counts </span>
<span class="fu">svytable</span><span class="op">(</span><span class="op">~</span><span class="va">died</span>, <span class="va">base_survey_design</span><span class="op">)</span></code></pre></div>
<pre><code>## died
##      FALSE       TRUE 
## 1406244.43   76213.01</code></pre>
<div class="sourceCode" id="cb1265"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## produce weighted proportions</span>
<span class="fu">svyciprop</span><span class="op">(</span><span class="op">~</span><span class="va">died</span>, <span class="va">base_survey_design</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<pre><code>##               2.5% 97.5%
## died 0.0514 0.0208  0.12</code></pre>
<div class="sourceCode" id="cb1267"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## get the design effect </span>
<span class="fu">svymean</span><span class="op">(</span><span class="op">~</span><span class="va">died</span>, <span class="va">base_survey_design</span>, na.rm <span class="op">=</span> <span class="cn">T</span>, deff <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">deff</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## diedFALSE  diedTRUE 
##  3.755508  3.755508</code></pre>
<p>Podemos combinar las funciones de <strong>survey</strong> mostradas arriba en una función que definimos nosotros mismos a continuación, llamada <code>svy_prop</code>; y podemos entonces usar esa función junto con <code>map()</code> del paquete purrr para iterar sobre varias variables y crear una tabla. Consulta el capítulo de <a href="iteration-loops-and-lists.html#iteration-loops-and-lists">iteración</a> del manual para obtener más detalles sobre <strong>purrr</strong>.</p>
<div class="sourceCode" id="cb1269"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Define function to calculate weighted counts, proportions, CI and design effect</span>
<span class="co"># x is the variable in quotation marks </span>
<span class="co"># design is your survey design object</span>

<span class="va">svy_prop</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">design</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="co">## put the variable of interest in a formula </span>
  <span class="va">form</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span> <span class="st">"~"</span> , <span class="va">x</span><span class="op">)</span><span class="op">)</span>
  <span class="co">## only keep the TRUE column of counts from svytable</span>
  <span class="va">weighted_counts</span> <span class="op">&lt;-</span> <span class="fu">svytable</span><span class="op">(</span><span class="va">form</span>, <span class="va">design</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>
  <span class="co">## calculate proportions (multiply by 100 to get percentages)</span>
  <span class="va">weighted_props</span> <span class="op">&lt;-</span> <span class="fu">svyciprop</span><span class="op">(</span><span class="va">form</span>, <span class="va">design</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>
  <span class="co">## extract the confidence intervals and multiply to get percentages</span>
  <span class="va">weighted_confint</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">weighted_props</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>
  <span class="co">## use svymean to calculate design effect and only keep the TRUE column</span>
  <span class="va">design_eff</span> <span class="op">&lt;-</span> <span class="fu">deff</span><span class="op">(</span><span class="fu">svymean</span><span class="op">(</span><span class="va">form</span>, <span class="va">design</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, deff <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="cn">TRUE</span><span class="op">]</span><span class="op">]</span>
  
  <span class="co">## combine in to one data frame</span>
  <span class="va">full_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>
    <span class="st">"Variable"</span>        <span class="op">=</span> <span class="va">x</span>,
    <span class="st">"Count"</span>           <span class="op">=</span> <span class="va">weighted_counts</span>,
    <span class="st">"Proportion"</span>      <span class="op">=</span> <span class="va">weighted_props</span>,
    <span class="va">weighted_confint</span>, 
    <span class="st">"Design effect"</span>   <span class="op">=</span> <span class="va">design_eff</span>
    <span class="op">)</span>
  
  <span class="co">## return table as a dataframe</span>
  <span class="va">full_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">full_table</span>, 
             <span class="co">## remove the variable names from rows (is a separate column now)</span>
             row.names <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
  
  <span class="co">## change numerics back to numeric</span>
  <span class="va">full_table</span><span class="op">[</span> , <span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">full_table</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span>
  
  <span class="co">## return dataframe</span>
  <span class="va">full_table</span>
<span class="op">}</span>

<span class="co">## iterate over several variables to create a table </span>
<span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span>
  <span class="co">## define variables of interest</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"died"</span>, <span class="st">"arrived"</span><span class="op">)</span>, 
  <span class="co">## state function using and arguments for that function (design)</span>
  <span class="va">svy_prop</span>, design <span class="op">=</span> <span class="va">base_survey_design</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co">## collapse list in to a single data frame</span>
  <span class="fu">bind_rows</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co">## round </span>
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="va">round</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##   Variable    Count Proportion X2.5. X97.5. Design.effect
## 1     left 701199.1       47.3  39.2   55.5           2.4
## 2     died  76213.0        5.1   2.1   12.1           3.8
## 3  arrived 761799.0       51.4  40.9   61.7           3.9</code></pre>
</div>
<div id="paquete-srvyr-1" class="section level3 unnumbered">
<h3>Paquete <strong>Srvyr</strong><a class="anchor" aria-label="anchor" href="#paquete-srvyr-1"><i class="fas fa-link"></i></a>
</h3>
<p>Con <strong>srvyr</strong> podemos utilizar la sintaxis de <strong>dplyr</strong> para crear una tabla. Observa que se utiliza la función <code>survey_mean()</code> y se especifica el argumento de la proporción, y también que se utiliza la misma función para calcular el efecto del diseño. Esto se debe a que <strong>srvyr</strong> envuelve las dos funciones del paquete <strong>survey</strong>, <code>svyciprop()</code> y <code>svymean()</code>, que se utilizan en la sección anterior.</p>
<p><span style="color: black;"><strong><em>NOTA:</em></strong> Tampoco parece posible obtener proporciones a partir de variables categóricas utilizando <strong>srvyr</strong>, si lo necesitas, consulta la sección siguiente utilizando <strong>sitrep </strong></span></p>
<div class="sourceCode" id="cb1271"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## use the srvyr design object</span>
<span class="va">survey_design</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarise</span><span class="op">(</span>
    <span class="co">## produce the weighted counts </span>
    counts <span class="op">=</span> <span class="fu">survey_total</span><span class="op">(</span><span class="va">died</span><span class="op">)</span>, 
    <span class="co">## produce weighted proportions and confidence intervals </span>
    <span class="co">## multiply by 100 to get a percentage </span>
    props <span class="op">=</span> <span class="fu">survey_mean</span><span class="op">(</span><span class="va">died</span>, 
                        proportion <span class="op">=</span> <span class="cn">TRUE</span>, 
                        vartype <span class="op">=</span> <span class="st">"ci"</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, 
    <span class="co">## produce the design effect </span>
    deff <span class="op">=</span> <span class="fu">survey_mean</span><span class="op">(</span><span class="va">died</span>, deff <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co">## only keep the rows of interest</span>
  <span class="co">## (drop standard errors and repeat proportion calculation)</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">counts</span>, <span class="va">props</span>, <span class="va">props_low</span>, <span class="va">props_upp</span>, <span class="va">deff_deff</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   counts props props_low props_upp deff_deff
##    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 76213.  5.14      2.08      12.1      3.76</code></pre>
<p>Aquí también podríamos escribir una función para iterar sobre múltiples variables utilizando el paquete purrr. Consulta el capítulo de <a href="iteration-loops-and-lists.html#iteration-loops-and-lists">iteración</a> del manual para obtener más detalles sobre <strong>purrr</strong>.</p>
<div class="sourceCode" id="cb1273"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Define function to calculate weighted counts, proportions, CI and design effect</span>
<span class="co"># design is your survey design object</span>
<span class="co"># x is the variable in quotation marks </span>


<span class="va">srvyr_prop</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">design</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="fu">summarise</span><span class="op">(</span>
    <span class="co">## using the survey design object</span>
    <span class="va">design</span>, 
    <span class="co">## produce the weighted counts </span>
    counts <span class="op">=</span> <span class="fu">survey_total</span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, 
    <span class="co">## produce weighted proportions and confidence intervals </span>
    <span class="co">## multiply by 100 to get a percentage </span>
    props <span class="op">=</span> <span class="fu">survey_mean</span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, 
                        proportion <span class="op">=</span> <span class="cn">TRUE</span>, 
                        vartype <span class="op">=</span> <span class="st">"ci"</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, 
    <span class="co">## produce the design effect </span>
    deff <span class="op">=</span> <span class="fu">survey_mean</span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, deff <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co">## add in the variable name</span>
  <span class="fu">mutate</span><span class="op">(</span>variable <span class="op">=</span> <span class="va">x</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co">## only keep the rows of interest</span>
  <span class="co">## (drop standard errors and repeat proportion calculation)</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">variable</span>, <span class="va">counts</span>, <span class="va">props</span>, <span class="va">props_low</span>, <span class="va">props_upp</span>, <span class="va">deff_deff</span><span class="op">)</span>
  
<span class="op">}</span>
  

<span class="co">## iterate over several variables to create a table </span>
<span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span>
  <span class="co">## define variables of interest</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"died"</span>, <span class="st">"arrived"</span><span class="op">)</span>, 
  <span class="co">## state function using and arguments for that function (design)</span>
  <span class="op">~</span><span class="fu">srvyr_prop</span><span class="op">(</span><span class="va">.x</span>, design <span class="op">=</span> <span class="va">survey_design</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="co">## collapse list in to a single data frame</span>
  <span class="fu">bind_rows</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 6
##   variable  counts props props_low props_upp deff_deff
##   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 left     701199. 47.3      39.2       55.5      2.38
## 2 died      76213.  5.14      2.08      12.1      3.76
## 3 arrived  761799. 51.4      40.9       61.7      3.93</code></pre>
</div>
<div id="paquete-sitrep" class="section level3 unnumbered">
<h3>Paquete <strong>Sitrep</strong><a class="anchor" aria-label="anchor" href="#paquete-sitrep"><i class="fas fa-link"></i></a>
</h3>
<p>La función <code><a href="https://r4epi.github.io/sitrep/reference/tab_linelist.html">tab_survey()</a></code> de <strong>sitrep</strong> es una envoltura para <strong>srvyr</strong>, que permite crear tablas ponderadas con una codificación mínima. También permite calcular proporciones ponderadas para variables categóricas.</p>
<div class="sourceCode" id="cb1275"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## using the survey design object</span>
<span class="va">survey_design</span> <span class="op">%&gt;%</span> 
  <span class="co">## pass the names of variables of interest unquoted</span>
  <span class="fu"><a href="https://r4epi.github.io/sitrep/reference/tab_linelist.html">tab_survey</a></span><span class="op">(</span><span class="va">arrived</span>, <span class="va">left</span>, <span class="va">died</span>, <span class="va">education_level</span>,
             deff <span class="op">=</span> <span class="cn">TRUE</span>,   <span class="co"># calculate the design effect</span>
             pretty <span class="op">=</span> <span class="cn">TRUE</span>  <span class="co"># merge the proportion and 95%CI</span>
             <span class="op">)</span></code></pre></div>
<pre><code>## Warning: removing 257 missing value(s) from `education_level`</code></pre>
<pre><code>## # A tibble: 9 x 5
##   variable        value            n  deff ci                
##   &lt;chr&gt;           &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;             
## 1 arrived         TRUE       761799.  3.93 51.4% (40.9--61.7)
## 2 arrived         FALSE      720658.  3.93 48.6% (38.3--59.1)
## 3 left            TRUE       701199.  2.38 47.3% (39.2--55.5)
## 4 left            FALSE      781258.  2.38 52.7% (44.5--60.8)
## 5 died            TRUE        76213.  3.76 5.1% (2.1--12.1)  
## 6 died            FALSE     1406244.  3.76 94.9% (87.9--97.9)
## 7 education_level higher     171644.  4.70 42.4% (26.9--59.7)
## 8 education_level primary    102609.  2.37 25.4% (16.2--37.3)
## 9 education_level secondary  130201.  6.68 32.2% (16.5--53.3)</code></pre>
</div>
<div id="paquete-gtsummary" class="section level3 unnumbered">
<h3>Paquete <strong>Gtsummary</strong><a class="anchor" aria-label="anchor" href="#paquete-gtsummary"><i class="fas fa-link"></i></a>
</h3>
<p>Con <strong>gtsummary</strong> no parece haber todavía funciones incorporadas para añadir intervalos de confianza o efecto de diseño. Aquí mostramos cómo definir una función para añadir intervalos de confianza y luego añadir intervalos de confianza a una tabla gtsummary creada con la función <code>tbl_svysummary()</code>.</p>
<div class="sourceCode" id="cb1278"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">confidence_intervals</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">variable</span>, <span class="va">by</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="co">## extract the confidence intervals and multiply to get percentages</span>
  <span class="va">props</span> <span class="op">&lt;-</span> <span class="fu">svyciprop</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span> <span class="st">"~"</span> , <span class="va">variable</span><span class="op">)</span><span class="op">)</span>,
              <span class="va">data</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  
  <span class="co">## extract the confidence intervals </span>
  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">props</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">## make numeric and multiply for percentage</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">.</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>           <span class="co">## round to one digit</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span>                           <span class="co">## extract the numbers from matrix</span>
    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">.</span>, collapse <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span>          <span class="co">## combine to single character</span>
<span class="op">}</span>

<span class="co">## using the survey package design object</span>
<span class="fu">tbl_svysummary</span><span class="op">(</span><span class="va">base_survey_design</span>, 
               include <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">arrived</span>, <span class="va">left</span>, <span class="va">died</span><span class="op">)</span>,   <span class="co">## define variables want to include</span>
               statistic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"{n} ({p}%)"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">## define stats of interest</span>
  <span class="fu">add_n</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co">## add the weighted total </span>
  <span class="fu">add_stat</span><span class="op">(</span>fns <span class="op">=</span> <span class="fu">everything</span><span class="op">(</span><span class="op">)</span> <span class="op">~</span> <span class="va">confidence_intervals</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co">## add CIs</span>
  <span class="co">## modify the column headers</span>
  <span class="fu">modify_header</span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      <span class="va">n</span> <span class="op">~</span> <span class="st">"**Weighted total (N)**"</span>,
      <span class="va">stat_0</span> <span class="op">~</span> <span class="st">"**Weighted Count**"</span>,
      <span class="va">add_stat_1</span> <span class="op">~</span> <span class="st">"**95%CI**"</span>
    <span class="op">)</span>
    <span class="op">)</span></code></pre></div>
<pre><code>## ! Use of `vars()` is now deprecated and support will soon be removed. Please replace calls to `vars()` with `c()`.
## ! Use of `vars()` is now deprecated and support will soon be removed. Please replace calls to `vars()` with `c()`.</code></pre>
<pre><code>## Warning: Since gt v0.6.0 the `fmt_missing()` function is deprecated and
## will soon be removed.
## * Use the `sub_missing()` function instead.</code></pre>
<div id="ojfiojqohb" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ojfiojqohb .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ojfiojqohb .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ojfiojqohb .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ojfiojqohb .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ojfiojqohb .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ojfiojqohb .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ojfiojqohb .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ojfiojqohb .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ojfiojqohb .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ojfiojqohb .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ojfiojqohb .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ojfiojqohb .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#ojfiojqohb .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ojfiojqohb .gt_from_md > :first-child {
  margin-top: 0;
}

#ojfiojqohb .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ojfiojqohb .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ojfiojqohb .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ojfiojqohb .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ojfiojqohb .gt_row_group_first td {
  border-top-width: 2px;
}

#ojfiojqohb .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ojfiojqohb .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ojfiojqohb .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ojfiojqohb .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ojfiojqohb .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ojfiojqohb .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ojfiojqohb .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ojfiojqohb .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ojfiojqohb .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ojfiojqohb .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ojfiojqohb .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ojfiojqohb .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ojfiojqohb .gt_left {
  text-align: left;
}

#ojfiojqohb .gt_center {
  text-align: center;
}

#ojfiojqohb .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ojfiojqohb .gt_font_normal {
  font-weight: normal;
}

#ojfiojqohb .gt_font_bold {
  font-weight: bold;
}

#ojfiojqohb .gt_font_italic {
  font-style: italic;
}

#ojfiojqohb .gt_super {
  font-size: 65%;
}

#ojfiojqohb .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#ojfiojqohb .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ojfiojqohb .gt_indent_1 {
  text-indent: 5px;
}

#ojfiojqohb .gt_indent_2 {
  text-indent: 10px;
}

#ojfiojqohb .gt_indent_3 {
  text-indent: 15px;
}

#ojfiojqohb .gt_indent_4 {
  text-indent: 20px;
}

#ojfiojqohb .gt_indent_5 {
  text-indent: 25px;
}
</style>
<div class="inline-table"><table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col"><strong>Weighted total (N)</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col">
<strong>Weighted Count</strong><sup class="gt_footnote_marks">1</sup>
</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col"><strong>95%CI</strong></th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_left">arrived</td>
<td class="gt_row gt_center">1,482,457</td>
<td class="gt_row gt_center">761,799 (51%)</td>
<td class="gt_row gt_center">40.9-61.7</td>
</tr>
<tr>
<td class="gt_row gt_left">left</td>
<td class="gt_row gt_center">1,482,457</td>
<td class="gt_row gt_center">701,199 (47%)</td>
<td class="gt_row gt_center">39.2-55.5</td>
</tr>
<tr>
<td class="gt_row gt_left">died</td>
<td class="gt_row gt_center">1,482,457</td>
<td class="gt_row gt_center">76,213 (5.1%)</td>
<td class="gt_row gt_center">2.1-12.1</td>
</tr>
</tbody>
<tfoot class="gt_footnotes"><tr>
<td class="gt_footnote" colspan="4">
<sup class="gt_footnote_marks">1</sup> n (%)</td>
    </tr></tfoot>
</table></div>
</div>
<!-- ======================================================= -->
</div>
</div>
<div id="weighted-ratios" class="section level2" number="25.15">
<h2>
<span class="header-section-number">25.15</span> Razones ponderadas<a class="anchor" aria-label="anchor" href="#weighted-ratios"><i class="fas fa-link"></i></a>
</h2>
<p>Del mismo modo, para los ratios ponderados (como los ratios de mortalidad) puedes utilizar el paquete <strong>survey</strong> o <strong>srvyr</strong>. También se pueden escribir funciones (similares a las anteriores) para iterar sobre varias variables. También se podría crear una función para <strong>gtsummary</strong> como la anterior, pero actualmente no tiene una funcionalidad incorporada.</p>
<div id="paquete-survey-2" class="section level3 unnumbered">
<h3>Paquete <strong>survey</strong><a class="anchor" aria-label="anchor" href="#paquete-survey-2"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb1281"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ratio</span> <span class="op">&lt;-</span> <span class="fu">svyratio</span><span class="op">(</span><span class="op">~</span><span class="va">died</span>, 
         denominator <span class="op">=</span> <span class="op">~</span><span class="va">obstime</span>, 
         design <span class="op">=</span> <span class="va">base_survey_design</span><span class="op">)</span>

<span class="va">ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">ratio</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>
  <span class="va">ratio</span><span class="op">$</span><span class="va">ratio</span> <span class="op">*</span> <span class="fl">10000</span>, 
  <span class="va">ci</span> <span class="op">*</span> <span class="fl">10000</span>
<span class="op">)</span></code></pre></div>
<pre><code>##       obstime    2.5 %   97.5 %
## died 5.981922 1.194294 10.76955</code></pre>
</div>
<div id="paquete-srvyr-2" class="section level3 unnumbered">
<h3>Paquete <strong>Srvyr</strong><a class="anchor" aria-label="anchor" href="#paquete-srvyr-2"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb1283"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">survey_design</span> <span class="op">%&gt;%</span> 
  <span class="co">## survey ratio used to account for observation time </span>
  <span class="fu">summarise</span><span class="op">(</span>
    mortality <span class="op">=</span> <span class="fu">survey_ratio</span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">died</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10000</span>, 
      <span class="va">obstime</span>, 
      vartype <span class="op">=</span> <span class="st">"ci"</span><span class="op">)</span>
    <span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   mortality mortality_low mortality_upp
##       &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;
## 1      5.98         0.349          11.6</code></pre>
<!-- ======================================================= -->
</div>
</div>
<div id="resources-18" class="section level2" number="25.16">
<h2>
<span class="header-section-number">25.16</span> Recursos<a class="anchor" aria-label="anchor" href="#resources-18"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://stats.idre.ucla.edu/r/seminars/survey-data-analysis-with-r/">Página de estadísticas de la UCLA</a></p>
<p><a href="http://asdfree.com/">Analizar datos de encuestas gratis</a></p>
<p><a href="http://gdfe.co/srvyr/">srvyr packge</a></p>
<p><a href="http://www.danieldsjoberg.com/gtsummary/reference/index.html">paquete gtsummary</a></p>
<p><a href="https://github.com/EPIET/RapidAssessmentSurveys">Estudios de caso de la encuesta EPIET</a></p>

<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="epidemic-modeling.html"><span class="header-section-number">24</span> Modelización de epidemias</a></div>
<div class="next"><a href="survival-analysis.html"><span class="header-section-number">26</span> Análisis de supervivencia</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>En esta página</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#contact-tracing-1"><span class="header-section-number">25</span> Rastreo de contactos</a></li>
<li>
<a class="nav-link" href="#preparation-16"><span class="header-section-number">25.1</span> Preparation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#cargar-paquetes-15">Cargar paquetes</a></li>
<li><a class="nav-link" href="#importar-datos-13">Importar datos</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#descriptive-analyses"><span class="header-section-number">25.2</span> Análisis descriptivo</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#datos-demogr%C3%A1ficos">Datos demográficos</a></li>
<li><a class="nav-link" href="#contactos-por-caso">Contactos por caso</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#contact-follow-up"><span class="header-section-number">25.3</span> Seguimiento de contactos</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#limpieza-de-datos">Limpieza de datos</a></li>
<li><a class="nav-link" href="#gr%C3%A1fica-en-el-tiempo">Gráfica en el tiempo</a></li>
<li><a class="nav-link" href="#seguimiento-individual-diario">Seguimiento individual diario</a></li>
<li><a class="nav-link" href="#analizar-por-grupos">Analizar por grupos</a></li>
</ul>
</li>
<li><a class="nav-link" href="#kpi-tables"><span class="header-section-number">25.4</span> Tablas KPI</a></li>
<li><a class="nav-link" href="#transmission-matrices"><span class="header-section-number">25.5</span> Matrices de transmisión</a></li>
<li><a class="nav-link" href="#resources-18"><span class="header-section-number">25.6</span> Recursos</a></li>
<li><a class="nav-link" href="#overview-4"><span class="header-section-number">25.7</span> Resumen</a></li>
<li>
<a class="nav-link" href="#preparation-17"><span class="header-section-number">25.8</span> Preparación</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#paquetes-2">Paquetes</a></li>
<li><a class="nav-link" href="#carga-de-datos">Carga de datos</a></li>
<li><a class="nav-link" href="#limpieza-de-datos-1">Limpieza de datos</a></li>
</ul>
</li>
<li><a class="nav-link" href="#survey-data"><span class="header-section-number">25.9</span> Datos de encuestas</a></li>
<li><a class="nav-link" href="#observation-time"><span class="header-section-number">25.10</span> Tiempo de observación</a></li>
<li><a class="nav-link" href="#weighting"><span class="header-section-number">25.11</span> Ponderación</a></li>
<li>
<a class="nav-link" href="#survey-design-objects"><span class="header-section-number">25.12</span> Objetos de diseño de la encuesta</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#paquete-survey">Paquete survey</a></li>
<li><a class="nav-link" href="#paquete-srvyr">Paquete Srvyr</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#descriptive-analysis-2"><span class="header-section-number">25.13</span> Análisis descriptivo</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#sesgo-de-muestreo">Sesgo de muestreo</a></li>
<li><a class="nav-link" href="#pir%C3%A1mides-demogr%C3%A1ficas">Pirámides demográficas</a></li>
<li><a class="nav-link" href="#diagrama-aluvialsankey">Diagrama aluvial/sankey</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#weighted-proportions"><span class="header-section-number">25.14</span> Proporciones ponderadas</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#paquete-survey-1">Paquete survey</a></li>
<li><a class="nav-link" href="#paquete-srvyr-1">Paquete Srvyr</a></li>
<li><a class="nav-link" href="#paquete-sitrep">Paquete Sitrep</a></li>
<li><a class="nav-link" href="#paquete-gtsummary">Paquete Gtsummary</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#weighted-ratios"><span class="header-section-number">25.15</span> Razones ponderadas</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#paquete-survey-2">Paquete survey</a></li>
<li><a class="nav-link" href="#paquete-srvyr-2">Paquete Srvyr</a></li>
</ul>
</li>
<li><a class="nav-link" href="#resources-18"><span class="header-section-number">25.16</span> Recursos</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>EpiRhandbook en español</strong>" fué escrito por el equipo del manual. Compilado el 2022-11-08.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>Este libro fué construido con el paquete <a class="text-light" href="https://bookdown.org">bookdown</a> de R.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
