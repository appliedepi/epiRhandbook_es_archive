<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>27 Borrador. Análisis de supervivencia | El manual de R para la Epidemiología</title>
<meta name="author" content="El equipo del manual">
<meta name="description" content="ADVERTENCIA: Esta traducción es sólo un borrador de la traducción al español. Este documento tal cual está ha sido generado automáticamente con DeepL.com y se han hecho algunas correcciones...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="27 Borrador. Análisis de supervivencia | El manual de R para la Epidemiología">
<meta property="og:type" content="book">
<meta property="og:description" content="ADVERTENCIA: Esta traducción es sólo un borrador de la traducción al español. Este documento tal cual está ha sido generado automáticamente con DeepL.com y se han hecho algunas correcciones...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="27 Borrador. Análisis de supervivencia | El manual de R para la Epidemiología">
<meta name="twitter:description" content="ADVERTENCIA: Esta traducción es sólo un borrador de la traducción al español. Este documento tal cual está ha sido generado automáticamente con DeepL.com y se han hecho algunas correcciones...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.20/datatables.js"></script><link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.7/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.0/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.5.1/plotly-basic-2.5.1.min.js"></script><script src="libs/plotly-cartesian-2.5.1/plotly-cartesian-2.5.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">El manual de R para la Epidemiología</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">Acerca de este libro</li>
<li><a class="" href="editorial-and-technical-notes.html"><span class="header-section-number">1</span> Notas editoriales y técnicas</a></li>
<li><a class="" href="download-handbook-and-data.html"><span class="header-section-number">2</span> Descargando el manual y los datos</a></li>
<li class="book-part">Aspectos básicos</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">3</span> Fundamentos de R</a></li>
<li><a class="" href="transition-to-r.html"><span class="header-section-number">4</span> Transición a R</a></li>
<li><a class="" href="suggested-packages-1.html"><span class="header-section-number">5</span> Paquetes recomendados</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> Proyectos en R</a></li>
<li><a class="" href="import-and-export.html"><span class="header-section-number">7</span> Importación y exportación</a></li>
<li class="book-part">Gestión de datos</li>
<li><a class="" href="cleaning-data-and-core-functions.html"><span class="header-section-number">8</span> Limpieza de datos y funciones básicas</a></li>
<li><a class="" href="working-with-dates.html"><span class="header-section-number">9</span> Borrador. Trabajando con Fechas</a></li>
<li><a class="" href="characters-and-strings.html"><span class="header-section-number">10</span> Borrador. Caracteres y cadenas</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> Borrador. Factores</a></li>
<li><a class="" href="pivoting-data.html"><span class="header-section-number">12</span> Borrador. Pivotar datos</a></li>
<li><a class="" href="grouping-data.html"><span class="header-section-number">13</span> Borrador. Agrupar datos</a></li>
<li><a class="" href="joining-data.html"><span class="header-section-number">14</span> Borrador. Unir datos</a></li>
<li><a class="" href="de-duplication.html"><span class="header-section-number">15</span> Borrador. De-duplicación</a></li>
<li><a class="" href="iteration-loops-and-lists.html"><span class="header-section-number">16</span> Borrador. Iteración, bucles y listas</a></li>
<li class="book-part">Análisis</li>
<li><a class="" href="descriptive-tables.html"><span class="header-section-number">17</span> Borrador. Tablas descriptivas</a></li>
<li><a class="" href="simple-statistical-tests.html"><span class="header-section-number">18</span> Borrador. Tests estadísticos sencillos</a></li>
<li><a class="" href="univariate-and-multivariable-regression.html"><span class="header-section-number">19</span> Borrador. Regresión univariante y multivariable</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> Borrador. Valores faltantes</a></li>
<li><a class="" href="standardised-rates.html"><span class="header-section-number">21</span> Borrador. Tasas estandarizadas</a></li>
<li><a class="" href="moving-averages.html"><span class="header-section-number">22</span> Borrador. Medias Móviles</a></li>
<li><a class="" href="time-series-and-outbreak-detection.html"><span class="header-section-number">23</span> Borrador. Series temporales y detección de brotes</a></li>
<li><a class="" href="epidemic-modeling.html"><span class="header-section-number">24</span> Borrador. Modelización de epidemias</a></li>
<li><a class="" href="contact-tracing-1.html"><span class="header-section-number">25</span> Borrador. Rastreo de contactos</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">26</span> Borrador. Análisis de encuestas</a></li>
<li><a class="active" href="survival-analysis.html"><span class="header-section-number">27</span> Borrador. Análisis de supervivencia</a></li>
<li><a class="" href="gis-basics.html"><span class="header-section-number">28</span> Conceptos básicos de los SIG</a></li>
<li class="book-part">Visualización de datos</li>
<li><a class="" href="tables-for-presentation.html"><span class="header-section-number">29</span> Borrador. Tablas para presentaciones</a></li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">30</span> Conceptos básicos de ggplot</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">31</span> Consejos de ggplot</a></li>
<li><a class="" href="epidemic-curves.html"><span class="header-section-number">32</span> Curvas epidémicas</a></li>
<li><a class="" href="demographic-pyramids-and-likert-scales.html"><span class="header-section-number">33</span> Pirámides de población y escalas de Likert</a></li>
<li><a class="" href="heat-plots.html"><span class="header-section-number">34</span> Gráficos de calor</a></li>
<li><a class="" href="diagrams-and-charts.html"><span class="header-section-number">35</span> Diagramas y gráficos</a></li>
<li><a class="" href="combinations-analysis.html"><span class="header-section-number">36</span> Borrador. Análisis de combinaciones</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">37</span> Borrador. Cadenas de transmisión</a></li>
<li><a class="" href="phylogenetic-trees-1.html"><span class="header-section-number">38</span> Árboles filogenéticos</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">39</span> Gráficos interactivos</a></li>
<li class="book-part">Informes y Dashboards</li>
<li><a class="" href="reports-with-r-markdown.html"><span class="header-section-number">40</span> Informes con R Markdown</a></li>
<li><a class="" href="organizing-routine-reports.html"><span class="header-section-number">41</span> Organización de informes rutinarios</a></li>
<li><a class="" href="dashboards-with-r-markdown.html"><span class="header-section-number">42</span> Borrador. Dashboards con R Markdown</a></li>
<li><a class="" href="dashboards-with-shiny.html"><span class="header-section-number">43</span> Borrador. Dashboards con Shiny</a></li>
<li class="book-part">Miscelánea</li>
<li><a class="" href="writing-functions-1.html"><span class="header-section-number">44</span> Escribir funciones</a></li>
<li><a class="" href="directory-interactions.html"><span class="header-section-number">45</span> Borrador. Interacciones con directorios</a></li>
<li><a class="" href="version-control-and-collaboration-with-git-and-github.html"><span class="header-section-number">46</span> Control de versiones y colaboración con Git y Github</a></li>
<li><a class="" href="common-errors.html"><span class="header-section-number">47</span> Errores comunes</a></li>
<li><a class="" href="getting-help.html"><span class="header-section-number">48</span> Cómo obtener ayuda</a></li>
<li><a class="" href="r-on-network-drives.html"><span class="header-section-number">49</span> Borrador. R en redes locales</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">50</span> Borrador. data.table</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="survival-analysis" class="section level1" number="27">
<h1>
<span class="header-section-number">27</span> Borrador. Análisis de supervivencia<a class="anchor" aria-label="anchor" href="#survival-analysis"><i class="fas fa-link"></i></a>
</h1>
<div class="inline-figure"><img src="images/survival_analysis.png" width="75%" style="display: block; margin: auto;"></div>
<!-- ======================================================= -->
<p><span style="color: red;"><strong><em>ADVERTENCIA:</em></strong> Esta traducción es sólo un borrador de la traducción al español. Este documento tal cual está ha sido generado automáticamente con DeepL.com y se han hecho algunas correcciones globales. Está pendiente de una revisión completa. </span></p>
<div id="overview-5" class="section level2" number="27.1">
<h2>
<span class="header-section-number">27.1</span> Resumen<a class="anchor" aria-label="anchor" href="#overview-5"><i class="fas fa-link"></i></a>
</h2>
<p>El <em>análisis de supervivencia</em> se centra en la descripción, para un individuo o grupo de individuos determinado, de un punto definido de acontecimiento denominado <strong><em>the failure</em></strong> (aparición de una enfermedad, curación de una enfermedad, muerte, recaída tras la respuesta al tratamiento…) que se produce tras un periodo de tiempo denominado <strong><em>failure time</em></strong> (o <strong><em>follow-up time</em></strong> (tiempo de seguimiento en los estudios basados en cohortes/poblaciones) durante el cual se observa a los individuos. Para determinar el tiempo de fracaso, es necesario definir un tiempo de origen (que puede ser la fecha de inclusión, la fecha de diagnóstico…).</p>
<p>El objetivo de la inferencia para el análisis de supervivencia es entonces el tiempo entre un origen y un evento. En la investigación médica actual, se utiliza ampliamente en los estudios clínicos para evaluar el efecto de un tratamiento, por ejemplo, o en la epidemiología del cáncer para evaluar una gran variedad de medidas de supervivencia del cáncer.</p>
<p>Suele expresarse mediante la <strong><em>probabilidad de supervivencia</em></strong> (survival probability), que es la probabilidad de que el suceso de interés no haya ocurrido en una duración t.</p>
<p><strong><em>Censura</em></strong>: La censura se produce cuando al final del seguimiento, algunos de los individuos no han tenido el evento de interés, y por lo tanto su verdadero tiempo hasta el evento es desconocido. Aquí nos centraremos principalmente en la censura derecha, pero para más detalles sobre la censura y el análisis de supervivencia en general, puedes consultar las referencias.</p>
<!-- ======================================================= -->
</div>
<div id="preparation-17" class="section level2" number="27.2">
<h2>
<span class="header-section-number">27.2</span> Preparación<a class="anchor" aria-label="anchor" href="#preparation-17"><i class="fas fa-link"></i></a>
</h2>
<div id="cargar-paquetes-16" class="section level3 unnumbered">
<h3>Cargar paquetes<a class="anchor" aria-label="anchor" href="#cargar-paquetes-16"><i class="fas fa-link"></i></a>
</h3>
<p>Para realizar análisis de supervivencia en R, uno de los paquetes más utilizados es el de <strong>survival</strong>. Primero lo instalamos y luego lo cargamos, así como los demás paquetes que se utilizarán en esta sección:</p>
<p>En este manual destacamos <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> de <strong>pacman</strong>, que instala el paquete si es necesario <em>y</em> lo carga para su uso. También puedes cargar los paquetes instalados con <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> de R <strong>base</strong>. Consulta la página sobre <a href="r-basics.html#r-basics">fundamentos de R</a> para obtener más información sobre los paquetes de R.</p>
<p>Esta página explora los análisis de supervivencia sobre <code>linelist</code> utilizada en la mayoría de las páginas anteriores y sobre el que aplicamos algunos cambios para tener unos datos de supervivencia adecuados.</p>
</div>
<div id="importar-los-datos" class="section level3 unnumbered">
<h3>Importar los datos<a class="anchor" aria-label="anchor" href="#importar-los-datos"><i class="fas fa-link"></i></a>
</h3>
<p>Importamos los datos de casos de una epidemia de ébola simulada. Si quiere seguir el proceso, <a href="https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/case_linelists/linelist_cleaned.rds">clica para descargar linelist “limpia”</a> (como archivo .rds). Importa los datos con la función <code>import()</code> del paquete <strong>rio</strong> (maneja muchos tipos de archivos como .xlsx, .csv, .rds - Mira la página de <a href="import-and-export.html#import-and-export">importación y exportación</a> para más detalles).</p>
<div class="sourceCode" id="cb1191"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># import linelist</span>
<span class="va">linelist_case_data</span> <span class="op">&lt;-</span> <span class="fu">rio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.rds"</span><span class="op">)</span></code></pre></div>
</div>
<div id="gestión-y-transformación-de-datos" class="section level3 unnumbered">
<h3>Gestión y transformación de datos<a class="anchor" aria-label="anchor" href="#gesti%C3%B3n-y-transformaci%C3%B3n-de-datos"><i class="fas fa-link"></i></a>
</h3>
<p>En resumen, los datos de supervivencia pueden describirse con las tres características siguientes:</p>
<ol style="list-style-type: decimal">
<li>la variable dependiente o respuesta es el tiempo de espera hasta la ocurrencia de un evento bien definido,</li>
<li>bservaciones censuradas, en el sentido de que para algunas unidades el evento de interés no ha ocurrido en el momento en que se analizan los datos, y</li>
</ol>
<ol start="3" style="list-style-type: decimal">
<li>existen predictores o variables explicativas cuyo efecto sobre el tiempo de espera queremos evaluar o controlar.</li>
</ol>
<p>Así, crearemos las diferentes variables necesarias para respetar esa estructura y ejecutaremos el análisis de supervivencia.</p>
<p>Definiremos:</p>
<ul>
<li>un nuevo dataframe <code>linelist_surv</code> para este análisis</li>
<li>nuestro evento de interés como “death” (por lo tanto, nuestra probabilidad de supervivencia será la probabilidad de estar vivo después de un cierto tiempo después del momento de origen),</li>
<li>el tiempo de seguimiento (<code>futime</code>) como el tiempo transcurrido entre el momento del inicio y el momento del desenlace <em>en días</em>,</li>
<li>pacientes censurados son aquellos que se recuperaron o para los que no se conoce el resultado final, es decir, no se observó el evento “muerte” (<code>evento=0</code>).</li>
</ul>
<p><span style="color: orange;"><strong><em>PRECAUCIÓN:</em></strong> Dado que en un estudio de cohortes real, la información sobre el momento de origen y el final del seguimiento se conoce dado que los individuos son observados, eliminaremos las observaciones en las que se desconozca la fecha de inicio o la fecha de desenlace. También se eliminarán los casos en los que la fecha de inicio sea posterior a la fecha de desenlace, ya que se consideran erróneos.</span></p>
<p><span style="color: darkgreen;"><strong><em>CONSEJO:</em></strong> Dado que el filtrado a mayor (&gt;) o menor (&lt;) de una fecha puede eliminar las filas con valores faltantes, la aplicación del filtro en las fechas incorrectas también eliminará las filas con fechas faltantes.</span></p>
<p>A continuación, utilizamos <code>case_when()</code> para crear una <code>columna age_cat_small</code> en la que sólo hay 3 categorías de edad.</p>
<div class="sourceCode" id="cb1192"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#create a new data called linelist_surv from the linelist_case_data</span>

<span class="va">linelist_surv</span> <span class="op">&lt;-</span>  <span class="va">linelist_case_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
     
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span>
       <span class="co"># remove observations with wrong or missing dates of onset or date of outcome</span>
       <span class="va">date_outcome</span> <span class="op">&gt;</span> <span class="va">date_onset</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
       <span class="co"># create the event var which is 1 if the patient died and 0 if he was right censored</span>
       event <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span> <span class="op">|</span> <span class="va">outcome</span> <span class="op">==</span> <span class="st">"Recover"</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, 
    
       <span class="co"># create the var on the follow-up time in days</span>
       futime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html">as.double</a></span><span class="op">(</span><span class="va">date_outcome</span> <span class="op">-</span> <span class="va">date_onset</span><span class="op">)</span>, 
    
       <span class="co"># create a new age category variable with only 3 strata levels</span>
       age_cat_small <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span> 
            <span class="va">age_years</span> <span class="op">&lt;</span> <span class="fl">5</span>  <span class="op">~</span> <span class="st">"0-4"</span>,
            <span class="va">age_years</span> <span class="op">&gt;=</span> <span class="fl">5</span> <span class="op">&amp;</span> <span class="va">age_years</span> <span class="op">&lt;</span> <span class="fl">20</span> <span class="op">~</span> <span class="st">"5-19"</span>,
            <span class="va">age_years</span> <span class="op">&gt;=</span> <span class="fl">20</span>   <span class="op">~</span> <span class="st">"20+"</span><span class="op">)</span>,
       
       <span class="co"># previous step created age_cat_small var as character.</span>
       <span class="co"># now convert it to factor and specify the levels.</span>
       <span class="co"># Note that the NA values remain NA's and are not put in a level "unknown" for example,</span>
       <span class="co"># since in the next analyses they have to be removed.</span>
       age_cat_small <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">age_cat_small</span>, <span class="st">"0-4"</span>, <span class="st">"5-19"</span>, <span class="st">"20+"</span><span class="op">)</span>
       <span class="op">)</span></code></pre></div>
<p><span style="color: darkgreen;"><strong><em>CONSEJO:</em></strong> Podemos verificar las nuevas columnas que hemos creado haciendo un resumen sobre el <code>futime</code> y una tabulación cruzada entre <code>event</code> y <code>outcome</code> a partir del cual se ha creado. Además de esta verificación, es un buen hábito comunicar la mediana del tiempo de seguimiento al interpretar los resultados del análisis de supervivencia.</span></p>
<div class="sourceCode" id="cb1193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">linelist_surv</span><span class="op">$</span><span class="va">futime</span><span class="op">)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    1.00    6.00   10.00   11.98   16.00   64.00</code></pre>
<div class="sourceCode" id="cb1195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># cross tabulate the new event var and the outcome var from which it was created</span>
<span class="co"># to make sure the code did what it was intended to</span>
<span class="va">linelist_surv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">tabyl</span><span class="op">(</span><span class="va">outcome</span>, <span class="va">event</span><span class="op">)</span></code></pre></div>
<pre><code>##  outcome    0    1
##    Death    0 1952
##  Recover 1547    0
##     &lt;NA&gt; 1040    0</code></pre>
<p>Ahora cruzamos la nueva var de <code>age_cat_small</code> y la antigua columna <code>age_cat</code> para asegurarnos de que las asignaciones son correctas</p>
<div class="sourceCode" id="cb1197"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_surv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">tabyl</span><span class="op">(</span><span class="va">age_cat_small</span>, <span class="va">age_cat</span><span class="op">)</span></code></pre></div>
<pre><code>##  age_cat_small 0-4 5-9 10-14 15-19 20-29 30-49 50-69 70+ NA_
##            0-4 834   0     0     0     0     0     0   0   0
##           5-19   0 852   717   575     0     0     0   0   0
##            20+   0   0     0     0   862   554    69   5   0
##           &lt;NA&gt;   0   0     0     0     0     0     0   0  71</code></pre>
<p>Ahora revisamos las 10 primeras observaciones de los datos de <code>linelist_surv</code> mirando las variables específicas (incluyendo las de nueva creación).</p>
<div class="sourceCode" id="cb1199"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_surv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">case_id</span>, <span class="va">age_cat_small</span>, <span class="va">date_onset</span>, <span class="va">date_outcome</span>, <span class="va">outcome</span>, <span class="va">event</span>, <span class="va">futime</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></code></pre></div>
<pre><code>##    case_id age_cat_small date_onset date_outcome outcome event futime
## 1   8689b7           0-4 2014-05-13   2014-05-18 Recover     0      5
## 2   11f8ea           20+ 2014-05-16   2014-05-30 Recover     0     14
## 3   893f25           0-4 2014-05-21   2014-05-29 Recover     0      8
## 4   be99c8          5-19 2014-05-22   2014-05-24 Recover     0      2
## 5   07e3e8          5-19 2014-05-27   2014-06-01 Recover     0      5
## 6   369449           0-4 2014-06-02   2014-06-07   Death     1      5
## 7   f393b4           20+ 2014-06-05   2014-06-18 Recover     0     13
## 8   1389ca           20+ 2014-06-05   2014-06-09   Death     1      4
## 9   2978ac          5-19 2014-06-06   2014-06-15   Death     1      9
## 10  fc15ef          5-19 2014-06-16   2014-07-09 Recover     0     23</code></pre>
<p>También podemos cruzar las columnas <code>age_cat_small</code> y <code>gender</code> para tener más detalles sobre la distribución de esta nueva columna por género. Utilizamos <code>tabyl()</code> y las funciones de <em>adorno</em> de <strong>janitor</strong> como se describe en la página de <a href="descriptive-tables.html#descriptive-tables">tablas descriptivas</a>.</p>
<!-- For this we use the `stat.table()` function of the **Epi** package. -->
<div class="sourceCode" id="cb1201"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_surv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">tabyl</span><span class="op">(</span><span class="va">gender</span>, <span class="va">age_cat_small</span>, show_na <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">adorn_totals</span><span class="op">(</span>where <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">adorn_percentages</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">adorn_pct_formatting</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">adorn_ns</span><span class="op">(</span>position <span class="op">=</span> <span class="st">"front"</span><span class="op">)</span></code></pre></div>
<pre><code>##  gender         0-4         5-19          20+         Total
##       f 482 (22.4%) 1184 (54.9%)  490 (22.7%) 2156 (100.0%)
##       m 325 (15.0%)  880 (40.6%)  960 (44.3%) 2165 (100.0%)
##   Total 807 (18.7%) 2064 (47.8%) 1450 (33.6%) 4321 (100.0%)</code></pre>
<!-- Epi::stat.table(  -->
<!--   #give variables for the cross tabulation -->
<!--   list( -->
<!--     gender,  -->
<!--     age_cat_small -->
<!--     ), -->
<!--   #precise the function you want to call (mean,count..) -->
<!--   list(  -->
<!--     count(), -->
<!--     percent(age_cat_small) -->
<!--     ),  -->
<!--   #add margins -->
<!--   margins=T,  -->
<!--   #data used -->
<!--   data = linelist_surv  -->
<!--   ) -->
<!-- ``` -->
<!-- ======================================================= -->
</div>
</div>
<div id="basics-of-survival-analysis" class="section level2" number="27.3">
<h2>
<span class="header-section-number">27.3</span> Fundamentos del análisis de supervivencia<a class="anchor" aria-label="anchor" href="#basics-of-survival-analysis"><i class="fas fa-link"></i></a>
</h2>
<div id="construir-un-objeto-de-tipo-surv-type" class="section level3 unnumbered">
<h3>Construir un objeto de tipo surv-type<a class="anchor" aria-label="anchor" href="#construir-un-objeto-de-tipo-surv-type"><i class="fas fa-link"></i></a>
</h3>
<p>Primero utilizaremos <code>Surv()</code> de <strong>survival</strong> para construir un objeto de supervivencia a partir de las columnas de tiempo de seguimiento y evento.</p>
<p>El resultado de este paso es producir un objeto de tipo <em>Surv</em> que condensa la información de tiempo y si el evento de interés (muerte) fue observado. Este objeto se utilizará en última instancia en el lado derecho de las fórmulas posteriores del modelo (<a href="https://cran.r-project.org/web/packages/survival/vignettes/survival.pdf">véase la documentación</a>).</p>
<div class="sourceCode" id="cb1203"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Use Suv() syntax for right-censored data</span>
<span class="va">survobj</span> <span class="op">&lt;-</span> <span class="fu">Surv</span><span class="op">(</span>time <span class="op">=</span> <span class="va">linelist_surv</span><span class="op">$</span><span class="va">futime</span>,
                event <span class="op">=</span> <span class="va">linelist_surv</span><span class="op">$</span><span class="va">event</span><span class="op">)</span></code></pre></div>
<!-- ```{r} -->
<!-- survobj <- with(linelist_surv, -->
<!--                 survival::Surv(futime, event) -->
<!--                 ) -->
<!-- ``` -->
<p>Puedes revisar las primeras 10 filas de los datos de <code>linelist_surv</code>, viendo sólo algunas columnas importantes.</p>
<div class="sourceCode" id="cb1204"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_surv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">case_id</span>, <span class="va">date_onset</span>, <span class="va">date_outcome</span>, <span class="va">futime</span>, <span class="va">outcome</span>, <span class="va">event</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></code></pre></div>
<pre><code>##    case_id date_onset date_outcome futime outcome event
## 1   8689b7 2014-05-13   2014-05-18      5 Recover     0
## 2   11f8ea 2014-05-16   2014-05-30     14 Recover     0
## 3   893f25 2014-05-21   2014-05-29      8 Recover     0
## 4   be99c8 2014-05-22   2014-05-24      2 Recover     0
## 5   07e3e8 2014-05-27   2014-06-01      5 Recover     0
## 6   369449 2014-06-02   2014-06-07      5   Death     1
## 7   f393b4 2014-06-05   2014-06-18     13 Recover     0
## 8   1389ca 2014-06-05   2014-06-09      4   Death     1
## 9   2978ac 2014-06-06   2014-06-15      9   Death     1
## 10  fc15ef 2014-06-16   2014-07-09     23 Recover     0</code></pre>
<p>Y aquí están los primeros 10 elementos de <code>survobj</code>. Se imprime como esencialmente un vector de tiempo de seguimiento, con “+” para representar si una observación fue censurada a la derecha. Mira cómo los números se alinean arriba y abajo.</p>
<div class="sourceCode" id="cb1206"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#print the 50 first elements of the vector to see how it presents</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">survobj</span>, <span class="fl">10</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1]  5+ 14+  8+  2+  5+  5  13+  4   9  23+</code></pre>
</div>
<div id="realización-de-los-primeros-análisis" class="section level3 unnumbered">
<h3>Realización de los primeros análisis<a class="anchor" aria-label="anchor" href="#realizaci%C3%B3n-de-los-primeros-an%C3%A1lisis"><i class="fas fa-link"></i></a>
</h3>
<p>A continuación, iniciamos nuestro análisis utilizando la función <code>survfit()</code> para producir un <em>objeto survfit</em>, que se ajusta a los cálculos por defecto para las estimaciones de <strong><em>Kaplan Meier</em></strong> (KM) de la curva de supervivencia global (marginal), que son de hecho una función escalonada con saltos en los tiempos de los eventos observados. El <em>objeto survfit</em> final contiene una o más curvas de supervivencia y se crea utilizando el objeto <em>Surv</em> como variable de respuesta en la fórmula del modelo.</p>
<p><span style="color: black;"><strong><em>NOTA:</em></strong> La estimación de Kaplan-Meier es una estimación no paramétrica de máxima verosimilitud (MLE) de la función de supervivencia. (ver recursos para más información).</span></p>
<p>El resumen de este <em>objeto survfit</em> dará lo que se llama una <em>tabla de vida</em>. Para cada paso de tiempo del seguimiento (tiempo) en el que ocurrió un evento (en orden ascendente):</p>
<ul>
<li>el número de personas que estaban en riesgo de desarrollar el evento (personas que aún no tenían el evento ni estaban censuradas: n.riesgo)</li>
<li>los que sí desarrollaron el evento (<code>n.event</code>)</li>
<li>y de lo anterior: la probabilidad de <em>no</em> desarrollar el evento (probabilidad de no morir, o de sobrevivir más allá de ese tiempo específico)</li>
<li>por último, se obtienen y muestran el error estándar y el intervalo de confianza de esa probabilidad</li>
</ul>
<p>Ajustamos las estimaciones de KM mediante la fórmula en la que el objeto Surv “survobj” anterior es la variable de respuesta. “~ 1” precisa que ejecutamos el modelo para la supervivencia global.</p>
<div class="sourceCode" id="cb1208"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># fit the KM estimates using a formula where the Surv object "survobj" is the response variable.</span>
<span class="co"># "~ 1" signifies that we run the model for the overall survival  </span>
<span class="va">linelistsurv_fit</span> <span class="op">&lt;-</span>  <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a></span><span class="op">(</span><span class="va">survobj</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span>

<span class="co">#print its summary for more details</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">linelistsurv_fit</span><span class="op">)</span></code></pre></div>
<pre><code>## Call: survfit(formula = survobj ~ 1)
## 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##     1   4539      30    0.993 0.00120        0.991        0.996
##     2   4500      69    0.978 0.00217        0.974        0.982
##     3   4394     149    0.945 0.00340        0.938        0.952
##     4   4176     194    0.901 0.00447        0.892        0.910
##     5   3899     214    0.852 0.00535        0.841        0.862
##     6   3592     210    0.802 0.00604        0.790        0.814
##     7   3223     179    0.757 0.00656        0.745        0.770
##     8   2899     167    0.714 0.00700        0.700        0.728
##     9   2593     145    0.674 0.00735        0.660        0.688
##    10   2311     109    0.642 0.00761        0.627        0.657
##    11   2081     119    0.605 0.00788        0.590        0.621
##    12   1843      89    0.576 0.00809        0.560        0.592
##    13   1608      55    0.556 0.00823        0.540        0.573
##    14   1448      43    0.540 0.00837        0.524        0.556
##    15   1296      31    0.527 0.00848        0.511        0.544
##    16   1152      48    0.505 0.00870        0.488        0.522
##    17   1002      29    0.490 0.00886        0.473        0.508
##    18    898      21    0.479 0.00900        0.462        0.497
##    19    798       7    0.475 0.00906        0.457        0.493
##    20    705       4    0.472 0.00911        0.454        0.490
##    21    626      13    0.462 0.00932        0.444        0.481
##    22    546       8    0.455 0.00948        0.437        0.474
##    23    481       5    0.451 0.00962        0.432        0.470
##    24    436       4    0.447 0.00975        0.428        0.466
##    25    378       4    0.442 0.00993        0.423        0.462
##    26    336       3    0.438 0.01010        0.419        0.458
##    27    297       1    0.436 0.01017        0.417        0.457
##    29    235       1    0.435 0.01030        0.415        0.455
##    38     73       1    0.429 0.01175        0.406        0.452</code></pre>
<p>Al utilizar <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> podemos añadir la opción <code>times</code> y especificar ciertos tiempos en los que queremos ver la información de supervivencia</p>
<div class="sourceCode" id="cb1210"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#print its summary at specific times</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">linelistsurv_fit</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">60</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Call: survfit(formula = survobj ~ 1)
## 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##     5   3899     656    0.852 0.00535        0.841        0.862
##    10   2311     810    0.642 0.00761        0.627        0.657
##    20    705     446    0.472 0.00911        0.454        0.490
##    30    210      39    0.435 0.01030        0.415        0.455
##    60      2       1    0.429 0.01175        0.406        0.452</code></pre>
<p>También podemos utilizar la función <code><a href="https://rdrr.io/r/base/print.html">print()</a></code>. El argumento <code>print.rmean = TRUE</code> se utiliza para obtener el tiempo medio de supervivencia y su error estándar (se).</p>
<p><strong><em>NOTA:</em></strong> El tiempo medio de supervivencia restringido (RMST) es una medida de supervivencia específica cada vez más utilizada en el análisis de supervivencia del cáncer y que suele definirse como el área bajo la curva de supervivencia, dado que observamos a los pacientes hasta el tiempo restringido T (más detalles en la sección Recursos).</p>
<div class="sourceCode" id="cb1212"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># print linelistsurv_fit object with mean survival time and its se. </span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">linelistsurv_fit</span>, print.rmean <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Call: survfit(formula = survobj ~ 1)
## 
##          n     events     *rmean *se(rmean)     median    0.95LCL    0.95UCL 
##   4539.000   1952.000     33.105      0.539     17.000     16.000     18.000 
##     * restricted mean with upper limit =  64</code></pre>
<p><span style="color: darkgreen;"><strong><em>CONSEJO:</em></strong> Podemos crear el <em>objeto surv</em> directamente en la función <code>survfit()</code> y ahorrarnos una línea de código. Esto se verá como: <code>linelistsurv_quick &lt;- survfit(Surv(futime, event) ~ 1, data=linelist_surv)</code>.</span></p>
</div>
<div id="peligro-acumulado" class="section level3 unnumbered">
<h3>Peligro acumulado<a class="anchor" aria-label="anchor" href="#peligro-acumulado"><i class="fas fa-link"></i></a>
</h3>
<p>Además de la función <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code>, también podemos utilizar la función <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> que da más detalles sobre la estructura del objeto <code>survfit()</code>. Se trata de una lista de 16 elementos.</p>
<p>Entre estos elementos hay uno importante: el <code>cumhaz</code>, que es un vector numérico. Se puede trazar para mostrar el <strong><em>peligro acumulado,</em></strong> siendo el <strong><em>peligro</em></strong> la <strong><em>tasa instantánea de ocurrencia del evento</em></strong> (ver referencias).</p>
<div class="sourceCode" id="cb1214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">linelistsurv_fit</span><span class="op">)</span></code></pre></div>
<pre><code>## List of 16
##  $ n        : int 4539
##  $ time     : num [1:59] 1 2 3 4 5 6 7 8 9 10 ...
##  $ n.risk   : num [1:59] 4539 4500 4394 4176 3899 ...
##  $ n.event  : num [1:59] 30 69 149 194 214 210 179 167 145 109 ...
##  $ n.censor : num [1:59] 9 37 69 83 93 159 145 139 137 121 ...
##  $ surv     : num [1:59] 0.993 0.978 0.945 0.901 0.852 ...
##  $ std.err  : num [1:59] 0.00121 0.00222 0.00359 0.00496 0.00628 ...
##  $ cumhaz   : num [1:59] 0.00661 0.02194 0.05585 0.10231 0.15719 ...
##  $ std.chaz : num [1:59] 0.00121 0.00221 0.00355 0.00487 0.00615 ...
##  $ type     : chr "right"
##  $ logse    : logi TRUE
##  $ conf.int : num 0.95
##  $ conf.type: chr "log"
##  $ lower    : num [1:59] 0.991 0.974 0.938 0.892 0.841 ...
##  $ upper    : num [1:59] 0.996 0.982 0.952 0.91 0.862 ...
##  $ call     : language survfit(formula = survobj ~ 1)
##  - attr(*, "class")= chr "survfit"</code></pre>
<!-- ======================================================= -->
</div>
<div id="trazado-de-curvas-de-kaplan-meir" class="section level3 unnumbered">
<h3>Trazado de curvas de Kaplan-Meir<a class="anchor" aria-label="anchor" href="#trazado-de-curvas-de-kaplan-meir"><i class="fas fa-link"></i></a>
</h3>
<p>Una vez ajustadas las estimaciones de KM, podemos visualizar la probabilidad de estar vivo a lo largo de un tiempo determinado utilizando la función básica <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> que dibuja la “curva de Kaplan-Meier”. En otras palabras, la curva de abajo es una ilustración convencional de la experiencia de supervivencia en todo el grupo de pacientes.</p>
<p>Podemos verificar rápidamente el tiempo de seguimiento mínimo y máximo en la curva.</p>
<p>Una forma fácil de interpretarlo es decir que en el momento cero, todos los participantes siguen vivos y la probabilidad de supervivencia es entonces del 100%. Esta probabilidad disminuye con el tiempo a medida que los pacientes mueren. La proporción de participantes que sobreviven más allá de los 60 días de seguimiento se sitúa en torno al 40%.</p>
<div class="sourceCode" id="cb1216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">linelistsurv_fit</span>, 
     xlab <span class="op">=</span> <span class="st">"Days of follow-up"</span>,    <span class="co"># x-axis label</span>
     ylab<span class="op">=</span><span class="st">"Survival Probability"</span>,   <span class="co"># y-axis label</span>
     main<span class="op">=</span> <span class="st">"Overall survival curve"</span> <span class="co"># figure title</span>
     <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-915-1.png" width="672"></div>
<p>El intervalo de confianza de las estimaciones de supervivencia de KM también se traza por defecto y puede descartarse añadiendo la opción <code>conf.int = FALSE</code> al comando <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code>.</p>
<p>Dado que el evento de interés es “death”, dibujar una curva que describa los complementos de las proporciones de supervivencia llevará a dibujar las proporciones de mortalidad acumulada. Esto puede hacerse con <code><a href="https://rdrr.io/r/graphics/lines.html">lines()</a></code>, que añade información a un gráfico existente.</p>
<div class="sourceCode" id="cb1217"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># original plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>
  <span class="va">linelistsurv_fit</span>,
  xlab <span class="op">=</span> <span class="st">"Days of follow-up"</span>,       
  ylab <span class="op">=</span> <span class="st">"Survival Probability"</span>,       
  mark.time <span class="op">=</span> <span class="cn">TRUE</span>,              <span class="co"># mark events on the curve: a "+" is printed at every event</span>
  conf.int <span class="op">=</span> <span class="cn">FALSE</span>,              <span class="co"># do not plot the confidence interval</span>
  main <span class="op">=</span> <span class="st">"Overall survival curve and cumulative mortality"</span>
  <span class="op">)</span>

<span class="co"># draw an additional curve to the previous plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span>
  <span class="va">linelistsurv_fit</span>,
  lty <span class="op">=</span> <span class="fl">3</span>,             <span class="co"># use different line type for clarity</span>
  fun <span class="op">=</span> <span class="st">"event"</span>,       <span class="co"># draw the cumulative events instead of the survival </span>
  mark.time <span class="op">=</span> <span class="cn">FALSE</span>,
  conf.int <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span>

<span class="co"># add a legend to the plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span>
  <span class="st">"topright"</span>,                               <span class="co"># position of legend</span>
  legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Survival"</span>, <span class="st">"Cum. Mortality"</span><span class="op">)</span>, <span class="co"># legend text </span>
  lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>,                            <span class="co"># line types to use in the legend</span>
  cex <span class="op">=</span> <span class="fl">.85</span>,                                <span class="co"># parametes that defines size of legend text</span>
  bty <span class="op">=</span> <span class="st">"n"</span>                                 <span class="co"># no box type to be drawn for the legend</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-916-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
</div>
<div id="comparison-of-survival-curves" class="section level2" number="27.4">
<h2>
<span class="header-section-number">27.4</span> Comparación de las curvas de supervivencia<a class="anchor" aria-label="anchor" href="#comparison-of-survival-curves"><i class="fas fa-link"></i></a>
</h2>
<p>Para comparar la supervivencia dentro de los diferentes grupos de nuestros participantes o pacientes observados, es posible que tengamos que observar primero sus respectivas curvas de supervivencia y luego realizar pruebas para evaluar la diferencia entre grupos independientes. Esta comparación puede referirse a grupos basados en el género, la edad, el tratamiento, la comorbilidad…</p>
<div id="test-log-rank" class="section level3 unnumbered">
<h3>test Log rank<a class="anchor" aria-label="anchor" href="#test-log-rank"><i class="fas fa-link"></i></a>
</h3>
<p>El test Log rank (de rango logarítmico) es una prueba popular que compara toda la experiencia de supervivencia entre dos o más grupos <em>independientes</em> y puede considerarse como una prueba de si las curvas de supervivencia son idénticas (se superponen) o no (hipótesis nula de no diferencia de supervivencia entre los grupos). La función <code>survdiff()</code> del paquete <strong>survival</strong> permite ejecutar el test Log rank cuando especificamos <code>rho = 0</code> (que es el valor predeterminado). Los resultados de la prueba dan un estadístico chi-cuadrado junto con un valor-p, ya que el estadístico log rank se distribuye aproximadamente como un test estadístico de chi-cuadrado.</p>
<p>En primer lugar, tratamos de comparar las curvas de supervivencia por grupos de género. Para ello, primero intentamos visualizarlo (comprobar si las dos curvas de supervivencia se superponen). Se creará un nuevo <em>objeto survfit</em> con una fórmula ligeramente diferente. Luego se creará el <em>objeto survdiff</em>.</p>
<p>Al suministrar <code>~ gender</code> como lado derecho de la fórmula, ya no trazamos la supervivencia global sino por género.</p>
<div class="sourceCode" id="cb1218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create the new survfit object based on gender</span>
<span class="va">linelistsurv_fit_sex</span> <span class="op">&lt;-</span>  <span class="fu">survfit</span><span class="op">(</span><span class="fu">Surv</span><span class="op">(</span><span class="va">futime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span>, data <span class="op">=</span> <span class="va">linelist_surv</span><span class="op">)</span></code></pre></div>
<p>Ahora podemos trazar las curvas de supervivencia por género. Observa el <em>orden</em> de los niveles de los estratos en la columna de género antes de definir los colores y la leyenda.</p>
<div class="sourceCode" id="cb1219"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># set colors</span>
<span class="va">col_sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lightgreen"</span>, <span class="st">"darkgreen"</span><span class="op">)</span>

<span class="co"># create plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>
  <span class="va">linelistsurv_fit_sex</span>,
  col <span class="op">=</span> <span class="va">col_sex</span>,
  xlab <span class="op">=</span> <span class="st">"Days of follow-up"</span>,
  ylab <span class="op">=</span> <span class="st">"Survival Probability"</span><span class="op">)</span>

<span class="co"># add legend</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span>
  <span class="st">"topright"</span>,
  legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Female"</span>,<span class="st">"Male"</span><span class="op">)</span>,
  col <span class="op">=</span> <span class="va">col_sex</span>,
  lty <span class="op">=</span> <span class="fl">1</span>,
  cex <span class="op">=</span> <span class="fl">.9</span>,
  bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-917-1.png" width="672"></div>
<p>Y ahora podemos calcular la prueba de la diferencia entre las curvas de supervivencia utilizando <code>survdiff()</code></p>
<div class="sourceCode" id="cb1220"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#compute the test of the difference between the survival curves</span>
<span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/survdiff.html">survdiff</a></span><span class="op">(</span>
  <span class="fu">Surv</span><span class="op">(</span><span class="va">futime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span>, 
  data <span class="op">=</span> <span class="va">linelist_surv</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## Call:
## survival::survdiff(formula = Surv(futime, event) ~ gender, data = linelist_surv)
## 
## n=4321, 218 observations deleted due to missingness.
## 
##             N Observed Expected (O-E)^2/E (O-E)^2/V
## gender=f 2156      924      909     0.255     0.524
## gender=m 2165      929      944     0.245     0.524
## 
##  Chisq= 0.5  on 1 degrees of freedom, p= 0.5</code></pre>
<p>Vemos que la curva de supervivencia de las mujeres y la de los hombres se superponen y la prueba de rango logarítmico no da pruebas de una diferencia de supervivencia entre mujeres y hombres.</p>
<p>Algunos otros paquetes de R permiten ilustrar curvas de supervivencia para diferentes grupos y probar la diferencia de una sola vez. Utilizando la función <code>ggsurvplot()</code> del paquete <strong>survminer</strong>, también podemos incluir en nuestra curva las tablas de riesgo impresas para cada grupo, así como el valor p del test log-rank.</p>
<p><span style="color: orange;"><strong><em>PRECAUCIÓN:</em></strong> las funciones de <strong>survminer</strong> requieren que especifiques el objeto de supervivencia <em>y</em> que vuelva a especificar los datos utilizados para ajustar el objeto de supervivencia. Recuerde hacer esto para evitar mensajes de error no específicos. </span></p>
<div class="sourceCode" id="cb1222"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">survminer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggsurvplot.html">ggsurvplot</a></span><span class="op">(</span>
    <span class="va">linelistsurv_fit_sex</span>, 
    data <span class="op">=</span> <span class="va">linelist_surv</span>,          <span class="co"># again specify the data used to fit linelistsurv_fit_sex </span>
    conf.int <span class="op">=</span> <span class="cn">FALSE</span>,              <span class="co"># do not show confidence interval of KM estimates</span>
    surv.scale <span class="op">=</span> <span class="st">"percent"</span>,        <span class="co"># present probabilities in the y axis in %</span>
    break.time.by <span class="op">=</span> <span class="fl">10</span>,            <span class="co"># present the time axis with an increment of 10 days</span>
    xlab <span class="op">=</span> <span class="st">"Follow-up days"</span>,
    ylab <span class="op">=</span> <span class="st">"Survival Probability"</span>,
    pval <span class="op">=</span> <span class="cn">T</span>,                      <span class="co"># print p-value of Log-rank test </span>
    pval.coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">40</span>,<span class="fl">.91</span><span class="op">)</span>,        <span class="co"># print p-value at these plot coordinates</span>
    risk.table <span class="op">=</span> <span class="cn">T</span>,                <span class="co"># print the risk table at bottom </span>
    legend.title <span class="op">=</span> <span class="st">"Gender"</span>,       <span class="co"># legend characteristics</span>
    legend.labs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Female"</span>,<span class="st">"Male"</span><span class="op">)</span>,
    font.legend <span class="op">=</span> <span class="fl">10</span>, 
    palette <span class="op">=</span> <span class="st">"Dark2"</span>,             <span class="co"># specify color palette </span>
    surv.median.line <span class="op">=</span> <span class="st">"hv"</span>,       <span class="co"># draw horizontal and vertical lines to the median survivals</span>
    ggtheme <span class="op">=</span> <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span>        <span class="co"># simplify plot background</span>
<span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-919-1.png" width="672"></div>
<p>También podemos comprobar si hay diferencias en la supervivencia según la fuente de infección (fuente de contaminación).</p>
<p>En este caso, la prueba de rango logarítmico da pruebas suficientes de una diferencia en las probabilidades de supervivencia a <code>alfa= 0,005</code>. Las probabilidades de supervivencia de los pacientes que se infectaron en los funerales son mayores que las de los pacientes que se infectaron en otros lugares, lo que sugiere un beneficio para la supervivencia.</p>
<div class="sourceCode" id="cb1223"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelistsurv_fit_source</span> <span class="op">&lt;-</span>  <span class="fu">survfit</span><span class="op">(</span>
  <span class="fu">Surv</span><span class="op">(</span><span class="va">futime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">source</span>,
  data <span class="op">=</span> <span class="va">linelist_surv</span>
  <span class="op">)</span>

<span class="co"># plot</span>
<span class="fu">ggsurvplot</span><span class="op">(</span> 
  <span class="va">linelistsurv_fit_source</span>,
  data <span class="op">=</span> <span class="va">linelist_surv</span>,
  size <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="st">"strata"</span>,   <span class="co"># line types</span>
  conf.int <span class="op">=</span> <span class="cn">T</span>,
  surv.scale <span class="op">=</span> <span class="st">"percent"</span>,  
  break.time.by <span class="op">=</span> <span class="fl">10</span>, 
  xlab <span class="op">=</span> <span class="st">"Follow-up days"</span>,
  ylab<span class="op">=</span> <span class="st">"Survival Probability"</span>,
  pval <span class="op">=</span> <span class="cn">T</span>,
  pval.coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">40</span>,<span class="fl">.91</span><span class="op">)</span>,
  risk.table <span class="op">=</span> <span class="cn">T</span>,
  legend.title <span class="op">=</span> <span class="st">"Source of \ninfection"</span>,
  legend.labs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Funeral"</span>, <span class="st">"Other"</span><span class="op">)</span>,
  font.legend <span class="op">=</span> <span class="fl">10</span>,
  palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#E7B800"</span>,<span class="st">"#3E606F"</span><span class="op">)</span>,
  surv.median.line <span class="op">=</span> <span class="st">"hv"</span>, 
  ggtheme <span class="op">=</span> <span class="fu">theme_light</span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-920-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
</div>
<div id="cox-regression-analysis" class="section level2" number="27.5">
<h2>
<span class="header-section-number">27.5</span> Análisis de regresión de Cox<a class="anchor" aria-label="anchor" href="#cox-regression-analysis"><i class="fas fa-link"></i></a>
</h2>
<p>La regresión de riesgos proporcionales de Cox es una de las técnicas de regresión más populares para el análisis de supervivencia. También se pueden utilizar otros modelos, ya que el modelo de Cox requiere <em>supuestos importantes</em> que deben verificarse para un uso adecuado, como el supuesto de riesgos proporcionales: véanse las referencias.</p>
<p>En un modelo de regresión de riesgos proporcionales de Cox, la medida del efecto es la tasa de <strong><em>riesgo (</em></strong>HR), que es el riesgo de fracaso (o el riesgo de muerte en nuestro ejemplo), dado que el participante ha sobrevivido hasta un momento específico. Normalmente, estamos interesados en comparar grupos <em>independientes</em> con respecto a sus riesgos, y utilizamos una razón de riesgo, que es análoga a una razón de probabilidades en el entorno del análisis de regresión logística múltiple. La función <code>cox.ph()</code> del paquete de supervivencia se utiliza para ajustar el modelo. La función <code>cox.zph()</code> del paquete de <strong>survival</strong> puede utilizarse para probar la suposición de riesgos proporcionales para un ajuste del modelo de regresión de Cox.</p>
<p><span style="color: black;"><strong><em>NOTA:</em></strong> Una probabilidad debe estar en el rango de 0 a 1. Sin embargo, el peligro representa el número esperado de eventos por una unidad de tiempo.</span></p>
<ul>
<li>Si la razón de riesgo de un predictor es cercana a 1, entonces ese predictor no afecta a la supervivencia,</li>
<li>si el HR es inferior a 1, entonces el predictor es protector (es decir, está asociado a una mejor supervivencia),</li>
<li>y si el HR es mayor que 1, entonces el predictor se asocia a un mayor riesgo (o a una menor supervivencia).</li>
</ul>
<div id="ajuste-de-un-modelo-de-cox" class="section level3 unnumbered">
<h3>Ajuste de un modelo de Cox<a class="anchor" aria-label="anchor" href="#ajuste-de-un-modelo-de-cox"><i class="fas fa-link"></i></a>
</h3>
<p>Primero podemos ajustar un modelo para evaluar el efecto de la edad y el sexo en la supervivencia. Con sólo imprimir el modelo, tenemos la información sobre:</p>
<ul>
<li>los coeficientes de regresión estimados <code>coef</code> que cuantifican la asociación entre los predictores y el resultado,</li>
<li>su exponencial (para tu interpretación, <code>exp(coef)</code>) que produce la <em>razón de riesgo</em>,</li>
<li>su error estándar <code>se(coef)</code>,</li>
<li>la puntuación z: cuántos errores estándar se aleja el coeficiente estimado de 0,</li>
<li>y el valor- p: la probabilidad de que el coeficiente estimado sea 0.</li>
</ul>
<p>La función <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> aplicada al objeto del modelo cox ofrece más información, como el intervalo de confianza de la HR estimada y las diferentes puntuaciones de la prueba.</p>
<p>El efecto de la primera covariable, <code>gender</code>, se presenta en la primera fila. Se imprime <code>genderm</code> (masculino), lo que implica que el primer nivel de estrato (“f”), es decir, el grupo femenino, es el grupo de referencia para el género. Por lo tanto, la interpretación del parámetro de la prueba es la de los hombres en comparación con las mujeres. El valor p indica que no hay pruebas suficientes de un efecto del género sobre el peligro esperado o de una asociación entre el género y la mortalidad por todas las causas.</p>
<p>La misma falta de pruebas se observa en relación con el grupo de edad.</p>
<div class="sourceCode" id="cb1224"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#fitting the cox model</span>
<span class="va">linelistsurv_cox_sexage</span> <span class="op">&lt;-</span>  <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html">coxph</a></span><span class="op">(</span>
              <span class="fu">Surv</span><span class="op">(</span><span class="va">futime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">age_cat_small</span>, 
              data <span class="op">=</span> <span class="va">linelist_surv</span>
              <span class="op">)</span>


<span class="co">#printing the model fitted</span>
<span class="va">linelistsurv_cox_sexage</span></code></pre></div>
<pre><code>## Call:
## survival::coxph(formula = Surv(futime, event) ~ gender + age_cat_small, 
##     data = linelist_surv)
## 
##                       coef exp(coef) se(coef)      z     p
## genderm           -0.03149   0.96900  0.04767 -0.661 0.509
## age_cat_small5-19  0.09400   1.09856  0.06454  1.456 0.145
## age_cat_small20+   0.05032   1.05161  0.06953  0.724 0.469
## 
## Likelihood ratio test=2.8  on 3 df, p=0.4243
## n= 4321, number of events= 1853 
##    (218 observations deleted due to missingness)</code></pre>
<div class="sourceCode" id="cb1226"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#summary of the model</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">linelistsurv_cox_sexage</span><span class="op">)</span></code></pre></div>
<pre><code>## Call:
## survival::coxph(formula = Surv(futime, event) ~ gender + age_cat_small, 
##     data = linelist_surv)
## 
##   n= 4321, number of events= 1853 
##    (218 observations deleted due to missingness)
## 
##                       coef exp(coef) se(coef)      z Pr(&gt;|z|)
## genderm           -0.03149   0.96900  0.04767 -0.661    0.509
## age_cat_small5-19  0.09400   1.09856  0.06454  1.456    0.145
## age_cat_small20+   0.05032   1.05161  0.06953  0.724    0.469
## 
##                   exp(coef) exp(-coef) lower .95 upper .95
## genderm               0.969     1.0320    0.8826     1.064
## age_cat_small5-19     1.099     0.9103    0.9680     1.247
## age_cat_small20+      1.052     0.9509    0.9176     1.205
## 
## Concordance= 0.514  (se = 0.007 )
## Likelihood ratio test= 2.8  on 3 df,   p=0.4
## Wald test            = 2.78  on 3 df,   p=0.4
## Score (logrank) test = 2.78  on 3 df,   p=0.4</code></pre>
<p>Fue interesante ejecutar el modelo y observar los resultados, pero un primer vistazo para verificar si se respetan los supuestos de riesgos proporcionales podría ayudar a ahorrar tiempo.</p>
<div class="sourceCode" id="cb1228"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">test_ph_sexage</span> <span class="op">&lt;-</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/cox.zph.html">cox.zph</a></span><span class="op">(</span><span class="va">linelistsurv_cox_sexage</span><span class="op">)</span>
<span class="va">test_ph_sexage</span></code></pre></div>
<pre><code>##               chisq df    p
## gender        0.454  1 0.50
## age_cat_small 0.838  2 0.66
## GLOBAL        1.399  3 0.71</code></pre>
<p><span style="color: black;"><strong><em>NOTA:</em></strong> Se puede especificar un segundo argumento llamado <em>método</em> cuando se calcula el modelo cox, que determina cómo se manejan los empates. El <em>valor por defecto</em> es “efron”, y las otras opciones son “breslow” y “exact”.</span></p>
<p>En otro modelo añadimos más factores de riesgo, como el origen de la infección y el número de días entre la fecha de inicio y el ingreso. Esta vez, primero verificamos la hipótesis de riesgos proporcionales antes de seguir adelante.</p>
<p>En este modelo, hemos incluido un predictor continuo (<code>days_onset_hosp</code>). En este caso, interpretamos las estimaciones de los parámetros como el aumento del logaritmo esperado del riesgo relativo por cada aumento de una unidad en el predictor, manteniendo los demás predictores constantes. Primero verificamos el supuesto de riesgos proporcionales.</p>
<div class="sourceCode" id="cb1230"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#fit the model</span>
<span class="va">linelistsurv_cox</span> <span class="op">&lt;-</span>  <span class="fu">coxph</span><span class="op">(</span>
                        <span class="fu">Surv</span><span class="op">(</span><span class="va">futime</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">age_years</span><span class="op">+</span> <span class="va">source</span> <span class="op">+</span> <span class="va">days_onset_hosp</span>,
                        data <span class="op">=</span> <span class="va">linelist_surv</span>
                        <span class="op">)</span>


<span class="co">#test the proportional hazard model</span>
<span class="va">linelistsurv_ph_test</span> <span class="op">&lt;-</span> <span class="fu">cox.zph</span><span class="op">(</span><span class="va">linelistsurv_cox</span><span class="op">)</span>
<span class="va">linelistsurv_ph_test</span></code></pre></div>
<pre><code>##                    chisq df       p
## gender           0.45062  1    0.50
## age_years        0.00199  1    0.96
## source           1.79622  1    0.18
## days_onset_hosp 31.66167  1 1.8e-08
## GLOBAL          34.08502  4 7.2e-07</code></pre>
<p>La verificación gráfica de esta suposición puede realizarse con la función <code>ggcoxzph()</code> del paquete <strong>survminer</strong>.</p>
<div class="sourceCode" id="cb1232"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">survminer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survminer/man/ggcoxzph.html">ggcoxzph</a></span><span class="op">(</span><span class="va">linelistsurv_ph_test</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-921-1.png" width="672"></div>
<p>Los resultados del modelo indican que existe una asociación negativa entre la duración del inicio del ingreso y la mortalidad por todas las causas. El riesgo esperado es 0,9 veces menor en una persona que ingresa un día más tarde que otra, manteniendo el género constante. O, en una explicación más directa, un aumento de una unidad en la duración del inicio al ingreso se asocia con una disminución del 10,7% (<code>coef *100</code>) en el riesgo de muerte.</p>
<p>Los resultados muestran también una asociación positiva entre la fuente de infección y la mortalidad por todas las causas. Es decir, hay un mayor riesgo de muerte (1,21 veces) para los pacientes que tuvieron una fuente de infección distinta de los funerales.</p>
<div class="sourceCode" id="cb1233"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#print the summary of the model</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">linelistsurv_cox</span><span class="op">)</span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(futime, event) ~ gender + age_years + source + 
##     days_onset_hosp, data = linelist_surv)
## 
##   n= 2772, number of events= 1180 
##    (1767 observations deleted due to missingness)
## 
##                      coef exp(coef)  se(coef)      z Pr(&gt;|z|)    
## genderm          0.004710  1.004721  0.060827  0.077   0.9383    
## age_years       -0.002249  0.997753  0.002421 -0.929   0.3528    
## sourceother      0.178393  1.195295  0.084291  2.116   0.0343 *  
## days_onset_hosp -0.104063  0.901169  0.014245 -7.305 2.77e-13 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
##                 exp(coef) exp(-coef) lower .95 upper .95
## genderm            1.0047     0.9953    0.8918    1.1319
## age_years          0.9978     1.0023    0.9930    1.0025
## sourceother        1.1953     0.8366    1.0133    1.4100
## days_onset_hosp    0.9012     1.1097    0.8764    0.9267
## 
## Concordance= 0.566  (se = 0.009 )
## Likelihood ratio test= 71.31  on 4 df,   p=1e-14
## Wald test            = 59.22  on 4 df,   p=4e-12
## Score (logrank) test = 59.54  on 4 df,   p=4e-12</code></pre>
<p>Podemos comprobar esta relación con una tabla:</p>
<div class="sourceCode" id="cb1235"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_case_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">tabyl</span><span class="op">(</span><span class="va">days_onset_hosp</span>, <span class="va">outcome</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">adorn_percentages</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  
  <span class="fu">adorn_pct_formatting</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##  days_onset_hosp Death Recover   NA_
##                0 44.3%   31.4% 24.3%
##                1 46.6%   32.2% 21.2%
##                2 43.0%   32.8% 24.2%
##                3 45.0%   32.3% 22.7%
##                4 41.5%   38.3% 20.2%
##                5 40.0%   36.2% 23.8%
##                6 32.2%   48.7% 19.1%
##                7 31.8%   38.6% 29.5%
##                8 29.8%   38.6% 31.6%
##                9 30.3%   51.5% 18.2%
##               10 16.7%   58.3% 25.0%
##               11 36.4%   45.5% 18.2%
##               12 18.8%   62.5% 18.8%
##               13 10.0%   60.0% 30.0%
##               14 10.0%   50.0% 40.0%
##               15 28.6%   42.9% 28.6%
##               16 20.0%   80.0%  0.0%
##               17  0.0%  100.0%  0.0%
##               18  0.0%  100.0%  0.0%
##               22  0.0%  100.0%  0.0%
##               NA 52.7%   31.2% 16.0%</code></pre>
<p>Habría que considerar e investigar por qué existe esta asociación en los datos. Una posible explicación podría ser que los pacientes que viven lo suficiente como para ser ingresados más tarde tenían una enfermedad menos grave para empezar. Otra explicación, quizá más probable, es que, dado que utilizamos unos datos falsos simulados, este patrón no refleja la realidad.</p>
<!-- ======================================================= -->
</div>
<div id="forest-plots" class="section level3 unnumbered">
<h3>Forest plots<a class="anchor" aria-label="anchor" href="#forest-plots"><i class="fas fa-link"></i></a>
</h3>
<p>A continuación, podemos visualizar los resultados del modelo cox utilizando los prácticos gráficos de bosque con la función <code>ggforest()</code> del <strong>paquete survminer</strong>.</p>
<div class="sourceCode" id="cb1237"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggforest</span><span class="op">(</span><span class="va">linelistsurv_cox</span>, data <span class="op">=</span> <span class="va">linelist_surv</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/forestp-1.png" width="672"></div>
<!-- ======================================================= -->
</div>
</div>
<div id="time-dependent-covariates-in-survival-models" class="section level2" number="27.6">
<h2>
<span class="header-section-number">27.6</span> Covariables dependientes del tiempo en los modelos de supervivencia<a class="anchor" aria-label="anchor" href="#time-dependent-covariates-in-survival-models"><i class="fas fa-link"></i></a>
</h2>
<p>Algunas de las siguientes secciones han sido adaptadas con permiso de una excelente <a href="https://www.emilyzabor.com/tutorials/survival_analysis_in_r_tutorial.html">introducción al análisis de supervivencia en R</a> por <a href="https://www.emilyzabor.com/">la Dra. Emily Zabor</a></p>
<p>En la última sección hemos tratado el uso de la regresión de Cox para examinar las asociaciones entre las covariables de interés y los resultados de supervivencia, pero estos análisis dependen de que la covariable se mida en la línea de base, es decir, antes de que comience el tiempo de seguimiento del evento.</p>
<p>¿Qué ocurre si está interesado en una covariable que se mide <strong>después del</strong> tiempo de seguimiento? O, ¿qué pasa si tiene una covariable que puede cambiar con el tiempo?</p>
<p>Por ejemplo, tal vez esté trabajando con datos clínicos en los que repite medidas de valores de laboratorio del hospital que pueden cambiar con el tiempo. Este es un ejemplo de una <strong>covariable dependiente del tiempo</strong>. Para abordar esto se necesita una configuración especial, pero afortunadamente el modelo cox es muy flexible y este tipo de datos también puede ser modelado con herramientas del paquete de <strong>survival</strong>.</p>
<div id="configuración-de-covariables-dependientes-del-tiempo" class="section level3 unnumbered">
<h3>Configuración de covariables dependientes del tiempo<a class="anchor" aria-label="anchor" href="#configuraci%C3%B3n-de-covariables-dependientes-del-tiempo"><i class="fas fa-link"></i></a>
</h3>
<p>El análisis de covariables dependientes del tiempo en R requiere la configuración de unos datos especial. Si está interesado, Mira el documento más detallado sobre esto por el autor del paquete <strong>survival</strong> <a href="https://cran.r-project.org/web/packages/survival/vignettes/timedep.pdf">Using Time Dependent Covariates and Time Dependent Coefficients in the Cox Model</a>.</p>
<p>Para ello, utilizaremos un nuevo conjunto de datos del paquete <strong>SemiCompRisks</strong> denominado <code>BMT</code>, que incluye datos de 137 pacientes de trasplante de médula ósea. Las variables en las que nos centraremos son:</p>
<ul>
<li>
<code>T1</code> - tiempo (en días) hasta la muerte o el último seguimiento</li>
<li>
<code>delta1</code> - indicador de muerte; 1-Muerto, 0-Vivo</li>
<li>
<code>TA</code> - tiempo (en días) hasta la enfermedad de injerto contra huésped aguda</li>
<li>
<code>deltaA</code> - indicador de la enfermedad de injerto contra huésped aguda;
<ul>
<li>1 - Desarrolló la enfermedad de injerto contra huésped aguda</li>
<li>0 - Nunca desarrolló la enfermedad de injerto contra huésped aguda</li>
</ul>
</li>
</ul>
<p>Cargaremos este conjunto de datos del paquete <strong>survival</strong> utilizando el comando DE R <strong>base</strong> <code><a href="https://rdrr.io/r/utils/data.html">data()</a></code>, que puede utilizarse para cargar datos que ya están incluidos en un paquete de R que se ha cargado. El dataframe <code>BMT</code> aparecerá en tu entorno de R.</p>
<div class="sourceCode" id="cb1238"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">BMT</span>, package <span class="op">=</span> <span class="st">"SemiCompRisks"</span><span class="op">)</span></code></pre></div>
<div id="añadir-un-identificador-único-de-paciente" class="section level4 unnumbered">
<h4>Añadir un identificador único de paciente<a class="anchor" aria-label="anchor" href="#a%C3%B1adir-un-identificador-%C3%BAnico-de-paciente"><i class="fas fa-link"></i></a>
</h4>
<p>No hay una columna de identificación única en los datos de <code>BMT</code>, que es necesaria para crear el tipo de conjunto de datos que queremos. Así que utilizamos la función <code>rowid_to_column()</code> del paquete <strong>tibble</strong> de <strong>tidyverse</strong> para crear una nueva columna de identificación llamada <code>my_id</code> (añade una columna al principio del dataframe con identificadores de fila secuenciales, empezando por el 1). Llamamos al dataframe <code>bmt</code>.</p>
<div class="sourceCode" id="cb1239"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bmt</span> <span class="op">&lt;-</span> <span class="fu">rowid_to_column</span><span class="op">(</span><span class="va">BMT</span>, <span class="st">"my_id"</span><span class="op">)</span></code></pre></div>
<p>El conjunto de datos tiene ahora este aspecto:</p>
<div id="htmlwidget-187713d4f6e3f1af3ff3" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-187713d4f6e3f1af3ff3">{"x":{"filter":"none","vertical":false,"data":[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[2081,1602,1496,1462,1433,1377,1330,996,226,1199,1111,530,1182,1167,418,417,276,156,781,172,487,716,194,371,526,122,1279,110,243,86,466,262,162,262,1,107,269,350,2569,2506,2409,2218,1857,1829,1562,1470,1363,1030,860,1258,2246,1870,1799,1709,1674,1568,1527,1324,957,932,847,848,1850,1843,1535,1447,1384,414,2204,1063,481,105,641,390,288,522,79,1156,583,48,431,1074,393,10,53,80,35,1499,704,653,222,1356,2640,2430,2252,2140,2133,1238,1631,2024,1345,1136,845,491,162,1298,121,2,62,265,547,341,318,195,469,93,515,183,105,128,164,129,122,80,677,73,168,74,16,248,732,105,392,63,97,153,363],[2081,1602,1496,1462,1433,1377,1330,996,226,1199,1111,530,1182,1167,418,383,276,104,609,172,487,662,194,230,526,122,129,74,122,86,466,192,109,55,1,107,110,332,2569,2506,2409,2218,1857,1829,1562,1470,1363,1030,860,1258,2246,1870,1799,1709,1674,1568,1527,1324,957,932,847,848,1850,1843,1535,1447,1384,414,2204,1063,481,105,641,390,288,421,79,748,486,48,272,1074,381,10,53,80,35,248,704,211,219,606,2640,2430,2252,2140,2133,1238,1631,2024,1345,1136,845,422,162,84,100,2,47,242,456,268,318,32,467,47,390,183,105,115,164,93,120,80,677,64,168,74,16,157,625,48,273,63,76,113,363],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,0,0,1,0,1,0,0,1,1,1,0,0,1,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,0,1,0,1,0,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,0,1,1,1,1,0,1,1,1,1,0,0,1,0,1,1,0,0,1,0,0,0,1,1,1,1,0,1,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[67,1602,1496,70,1433,1377,1330,72,226,1199,1111,38,1182,39,418,417,276,28,781,22,487,716,194,371,526,88,1279,110,243,86,466,10,162,262,1,107,269,350,2569,2506,2409,2218,1857,1829,1562,1470,1363,1030,860,1258,52,1870,1799,20,1674,1568,1527,25,957,29,847,848,1850,1843,1535,1447,1384,414,2204,1063,30,21,641,390,18,25,16,1156,583,48,431,1074,393,10,53,10,35,1499,36,653,222,1356,2640,2430,2252,2140,2133,1238,1631,2024,32,1136,845,491,162,1298,28,2,62,265,547,21,318,195,469,93,515,183,105,128,164,129,122,21,677,73,168,29,16,248,732,105,392,38,97,153,363],[1,0,0,1,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,1,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0],[121,139,307,95,236,123,96,121,226,91,1111,84,112,487,220,417,81,156,781,172,76,716,94,184,121,122,1279,110,243,86,119,84,162,262,1,107,120,350,2569,2506,2409,2218,260,1829,1562,180,200,210,860,120,380,230,140,348,1674,1568,1527,1324,957,932,847,155,1850,1843,1535,220,200,414,2204,240,120,105,641,390,100,140,79,180,583,48,431,120,100,10,53,80,35,1499,155,653,123,1356,2640,2430,150,220,250,250,150,180,360,140,845,180,162,1298,121,2,62,210,130,100,140,195,90,93,515,130,105,128,164,129,122,80,150,73,200,74,16,100,732,105,122,63,97,153,363],[1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,0,1,0,0,0,1,0,1,1,1,0,0,0,0,0,1,1,0,0,0,0,1,0,0,0,0,0,1,0,0,1,1,1,0,1,1,1,1,1,0,0,0,0,0,0,0,1,0,0,0,1,1,0,0,1,1,0,0,0,1,1,0,1,0,0,0,1,1,0,0,0,0,0,1,0,1,0,0,0,1,1,1,1,1,1,1,1,0,1,0,0,0,0,0,1,1,1,1,0,1,0,0,1,0,0,0,0,0,0,1,0,1,0,0,1,0,0,1,0,0,0,0],[13,18,12,13,12,12,17,12,10,29,22,34,22,1167,21,16,21,20,26,37,22,17,25,9,11,13,22,49,23,86,100,59,40,24,1,107,27,33,21,17,16,11,15,19,18,14,12,14,15,66,15,16,12,19,24,14,13,15,69,7,16,16,9,19,21,24,19,27,12,16,24,15,11,11,288,20,79,18,11,14,12,19,16,10,53,80,35,9,18,23,52,14,22,14,17,18,17,18,40,16,14,15,20,491,13,1298,65,2,11,14,24,17,12,16,20,28,31,21,105,12,164,51,12,0,8,38,48,24,16,52,18,30,24,16,97,59,19],[1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1,1],[26,21,26,17,32,22,20,22,18,24,19,17,24,27,18,15,18,20,27,40,22,28,26,39,15,20,17,28,37,17,15,29,36,23,42,30,29,22,19,31,35,16,29,19,26,27,13,25,25,30,45,33,32,23,37,15,22,46,18,27,28,23,37,34,35,33,21,21,25,50,35,37,26,50,45,28,43,14,17,32,30,30,33,34,33,30,23,35,29,23,28,33,18,29,35,27,36,24,27,35,50,47,40,22,22,8,39,20,27,32,31,20,35,36,35,7,23,11,14,37,19,37,25,35,15,45,32,41,27,33,39,17,43,44,48,31,52],[33,37,35,21,36,31,17,24,21,40,28,28,23,22,14,20,5,33,27,37,20,32,32,31,20,26,20,25,38,26,18,32,43,16,48,19,20,20,13,34,31,16,35,18,30,34,24,29,31,16,39,30,23,28,34,19,12,31,17,30,29,26,36,32,32,28,18,15,19,38,36,34,24,48,43,30,43,19,14,33,23,32,28,54,41,35,25,18,21,16,30,22,23,26,31,17,39,28,21,41,36,27,39,21,23,2,48,19,25,32,28,23,40,39,33,2,25,7,18,35,32,34,29,28,14,42,43,29,36,39,43,14,50,37,56,25,48],[1,1,1,0,1,1,1,1,0,1,1,1,0,0,1,1,0,1,1,0,1,1,0,0,1,1,0,1,0,1,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,0,0,0,0,0,1,0,1,1,0,1,1,0,1,1,0,0,0,0,0,1,0,1,1,1,1,1,1,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,1,1,1,0,1,1,0,1,1,0,0,1,0,1,1,1,1,1,0,0,1,0,1,1,0,1,0,0,0,0,1,1,0,0,0,0,0,0,0,1,1,1,0,1],[0,1,1,1,1,1,0,0,1,1,1,1,0,1,1,1,0,1,0,0,1,1,1,1,1,0,0,0,1,0,1,1,1,1,1,1,1,0,1,1,1,1,0,1,1,1,1,0,1,1,0,0,0,1,1,0,1,1,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,1,1,1,0,0,1,1,1,1,0,0,1,0,1,1,1,0,1,1,1,1,0,1,1,0,0,1,1,0,0,0,0,0,1,1,1,0,0,1,1,1,0,1,1,1,0,0,0,1,1,0,1,1,1,1,0,0,1,1,1,1,1,1,1],[1,0,1,0,1,1,1,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1,0,1,1,1,0,1,1,0,1,0,1,1,1,1,1,0,1,0,0,1,0,1,0,1,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,1,1,1,0,0,1,0,0,0,0,1,1,1,0,1,1,0,1,0,1,0,1,1,0,0,0,1,0,1,1,0,1,1,1,0,0,1,1,0,0,0,1,1,1,0,1,0,1,0,0,1,0,1,1,0,1,1,1,1,1,1,1,0,1,0,1,1,1],[1,0,0,0,1,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,0,0,0,1,0,1,0,0,1,0,0,0,0,1,0,1,1,0,0,0,1,0,0,0,1,1,0,0,1,0,0,1,0,0,0,0,1,1,0,0,0,0,1,1,0,1,0,1,1,0,1,1,0,0,1,1,0,0,0,0,0,0,0,1,1,1,1,1,0,0,1,0,0,1,0,1,0,1,0,0,1,0,1,0,1,0,1,0,0,0,1,1,1,0,0,0,0,0,0,1,1,0,1,0,0,0,1,1,0,1,1,0,0,0,1,1,0],[98,1720,127,168,93,2187,1006,1319,208,174,236,151,203,191,110,824,146,85,187,129,128,84,329,147,943,2616,937,303,170,239,508,74,393,331,196,178,361,834,270,60,120,60,90,210,90,240,90,210,180,180,105,225,120,90,60,90,450,75,90,60,75,180,180,270,180,150,120,120,60,270,90,120,90,120,90,90,90,60,120,150,120,150,120,240,180,150,150,30,105,90,120,210,750,24,120,210,240,240,690,105,120,900,210,210,300,105,210,75,90,180,630,180,300,90,120,135,210,120,150,270,285,240,510,780,150,180,150,750,180,180,150,210,240,360,330,240,180],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,0,0,1,0,0,0,0,1,0,0,1,0,1,1,0,0,0,0,1,0,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,1,0,0,1,1,0,1,1,1,1,1,1,1,0,1,0,1,1,1,1,0,1,1,1,1,1,1,1,0,0,1,1,1,0,1,0,0,0],[1,1,1,1,1,1,1,1,1,3,3,3,2,2,1,1,1,1,1,1,1,1,1,1,1,1,3,3,3,3,3,3,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,2,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,4,4,4,3,3,1,1,1,1,1,1,2,4,4,3,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,4,4,4,4,3,3,3,3,3],[0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,1,1,0,0,0,0,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,1,1,1,1,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>my_id<\/th>\n      <th>g<\/th>\n      <th>T1<\/th>\n      <th>T2<\/th>\n      <th>delta1<\/th>\n      <th>delta2<\/th>\n      <th>delta3<\/th>\n      <th>TA<\/th>\n      <th>deltaA<\/th>\n      <th>TC<\/th>\n      <th>deltaC<\/th>\n      <th>TP<\/th>\n      <th>deltaP<\/th>\n      <th>Z1<\/th>\n      <th>Z2<\/th>\n      <th>Z3<\/th>\n      <th>Z4<\/th>\n      <th>Z5<\/th>\n      <th>Z6<\/th>\n      <th>Z7<\/th>\n      <th>Z8<\/th>\n      <th>Z9<\/th>\n      <th>Z10<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="ampliar-las-filas-de-pacientes" class="section level4 unnumbered">
<h4>Ampliar las filas de pacientes<a class="anchor" aria-label="anchor" href="#ampliar-las-filas-de-pacientes"><i class="fas fa-link"></i></a>
</h4>
<p>A continuación, utilizaremos la función <code>tmerge()</code> con las funciones de ayuda <code>event()</code> y <code>tdc()</code> para crear el conjunto de datos reestructurado. Nuestro objetivo es reestructurar el conjunto de datos para crear una fila separada para cada paciente por cada intervalo de tiempo en el que tengan un valor diferente de <code>deltaA</code>. En este caso, cada paciente puede tener como máximo dos filas dependiendo de si desarrollaron la enfermedad aguda de injerto contra huésped durante el periodo de recogida de datos. Llamaremos a nuestro nuevo indicador para el desarrollo de la enfermedad aguda de injerto contra huésped <code>agvhd</code>.</p>
<ul>
<li>
<code>tmerge()</code> crea unos datos largo con múltiples intervalos de tiempo para los diferentes valores de las covariables de cada paciente</li>
<li>
<code>event()</code> crea el nuevo indicador de eventos para que vaya con los intervalos de tiempo recién creados</li>
<li>
<code>tdc()</code> crea la columna de covarianza dependiente del tiempo, <code>agvhd</code>, para que vaya con los intervalos de tiempo recién creados</li>
</ul>
<div class="sourceCode" id="cb1240"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">td_dat</span> <span class="op">&lt;-</span> 
  <span class="fu">tmerge</span><span class="op">(</span>
    data1 <span class="op">=</span> <span class="va">bmt</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">select</span><span class="op">(</span><span class="va">my_id</span>, <span class="va">T1</span>, <span class="va">delta1</span><span class="op">)</span>, 
    data2 <span class="op">=</span> <span class="va">bmt</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">select</span><span class="op">(</span><span class="va">my_id</span>, <span class="va">T1</span>, <span class="va">delta1</span>, <span class="va">TA</span>, <span class="va">deltaA</span><span class="op">)</span>, 
    id <span class="op">=</span> <span class="va">my_id</span>, 
    death <span class="op">=</span> <span class="fu">event</span><span class="op">(</span><span class="va">T1</span>, <span class="va">delta1</span><span class="op">)</span>,
    agvhd <span class="op">=</span> <span class="fu">tdc</span><span class="op">(</span><span class="va">TA</span><span class="op">)</span>
    <span class="op">)</span></code></pre></div>
<p>Para ver qué hace esto, veamos los datos de los 5 primeros pacientes individuales.</p>
<p>Las variables de interés en los datos originales tenían este aspecto:</p>
<div class="sourceCode" id="cb1241"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bmt</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">my_id</span>, <span class="va">T1</span>, <span class="va">delta1</span>, <span class="va">TA</span>, <span class="va">deltaA</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">my_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##   my_id   T1 delta1   TA deltaA
## 1     1 2081      0   67      1
## 2     2 1602      0 1602      0
## 3     3 1496      0 1496      0
## 4     4 1462      0   70      1
## 5     5 1433      0 1433      0</code></pre>
<p>El nuevo conjunto de datos para estos mismos pacientes tiene el siguiente aspecto:</p>
<div class="sourceCode" id="cb1243"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">td_dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">my_id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##   my_id   T1 delta1 tstart tstop death agvhd
## 1     1 2081      0      0    67     0     0
## 2     1 2081      0     67  2081     0     1
## 3     2 1602      0      0  1602     0     0
## 4     3 1496      0      0  1496     0     0
## 5     4 1462      0      0    70     0     0
## 6     4 1462      0     70  1462     0     1
## 7     5 1433      0      0  1433     0     0</code></pre>
<p>Ahora algunos de nuestros pacientes tienen dos filas en el conjunto de datos correspondientes a intervalos en los que tienen un valor diferente de nuestra nueva variable, agvhd. Por ejemplo, el paciente 1 tiene ahora dos filas con un valor de agvhd de cero desde el tiempo 0 hasta el tiempo 67, y un valor de 1 desde el tiempo 67 hasta el tiempo 2081.</p>
</div>
</div>
<div id="regresión-de-cox-con-covariables-dependientes-del-tiempo" class="section level3 unnumbered">
<h3>Regresión de Cox con covariables dependientes del tiempo<a class="anchor" aria-label="anchor" href="#regresi%C3%B3n-de-cox-con-covariables-dependientes-del-tiempo"><i class="fas fa-link"></i></a>
</h3>
<p>Ahora que hemos remodelado nuestros datos y añadido la nueva variable <code>aghvd</code> dependiente del tiempo, vamos a ajustar un modelo de regresión cox simple de una sola variable. Podemos utilizar la misma función <code>coxph()</code> que antes, sólo tenemos que cambiar nuestra función <code>Surv()</code> para especificar tanto el tiempo de inicio como el de finalización de cada intervalo utilizando los argumentos <code>time1 =</code> y <code>time2 =</code>.</p>
<div class="sourceCode" id="cb1245"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bmt_td_model</span> <span class="op">=</span> <span class="fu">coxph</span><span class="op">(</span>
  <span class="fu">Surv</span><span class="op">(</span>time <span class="op">=</span> <span class="va">tstart</span>, time2 <span class="op">=</span> <span class="va">tstop</span>, event <span class="op">=</span> <span class="va">death</span><span class="op">)</span> <span class="op">~</span> <span class="va">agvhd</span>, 
  data <span class="op">=</span> <span class="va">td_dat</span>
  <span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">bmt_td_model</span><span class="op">)</span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(time = tstart, time2 = tstop, event = death) ~ 
##     agvhd, data = td_dat)
## 
##   n= 163, number of events= 80 
## 
##         coef exp(coef) se(coef)    z Pr(&gt;|z|)
## agvhd 0.3351    1.3980   0.2815 1.19    0.234
## 
##       exp(coef) exp(-coef) lower .95 upper .95
## agvhd     1.398     0.7153    0.8052     2.427
## 
## Concordance= 0.535  (se = 0.024 )
## Likelihood ratio test= 1.33  on 1 df,   p=0.2
## Wald test            = 1.42  on 1 df,   p=0.2
## Score (logrank) test = 1.43  on 1 df,   p=0.2</code></pre>
<p>De nuevo, visualizaremos los resultados de nuestro modelo cox utilizando la función <code>ggforest()</code> del paquete <strong>urvminer</strong>.:</p>
<div class="sourceCode" id="cb1247"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggforest</span><span class="op">(</span><span class="va">bmt_td_model</span>, data <span class="op">=</span> <span class="va">td_dat</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-930-1.png" width="672"></div>
<p>Como se puede ver en el gráfico de bosque, el intervalo de confianza y el valor-p p, no parece haber una fuerte asociación entre la muerte y la enfermedad de injerto contra huésped aguda en el contexto de nuestro modelo simple.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="resources-19" class="section level2" number="27.7">
<h2>
<span class="header-section-number">27.7</span> Recursos<a class="anchor" aria-label="anchor" href="#resources-19"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2394262/">Análisis de supervivencia Parte I: Conceptos básicos y primeros análisis</a></p>
<p><a href="https://www.emilyzabor.com/tutorials/survival_analysis_in_r_tutorial.html">Análisis de supervivencia en R</a></p>
<p><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2954271/">Análisis de supervivencia en la investigación de enfermedades infecciosas: Descripción de eventos en el tiempo</a></p>
<p><a href="https://data.princeton.edu/wws509/notes/c7.pdf">Capítulo sobre modelos de supervivencia avanzados Princeton</a></p>
<p><a href="https://cran.r-project.org/web/packages/survival/vignettes/timedep.pdf">Uso de covariables y coeficientes dependientes del tiempo en el modelo de Cox</a></p>
<p><a href="https://publicifsv.sund.ku.dk/~ts/survival/survival-cheat.pdf">Hoja de trucos de análisis de supervivencia con R</a></p>
<p><a href="https://paulvanderlaken.files.wordpress.com/2017/08/survminer_cheatsheet.pdf">Hoja de trucos de Survminer</a></p>
<p><a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6322561/">Documento sobre diferentes medidas de supervivencia para datos de registros de cáncer con Rcode proporcionado como material suplementario</a></p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="survey-analysis.html"><span class="header-section-number">26</span> Borrador. Análisis de encuestas</a></div>
<div class="next"><a href="gis-basics.html"><span class="header-section-number">28</span> Conceptos básicos de los SIG</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#survival-analysis"><span class="header-section-number">27</span> Borrador. Análisis de supervivencia</a></li>
<li><a class="nav-link" href="#overview-5"><span class="header-section-number">27.1</span> Resumen</a></li>
<li>
<a class="nav-link" href="#preparation-17"><span class="header-section-number">27.2</span> Preparación</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#cargar-paquetes-16">Cargar paquetes</a></li>
<li><a class="nav-link" href="#importar-los-datos">Importar los datos</a></li>
<li><a class="nav-link" href="#gesti%C3%B3n-y-transformaci%C3%B3n-de-datos">Gestión y transformación de datos</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#basics-of-survival-analysis"><span class="header-section-number">27.3</span> Fundamentos del análisis de supervivencia</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#construir-un-objeto-de-tipo-surv-type">Construir un objeto de tipo surv-type</a></li>
<li><a class="nav-link" href="#realizaci%C3%B3n-de-los-primeros-an%C3%A1lisis">Realización de los primeros análisis</a></li>
<li><a class="nav-link" href="#peligro-acumulado">Peligro acumulado</a></li>
<li><a class="nav-link" href="#trazado-de-curvas-de-kaplan-meir">Trazado de curvas de Kaplan-Meir</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#comparison-of-survival-curves"><span class="header-section-number">27.4</span> Comparación de las curvas de supervivencia</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#test-log-rank">test Log rank</a></li></ul>
</li>
<li>
<a class="nav-link" href="#cox-regression-analysis"><span class="header-section-number">27.5</span> Análisis de regresión de Cox</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#ajuste-de-un-modelo-de-cox">Ajuste de un modelo de Cox</a></li>
<li><a class="nav-link" href="#forest-plots">Forest plots</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#time-dependent-covariates-in-survival-models"><span class="header-section-number">27.6</span> Covariables dependientes del tiempo en los modelos de supervivencia</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#configuraci%C3%B3n-de-covariables-dependientes-del-tiempo">Configuración de covariables dependientes del tiempo</a></li>
<li><a class="nav-link" href="#regresi%C3%B3n-de-cox-con-covariables-dependientes-del-tiempo">Regresión de Cox con covariables dependientes del tiempo</a></li>
</ul>
</li>
<li><a class="nav-link" href="#resources-19"><span class="header-section-number">27.7</span> Recursos</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>El manual de R para la Epidemiología</strong>" was written by El equipo del manual. It was last built on 2022-02-01.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
