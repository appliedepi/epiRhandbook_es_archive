<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>14 Unir datos | EpiRhandbook en español</title>
<meta name="author" content="El equipo del manual">
<meta name="description" content="Arriba: un ejemplo animado de una unión por la izquierda (fuente de la imagen) Esta página describe diferentes formas de unir datos (“join”, “match”, “link”, “bind”) y combinar dataframes.  14.1...">
<meta name="generator" content="bookdown 0.29 with bs4_book()">
<meta property="og:title" content="14 Unir datos | EpiRhandbook en español">
<meta property="og:type" content="book">
<meta property="og:description" content="Arriba: un ejemplo animado de una unión por la izquierda (fuente de la imagen) Esta página describe diferentes formas de unir datos (“join”, “match”, “link”, “bind”) y combinar dataframes.  14.1...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="14 Unir datos | EpiRhandbook en español">
<meta name="twitter:description" content="Arriba: un ejemplo animado de una unión por la izquierda (fuente de la imagen) Esta página describe diferentes formas de unir datos (“join”, “match”, “link”, “bind”) y combinar dataframes.  14.1...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.25/datatables.js"></script><link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/tabwid.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/scrool.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.9/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.5.1/plotly-basic-2.5.1.min.js"></script><script src="libs/plotly-cartesian-2.5.1/plotly-cartesian-2.5.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">EpiRhandbook en español</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Buscar" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Tabla de contenidos</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">Acerca de este libro</li>
<li><a class="" href="editorial-and-technical-notes.html"><span class="header-section-number">1</span> Notas editoriales y técnicas</a></li>
<li><a class="" href="download-handbook-and-data.html"><span class="header-section-number">2</span> Descargando el manual y los datos</a></li>
<li class="book-part">Aspectos básicos</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">3</span> Fundamentos de R</a></li>
<li><a class="" href="transition-to-r.html"><span class="header-section-number">4</span> Transición a R</a></li>
<li><a class="" href="suggested-packages-1.html"><span class="header-section-number">5</span> Paquetes recomendados</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> Proyectos en R</a></li>
<li><a class="" href="import-and-export.html"><span class="header-section-number">7</span> Importación y exportación</a></li>
<li class="book-part">Gestión de datos</li>
<li><a class="" href="cleaning-data-and-core-functions.html"><span class="header-section-number">8</span> Limpieza de datos y funciones básicas</a></li>
<li><a class="" href="working-with-dates.html"><span class="header-section-number">9</span> Trabajando con Fechas</a></li>
<li><a class="" href="characters-and-strings.html"><span class="header-section-number">10</span> Caracteres y cadenas</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> Factores</a></li>
<li><a class="" href="pivoting-data.html"><span class="header-section-number">12</span> Pivotar datos</a></li>
<li><a class="" href="grouping-data.html"><span class="header-section-number">13</span> Agrupar datos</a></li>
<li><a class="active" href="joining-data.html"><span class="header-section-number">14</span> Unir datos</a></li>
<li><a class="" href="de-duplication.html"><span class="header-section-number">15</span> De-duplicación</a></li>
<li><a class="" href="iteration-loops-and-lists.html"><span class="header-section-number">16</span> Iteración, bucles y listas</a></li>
<li class="book-part">Análisis</li>
<li><a class="" href="descriptive-tables.html"><span class="header-section-number">17</span> Tablas descriptivas</a></li>
<li><a class="" href="simple-statistical-tests.html"><span class="header-section-number">18</span> Tests estadísticos sencillos</a></li>
<li><a class="" href="univariate-and-multivariable-regression.html"><span class="header-section-number">19</span> Regresión univariante y multivariable</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> Valores faltantes</a></li>
<li><a class="" href="standardised-rates.html"><span class="header-section-number">21</span> Tasas estandarizadas</a></li>
<li><a class="" href="moving-averages.html"><span class="header-section-number">22</span> Medias Móviles</a></li>
<li><a class="" href="time-series-and-outbreak-detection.html"><span class="header-section-number">23</span> Series temporales y detección de brotes</a></li>
<li><a class="" href="epidemic-modeling.html"><span class="header-section-number">24</span> Modelización de epidemias</a></li>
<li><a class="" href="contact-tracing-1.html"><span class="header-section-number">25</span> Rastreo de contactos</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">26</span> Análisis de supervivencia</a></li>
<li><a class="" href="gis-basics.html"><span class="header-section-number">27</span> Conceptos básicos de los SIG</a></li>
<li class="book-part">Visualización de datos</li>
<li><a class="" href="tables-for-presentation.html"><span class="header-section-number">28</span> Tablas para presentaciones</a></li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">29</span> Conceptos básicos de ggplot</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">30</span> Consejos de ggplot</a></li>
<li><a class="" href="epidemic-curves.html"><span class="header-section-number">31</span> Curvas epidémicas</a></li>
<li><a class="" href="demographic-pyramids-and-likert-scales.html"><span class="header-section-number">32</span> Pirámides de población y escalas de Likert</a></li>
<li><a class="" href="heat-plots.html"><span class="header-section-number">33</span> Gráficos de calor</a></li>
<li><a class="" href="diagrams-and-charts.html"><span class="header-section-number">34</span> Diagramas y gráficos</a></li>
<li><a class="" href="combinations-analysis.html"><span class="header-section-number">35</span> Análisis de combinaciones</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">36</span> Cadenas de transmisión</a></li>
<li><a class="" href="phylogenetic-trees-1.html"><span class="header-section-number">37</span> Árboles filogenéticos</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">38</span> Gráficos interactivos</a></li>
<li class="book-part">Informes y Dashboards</li>
<li><a class="" href="reports-with-r-markdown.html"><span class="header-section-number">39</span> Informes con R Markdown</a></li>
<li><a class="" href="organizing-routine-reports.html"><span class="header-section-number">40</span> Organización de informes rutinarios</a></li>
<li><a class="" href="dashboards-with-r-markdown.html"><span class="header-section-number">41</span> Dashboards con R Markdown</a></li>
<li><a class="" href="dashboards-with-shiny.html"><span class="header-section-number">42</span> Dashboards con Shiny</a></li>
<li class="book-part">Miscelánea</li>
<li><a class="" href="writing-functions-1.html"><span class="header-section-number">43</span> Escribir funciones</a></li>
<li><a class="" href="directory-interactions.html"><span class="header-section-number">44</span> Interacciones con directorios</a></li>
<li><a class="" href="version-control-and-collaboration-with-git-and-github.html"><span class="header-section-number">45</span> Control de versiones y colaboración con Git y Github</a></li>
<li><a class="" href="common-errors.html"><span class="header-section-number">46</span> Errores comunes</a></li>
<li><a class="" href="getting-help.html"><span class="header-section-number">47</span> Cómo obtener ayuda</a></li>
<li><a class="" href="r-on-network-drives.html"><span class="header-section-number">48</span> R en redes locales</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">49</span> data.table</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="joining-data" class="section level1" number="14">
<h1>
<span class="header-section-number">14</span> Unir datos<a class="anchor" aria-label="anchor" href="#joining-data"><i class="fas fa-link"></i></a>
</h1>
<div class="inline-figure"><img src="images/left-join.gif" width="50%"></div>
<p><em>Arriba: un ejemplo animado de una unión por la izquierda (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">fuente de la imagen</a>)</em></p>
<p>Esta página describe diferentes formas de unir datos (“join”, “match”, “link”, “bind”) y combinar dataframes.</p>
<!-- ======================================================= -->
<div id="preparation-5" class="section level2" number="14.1">
<h2>
<span class="header-section-number">14.1</span> Preparación<a class="anchor" aria-label="anchor" href="#preparation-5"><i class="fas fa-link"></i></a>
</h2>
<div id="cargar-paquetes-5" class="section level3 unnumbered">
<h3>Cargar paquetes<a class="anchor" aria-label="anchor" href="#cargar-paquetes-5"><i class="fas fa-link"></i></a>
</h3>
<p>Este trozo de código muestra la carga de los paquetes necesarios para los análisis. En este manual destacamos <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> de <strong>pacman</strong>, que instala el paquete si es necesario <em>y</em> lo carga para su uso. También puede cargar los paquetes instalados con <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> de R <strong>base</strong>. Consulta la página sobre <a href="r-basics.html#r-basics">Fundamentos de R</a> para obtener más información sobre los paquetes de R.</p>
<div class="sourceCode" id="cb665"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
  <span class="va">rio</span>,            <span class="co"># import and export</span>
  <span class="va">here</span>,           <span class="co"># locate files </span>
  <span class="va">tidyverse</span>,      <span class="co"># data management and visualisation</span>
  <span class="va">RecordLinkage</span>,  <span class="co"># probabilistic matches</span>
  <span class="va">fastLink</span>        <span class="co"># probabilistic matches</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="importar-datos-5" class="section level3 unnumbered">
<h3>Importar datos<a class="anchor" aria-label="anchor" href="#importar-datos-5"><i class="fas fa-link"></i></a>
</h3>
<p>Para empezar, importamos la lista de casos limpiada de una epidemia de ébola simulada. Si quieres seguir el proceso, <a href="https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/case_linelists/linelist_cleaned.rds">clica aquí para descargar el listado “limpio”</a> (como archivo .rds). Importa los datos con la función <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> del paquete <strong>rio</strong> (maneja muchos tipos de archivos como .xlsx, .csv, .rds - mira la página de <a href="import-and-export.html#import-and-export">importación y exportación</a> para más detalles).</p>
<div class="sourceCode" id="cb666"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># import case linelist </span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_cleaned.rds"</span><span class="op">)</span></code></pre></div>
<p>A continuación se muestran las primeras 50 filas del listado.</p>
<div id="htmlwidget-5328e5930e76c387a94e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5328e5930e76c387a94e">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399939200000\" data-max=\"1407024000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-29&quot;,&quot;30-49&quot;,&quot;50-69&quot;,&quot;70+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.8184429761563,16.0652496292635,22.4965706447188,71.4144019043841,41.6171224732461,62.0953890870657,0,16.8376536925366,22.7903289734443,53.4119897959184,24.2802636142907,22.4600343506408,54.320987654321,41.0578432556455,28.5664819944598,17.0320552013276,25.0412914912888,38.7172182043977,27.3876813705495,31.5555555555556,14.8069075945662,30.8839811199813,26.6193433895297,59.375,96.6183574879227,19.2394748755093,84.9403122130395,18.4199377406104,27.7722674072605,41.3223140495868,17.2080666586161,24.1671624033314,15.7218971089178,428.994082840237,27.9930220292912,243.261012491782,20.2395007589813,30.527446435638,25.15589569161,47,39.04,31.0661643201798,77.9683671196257,29.5165961238583,166.493236212279,100.308641975309,37.76,20.6037803457852,23.458562375267],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
<div id="datos-de-los-ejemplos" class="section level3 unnumbered">
<h3>Datos de los ejemplos<a class="anchor" aria-label="anchor" href="#datos-de-los-ejemplos"><i class="fas fa-link"></i></a>
</h3>
<p>En la sección de unión que sigue, utilizaremos los siguientes datos:</p>
<ol style="list-style-type: decimal">
<li>Una versión “en miniatura” de casos de <code>linelist</code>, que contiene sólo las columnas <code>case_id</code>, <code>date_onset</code>, y <code>hospital</code>, y sólo las 10 primeras filas</li>
<li>Un dataframe separado llamado <code>hosp_info</code>, que contiene más detalles sobre cada hospital</li>
</ol>
<p>En la sección sobre el emparejamiento probabilístico, utilizaremos dos pequeños conjuntos de datos diferentes. El código para crear esos conjuntos de datos se da en esa sección.</p>
<div id="joins_llmini" class="section level4 unnumbered">
<h4>“Miniatura” de casos de linelist<a class="anchor" aria-label="anchor" href="#joins_llmini"><i class="fas fa-link"></i></a>
</h4>
<p>A continuación se muestra la lista de casos en miniatura, que contiene sólo 10 filas y sólo las columnas <code>case_id</code>, <code>date_onset</code>, y <code>hospital</code>.</p>
<div class="sourceCode" id="cb667"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_mini</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>                 <span class="co"># start with original linelist</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">case_id</span>, <span class="va">date_onset</span>, <span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co"># select columns</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>                                    <span class="co"># only take the first 10 rows</span></code></pre></div>
<div id="htmlwidget-f39f730cf32c249e1ee9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f39f730cf32c249e1ee9">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca"],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="joins_hosp_info" class="section level4 unnumbered">
<h4>dataframe de información hospitalaria<a class="anchor" aria-label="anchor" href="#joins_hosp_info"><i class="fas fa-link"></i></a>
</h4>
<p>A continuación se muestra el código para crear un dataframe separado con información adicional sobre siete hospitales (la población de captación y el nivel de atención disponible). Obsérvese que el nombre “Hospital Militar” pertenece a dos hospitales diferentes: uno de nivel primario que atiende a 10000 residentes y otro de nivel secundario que atiende a 50280 residentes.</p>
<div class="sourceCode" id="cb668"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make the hospital information data frame</span>
<span class="va">hosp_info</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  hosp_name     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"central hospital"</span>, <span class="st">"military"</span>, <span class="st">"military"</span>, <span class="st">"port"</span>, <span class="st">"St. Mark's"</span>, <span class="st">"ignace"</span>, <span class="st">"sisters"</span><span class="op">)</span>,
  catchment_pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1950280</span>, <span class="fl">40500</span>, <span class="fl">10000</span>, <span class="fl">50280</span>, <span class="fl">12000</span>, <span class="fl">5000</span>, <span class="fl">4200</span><span class="op">)</span>,
  level         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tertiary"</span>, <span class="st">"Secondary"</span>, <span class="st">"Primary"</span>, <span class="st">"Secondary"</span>, <span class="st">"Secondary"</span>, <span class="st">"Primary"</span>, <span class="st">"Primary"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Aquí está este dataframe:</p>
<div id="htmlwidget-0191acfd5007e582da43" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-0191acfd5007e582da43">{"x":{"filter":"none","vertical":false,"data":[["central hospital","military","military","port","St. Mark's","ignace","sisters"],[1950280,40500,10000,50280,12000,5000,4200],["Tertiary","Secondary","Primary","Secondary","Secondary","Primary","Primary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hosp_name<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":7,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[7,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
</div>
<div id="pre-limpieza" class="section level3 unnumbered">
<h3>Pre-limpieza<a class="anchor" aria-label="anchor" href="#pre-limpieza"><i class="fas fa-link"></i></a>
</h3>
<p>Las uniones tradicionales (no probabilísticas) distinguen entre mayúsculas y minúsculas y requieren coincidencias de caracteres exactas entre los valores de los dos dataframes. Para mostrar algunos de los pasos de limpieza que puedes necesitar antes de iniciar una unión, ahora limpiaremos y alinearemos los datos <code>linelist_mini</code> y <code>hosp_info</code>.</p>
<p><strong>Identificar las diferencias</strong></p>
<p>Necesitamos que los valores de la columna <code>hosp_name</code> en el dataframe <code>hosp_info</code> coincidan con los valores de la columna <code>hospital</code> en el dataframe <code>linelist_mini</code>.</p>
<p>Aquí están los valores del dataframe <code>linelist_mini</code>, impresos con la función de R <strong>base</strong> <code><a href="https://rdrr.io/r/base/unique.html">unique()</a></code>:</p>
<div class="sourceCode" id="cb669"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">linelist_mini</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Other"                               
## [2] "Missing"                             
## [3] "St. Mark's Maternity Hospital (SMMH)"
## [4] "Port Hospital"                       
## [5] "Military Hospital"</code></pre>
<p>y aquí están los valores del dataframe <code>hosp_info</code>:</p>
<div class="sourceCode" id="cb671"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">hosp_info</span><span class="op">$</span><span class="va">hosp_name</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "central hospital" "military"         "port"            
## [4] "St. Mark's"       "ignace"           "sisters"</code></pre>
<p>Puedes ver que, aunque algunos de los hospitales existen en ambos dataframes, hay muchas diferencias en la ortografía.</p>
<p><strong>Alinear los valores</strong></p>
<p>Comenzamos limpiando los valores del dataframe <code>hosp_info</code>. Como se explica en la página <a href="cleaning-data-and-core-functions.html#cleaning-data-and-core-functions">Limpieza de datos y funciones básicas</a>, podemos recodificar los valores con criterios lógicos utilizando la función <code>case_when()</code> de <strong>dplyr</strong>. Para los cuatro hospitales que existen en ambos dataframes, cambiamos los valores para alinearlos con los valores de <code>linelist_mini</code>. Para los demás hospitales dejamos los valores como están (<code>TRUE ~ hosp_name</code>).</p>
<p><span style="color: orange;"><strong><em>PRECAUCIÓN:</em></strong> Normalmente, al limpiar se debe crear una nueva columna (por ejemplo, <code>hosp_name_clean</code>), pero para facilitar la demostración mostramos la modificación de la antigua columna </span></p>
<div class="sourceCode" id="cb673"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hosp_info</span> <span class="op">&lt;-</span> <span class="va">hosp_info</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    hosp_name <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span>
      <span class="co"># criteria                         # new value</span>
      <span class="va">hosp_name</span> <span class="op">==</span> <span class="st">"military"</span>          <span class="op">~</span> <span class="st">"Military Hospital"</span>,
      <span class="va">hosp_name</span> <span class="op">==</span> <span class="st">"port"</span>              <span class="op">~</span> <span class="st">"Port Hospital"</span>,
      <span class="va">hosp_name</span> <span class="op">==</span> <span class="st">"St. Mark's"</span>        <span class="op">~</span> <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span>,
      <span class="va">hosp_name</span> <span class="op">==</span> <span class="st">"central hospital"</span>  <span class="op">~</span> <span class="st">"Central Hospital"</span>,
      <span class="cn">TRUE</span>                             <span class="op">~</span> <span class="va">hosp_name</span>
      <span class="op">)</span>
    <span class="op">)</span></code></pre></div>
<p>Los nombres de los hospitales que aparecen en ambos dataframes están alineados. Hay dos hospitales en <code>hosp_info</code> que no están presentes en <code>linelist_mini</code> - nos ocuparemos de ellos más adelante, en la unión.</p>
<div class="sourceCode" id="cb674"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">hosp_info</span><span class="op">$</span><span class="va">hosp_name</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Central Hospital"                    
## [2] "Military Hospital"                   
## [3] "Port Hospital"                       
## [4] "St. Mark's Maternity Hospital (SMMH)"
## [5] "ignace"                              
## [6] "sisters"</code></pre>
<p>Antes de una unión, a menudo es más fácil convertir en una columna todas a minúsculas o todas a mayúsculas. Si necesitas convertir todos los valores de una columna a MAYÚSCULAS o minúsculas, utiliza <code>mutate()</code> y envuelva la columna con una de estas funciones de <strong>stringr</strong>, como se muestra en la página sobre <a href="characters-and-strings.html#characters-and-strings">Caracteres y cadenas</a>.</p>
<p><code>str_to_upper()</code><br><code>str_to_upper()</code><br><code>str_to_title()</code></p>
<!-- ======================================================= -->
</div>
</div>
<div id="dplyr-joins" class="section level2" number="14.2">
<h2>
<span class="header-section-number">14.2</span> Uniones en <strong>dplyr</strong><a class="anchor" aria-label="anchor" href="#dplyr-joins"><i class="fas fa-link"></i></a>
</h2>
<p>El paquete <strong>dplyr</strong> ofrece varias funciones de unión. <strong>dplyr</strong> está incluido en el paquete <strong>tidyverse</strong>. Estas funciones de unión se describen a continuación, con casos de uso sencillos.</p>
<p>Muchas gracias a <a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">https://github.com/gadenbuie</a> por los gifs informativos.</p>
<!-- ======================================================= -->
<div id="sintaxis-general" class="section level3 unnumbered">
<h3>Sintaxis general<a class="anchor" aria-label="anchor" href="#sintaxis-general"><i class="fas fa-link"></i></a>
</h3>
<p>Los comandos de unión pueden ejecutarse como comandos independientes para unir dos dataframes en un nuevo objeto, o pueden utilizarse dentro de una cadena de pipes (<code>%&gt;%</code>) para fusionar un dataframe en otro mientras se limpia o se modifica de alguna manera.</p>
<p>En el siguiente ejemplo, la función <code>left_join()</code> se utiliza como un comando independiente para crear un nuevo dataframe <code>joined_data</code>. Las entradas son los dataframes 1 y 2 (<code>df1</code> y <code>df2</code>). El primer dataframe es el dataframe de referencia, y el segundo se une <em>a</em> él.</p>
<p>El tercer argumento <code>by =</code> es donde se especifican las columnas de cada dataframe que se utilizarán para alinear las filas de los dos dataframes. Si los nombres de estas columnas son diferentes, proporciónelos dentro de un vector <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> como se muestra a continuación, donde las filas se emparejan sobre la base de valores comunes entre la columna <code>ID</code> en <code>df1</code> y la columna <code>identifier</code> en <code>df2</code>.</p>
<div class="sourceCode" id="cb676"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Join based on common values between column "ID" (first data frame) and column "identifier" (second data frame)</span>
<span class="va">joined_data</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span> <span class="op">=</span> <span class="st">"identifier"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Si las columnas <code>by</code> de ambos dataframes tienen exactamente el mismo nombre, puedes proporcionar sólo este nombre, entre comillas.</p>
<div class="sourceCode" id="cb677"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Joint based on common values in column "ID" in both data frames</span>
<span class="va">joined_data</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, by <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span></code></pre></div>
<p>Si estás uniendo los dataframes basándote en valores comunes en varios campos, enumera estos campos dentro del vector <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>. Este ejemplo une filas si los valores de tres columnas de cada conjunto de datos se alinean exactamente.</p>
<div class="sourceCode" id="cb678"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># join based on same first name, last name, and age</span>
<span class="va">joined_data</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"name"</span> <span class="op">=</span> <span class="st">"firstname"</span>, <span class="st">"surname"</span> <span class="op">=</span> <span class="st">"lastname"</span>, <span class="st">"Age"</span> <span class="op">=</span> <span class="st">"age"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Los comandos de unión también pueden ejecutarse dentro de una cadena de pipes. Esto modificará el dataframe que se está canalizando.</p>
<p>En el ejemplo siguiente, <code>df1</code> se pasa por los pipes, <code>df2</code> se une a él y, por tanto, <code>df</code>se modifica y se redefine.</p>
<div class="sourceCode" id="cb679"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df1</span> <span class="op">&lt;-</span> <span class="va">df1</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">date_onset</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2020-03-05"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># miscellaneous cleaning </span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">df2</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span> <span class="op">=</span> <span class="st">"identifier"</span><span class="op">)</span><span class="op">)</span>    <span class="co"># join df2 to df1</span></code></pre></div>
<p><span style="color: orange;"><strong><em>ATENCIÓN:</em></strong> ¡Las uniones son específicas para cada caso! Por lo tanto, es útil convertir todos los valores a minúsculas o mayúsculas antes de la unión. Consulta la página sobre caracteres/cadenas. </span></p>
<!-- ======================================================= -->
</div>
<div id="uniones-izquierda-y-derecha" class="section level3 unnumbered">
<h3>Uniones izquierda y derecha<a class="anchor" aria-label="anchor" href="#uniones-izquierda-y-derecha"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Una unión a la izquierda o a la derecha se utiliza habitualmente para añadir información a un dataframe</strong>: la nueva información se añade sólo a las filas que ya existían en el dataframe de referencia. Estas uniones son comunes en el trabajo epidemiológico, ya que se utilizan para añadir información de unos datos a otro.</p>
<p>Al utilizar estas uniones, el orden de escritura de los dataframes en el comando es importante*.</p>
<ul>
<li>En una <em>unión a la izquierda</em>, el <em>primer</em> dataframe escrito es el de base</li>
<li>En una <em>unión a la derecha</em>, el <em>segundo</em> dataframe escrito es el de base</li>
</ul>
<p><strong>Se conservan todas las filas del dataframe de referencia.</strong> La información del otro dataframe (secundario) se une al dataframe de referencia <em>sólo si hay una coincidencia a través de la(s) columna(s) del identificador</em>. Además:</p>
<ul>
<li>Las filas del dataframe secundario que no coinciden se eliminan.</li>
<li>Si hay muchas filas de la línea <em>de</em> base que coinciden con una fila del dataframe secundarios (muchos a uno), la información secundaria se añade a <em>cada fila de la línea de base que coincide</em>.</li>
<li>Si una fila del de base coincide con varias filas del dataframe secundario (uno a varios), se dan todas las combinaciones, lo que significa que <em>se pueden añadir nuevas filas al dataframe devuelto.</em>
</li>
</ul>
<p>Ejemplos animados de uniones a la izquierda y a la derecha (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">fuente de la imagen</a>)</p>
<p><img src="images/left-join.gif" width="50%"><img src="images/right-join.gif" width="50%"></p>
<p><strong>Ejemplo</strong></p>
<p>A continuación se muestra el resultado de un <code>left_join()</code> de <code>hosp_info</code> (dataframe secundario, <a href="joining-data.html#joins_hosp_info">ver aquí</a>) <em>en</em> <code>linelist_mini</code> (dataframe de referencia, <a href="joining-data.html#joins_llmini">ver aquí</a>). <code>linelist_mini</code> original tiene filas <code><a href="https://rdrr.io/r/base/nrow.html">nrow(linelist_mini)</a></code>. Se muestra <code>linelist_mini</code> modificada. Observa lo siguiente:</p>
<ul>
<li>Se han añadido dos nuevas columnas, <code>catchment_pop</code> y <code>level</code> en la parte izquierda de <code>linelist_mini</code>
</li>
<li>Se mantienen todas las filas originales del dataframe de referencia <code>linelist_mini</code>
</li>
<li>Cualquier fila original de <code>linelist_mini</code> para “Hospital Militar” está duplicada porque coincide con <em>dos</em> filas en el dataframe secundario, por lo que se devuelven ambas combinaciones</li>
<li>La columna del identificador de la unión del set de datos secundario (<code>hosp_name</code>) ha desaparecido porque es redundante con la columna del identificador primario (<code>hospital</code>)</li>
<li>Cuando una fila de referencia no coincide con ninguna fila secundaria (por ejemplo, cuando el <code>hospital</code> is “Other” or “Missing”), <code>NA</code> (en blanco) rellena las columnas del dataframe secundario</li>
<li>Se eliminaron las filas del dataframe secundario que no coincidían con el dataframe de referencia (hospitales “sisters” e “ignace”)</li>
</ul>
<div class="sourceCode" id="cb680"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_mini</span> <span class="op">%&gt;%</span> 
  <span class="fu">left_join</span><span class="op">(</span><span class="va">hosp_info</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hospital"</span> <span class="op">=</span> <span class="st">"hosp_name"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-998e8c247cdbbbe27940" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-998e8c247cdbbbe27940">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","893f25","be99c8","07e3e8","369449","f393b4","1389ca"],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing"],[null,null,12000,50280,40500,10000,50280,null,null,null,null],[null,null,"Secondary","Secondary","Secondary","Primary","Secondary",null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]}},"evals":[],"jsHooks":[]}</script><div id="debo-usar-una-unión-a-la-derecha-o-a-la-izquierda" class="section level4 unnumbered">
<h4>“¿Debo usar una unión a la derecha o a la izquierda?”<a class="anchor" aria-label="anchor" href="#debo-usar-una-uni%C3%B3n-a-la-derecha-o-a-la-izquierda"><i class="fas fa-link"></i></a>
</h4>
<p>Para responder a la pregunta anterior, hay que tener claro “¿qué dataframe debe conservar todas sus filas?” - Utiliza éste como base. Una unión <em>a la izquierda</em> conserva todas las filas del primer dataframe escrito en el comando, mientras que una <em>unión a la derecha</em> conserva todas las filas del segundo dataframe.</p>
<p>Los dos comandos de abajo consiguen el mismo resultado - 10 filas de <code>hosp_info</code> unidas <em>en</em> base a <code>linelist_mini</code>, pero utilizan diferentes uniones. El resultado es que el orden de las columnas variará en función de si <code>hosp_info</code> llega por la derecha (en la unión izquierda) o llega por la izquierda (en la unión derecha). El orden de las filas también puede cambiar en consecuencia. Pero ambas consecuencias pueden ser tratadas posteriormente, utilizando <code>select()</code> para reordenar las columnas o <code>arrange()</code> para ordenar las filas.</p>
<div class="sourceCode" id="cb681"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># The two commands below achieve the same data, but with differently ordered rows and columns</span>
<span class="fu">left_join</span><span class="op">(</span><span class="va">linelist_mini</span>, <span class="va">hosp_info</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hospital"</span> <span class="op">=</span> <span class="st">"hosp_name"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">right_join</span><span class="op">(</span><span class="va">hosp_info</span>, <span class="va">linelist_mini</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hosp_name"</span> <span class="op">=</span> <span class="st">"hospital"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Este es el resultado de <code>hosp_info</code> en <code>linelist_mini</code> a través de una unión a la izquierda (nuevas columnas entrando por la derecha)</p>
<div id="htmlwidget-00b527ccf15e88656778" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-00b527ccf15e88656778">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","893f25","be99c8","07e3e8","369449","f393b4","1389ca"],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing"],[null,null,12000,50280,40500,10000,50280,null,null,null,null],[null,null,"Secondary","Secondary","Secondary","Primary","Secondary",null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Este es el resultado de <code>hosp_info</code> en <code>linelist_mini</code> a través de una unión a la derecha (nuevas columnas entrando desde la izquierda)</p>
<div id="htmlwidget-715595b02fc00c059b37" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-715595b02fc00c059b37">{"x":{"filter":"none","vertical":false,"data":[["Military Hospital","Military Hospital","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Other","Missing","Missing","Missing","Missing","Missing"],[40500,10000,50280,50280,12000,null,null,null,null,null,null],["Secondary","Primary","Secondary","Secondary","Secondary",null,null,null,null,null,null],["893f25","893f25","b8812a","be99c8","11f8ea","5fe599","8689b7","07e3e8","369449","f393b4","1389ca"],["2014-05-21","2014-05-21","2014-05-18","2014-05-22","2014-05-16","2014-05-13","2014-05-13","2014-05-27","2014-06-02","2014-06-05","2014-06-05"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hosp_name<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Considera también si tu caso de uso está dentro de una cadena de pipes (<code>%&gt;%</code>). Si los datos del pipe son la base, es probable que utilices una unión izquierda para añadir datos a ella.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="unión-completa" class="section level3 unnumbered">
<h3>Unión completa<a class="anchor" aria-label="anchor" href="#uni%C3%B3n-completa"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Una unión completa (Full join) es la más <em>inclusiva</em> de las uniones</strong>: devuelve todas las filas de ambos dataframes.</p>
<p>Si hay filas presentes en una y no en la otra (donde no se encontró ninguna coincidencia), el dataframe las incluirá y se hará más largo. Los valores faltantes <code>NA</code> se utilizan para rellenar los huecos creados. A medida que se une, observa el número de columnas y filas con cuidado para solucionar el problema de las coincidencias de mayúsculas y minúsculas y de los caracteres exactos.</p>
<p>El dataframe de “base” es el que se escribe primero en el comando. El ajuste de esto no afectará a los registros devueltos por la unión, pero puede afectar al orden de las columnas resultantes, al orden de las filas y a las columnas de los identificadores que se conservan.</p>
<div class="inline-figure"><img src="images/full-join.gif" width="50%"></div>
<p>Ejemplo animado de una unión completa (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">fuente de la imagen</a>)</p>
<p><strong>Ejemplo</strong></p>
<p><code>A continuación se muestra la salida de</code> un <code>full_join()</code> de <code>hosp_info</code> (originalmente <code><a href="https://rdrr.io/r/base/nrow.html">nrow(hosp_info)</a></code>, <a href="joining-data.html#joins_hosp_info">view here</a>) <em>into</em> <code>linelist_mini</code> (originalmente <code><a href="https://rdrr.io/r/base/nrow.html">nrow(linelist_mini)</a></code>, <a href="joining-data.html#joins_llmini">view here</a>). Nota lo siguiente:</p>
<ul>
<li>Se mantienen todas las filas de la base (<code>linelist_mini</code>)</li>
<li>Se conservan las filas de los datos secundarios que no coinciden con la de base (“ignace” y “sisters”), con los valores de las columnas correspondientes de la de base <code>case_id</code> y <code>onset</code> rellenados con los valores que faltan<br>
</li>
<li>Del mismo modo, se conservan las filas de los datos de referencia que no coinciden con el secundario (“Otros” y “Falta”), y las columnas secundarias <code>catchment_pop</code> y <code>level</code> se rellenan con los valores que faltan</li>
<li>En el caso de coincidencias de uno a muchos o de muchos a uno (por ejemplo, filas para “Hospital Militar”), se devuelven todas las combinaciones posibles (alargando el conjunto de datos final)<br>
</li>
<li>Sólo se mantiene la columna del identificador de la línea de base (<code>hospital</code>)</li>
</ul>
<div class="sourceCode" id="cb682"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_mini</span> <span class="op">%&gt;%</span> 
  <span class="fu">full_join</span><span class="op">(</span><span class="va">hosp_info</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hospital"</span> <span class="op">=</span> <span class="st">"hosp_name"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-b70a1670931d096d04ef" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-b70a1670931d096d04ef">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","893f25","be99c8","07e3e8","369449","f393b4","1389ca",null,null,null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05",null,null,null],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Central Hospital","ignace","sisters"],[null,null,12000,50280,40500,10000,50280,null,null,null,null,1950280,5000,4200],[null,null,"Secondary","Secondary","Secondary","Primary","Secondary",null,null,null,null,"Tertiary","Primary","Primary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":15,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,15,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
<div id="unión-interna" class="section level3 unnumbered">
<h3>Unión interna<a class="anchor" aria-label="anchor" href="#uni%C3%B3n-interna"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Una unión interna es la más <em>restrictiva</em> de las uniones</strong>: sólo devuelve las filas que coinciden en ambos dataframes.
Esto significa que el número de filas en el dataframe de referencia puede <em>reducirse</em>. El ajuste de qué dataframe es el de “base” (escrito en primer lugar en la función) no afectará a las filas que se devuelven, pero sí al orden de las columnas, al orden de las filas y a las columnas de los identificadores que se conservan.</p>
<div class="inline-figure"><img src="images/inner-join.gif" width="50%"></div>
<p>Ejemplo animado de una unión interna (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">fuente de la imagen</a>)</p>
<p><strong>Ejemplo</strong></p>
<p>A continuación se muestra la salida de un <code>inner_join()</code> de <code>linelist_mini</code> (base) con <code>hosp_info</code> (secundario). Observa lo siguiente:</p>
<ul>
<li>Se eliminan las filas del de base que no coinciden con los datos secundarios (filas en las que el hospital es “Missing” u “Other”) * Asimismo, se eliminan las filas del dataframe secundario que no tenían ninguna coincidencia en la de base (filas en las que <code>hosp_name</code> es “sisters” o “ignace”)</li>
<li>Sólo se conserva la columna del identificador del de base (<code>hospital</code>)</li>
</ul>
<div class="sourceCode" id="cb683"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_mini</span> <span class="op">%&gt;%</span> 
  <span class="fu">inner_join</span><span class="op">(</span><span class="va">hosp_info</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hospital"</span> <span class="op">=</span> <span class="st">"hosp_name"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-58cf4c85238e54e7f4f6" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-58cf4c85238e54e7f4f6">{"x":{"filter":"none","vertical":false,"data":[["11f8ea","b8812a","893f25","893f25","be99c8"],["2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22"],["St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital"],[12000,50280,40500,10000,50280],["Secondary","Secondary","Secondary","Primary","Secondary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":12,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,12,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
<div id="semi-unión" class="section level3 unnumbered">
<h3>Semi-unión<a class="anchor" aria-label="anchor" href="#semi-uni%C3%B3n"><i class="fas fa-link"></i></a>
</h3>
<p>Una semi-unión join es una “unión filtrada” que utiliza otro conjunto de datos <em>no para añadir filas o columnas, sino para realizar un filtrado</em>.</p>
<p>Un <strong>semi-join mantiene todas las observaciones en el dataframe de referencia que tienen una coincidencia con el dataframe secundario</strong> (pero no añade nuevas columnas ni duplica ninguna fila para las coincidencias múltiples). Lee más sobre estas uniones de “filtrado” <a href="https://towardsdatascience.com/level-up-with-semi-joins-in-r-a068426096e0">aquí</a>.</p>
<div class="inline-figure"><img src="images/semi-join.gif" width="50%"></div>
<p>Ejemplo animado de una semiunión (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">fuente de la imagen</a>)</p>
<p>Como ejemplo, el siguiente código devuelve las filas del dataframe <code>hosp_info</code> que tienen coincidencias en <code>linelist_mini</code> basadas en el nombre del hospital.</p>
<div class="sourceCode" id="cb684"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hosp_info</span> <span class="op">%&gt;%</span> 
  <span class="fu">semi_join</span><span class="op">(</span><span class="va">linelist_mini</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hosp_name"</span> <span class="op">=</span> <span class="st">"hospital"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##                              hosp_name catchment_pop     level
## 1                    Military Hospital         40500 Secondary
## 2                    Military Hospital         10000   Primary
## 3                        Port Hospital         50280 Secondary
## 4 St. Mark's Maternity Hospital (SMMH)         12000 Secondary</code></pre>
<!-- ======================================================= -->
</div>
<div id="anti-unión" class="section level3 unnumbered">
<h3>Anti unión<a class="anchor" aria-label="anchor" href="#anti-uni%C3%B3n"><i class="fas fa-link"></i></a>
</h3>
<p><strong>La anti unión es otra “unión filtrada” que devuelve las filas del dataframe de referencia que <em>no</em> tienen una coincidencia en el dataframe secundario.</strong></p>
<p>Lee más sobre el filtrado de las uniones <a href="https://towardsdatascience.com/level-up-with-semi-joins-in-r-a068426096e0">aquí</a>.</p>
<p>Los anti-join son útiles para la identificación de registros que no están presentes en otro dataframe, la solución de problemas de ortografía en un join (revisión de registros que <em>deberían haber</em> coincidido) y el examen de registros que fueron excluidos después de otro join.</p>
<p><strong>Al igual que con <code>right_join()</code> y <code>left_join()</code>, el dataframe de <em>base</em> (que aparece primero) es importante</strong>. Las filas devueltas son sólo las del dataframe de referencia. Observa en el siguiente gif que la fila del dataframe secundario (fila púrpura 4) no se devuelve a pesar de que no coincide con la línea de base.</p>
<div class="inline-figure"><img src="images/anti-join.gif" width="50%"></div>
<p>Ejemplo animado de una anti-unión (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">fuente de la imagen</a>)</p>
<div id="ejemplo-de-anti_join-sencillo" class="section level4 unnumbered">
<h4>Ejemplo de <code>anti_join()</code> sencillo<a class="anchor" aria-label="anchor" href="#ejemplo-de-anti_join-sencillo"><i class="fas fa-link"></i></a>
</h4>
<p>Para un ejemplo sencillo, encontremos los hospitales de <code>hosp_info</code> que no tienen ningún caso en <code>linelist_mini</code>. Enumeramos primero <code>hosp_info</code>, como dataframe de referencia. Se devuelven los hospitales que no están presentes en <code>linelist_mini</code>.</p>
<div class="sourceCode" id="cb686"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hosp_info</span> <span class="op">%&gt;%</span> 
  <span class="fu">anti_join</span><span class="op">(</span><span class="va">linelist_mini</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hosp_name"</span> <span class="op">=</span> <span class="st">"hospital"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-ab5ad25dd03f3ae997d5" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ab5ad25dd03f3ae997d5">{"x":{"filter":"none","vertical":false,"data":[["Central Hospital","ignace","sisters"],[1950280,5000,4200],["Tertiary","Primary","Primary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hosp_name<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":12,"columnDefs":[{"className":"dt-right","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,12,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="ejemplo-de-anti_join-complejo" class="section level4 unnumbered">
<h4>Ejemplo de <code>anti_join()</code> complejo<a class="anchor" aria-label="anchor" href="#ejemplo-de-anti_join-complejo"><i class="fas fa-link"></i></a>
</h4>
<p>Para otro ejemplo, digamos que ejecutamos un <code>inner_join()</code> entre <code>linelist_mini</code> y <code>hosp_info</code>. Esto devuelve sólo un subconjunto de los registros originales de <code>linelist_mini</code>, ya que algunos no están presentes en <code>hosp_info</code>.</p>
<div class="sourceCode" id="cb687"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_mini</span> <span class="op">%&gt;%</span> 
  <span class="fu">inner_join</span><span class="op">(</span><span class="va">hosp_info</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hospital"</span> <span class="op">=</span> <span class="st">"hosp_name"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-62c6e669fb1f2c9fffcb" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-62c6e669fb1f2c9fffcb">{"x":{"filter":"none","vertical":false,"data":[["11f8ea","b8812a","893f25","893f25","be99c8"],["2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22"],["St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital"],[12000,50280,40500,10000,50280],["Secondary","Secondary","Secondary","Primary","Secondary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":8,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Para revisar los registros de <code>linelist_mini</code> que fueron excluidos durante el inner join, podemos ejecutar un anti-join con la misma configuración (linelist_mini como base).</p>
<div class="sourceCode" id="cb688"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_mini</span> <span class="op">%&gt;%</span> 
  <span class="fu">anti_join</span><span class="op">(</span><span class="va">hosp_info</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hospital"</span> <span class="op">=</span> <span class="st">"hosp_name"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-a7526588584fa9ae4e7e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a7526588584fa9ae4e7e">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","07e3e8","369449","f393b4","1389ca"],["2014-05-13","2014-05-13","2014-05-27","2014-06-02","2014-06-05","2014-06-05"],["Other","Missing","Missing","Missing","Missing","Missing"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":8,"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Para ver los registros de <code>hosp_info</code> que se excluyeron en la unión interna, también podríamos ejecutar una anti unión con <code>hosp_info</code> como dataframe de referencia.</p>
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="probabalistic-matching" class="section level2" number="14.3">
<h2>
<span class="header-section-number">14.3</span> Emparejamiento probabilístico<a class="anchor" aria-label="anchor" href="#probabalistic-matching"><i class="fas fa-link"></i></a>
</h2>
<p>Si no dispones de un identificador único común a todos los conjuntos de datos para unirlos, considera la posibilidad de utilizar un algoritmo de coincidencia probabilística. Este algoritmo buscaría coincidencias entre los registros basándose en la similitud (por ejemplo, la distancia de cadena de Jaro-Winkler o la distancia numérica). A continuación se muestra un ejemplo sencillo utilizando el paquete <strong>fastLink</strong> .</p>
<p><strong>Cargar paquetes</strong></p>
<div class="sourceCode" id="cb689"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
  <span class="va">tidyverse</span>,      <span class="co"># data manipulation and visualization</span>
  <span class="va">fastLink</span>        <span class="co"># record matching</span>
  <span class="op">)</span></code></pre></div>
<p>A continuación se presentan dos pequeños conjuntos de datos de ejemplo que utilizaremos para demostrar la correspondencia probabilística (<code>cases</code> y <code>test_results</code>):</p>
<p>Aquí está el código utilizado para hacer estos conjuntos de datos:</p>
<div class="sourceCode" id="cb690"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make datasets</span>

<span class="va">cases</span> <span class="op">&lt;-</span> <span class="fu">tribble</span><span class="op">(</span>
  <span class="op">~</span><span class="va">gender</span>, <span class="op">~</span><span class="va">first</span>,      <span class="op">~</span><span class="va">middle</span>,     <span class="op">~</span><span class="va">last</span>,        <span class="op">~</span><span class="va">yr</span>,   <span class="op">~</span><span class="va">mon</span>, <span class="op">~</span><span class="va">day</span>, <span class="op">~</span><span class="va">district</span>,
  <span class="st">"M"</span>,     <span class="st">"Amir"</span>,      <span class="cn">NA</span>,          <span class="st">"Khan"</span>,       <span class="fl">1989</span>,  <span class="fl">11</span>,   <span class="fl">22</span>,   <span class="st">"River"</span>,
  <span class="st">"M"</span>,     <span class="st">"Anthony"</span>,   <span class="st">"B."</span>,        <span class="st">"Smith"</span>,      <span class="fl">1970</span>, <span class="fl">09</span>, <span class="fl">19</span>,      <span class="st">"River"</span>, 
  <span class="st">"F"</span>,     <span class="st">"Marialisa"</span>, <span class="st">"Contreras"</span>, <span class="st">"Rodrigues"</span>,  <span class="fl">1972</span>, <span class="fl">04</span>, <span class="fl">15</span>,      <span class="st">"River"</span>,
  <span class="st">"F"</span>,     <span class="st">"Elizabeth"</span>, <span class="st">"Casteel"</span>,   <span class="st">"Chase"</span>,      <span class="fl">1954</span>, <span class="fl">03</span>, <span class="fl">03</span>,      <span class="st">"City"</span>,
  <span class="st">"M"</span>,     <span class="st">"Jose"</span>,      <span class="st">"Sanchez"</span>,   <span class="st">"Lopez"</span>,      <span class="fl">1996</span>, <span class="fl">01</span>, <span class="fl">06</span>,      <span class="st">"City"</span>,
  <span class="st">"F"</span>,     <span class="st">"Cassidy"</span>,   <span class="st">"Jones"</span>,      <span class="st">"Davis"</span>,     <span class="fl">1980</span>, <span class="fl">07</span>, <span class="fl">20</span>,      <span class="st">"City"</span>,
  <span class="st">"M"</span>,     <span class="st">"Michael"</span>,   <span class="st">"Murphy"</span>,     <span class="st">"O'Calaghan"</span>,<span class="fl">1969</span>, <span class="fl">04</span>, <span class="fl">12</span>,      <span class="st">"Rural"</span>, 
  <span class="st">"M"</span>,     <span class="st">"Oliver"</span>,    <span class="st">"Laurent"</span>,    <span class="st">"De Bordow"</span> , <span class="fl">1971</span>, <span class="fl">02</span>, <span class="fl">04</span>,     <span class="st">"River"</span>,
  <span class="st">"F"</span>,      <span class="st">"Blessing"</span>,  <span class="cn">NA</span>,          <span class="st">"Adebayo"</span>,   <span class="fl">1955</span>,  <span class="fl">02</span>, <span class="fl">14</span>,     <span class="st">"Rural"</span>
<span class="op">)</span>

<span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">tribble</span><span class="op">(</span>
  <span class="op">~</span><span class="va">gender</span>,  <span class="op">~</span><span class="va">first</span>,     <span class="op">~</span><span class="va">middle</span>,     <span class="op">~</span><span class="va">last</span>,          <span class="op">~</span><span class="va">yr</span>, <span class="op">~</span><span class="va">mon</span>, <span class="op">~</span><span class="va">day</span>, <span class="op">~</span><span class="va">district</span>, <span class="op">~</span><span class="va">result</span>,
  <span class="st">"M"</span>,      <span class="st">"Amir"</span>,     <span class="cn">NA</span>,          <span class="st">"Khan"</span>,         <span class="fl">1989</span>, <span class="fl">11</span>,   <span class="fl">22</span>,  <span class="st">"River"</span>, <span class="st">"positive"</span>,
  <span class="st">"M"</span>,      <span class="st">"Tony"</span>,   <span class="st">"B"</span>,         <span class="st">"Smith"</span>,          <span class="fl">1970</span>, <span class="fl">09</span>,   <span class="fl">19</span>,  <span class="st">"River"</span>, <span class="st">"positive"</span>,
  <span class="st">"F"</span>,      <span class="st">"Maria"</span>,    <span class="st">"Contreras"</span>, <span class="st">"Rodriguez"</span>,    <span class="fl">1972</span>, <span class="fl">04</span>,   <span class="fl">15</span>,  <span class="st">"Cty"</span>,   <span class="st">"negative"</span>,
  <span class="st">"F"</span>,      <span class="st">"Betty"</span>,    <span class="st">"Castel"</span>,   <span class="st">"Chase"</span>,        <span class="fl">1954</span>,  <span class="fl">03</span>,   <span class="fl">30</span>,  <span class="st">"City"</span>,  <span class="st">"positive"</span>,
  <span class="st">"F"</span>,      <span class="st">"Andrea"</span>,   <span class="cn">NA</span>,          <span class="st">"Kumaraswamy"</span>,  <span class="fl">2001</span>, <span class="fl">01</span>,   <span class="fl">05</span>,  <span class="st">"Rural"</span>, <span class="st">"positive"</span>,      
  <span class="st">"F"</span>,      <span class="st">"Caroline"</span>, <span class="cn">NA</span>,          <span class="st">"Wang"</span>,         <span class="fl">1988</span>, <span class="fl">12</span>,   <span class="fl">11</span>,  <span class="st">"Rural"</span>, <span class="st">"negative"</span>,
  <span class="st">"F"</span>,      <span class="st">"Trang"</span>,    <span class="cn">NA</span>,          <span class="st">"Nguyen"</span>,       <span class="fl">1981</span>, <span class="fl">06</span>,   <span class="fl">10</span>,  <span class="st">"Rural"</span>, <span class="st">"positive"</span>,
  <span class="st">"M"</span>,      <span class="st">"Olivier"</span> , <span class="st">"Laurent"</span>,   <span class="st">"De Bordeaux"</span>,  <span class="cn">NA</span>,   <span class="cn">NA</span>,   <span class="cn">NA</span>,  <span class="st">"River"</span>, <span class="st">"positive"</span>,
  <span class="st">"M"</span>,      <span class="st">"Mike"</span>,     <span class="st">"Murphy"</span>,    <span class="st">"O'Callaghan"</span>,  <span class="fl">1969</span>, <span class="fl">04</span>,   <span class="fl">12</span>,  <span class="st">"Rural"</span>, <span class="st">"negative"</span>,
  <span class="st">"F"</span>,      <span class="st">"Cassidy"</span>,  <span class="st">"Jones"</span>,     <span class="st">"Davis"</span>,        <span class="fl">1980</span>, <span class="fl">07</span>,   <span class="fl">02</span>,  <span class="st">"City"</span>,  <span class="st">"positive"</span>,
  <span class="st">"M"</span>,      <span class="st">"Mohammad"</span>, <span class="cn">NA</span>,          <span class="st">"Ali"</span>,          <span class="fl">1942</span>, <span class="fl">01</span>,   <span class="fl">17</span>,  <span class="st">"City"</span>,  <span class="st">"negative"</span>,
  <span class="cn">NA</span>,       <span class="st">"Jose"</span>,     <span class="st">"Sanchez"</span>,   <span class="st">"Lopez"</span>,        <span class="fl">1995</span>, <span class="fl">01</span>,   <span class="fl">06</span>,  <span class="st">"City"</span>,  <span class="st">"negative"</span>,
  <span class="st">"M"</span>,      <span class="st">"Abubakar"</span>, <span class="cn">NA</span>,          <span class="st">"Abullahi"</span>,     <span class="fl">1960</span>, <span class="fl">01</span>,   <span class="fl">01</span>,  <span class="st">"River"</span>, <span class="st">"positive"</span>,
  <span class="st">"F"</span>,      <span class="st">"Maria"</span>,    <span class="st">"Salinas"</span>,   <span class="st">"Contreras"</span>,    <span class="fl">1955</span>, <span class="fl">03</span>,   <span class="fl">03</span>,  <span class="st">"River"</span>, <span class="st">"positive"</span>
  <span class="op">)</span></code></pre></div>
<p><strong>El dataset <code>cases</code> tiene 9 registros</strong> de pacientes que están a la espera de los resultados de las pruebas.</p>
<div id="htmlwidget-d2ff6574642e64829f75" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-d2ff6574642e64829f75">{"x":{"filter":"none","vertical":false,"data":[["M","M","F","F","M","F","M","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo"],[1989,1970,1972,1954,1996,1980,1969,1971,1955],[11,9,4,3,1,7,4,2,2],[22,19,15,3,6,20,12,4,14],["River","River","River","City","City","City","Rural","River","Rural"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":9,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[9,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p><strong>El set de datos <code>test_results</code></strong> tiene 14 registros y contiene la columna resultado, que queremos añadir a los registros en <code>cases</code> basado en la coincidencia probabilística de registros.</p>
<div id="htmlwidget-467aced2958813f3d954" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-467aced2958813f3d954">{"x":{"filter":"none","vertical":false,"data":[["M","M","F","F","F","F","F","M","M","F","M",null,"M","F"],["Amir","Tony","Maria","Betty","Andrea","Caroline","Trang","Olivier","Mike","Cassidy","Mohammad","Jose","Abubakar","Maria"],[null,"B","Contreras","Castel",null,null,null,"Laurent","Murphy","Jones",null,"Sanchez",null,"Salinas"],["Khan","Smith","Rodriguez","Chase","Kumaraswamy","Wang","Nguyen","De Bordeaux","O'Callaghan","Davis","Ali","Lopez","Abullahi","Contreras"],[1989,1970,1972,1954,2001,1988,1981,null,1969,1980,1942,1995,1960,1955],[11,9,4,3,1,12,6,null,4,7,1,1,1,3],[22,19,15,30,5,11,10,null,12,2,17,6,1,3],["River","River","Cty","City","Rural","Rural","Rural","River","Rural","City","City","City","River","River"],["positive","positive","negative","positive","positive","negative","positive","positive","negative","positive","negative","negative","positive","positive"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n      <th>result<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":14,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,14,25,50,100]}},"evals":[],"jsHooks":[]}</script><div id="correspondencia-probabilística" class="section level3 unnumbered">
<h3>Correspondencia probabilística<a class="anchor" aria-label="anchor" href="#correspondencia-probabil%C3%ADstica"><i class="fas fa-link"></i></a>
</h3>
<p>La función <code>fastLink()</code> del paquete <strong>fastLink</strong> puede utilizarse para aplicar un algoritmo de coincidencia. Esta es la información básica. Puedes leer más detalles escribiendo <code>?fastLink</code> en tu consola.</p>
<ul>
<li>Define los dos dataframes para la comparación con los argumentos <code>dfA =</code>y <code>dfB =</code>
</li>
<li>En <code>varnames =</code> indica todos los nombres de columnas que se utilizarán para la comparación. Todos ellos deben existir tanto en <code>dfA</code> como en <code>dfB</code>.</li>
<li>En <code>stringdist.match =</code> escribe columnas de las que están en <code>varnames</code> para ser evaluadas en la cadena “distance”.</li>
<li>En <code>numeric.match =</code> dar columnas de las que están en <code>varnames</code> para ser evaluadas en la distancia numérica.</li>
<li>Los valores faltantes se ignoran</li>
<li>Por defecto, cada fila de cualquiera de los dos dataframes coincide como máximo con una fila del otro dataframe. Si deseas ver todas las coincidencias evaluadas, establece <code>dedupe.matches = FALSE</code>. La deduplicación se realiza mediante la solución de asignación lineal de Winkler.</li>
</ul>
<p><em>Sugerencia: divide una columna de fecha en tres columnas numéricas separadas utilizando <code>day()</code>, <code>month()</code>, and <code>year()</code> del paquete <strong>lubridate</strong></em></p>
<p>El umbral por defecto para las coincidencias es de 0,94 (<code>threshold.match =</code>), pero puedes ajustarlo más alto o más bajo. Si defines el umbral, ten en cuenta que los umbrales más altos podrían producir más falsos negativos (filas que no coinciden y que en realidad deberían coincidir) y, del mismo modo, un umbral más bajo podría producir más falsos positivos.</p>
<p>A continuación, los datos se emparejan según la distancia de las cadenas en las columnas de nombre y distrito, y según la distancia numérica para el año, el mes y el día de nacimiento. Se establece un umbral de coincidencia del 95% de probabilidad.</p>
<div class="sourceCode" id="cb691"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fl_output</span> <span class="op">&lt;-</span> <span class="fu">fastLink</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fastLink/man/fastLink.html">fastLink</a></span><span class="op">(</span>
  dfA <span class="op">=</span> <span class="va">cases</span>,
  dfB <span class="op">=</span> <span class="va">results</span>,
  varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"gender"</span>, <span class="st">"first"</span>, <span class="st">"middle"</span>, <span class="st">"last"</span>, <span class="st">"yr"</span>, <span class="st">"mon"</span>, <span class="st">"day"</span>, <span class="st">"district"</span><span class="op">)</span>,
  stringdist.match <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"first"</span>, <span class="st">"middle"</span>, <span class="st">"last"</span>, <span class="st">"district"</span><span class="op">)</span>,
  numeric.match <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"yr"</span>, <span class="st">"mon"</span>, <span class="st">"day"</span><span class="op">)</span>,
  threshold.match <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## ==================== 
## fastLink(): Fast Probabilistic Record Linkage
## ==================== 
## 
## If you set return.all to FALSE, you will not be able to calculate a confusion table as a summary statistic.
## Calculating matches for each variable.
## Getting counts for parameter estimation.
##     Parallelizing calculation using OpenMP. 1 threads out of 4 are used.
## Running the EM algorithm.
## Getting the indices of estimated matches.
##     Parallelizing calculation using OpenMP. 1 threads out of 4 are used.
## Deduping the estimated matches.
## Getting the match patterns for each estimated match.</code></pre>
<p><strong>Revisar los coincidentes</strong></p>
<p>Definimos el objeto devuelto por <code>fastLink()</code> como <code>fl_output</code>. Es de tipo <code>list</code>, y en realidad contiene varios dataframes dentro de él, detallando los resultados de la coincidencia. Uno de estos dataframes es <code>matches</code>, que contiene las coincidencias más probables entre <code>cases</code> y <code>results</code>. Puedes acceder a este dataframe “coincidencias” con <code>fl_output$matches</code>. A continuación, se guarda como <code>my_matches</code> para facilitar el acceso posterior.</p>
<p>Cuando se imprime <code>my_matches</code>, se ven dos vectores de columnas: los pares de números de fila/índices (también llamados “rownames”) en <code>cases</code> (“inds.a”) y en <code>results</code> (“inds.b”) que representan las mejores coincidencias. Si falta un número de fila de un dataframe, entonces no se ha encontrado ninguna coincidencia en el otro dataframe con el umbral de coincidencia especificado.</p>
<div class="sourceCode" id="cb693"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># print matches</span>
<span class="va">my_matches</span> <span class="op">&lt;-</span> <span class="va">fl_output</span><span class="op">$</span><span class="va">matches</span>
<span class="va">my_matches</span></code></pre></div>
<pre><code>##   inds.a inds.b
## 1      1      1
## 2      2      2
## 3      3      3
## 4      4      4
## 5      8      8
## 6      7      9
## 7      6     10
## 8      5     12</code></pre>
<p>Cosas a tener en cuenta:</p>
<ul>
<li>Las coincidencias se produjeron a pesar de las ligeras diferencias en la ortografía del nombre y las fechas de nacimiento:
<ul>
<li>“Tony B. Smith” coincide con “Anthony B Smith”</li>
<li>“María Rodríguez” coincide con “Marialisa Rodrigues”</li>
<li>“Betty Chase” coincide con “Elizabeth Chase”</li>
<li>“Olivier Laurent De Bordeaux” coincide con “Oliver Laurent De Bordow” (se ignora la fecha de nacimiento que falta)</li>
</ul>
</li>
<li>Una fila de <code>cases</code> (para “Blessing Adebayo”, fila 9) no tuvo una buena coincidencia en <code>results</code>, por lo que no está presente en <code>my_matches</code>.</li>
</ul>
<p><strong>Unión en base a las coincidencias probabilísticas</strong></p>
<p>Para utilizar estas coincidencias para unir los resultados a los casos, una estrategia es:</p>
<ol style="list-style-type: decimal">
<li>Utilizar <code>left_join()</code> para unir <code>my_matches</code> a <code>cases</code> (haciendo coincidir rownames en <code>cases</code> con “inds.a” en <code>my_matches</code>)</li>
<li>A continuación, utiliza otro <code>left_join()</code> para unir <code>results</code> a <code>cases</code> (haciendo coincidir los “inds.b” recién adquiridos en <code>cases</code> con los rownames en <code>results</code>)</li>
</ol>
<p>Antes de las uniones, debemos limpiar los tres dataframes:</p>
<ul>
<li>Tanto <code>dfA</code> como <code>dfB</code> deben tener sus números de fila (“rowname”) convertidos en una columna propia.</li>
<li>Las dos columnas de <code>my_matches</code> se convierten en tipo carácter, por lo que pueden unirse a las filas</li>
</ul>
<div class="sourceCode" id="cb695"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Clean data prior to joining</span>
<span class="co">#############################</span>

<span class="co"># convert cases rownames to a column </span>
<span class="va">cases_clean</span> <span class="op">&lt;-</span> <span class="va">cases</span> <span class="op">%&gt;%</span> <span class="fu">rownames_to_column</span><span class="op">(</span><span class="op">)</span>

<span class="co"># convert test_results rownames to a column</span>
<span class="va">results_clean</span> <span class="op">&lt;-</span> <span class="va">results</span> <span class="op">%&gt;%</span> <span class="fu">rownames_to_column</span><span class="op">(</span><span class="op">)</span>  

<span class="co"># convert all columns in matches dataset to character, so they can be joined to the rownames</span>
<span class="va">matches_clean</span> <span class="op">&lt;-</span> <span class="va">my_matches</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span>, <span class="va">as.character</span><span class="op">)</span><span class="op">)</span>



<span class="co"># Join matches to dfA, then add dfB</span>
<span class="co">###################################</span>
<span class="co"># column "inds.b" is added to dfA</span>
<span class="va">complete</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">cases_clean</span>, <span class="va">matches_clean</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rowname"</span> <span class="op">=</span> <span class="st">"inds.a"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># column(s) from dfB are added </span>
<span class="va">complete</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">complete</span>, <span class="va">results_clean</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"inds.b"</span> <span class="op">=</span> <span class="st">"rowname"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Como se realiza utilizando el código anterior, el dataframe resultante <code>complete</code> contendrá <em>todas</em> las columnas tanto de <code>cases</code> como de <code>results</code>. A muchas de ellas se les añadirán los sufijos “.x” e “.y”, ya que de lo contrario los nombres de las columnas estarían duplicados.</p>
<div id="htmlwidget-ec47e890e27274a288ba" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ec47e890e27274a288ba">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9"],["M","M","F","F","M","F","M","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo"],[1989,1970,1972,1954,1996,1980,1969,1971,1955],[11,9,4,3,1,7,4,2,2],[22,19,15,3,6,20,12,4,14],["River","River","River","City","City","City","Rural","River","Rural"],["1","2","3","4","12","10","9","8",null],["M","M","F","F",null,"F","M","M",null],["Amir","Tony","Maria","Betty","Jose","Cassidy","Mike","Olivier",null],[null,"B","Contreras","Castel","Sanchez","Jones","Murphy","Laurent",null],["Khan","Smith","Rodriguez","Chase","Lopez","Davis","O'Callaghan","De Bordeaux",null],[1989,1970,1972,1954,1995,1980,1969,null,null],[11,9,4,3,1,7,4,null,null],[22,19,15,30,6,2,12,null,null],["River","River","Cty","City","City","City","Rural","River",null],["positive","positive","negative","positive","negative","positive","negative","positive",null]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>rowname<\/th>\n      <th>gender.x<\/th>\n      <th>first.x<\/th>\n      <th>middle.x<\/th>\n      <th>last.x<\/th>\n      <th>yr.x<\/th>\n      <th>mon.x<\/th>\n      <th>day.x<\/th>\n      <th>district.x<\/th>\n      <th>inds.b<\/th>\n      <th>gender.y<\/th>\n      <th>first.y<\/th>\n      <th>middle.y<\/th>\n      <th>last.y<\/th>\n      <th>yr.y<\/th>\n      <th>mon.y<\/th>\n      <th>day.y<\/th>\n      <th>district.y<\/th>\n      <th>result<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":9,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[5,6,7,14,15,16]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[9,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Alternativamente, para conseguir sólo los 9 registros “originales” en los casos con la(s) nueva(s) columna(s) de <code>results</code>, usa <code>select()</code> en <code>results</code> antes de las uniones, de forma que sólo contenga los nombres y las columnas que deseas añadir a <code>cases</code> (por ej. la columna <code>result</code>).</p>
<div class="sourceCode" id="cb696"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cases_clean</span> <span class="op">&lt;-</span> <span class="va">cases</span> <span class="op">%&gt;%</span> <span class="fu">rownames_to_column</span><span class="op">(</span><span class="op">)</span>

<span class="va">results_clean</span> <span class="op">&lt;-</span> <span class="va">results</span> <span class="op">%&gt;%</span>
  <span class="fu">rownames_to_column</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">rowname</span>, <span class="va">result</span><span class="op">)</span>    <span class="co"># select only certain columns </span>

<span class="va">matches_clean</span> <span class="op">&lt;-</span> <span class="va">my_matches</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span>, <span class="va">as.character</span><span class="op">)</span><span class="op">)</span>

<span class="co"># joins</span>
<span class="va">complete</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">cases_clean</span>, <span class="va">matches_clean</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rowname"</span> <span class="op">=</span> <span class="st">"inds.a"</span><span class="op">)</span><span class="op">)</span>
<span class="va">complete</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">complete</span>, <span class="va">results_clean</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"inds.b"</span> <span class="op">=</span> <span class="st">"rowname"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-786cc90f1a1da9f850a9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-786cc90f1a1da9f850a9">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9"],["M","M","F","F","M","F","M","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo"],[1989,1970,1972,1954,1996,1980,1969,1971,1955],[11,9,4,3,1,7,4,2,2],[22,19,15,3,6,20,12,4,14],["River","River","River","City","City","City","Rural","River","Rural"],["1","2","3","4","12","10","9","8",null],["positive","positive","negative","positive","negative","positive","negative","positive",null]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>rowname<\/th>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n      <th>inds.b<\/th>\n      <th>result<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":9,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[5,6,7]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[9,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Si deseas subconjuntar cualquiera de los dos conjuntos de datos sólo con las filas que coincidan, puedes utilizar los siguientes códigos:</p>
<div class="sourceCode" id="cb697"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cases_matched</span> <span class="op">&lt;-</span> <span class="va">cases</span><span class="op">[</span><span class="va">my_matches</span><span class="op">$</span><span class="va">inds.a</span>,<span class="op">]</span>  <span class="co"># Rows in cases that matched to a row in results</span>
<span class="va">results_matched</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="va">my_matches</span><span class="op">$</span><span class="va">inds.b</span>,<span class="op">]</span>  <span class="co"># Rows in results that matched to a row in cases</span></code></pre></div>
<p>O, para ver sólo las filas que <strong>no</strong> coinciden:</p>
<div class="sourceCode" id="cb698"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cases_not_matched</span> <span class="op">&lt;-</span> <span class="va">cases</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span> <span class="op">%in%</span> <span class="va">my_matches</span><span class="op">$</span><span class="va">inds.a</span>,<span class="op">]</span>  <span class="co"># Rows in cases that did NOT match to a row in results</span>
<span class="va">results_not_matched</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">%in%</span> <span class="va">my_matches</span><span class="op">$</span><span class="va">inds.b</span>,<span class="op">]</span>  <span class="co"># Rows in results that did NOT match to a row in cases</span></code></pre></div>
</div>
<div id="de-duplicación-probabilística" class="section level3 unnumbered">
<h3>De-duplicación probabilística<a class="anchor" aria-label="anchor" href="#de-duplicaci%C3%B3n-probabil%C3%ADstica"><i class="fas fa-link"></i></a>
</h3>
<p>La coincidencia probabilística también puede utilizarse para de-duplicar unos datos. Consulta la página sobre <a href="de-duplication.html#de-duplication">de-duplicación</a> para conocer otros métodos de de-duplicación.</p>
<p>Aquí comenzamos con el conjunto de datos <code>cases</code>, pero ahora lo llamamos <code>cases_dup</code>, ya que tiene 2 filas adicionales que podrían ser duplicados de filas anteriores: Ver “Tony” con “Anthony”, y “Marialisa Rodrigues” con “Maria Rodriguez”.</p>
<div id="htmlwidget-f0d4411be0465e77f22d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f0d4411be0465e77f22d">{"x":{"filter":"none","vertical":false,"data":[["M","M","F","F","M","F","M","M","F","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing","Tony","Maria"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null,"B.","Contreras"],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo","Smith","Rodriguez"],[1989,1970,1972,1954,1996,1980,1969,1971,1955,1970,1972],[11,9,4,3,1,7,4,2,2,9,4],[22,19,15,3,6,20,12,4,14,19,15],["River","River","River","City","City","City","Rural","River","Rural","River","River"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":[4,5,6]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Ejecuta <code>fastLink()</code> como antes, pero compara el dataframe <code>cases_dup</code> consigo mismo. Cuando los dos dataframes proporcionados son idénticos, la función asume que se quiere de-duplicar. Observa que no especificamos <code>stringdist.match =</code> o <code>numeric.match =</code> como hicimos anteriormente.</p>
<div class="sourceCode" id="cb699"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Run fastLink on the same dataset</span>
<span class="va">dedupe_output</span> <span class="op">&lt;-</span> <span class="fu">fastLink</span><span class="op">(</span>
  dfA <span class="op">=</span> <span class="va">cases_dup</span>,
  dfB <span class="op">=</span> <span class="va">cases_dup</span>,
  varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"gender"</span>, <span class="st">"first"</span>, <span class="st">"middle"</span>, <span class="st">"last"</span>, <span class="st">"yr"</span>, <span class="st">"mon"</span>, <span class="st">"day"</span>, <span class="st">"district"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<pre><code>## 
## ==================== 
## fastLink(): Fast Probabilistic Record Linkage
## ==================== 
## 
## If you set return.all to FALSE, you will not be able to calculate a confusion table as a summary statistic.
## dfA and dfB are identical, assuming deduplication of a single data set.
## Setting return.all to FALSE.
## 
## Calculating matches for each variable.
## Getting counts for parameter estimation.
##     Parallelizing calculation using OpenMP. 1 threads out of 4 are used.
## Running the EM algorithm.
## Getting the indices of estimated matches.
##     Parallelizing calculation using OpenMP. 1 threads out of 4 are used.
## Calculating the posterior for each pair of matched observations.
## Getting the match patterns for each estimated match.</code></pre>
<p>Ahora, puedes revisar los duplicados potenciales con <code>getMatches()</code>. Proporciona el dataframe como <code>dfA =</code> y <code>dfB =</code>, y proporciona la salida de la función <code>fastLink()</code> como <code>fl.out =</code>. <code>fl.out</code> debe ser del tipo <code>fastLink.dedupe</code>, o en otras palabras, el resultado de <code>fastLink()</code>.</p>
<div class="sourceCode" id="cb701"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Run getMatches()</span>
<span class="va">cases_dedupe</span> <span class="op">&lt;-</span> <span class="fu">getMatches</span><span class="op">(</span>
  dfA <span class="op">=</span> <span class="va">cases_dup</span>,
  dfB <span class="op">=</span> <span class="va">cases_dup</span>,
  fl.out <span class="op">=</span> <span class="va">dedupe_output</span><span class="op">)</span></code></pre></div>
<p>Véase la columna de la derecha, que indica los IDs duplicados: las dos últimas filas se identifican como probables duplicados de las filas 2 y 3.</p>
<div id="htmlwidget-a1bce60856173ad66b69" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a1bce60856173ad66b69">{"x":{"filter":"none","vertical":false,"data":[["M","M","F","F","M","F","M","M","F","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing","Tony","Maria"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null,"B.","Contreras"],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo","Smith","Rodriguez"],[1989,1970,1972,1954,1996,1980,1969,1971,1955,1970,1972],[11,9,4,3,1,7,4,2,2,9,4],[22,19,15,3,6,20,12,4,14,19,15],["River","River","River","City","City","City","Rural","River","Rural","River","River"],[1,2,3,4,5,6,7,8,9,2,3]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n      <th>dedupe.ids<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":[4,5,6,8]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Para devolver los números de fila de las filas que probablemente sean duplicadas, puede contar el número de filas por valor único en la columna <code>dedupe.ids</code>, y luego filtrar para mantener sólo aquellas con más de una fila. En este caso, esto deja las filas 2 y 3.</p>
<div class="sourceCode" id="cb702"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cases_dedupe</span> <span class="op">%&gt;%</span> 
  <span class="fu">count</span><span class="op">(</span><span class="va">dedupe.ids</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<pre><code>##   dedupe.ids n
## 1          2 2
## 2          3 2</code></pre>
<p>Para inspeccionar las filas completas de los probables duplicados, pon el número de fila en este comando:</p>
<div class="sourceCode" id="cb704"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># displays row 2 and all likely duplicates of it</span>
<span class="va">cases_dedupe</span><span class="op">[</span><span class="va">cases_dedupe</span><span class="op">$</span><span class="va">dedupe.ids</span> <span class="op">==</span> <span class="fl">2</span>,<span class="op">]</span>   </code></pre></div>
<pre><code>##    gender   first middle  last   yr mon day district dedupe.ids
## 2       M Anthony     B. Smith 1970   9  19    River          2
## 10      M    Tony     B. Smith 1970   9  19    River          2</code></pre>
</div>
</div>
<div id="binding-and-aligning" class="section level2" number="14.4">
<h2>
<span class="header-section-number">14.4</span> Enlazamiento y alineación<a class="anchor" aria-label="anchor" href="#binding-and-aligning"><i class="fas fa-link"></i></a>
</h2>
<p>Otro método para combinar dos dataframes es “unirlos”. También se puede pensar en esto como “anexar” o “añadir” filas o columnas.</p>
<p>En esta sección también se discutirá cómo “alinear” el orden de las filas de un dataframe con el orden de otro dataframe. Este tema se discute más adelante en la sección sobre Vinculación de columnas.</p>
<div id="enlazar-filas" class="section level3 unnumbered">
<h3>Enlazar filas<a class="anchor" aria-label="anchor" href="#enlazar-filas"><i class="fas fa-link"></i></a>
</h3>
<p>Para unir las filas de un dataframe con el fondo de otro dataframe, utiliza <code>bind_rows()</code> de <strong>dplyr</strong>. Es muy inclusivo, por lo que cualquier columna presente en cualquiera de los dataframes se incluirá en la salida. Algunas notas:</p>
<ul>
<li>A diferencia de la versión de R <strong>base</strong> de R <code>row.bind()</code>, <code>bind_rows()</code> de <strong>dplyr</strong> no requiere que el orden de las columnas sea el mismo en ambos dataframes. Siempre que los nombres de las columnas se escriban de forma idéntica, las alineará correctamente.</li>
<li>Puedes especificar opcionalmente el argumento <code>.id =</code>. Proporcionar un nombre de columna de caracteres. Esto producirá una nueva columna que sirve para identificar de qué dataframe procede originalmente cada fila.</li>
<li>Puedes utilizar <code>bind_rows()</code> en una lista de dataframes de estructura similar para combinarlos en un dataframe. Mira un ejemplo en la página <a href="iteration-loops-and-lists.html#iteration-loops-and-lists">Iteración, bucles y listas</a> que implica la importación de múltiples listas de líneas con <strong>purrr</strong>.</li>
</ul>
<p>Un ejemplo común de vinculación de filas es vincular una fila “total” a una tabla descriptiva hecha con la función <code>summarise()</code> de <strong>dplyr</strong>. A continuación, creamos una tabla de recuentos de casos y valores medianos de TC por hospital con una fila de totales.</p>
<p>La función <code>summarise()</code> se utiliza en los datos agrupados por hospital para devolver un dataframe resumido por hospital. Pero la función <code>summarise()</code> no produce automáticamente una fila de “totales”, así que la creamos resumiendo los datos <em>de nuevo</em>, pero con los datos no agrupados por hospital. Esto produce un segundo dataframe de una sola fila. A continuación, podemos unir estos dataframes para obtener la tabla final.</p>
<p>Mira otros ejemplos trabajados como éste en las páginas de <a href="descriptive-tables.html#descriptive-tables">Tablas descriptivas</a> y <a href="tables-for-presentation.html#tables-for-presentation">Tablas para presentaciones</a>.</p>
<div class="sourceCode" id="cb706"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create core table</span>
<span class="co">###################</span>
<span class="va">hosp_summary</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span>                        <span class="co"># Group data by hospital</span>
  <span class="fu">summarise</span><span class="op">(</span>                                    <span class="co"># Create new summary columns of indicators of interest</span>
    cases <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,                                  <span class="co"># Number of rows per hospital-outcome group     </span>
    ct_value_med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">ct_blood</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span>     <span class="co"># median CT value per group</span></code></pre></div>
<p>Este es el dataframe de <code>hosp_summary</code>:</p>
<div id="htmlwidget-a1bf840e38d44b20bdae" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a1bf840e38d44b20bdae">{"x":{"filter":"none","vertical":false,"data":[["Central Hospital","Military Hospital","Missing","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)"],[454,896,1469,885,1762,422],[22,21,21,22,22,22]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>cases<\/th>\n      <th>ct_value_med<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Crea un dataframe con las estadísticas “totales” (<em>no agrupadas por hospital</em>). Esto devolverá una sola fila.</p>
<div class="sourceCode" id="cb707"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create totals</span>
<span class="co">###############</span>
<span class="va">totals</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarise</span><span class="op">(</span>
    cases <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,                               <span class="co"># Number of rows for whole dataset     </span>
    ct_value_med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">ct_blood</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Median CT for whole dataset</span></code></pre></div>
<p>Y a continuación está el dataframe <code>totals</code>. Observa que sólo hay dos columnas. Estas columnas también están en <code>hosp_summary</code>, pero hay una columna en <code>hosp_summary</code> que no está en <code>totals</code> (<code>hospital</code>).</p>
<div id="htmlwidget-42ac98ebf3d683e90522" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-42ac98ebf3d683e90522">{"x":{"filter":"none","vertical":false,"data":[[5888],[22]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>cases<\/th>\n      <th>ct_value_med<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[0,1]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Ahora podemos unir las filas con <code>bind_rows()</code>.</p>
<div class="sourceCode" id="cb708"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Bind data frames together</span>
<span class="va">combined</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">hosp_summary</span>, <span class="va">totals</span><span class="op">)</span></code></pre></div>
<p>Ahora podemos ver el resultado. Observa cómo en la última fila se rellena un valor <code>NA</code> vacío para la columna hospital que no estaba en hosp_summary. Como se explica en la página de <a href="tables-for-presentation.html#tables-for-presentation">Tablas para presentaciones</a>, podrías “rellenar” esta celda con “Total” utilizando replace_na().</p>
<div id="htmlwidget-30086ab3b73ca8249f53" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-30086ab3b73ca8249f53">{"x":{"filter":"none","vertical":false,"data":[["Central Hospital","Military Hospital","Missing","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)",null],[454,896,1469,885,1762,422,5888],[22,21,21,22,22,22,22]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>cases<\/th>\n      <th>ct_value_med<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="enlazar-columnas" class="section level3 unnumbered">
<h3>Enlazar columnas<a class="anchor" aria-label="anchor" href="#enlazar-columnas"><i class="fas fa-link"></i></a>
</h3>
<p>Existe una función similar de <strong>dplyr</strong> <code>bind_cols()</code> que se puede utilizar para combinar dos dataframes de forma lateral. Ten en cuenta que las filas se emparejan entre sí <em>por posición</em> (no como una <em>unión</em> anterior) - por ejemplo, la fila 12 en cada dataframe se alineará.</p>
<p>Como ejemplo, unimos varias tablas de resumen. Para ello, también mostramos cómo reordenar el orden de las filas de un dataframe para que coincida con el orden de otro dataframe, con <code><a href="https://rdrr.io/r/base/match.html">match()</a></code>.</p>
<p>Aquí definimos <code>case_info</code> como un dataframe resumido de los casos del listado, por hospital, con el número de casos y el número de muertes.</p>
<div class="sourceCode" id="cb709"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Case information</span>
<span class="va">case_info</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarise</span><span class="op">(</span>
    cases <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,
    deaths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">==</span> <span class="st">"Death"</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div id="htmlwidget-a7e7956a1473fe5797da" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a7e7956a1473fe5797da">{"x":{"filter":"none","vertical":false,"data":[["Central Hospital","Military Hospital","Missing","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)"],[454,896,1469,885,1762,422],[193,399,611,395,785,199]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>cases<\/th>\n      <th>deaths<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Y digamos que aquí hay un dataframe diferente <code>contact_fu</code> que contiene información sobre el porcentaje de contactos expuestos investigados y “seguidos”, de nuevo por hospital.</p>
<div class="sourceCode" id="cb710"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">contact_fu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  hospital <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"St. Mark's Maternity Hospital (SMMH)"</span>, <span class="st">"Military Hospital"</span>, <span class="st">"Missing"</span>, <span class="st">"Central Hospital"</span>, <span class="st">"Port Hospital"</span>, <span class="st">"Other"</span><span class="op">)</span>,
  investigated <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"80%"</span>, <span class="st">"82%"</span>, <span class="cn">NA</span>, <span class="st">"78%"</span>, <span class="st">"64%"</span>, <span class="st">"55%"</span><span class="op">)</span>,
  per_fu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"60%"</span>, <span class="st">"25%"</span>, <span class="cn">NA</span>, <span class="st">"20%"</span>, <span class="st">"75%"</span>, <span class="st">"80%"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div id="htmlwidget-9414b2dde84074fbc62c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-9414b2dde84074fbc62c">{"x":{"filter":"none","vertical":false,"data":[["St. Mark's Maternity Hospital (SMMH)","Military Hospital","Missing","Central Hospital","Port Hospital","Other"],["80%","82%",null,"78%","64%","55%"],["60%","25%",null,"20%","75%","80%"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>investigated<\/th>\n      <th>per_fu<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Observa que los hospitales son los mismos, pero están en diferente orden en cada dataframe. La solución más sencilla sería utilizar un <code>left_join()</code> en la columna <code>hospitals</code>, pero también podría utilizar <code>bind_cols()</code> con un paso adicional.</p>
<div id="utiliza-match-para-alinear-la-ordenación" class="section level4 unnumbered">
<h4>Utiliza <code>match()</code> para alinear la ordenación<a class="anchor" aria-label="anchor" href="#utiliza-match-para-alinear-la-ordenaci%C3%B3n"><i class="fas fa-link"></i></a>
</h4>
<p>Debido a que los órdenes de las filas son diferentes, un simple comando <code>bind_cols()</code> daría lugar a un desajuste de los datos. Para solucionarlo podemos utilizar <code><a href="https://rdrr.io/r/base/match.html">match()</a></code> de R <em>base</em> para alinear las filas de un dataframe en el mismo orden que en otro. Asumimos para este enfoque que no hay valores duplicados en ninguno de los dos dataframes.</p>
<p>Cuando utilizamos <code><a href="https://rdrr.io/r/base/match.html">match()</a></code>, la sintaxis es <code>match(TARGET ORDER VECTOR, DATA FRAME COLUMN TO CHANGE)</code>, donde el primer argumento es el orden deseado (ya sea un vector independiente, o en este caso una columna en un dataframe), y el segundo argumento es la columna del dataframe que se reordenará. La salida de <code><a href="https://rdrr.io/r/base/match.html">match()</a></code> es un vector de números que representa el ordenamiento correcto de las posiciones. Puedes obtener más información con <code><a href="https://rdrr.io/r/base/match.html">?match</a></code>.</p>
<div class="sourceCode" id="cb711"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">case_info</span><span class="op">$</span><span class="va">hospital</span>, <span class="va">contact_fu</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 4 2 3 6 5 1</code></pre>
<p>Puedes utilizar este vector numérico para reordenar el dataframe - colócalo dentro de los subcorchetes <code>[ ]</code> <em>antes de la coma</em>. Lee más sobre la <strong>sintaxis</strong> del subconjunto de corchetes en la página de <a href="r-basics.html#r-basics">Fundamentos de R</a>. El comando de abajo crea un nuevo dataframe, definido como el anterior en el que las filas están ordenadas en el vector numérico de arriba.</p>
<div class="sourceCode" id="cb713"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">contact_fu_aligned</span> <span class="op">&lt;-</span> <span class="va">contact_fu</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">case_info</span><span class="op">$</span><span class="va">hospital</span>, <span class="va">contact_fu</span><span class="op">$</span><span class="va">hospital</span><span class="op">)</span>,<span class="op">]</span></code></pre></div>
<div id="htmlwidget-d73a9ecfc29a37c7e634" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-d73a9ecfc29a37c7e634">{"x":{"filter":"none","vertical":false,"data":[["Central Hospital","Military Hospital","Missing","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)"],["78%","82%",null,"55%","64%","80%"],["20%","25%",null,"80%","75%","60%"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>investigated<\/th>\n      <th>per_fu<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>Ahora podemos unir las columnas del dataframe, con el orden correcto de las filas. Ten en cuenta que algunas columnas están duplicadas y será necesario limpiarlas con <code>rename()</code>. Lee más sobre <code>bind_rows()</code> <a href="https://dplyr.tidyverse.org/reference/bind.html">aquí</a>.</p>
<div class="sourceCode" id="cb714"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">bind_cols</span><span class="op">(</span><span class="va">case_info</span>, <span class="va">contact_fu</span><span class="op">)</span></code></pre></div>
<pre><code>## New names:
## * `hospital` -&gt; `hospital...1`
## * `hospital` -&gt; `hospital...4`</code></pre>
<pre><code>## # A tibble: 6 x 6
##   hospital...1                 cases deaths hospi~1 inves~2 per_fu
##   &lt;chr&gt;                        &lt;int&gt;  &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; 
## 1 Central Hospital               454    193 St. Ma~ 80%     60%   
## 2 Military Hospital              896    399 Milita~ 82%     25%   
## 3 Missing                       1469    611 Missing &lt;NA&gt;    &lt;NA&gt;  
## 4 Other                          885    395 Centra~ 78%     20%   
## 5 Port Hospital                 1762    785 Port H~ 64%     75%   
## 6 St. Mark's Maternity Hospit~   422    199 Other   55%     80%   
## # ... with abbreviated variable names 1: hospital...4,
## #   2: investigated</code></pre>
<p>Una alternativa en R <strong>base</strong> a <code>bind_cols</code> es <code><a href="https://rdrr.io/r/base/cbind.html">cbind()</a></code>, que realiza la misma operación.</p>
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="resources-7" class="section level2" number="14.5">
<h2>
<span class="header-section-number">14.5</span> Recursos<a class="anchor" aria-label="anchor" href="#resources-7"><i class="fas fa-link"></i></a>
</h2>
<p>Las <a href="https://dplyr.tidyverse.org/reference/index.html">páginas de tidyverse sobre join</a></p>
<p>La <a href="https://r4ds.had.co.nz/relational-data.html">página de R for Data Science sobre datos relacionales</a></p>
<p>La <a href="https://dplyr.tidyverse.org/reference/bind.html">página de tidyverse en dplyr</a> en la encuadernación</p>
<p>Una viñeta sobre <a href="https://github.com/kosukeimai/fastLink">fastLink</a> en la página de Github del paquete</p>
<p>Publicación que describe la metodología de <a href="https://imai.fas.harvard.edu/research/files/linkage.pdf">fastLink</a></p>
<p>Publicación que describe el <a href="https://journal.r-project.org/archive/2010/RJ-2010-017/RJ-2010-017.pdf">paquete RecordLinkage</a></p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="grouping-data.html"><span class="header-section-number">13</span> Agrupar datos</a></div>
<div class="next"><a href="de-duplication.html"><span class="header-section-number">15</span> De-duplicación</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>En esta página</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#joining-data"><span class="header-section-number">14</span> Unir datos</a></li>
<li>
<a class="nav-link" href="#preparation-5"><span class="header-section-number">14.1</span> Preparación</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#cargar-paquetes-5">Cargar paquetes</a></li>
<li><a class="nav-link" href="#importar-datos-5">Importar datos</a></li>
<li><a class="nav-link" href="#datos-de-los-ejemplos">Datos de los ejemplos</a></li>
<li><a class="nav-link" href="#pre-limpieza">Pre-limpieza</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#dplyr-joins"><span class="header-section-number">14.2</span> Uniones en dplyr</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#sintaxis-general">Sintaxis general</a></li>
<li><a class="nav-link" href="#uniones-izquierda-y-derecha">Uniones izquierda y derecha</a></li>
<li><a class="nav-link" href="#uni%C3%B3n-completa">Unión completa</a></li>
<li><a class="nav-link" href="#uni%C3%B3n-interna">Unión interna</a></li>
<li><a class="nav-link" href="#semi-uni%C3%B3n">Semi-unión</a></li>
<li><a class="nav-link" href="#anti-uni%C3%B3n">Anti unión</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#probabalistic-matching"><span class="header-section-number">14.3</span> Emparejamiento probabilístico</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#correspondencia-probabil%C3%ADstica">Correspondencia probabilística</a></li>
<li><a class="nav-link" href="#de-duplicaci%C3%B3n-probabil%C3%ADstica">De-duplicación probabilística</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#binding-and-aligning"><span class="header-section-number">14.4</span> Enlazamiento y alineación</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#enlazar-filas">Enlazar filas</a></li>
<li><a class="nav-link" href="#enlazar-columnas">Enlazar columnas</a></li>
</ul>
</li>
<li><a class="nav-link" href="#resources-7"><span class="header-section-number">14.5</span> Recursos</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>EpiRhandbook en español</strong>" fué escrito por el equipo del manual. Compilado el 2022-11-08.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>Este libro fué construido con el paquete <a class="text-light" href="https://bookdown.org">bookdown</a> de R.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
