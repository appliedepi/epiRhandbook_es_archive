<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>11 Factores | EpiRhandbook en español</title>
<meta name="author" content="El equipo del manual">
<meta name="description" content="En R, los factores son un tipo de datos que permiten categorías ordenadas con un conjunto fijo de valores. Normalmente, se convierte una columna de tipo numérico o de caracteres en un factor si se...">
<meta name="generator" content="bookdown 0.28 with bs4_book()">
<meta property="og:title" content="11 Factores | EpiRhandbook en español">
<meta property="og:type" content="book">
<meta property="og:description" content="En R, los factores son un tipo de datos que permiten categorías ordenadas con un conjunto fijo de valores. Normalmente, se convierte una columna de tipo numérico o de caracteres en un factor si se...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="11 Factores | EpiRhandbook en español">
<meta name="twitter:description" content="En R, los factores son un tipo de datos que permiten categorías ordenadas con un conjunto fijo de valores. Normalmente, se convierte una columna de tipo numérico o de caracteres en un factor si se...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.24/datatables.js"></script><link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/tabwid.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/scrool.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.9/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.5.1/plotly-basic-2.5.1.min.js"></script><script src="libs/plotly-cartesian-2.5.1/plotly-cartesian-2.5.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script>
</head>
<body>
<div class="alert alert-info alert-dismissible">
      <a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
      <strong>¿Necesita ayuda para aprender R?</strong> Inscríbase en Applied Epi's <a href="https://www.appliedepi.org/live/" class="alert-link">curso de introducción a R</a>, pruebe nuestro <a href="https://www.appliedepi.org/tutorial/" class="alert-link">tutoriales gratuitos de R</a>, hacer un post en nuestro <a href="https://community.appliedepi.org/" class="alert-link">Foro comunitario de preguntas y respuestas</a>, o pregunte por nuestro <a href="mailto:contact@appliedepi.org" class="alert-link">R Servicio de asistencia técnica</a>.
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">EpiRhandbook en español</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">Acerca de este libro</li>
<li><a class="" href="editorial-and-technical-notes.html"><span class="header-section-number">1</span> Notas editoriales y técnicas</a></li>
<li><a class="" href="download-handbook-and-data.html"><span class="header-section-number">2</span> Descargando el manual y los datos</a></li>
<li class="book-part">Aspectos básicos</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">3</span> Fundamentos de R</a></li>
<li><a class="" href="transition-to-r.html"><span class="header-section-number">4</span> Transición a R</a></li>
<li><a class="" href="suggested-packages-1.html"><span class="header-section-number">5</span> Paquetes recomendados</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> Proyectos en R</a></li>
<li><a class="" href="import-and-export.html"><span class="header-section-number">7</span> Importación y exportación</a></li>
<li class="book-part">Gestión de datos</li>
<li><a class="" href="cleaning-data-and-core-functions.html"><span class="header-section-number">8</span> Limpieza de datos y funciones básicas</a></li>
<li><a class="" href="working-with-dates.html"><span class="header-section-number">9</span> Trabajando con Fechas</a></li>
<li><a class="" href="characters-and-strings.html"><span class="header-section-number">10</span> Caracteres y cadenas</a></li>
<li><a class="active" href="factors.html"><span class="header-section-number">11</span> Factores</a></li>
<li><a class="" href="pivoting-data.html"><span class="header-section-number">12</span> Pivotar datos</a></li>
<li><a class="" href="grouping-data.html"><span class="header-section-number">13</span> Agrupar datos</a></li>
<li><a class="" href="joining-data.html"><span class="header-section-number">14</span> Unir datos</a></li>
<li><a class="" href="de-duplication.html"><span class="header-section-number">15</span> De-duplicación</a></li>
<li><a class="" href="iteration-loops-and-lists.html"><span class="header-section-number">16</span> Iteración, bucles y listas</a></li>
<li class="book-part">Análisis</li>
<li><a class="" href="descriptive-tables.html"><span class="header-section-number">17</span> Tablas descriptivas</a></li>
<li><a class="" href="simple-statistical-tests.html"><span class="header-section-number">18</span> Tests estadísticos sencillos</a></li>
<li><a class="" href="univariate-and-multivariable-regression.html"><span class="header-section-number">19</span> Regresión univariante y multivariable</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> Valores faltantes</a></li>
<li><a class="" href="standardised-rates.html"><span class="header-section-number">21</span> Tasas estandarizadas</a></li>
<li><a class="" href="moving-averages.html"><span class="header-section-number">22</span> Medias Móviles</a></li>
<li><a class="" href="time-series-and-outbreak-detection.html"><span class="header-section-number">23</span> Series temporales y detección de brotes</a></li>
<li><a class="" href="epidemic-modeling.html"><span class="header-section-number">24</span> Modelización de epidemias</a></li>
<li><a class="" href="contact-tracing-1.html"><span class="header-section-number">25</span> Rastreo de contactos</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">26</span> Análisis de encuestas</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">27</span> Análisis de supervivencia</a></li>
<li><a class="" href="gis-basics.html"><span class="header-section-number">28</span> Conceptos básicos de los SIG</a></li>
<li class="book-part">Visualización de datos</li>
<li><a class="" href="tables-for-presentation.html"><span class="header-section-number">29</span> Tablas para presentaciones</a></li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">30</span> Conceptos básicos de ggplot</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">31</span> Consejos de ggplot</a></li>
<li><a class="" href="epidemic-curves.html"><span class="header-section-number">32</span> Curvas epidémicas</a></li>
<li><a class="" href="demographic-pyramids-and-likert-scales.html"><span class="header-section-number">33</span> Pirámides de población y escalas de Likert</a></li>
<li><a class="" href="heat-plots.html"><span class="header-section-number">34</span> Gráficos de calor</a></li>
<li><a class="" href="diagrams-and-charts.html"><span class="header-section-number">35</span> Diagramas y gráficos</a></li>
<li><a class="" href="combinations-analysis.html"><span class="header-section-number">36</span> Análisis de combinaciones</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">37</span> Cadenas de transmisión</a></li>
<li><a class="" href="phylogenetic-trees-1.html"><span class="header-section-number">38</span> Árboles filogenéticos</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">39</span> Gráficos interactivos</a></li>
<li class="book-part">Informes y Dashboards</li>
<li><a class="" href="reports-with-r-markdown.html"><span class="header-section-number">40</span> Informes con R Markdown</a></li>
<li><a class="" href="organizing-routine-reports.html"><span class="header-section-number">41</span> Organización de informes rutinarios</a></li>
<li><a class="" href="dashboards-with-r-markdown.html"><span class="header-section-number">42</span> Dashboards con R Markdown</a></li>
<li><a class="" href="dashboards-with-shiny.html"><span class="header-section-number">43</span> Dashboards con Shiny</a></li>
<li class="book-part">Miscelánea</li>
<li><a class="" href="writing-functions-1.html"><span class="header-section-number">44</span> Escribir funciones</a></li>
<li><a class="" href="directory-interactions.html"><span class="header-section-number">45</span> Interacciones con directorios</a></li>
<li><a class="" href="version-control-and-collaboration-with-git-and-github.html"><span class="header-section-number">46</span> Control de versiones y colaboración con Git y Github</a></li>
<li><a class="" href="common-errors.html"><span class="header-section-number">47</span> Errores comunes</a></li>
<li><a class="" href="getting-help.html"><span class="header-section-number">48</span> Cómo obtener ayuda</a></li>
<li><a class="" href="r-on-network-drives.html"><span class="header-section-number">49</span> R en redes locales</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">50</span> Data Table</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="factors" class="section level1" number="11">
<h1>
<span class="header-section-number">11</span> Factores<a class="anchor" aria-label="anchor" href="#factors"><i class="fas fa-link"></i></a>
</h1>
<div class="inline-figure"><img src="images/Factors_1500x500.png" width="100%"></div>
<p>En R, los <em>factores</em> son un tipo de datos que permiten categorías ordenadas con un conjunto fijo de valores.</p>
<p>Normalmente, se convierte una columna de tipo numérico o de caracteres en un factor si se desea establecer un orden intrínseco a los valores (“<em>niveles”</em>) para que puedan mostrarse de forma no alfabética en gráficos y tablas. Otro uso común de los factores es normalizar las leyendas de los gráficos para que no fluctúen si ciertos valores están temporalmente faltantes de datos.</p>
<p>En esta página se muestra el uso de las funciones del paquete <strong>forcats</strong> (nombre abreviado de “<strong>For</strong> <strong>cat</strong>egorical variables”) y algunas funciones de R <strong>base</strong>. También se aborda el uso de <strong>lubridate</strong> y <strong>aweek</strong> para casos de factores especiales relacionados con semanas epidemiológicas.</p>
<p>Puedes encontrar una lista completa de las funciones de <strong>forcats</strong> en línea <a href="https://forcats.tidyverse.org/reference/index.html">aquí</a>. A continuación mostramos algunas de las más comunes.</p>
<!-- ======================================================= -->
<div id="preparation-2" class="section level2" number="11.1">
<h2>
<span class="header-section-number">11.1</span> Preparación<a class="anchor" aria-label="anchor" href="#preparation-2"><i class="fas fa-link"></i></a>
</h2>
<div id="cargar-paquetes-2" class="section level3 unnumbered">
<h3>Cargar paquetes<a class="anchor" aria-label="anchor" href="#cargar-paquetes-2"><i class="fas fa-link"></i></a>
</h3>
<p>Este trozo de código muestra la carga de los paquetes necesarios para el análisis. En este manual destacamos <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> de <strong>pacman</strong>, que instala el paquete si es necesario <em>y</em> lo carga para su uso. También puede cargar los paquetes instalados con <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> de R <strong>base</strong>. Consulta la página sobre <a href="r-basics.html#r-basics">Fundamentos de R</a> para obtener más información sobre los paquetes de R.</p>
<div class="sourceCode" id="cb455"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span></span>
<span>  <span class="va">rio</span>,           <span class="co"># import/export</span></span>
<span>  <span class="va">here</span>,          <span class="co"># filepaths</span></span>
<span>  <span class="va">lubridate</span>,     <span class="co"># working with dates</span></span>
<span>  <span class="va">forcats</span>,       <span class="co"># factors</span></span>
<span>  <span class="va">aweek</span>,         <span class="co"># create epiweeks with automatic factor levels</span></span>
<span>  <span class="va">janitor</span>,       <span class="co"># tables</span></span>
<span>  <span class="va">tidyverse</span>      <span class="co"># data mgmt and viz</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div id="importar-datos-2" class="section level3 unnumbered">
<h3>Importar datos<a class="anchor" aria-label="anchor" href="#importar-datos-2"><i class="fas fa-link"></i></a>
</h3>
<p>Importamos los datos de casos de una epidemia de ébola simulada. Si quieres seguir el proceso, <a href="https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/case_linelists/linelist_cleaned.rds">clica para descargar linelist “limpio”</a> (como archivo .rds). Importa sus datos con la función <code>import()</code> del paquete <strong>rio</strong> (acepta muchos tipos de archivos como .xlsx, .rds, .csv - Mira la página de <a href="import-and-export.html#import-and-export">importación y exportación</a> para más detalles).</p>
<div class="sourceCode" id="cb456"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># import your dataset</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu">import</span><span class="op">(</span><span class="st">"linelist_cleaned.rds"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="fct_newcat" class="section level3 unnumbered">
<h3>Nueva variable categórica<a class="anchor" aria-label="anchor" href="#fct_newcat"><i class="fas fa-link"></i></a>
</h3>
<p>Para mostrarlo en esta página utilizaremos un escenario común - la creación de una nueva variable categórica.</p>
<p>Ten en cuenta que si conviertes una columna numérica en una de tipo factor, no podrás calcular estadísticas numéricas sobre ella.</p>
<div id="crear-columna" class="section level4 unnumbered">
<h4>Crear columna<a class="anchor" aria-label="anchor" href="#crear-columna"><i class="fas fa-link"></i></a>
</h4>
<p>Utilizamos la columna existente <code>days_onset_hosp</code> (días desde el inicio de los síntomas hasta el ingreso en el hospital) y creamos una nueva columna <code>delay_cat</code> clasificando cada fila en una de varias categorías. Lo hacemos con la función <strong>dplyr</strong> <code>case_when()</code>, que aplica secuencialmente criterios lógicos (lado derecho) a cada fila y devuelve el valor correspondiente del lado izquierdo para la nueva columna <code>delay_cat</code>. Puedes leer más sobre <code>case_when()</code> en <a href="cleaning-data-and-core-functions.html#cleaning-data-and-core-functions">Limpieza de datos y funciones básicas</a>.</p>
<div class="sourceCode" id="cb457"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>delay_cat <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>    <span class="co"># criteria                                   # new value if TRUE</span></span>
<span>    <span class="va">days_onset_hosp</span> <span class="op">&lt;</span> <span class="fl">2</span>                        <span class="op">~</span> <span class="st">"&lt;2 days"</span>,</span>
<span>    <span class="va">days_onset_hosp</span> <span class="op">&gt;=</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="va">days_onset_hosp</span> <span class="op">&lt;</span> <span class="fl">5</span> <span class="op">~</span> <span class="st">"2-5 days"</span>,</span>
<span>    <span class="va">days_onset_hosp</span> <span class="op">&gt;=</span> <span class="fl">5</span>                       <span class="op">~</span> <span class="st">"&gt;5 days"</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">days_onset_hosp</span><span class="op">)</span>                     <span class="op">~</span> <span class="cn">NA_character_</span>,</span>
<span>    <span class="cn">TRUE</span>                                       <span class="op">~</span> <span class="st">"Check me"</span><span class="op">)</span><span class="op">)</span>  </span></code></pre></div>
</div>
<div id="orden-de-valores-por-defecto" class="section level4 unnumbered">
<h4>Orden de valores por defecto<a class="anchor" aria-label="anchor" href="#orden-de-valores-por-defecto"><i class="fas fa-link"></i></a>
</h4>
<p>Tal y como se creó con <code>case_when()</code>, la nueva columna <code>delay_cat</code> es una columna categórica de tipo Character - aún <em>no</em> es un factor. Así, en una tabla de frecuencias, vemos que los valores únicos aparecen en un orden alfanumérico por defecto - un orden que no tiene mucho sentido intuitivo:</p>
<div class="sourceCode" id="cb458"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">delay_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
##  &lt;2 days  &gt;5 days 2-5 days     &lt;NA&gt; 
##     2990      602     2040      256</code></pre>
<p>Del mismo modo, si hacemos un gráfico de barras, los valores también aparecen en este orden en el eje x (ver la página de <a href="ggplot-basics.html#ggplot-basics">conceptos básicos de ggplot</a> para más información sobre <strong>ggplot2</strong> - el paquete de visualización más común en R).</p>
<div class="sourceCode" id="cb460"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">delay_cat</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-377-1.png" width="672"></div>
</div>
</div>
</div>
<div id="convert-to-factor" class="section level2" number="11.2">
<h2>
<span class="header-section-number">11.2</span> Convertir en factor<a class="anchor" aria-label="anchor" href="#convert-to-factor"><i class="fas fa-link"></i></a>
</h2>
<p>Para convertir una columna numérica o de caracteres en una de <em>tipo factor</em>, puedes utilizar cualquier función del paquete <strong>forcats</strong> (muchas se detallan <a href="factors.html#fct_adjust">a continuación</a>). Las convertirán en otra de tipo factor y luego también realizarán o permitirán cierto ordenamiento de los niveles - por ejemplo usando <code>fct_relevel()</code> permite especificar manualmente el orden de los niveles. La función <code>as_factor()</code> simplemente convierte el tipo sin ninguna otra capacidad.</p>
<p>La función <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code> de R <strong>base</strong> convierte una columna en factor y permite especificar manualmente el orden de los niveles, como un vector de caracteres a su argumento <code>levels =</code>.</p>
<p>A continuación utilizamos <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> y <code>fct_relevel()</code> para convertir la columna delay_cat de tipo carácter a tipo factor. La columna <code>delay_cat</code> se crea en la sección de <a href="factors.html#fct_newcat">preparación</a> anterior.</p>
<div class="sourceCode" id="cb461"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>delay_cat <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">delay_cat</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><em>Los “valores” únicos de esta columna se consideran ahora “niveles” del factor.</em> Los niveles tienen un <em>orden</em>, que puede imprimirse con la función de <code><a href="https://rdrr.io/r/base/levels.html">levels()</a></code>, o alternativamente verse en una tabla de recuento mediante <code><a href="https://rdrr.io/r/base/table.html">table()</a></code> de R <strong>base</strong> o <code>tabyl()</code> de <strong>janitor</strong>. Por defecto, el orden de los niveles será alfanumérico, como antes. Ten en cuenta que <code>NA</code> no es un nivel de factor.</p>
<div class="sourceCode" id="cb462"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">delay_cat</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "&lt;2 days"  "&gt;5 days"  "2-5 days"</code></pre>
<p>La función <code>fct_relevel()</code> tiene la utilidad adicional de permitir especificar manualmente el orden de los niveles. Simplemente escribe los valores de nivel en orden, entre comillas, separados por comas, como se muestra a continuación. Ten en cuenta que la ortografía debe coincidir exactamente con los valores. Si deseas crear niveles que no existen en los datos, utiliza <a href="factors.html#fct_add">fct_expand() en su lugar</a>).</p>
<div class="sourceCode" id="cb464"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>delay_cat <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">delay_cat</span>, <span class="st">"&lt;2 days"</span>, <span class="st">"2-5 days"</span>, <span class="st">"&gt;5 days"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Ahora podemos ver que los niveles están ordenados, como se especificó en el comando anterior, en un orden sensato.</p>
<div class="sourceCode" id="cb465"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">delay_cat</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "&lt;2 days"  "2-5 days" "&gt;5 days"</code></pre>
<p>Ahora el orden de la gráfica también tiene un sentido más intuitivo.</p>
<div class="sourceCode" id="cb467"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">delay_cat</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-382-1.png" width="672"></div>
</div>
<div id="add-or-drop-levels" class="section level2" number="11.3">
<h2>
<span class="header-section-number">11.3</span> Añadir o quitar niveles<a class="anchor" aria-label="anchor" href="#add-or-drop-levels"><i class="fas fa-link"></i></a>
</h2>
<div id="fct_add" class="section level3 unnumbered">
<h3>Añadir<a class="anchor" aria-label="anchor" href="#fct_add"><i class="fas fa-link"></i></a>
</h3>
<p>Si necesitas añadir niveles a un factor, puedes hacerlo con <code>fct_expand()</code>. Basta con escribir el nombre de la columna seguido de los nuevos niveles (separados por comas). Al tabular los valores, podemos ver los nuevos niveles y los recuentos de cero. Puedes utilizar <code><a href="https://rdrr.io/r/base/table.html">table()</a></code> de R <strong>base</strong>, o <code>tabyl()</code> de <strong>janitor</strong>:</p>
<div class="sourceCode" id="cb468"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>delay_cat <span class="op">=</span> <span class="fu">fct_expand</span><span class="op">(</span><span class="va">delay_cat</span>, <span class="st">"Not admitted to hospital"</span>, <span class="st">"Transfer to other jurisdiction"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tabyl</span><span class="op">(</span><span class="va">delay_cat</span><span class="op">)</span>   <span class="co"># print table</span></span></code></pre></div>
<pre><code>##                       delay_cat    n    percent valid_percent
##                         &lt;2 days 2990 0.50781250     0.5308949
##                        2-5 days 2040 0.34646739     0.3622159
##                         &gt;5 days  602 0.10224185     0.1068892
##        Not admitted to hospital    0 0.00000000     0.0000000
##  Transfer to other jurisdiction    0 0.00000000     0.0000000
##                            &lt;NA&gt;  256 0.04347826            NA</code></pre>
<p>Nota: existe una función especial de <strong>forcats</strong> para añadir fácilmente valores faltantes (<code>NA</code>) como nivel. Véase la sección sobre <a href="factors.html#fct_missing">valores faltantes</a> más adelante.</p>
</div>
<div id="quitar" class="section level3 unnumbered">
<h3>Quitar<a class="anchor" aria-label="anchor" href="#quitar"><i class="fas fa-link"></i></a>
</h3>
<p>Si utilizas <code>fct_drop()</code>, los niveles “no utilizados” con recuento cero se eliminarán del conjunto de niveles. Los niveles que hemos añadido anteriormente (“No admitido en un hospital”) existen como nivel, pero ninguna fila tiene realmente esos valores. Por tanto, se eliminarán aplicando <code>fct_drop()</code> a nuestra columna de factores:</p>
<div class="sourceCode" id="cb470"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>delay_cat <span class="op">=</span> <span class="fu">fct_drop</span><span class="op">(</span><span class="va">delay_cat</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tabyl</span><span class="op">(</span><span class="va">delay_cat</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  delay_cat    n    percent valid_percent
##    &lt;2 days 2990 0.50781250     0.5308949
##   2-5 days 2040 0.34646739     0.3622159
##    &gt;5 days  602 0.10224185     0.1068892
##       &lt;NA&gt;  256 0.04347826            NA</code></pre>
</div>
</div>
<div id="fct_adjust" class="section level2" number="11.4">
<h2>
<span class="header-section-number">11.4</span> Ajustar el orden de los niveles<a class="anchor" aria-label="anchor" href="#fct_adjust"><i class="fas fa-link"></i></a>
</h2>
<p>El paquete <strong>forcats</strong> ofrece funciones útiles para ajustar fácilmente el orden de los niveles de un factor (después de haber definido una columna como de tipo factor):</p>
<p>Estas funciones pueden aplicarse a una columna de factores en dos contextos:</p>
<ol style="list-style-type: decimal">
<li>A la columna del dataframe, como es habitual, para que la transformación esté disponible para cualquier uso posterior de los datos</li>
<li>
<em>Dentro de un gráfico</em>, para que el cambio se aplique sólo dentro del gráfico</li>
</ol>
<div id="manualmente" class="section level3 unnumbered">
<h3>Manualmente<a class="anchor" aria-label="anchor" href="#manualmente"><i class="fas fa-link"></i></a>
</h3>
<p>Esta función se utiliza para ordenar manualmente los niveles de los factores. Si se utiliza en una columna no factorial, la columna se convertirá primero en de tipo factor.</p>
<p>Dentro del paréntesis, indica primero el nombre de la columna del factor y, a continuación, escribe</p>
<ul>
<li>Todos los niveles en el orden deseado (como un vector de caracteres <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>), o</li>
<li>Un nivel y se corrige la colocación utilizando el argumento <code>after =</code>
</li>
</ul>
<p>He aquí un ejemplo de redefinición de la columna <code>delay_cat</code> (que ya es de tipo Factor) y especificando todo el orden de niveles deseado.</p>
<div class="sourceCode" id="cb472"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># re-define level order</span></span>
<span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>delay_cat <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">delay_cat</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;2 days"</span>, <span class="st">"2-5 days"</span>, <span class="st">"&gt;5 days"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Si sólo quieres mover un nivel, puedes especificarlo sólo en <code>fct_relevel()</code> y dar un número al argumento <code>after =</code>para indicar en qué lugar del orden debe estar. Por ejemplo, el comando siguiente desplaza “&lt;2 días” a la segunda posición:</p>
<div class="sourceCode" id="cb473"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># re-define level order</span></span>
<span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>delay_cat <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">delay_cat</span>, <span class="st">"&lt;2 days"</span>, after <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tabyl</span><span class="op">(</span><span class="va">delay_cat</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="dentro-de-un-gráfico" class="section level3 unnumbered">
<h3>Dentro de un gráfico<a class="anchor" aria-label="anchor" href="#dentro-de-un-gr%C3%A1fico"><i class="fas fa-link"></i></a>
</h3>
<p>Los comandos <strong>forcats</strong> pueden utilizarse para establecer el orden de los niveles en el dataframe, o sólo dentro de un gráfico. Al utilizar el comando para “envolver” el nombre de la columna <em>dentro</em> del comando <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>, puedes invertir/nivelar/etc. la transformación sólo se aplicará dentro de ese gráfico.</p>
<p>A continuación, se crean dos gráficos con <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> (véase la página de <a href="ggplot-basics.html#ggplot-basics">conceptos básicos de ggplot</a>). En el primero, la columna delay_cat se asigna al eje x del gráfico, con su orden de nivel por defecto como en linelist de datos. En el segundo ejemplo se envuelve dentro de <code>fct_relevel()</code> y se cambia el orden en el gráfico.</p>
<div class="sourceCode" id="cb474"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Alpha-numeric default order - no adjustment within ggplot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">delay_cat</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Factor level order adjusted within ggplot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">delay_cat</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;2 days"</span>, <span class="st">"2-5 days"</span>, <span class="st">"&gt;5 days"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-388-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-388-2.png" width="50%"></p>
<p>Ten en cuenta que el título del eje x por defecto es ahora bastante complicado - puedes sobrescribir este título con el argumento de <strong>ggplot2</strong> <code><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs()</a></code>.</p>
</div>
<div id="invertir" class="section level3 unnumbered">
<h3>Invertir<a class="anchor" aria-label="anchor" href="#invertir"><i class="fas fa-link"></i></a>
</h3>
<p>Es bastante común que se quiera invertir el orden de los niveles. Basta con envolver el factor con <code>fct_rev()</code>.</p>
<p>Ten en cuenta que si deseas revertir <em>sólo</em> una leyenda del gráfico pero no los niveles reales del factor, puedes hacerlo con <code><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides()</a></code> (ver <a href="ggplot-tips.html#ggplot-tips">consejos de ggplot</a>).</p>
</div>
<div id="por-frecuencia" class="section level3 unnumbered">
<h3>Por frecuencia<a class="anchor" aria-label="anchor" href="#por-frecuencia"><i class="fas fa-link"></i></a>
</h3>
<p>Para ordenar por la frecuencia con que el valor aparece en los datos, utiliza <code>fct_infreq()</code>. Cualquier valor que falte (<code>NA</code>) se incluirá automáticamente al final, a menos que se convierta en un nivel explícito (véase <a href="factors.html#fct_missing">esta sección</a>). Puedes invertir el orden envolviendo más con <code>fct_rev()</code>.</p>
<p>Esta función puede utilizarse dentro de <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>, como se muestra a continuación.</p>
<div class="sourceCode" id="cb475"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ordered by frequency</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_infreq</span><span class="op">(</span><span class="va">delay_cat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Delay onset to admission (days)"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Ordered by frequency"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># reversed frequency</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="fu">fct_infreq</span><span class="op">(</span><span class="va">delay_cat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Delay onset to admission (days)"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Reverse of order by frequency"</span><span class="op">)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-389-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-389-2.png" width="50%"></p>
</div>
<div id="por-apariencia" class="section level3 unnumbered">
<h3>Por apariencia<a class="anchor" aria-label="anchor" href="#por-apariencia"><i class="fas fa-link"></i></a>
</h3>
<p>Utiliza <code>fct_inorder()</code> para establecer el orden de los niveles para que coincida con el orden de aparición en los datos, empezando por la primera fila. Esto puede ser útil si primero organizas cuidadosamente <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> los datos en el dataframe, y luego utiliza esto para establecer el orden de los factores.</p>
</div>
<div id="por-estadística-resumida-de-otra-columna" class="section level3 unnumbered">
<h3>Por estadística resumida de otra columna<a class="anchor" aria-label="anchor" href="#por-estad%C3%ADstica-resumida-de-otra-columna"><i class="fas fa-link"></i></a>
</h3>
<p>Puedes utilizar <code>fct_reorder()</code> para ordenar los niveles de una columna <em>por una estadística de resumen de otra columna</em>. Visualmente, esto puede dar lugar a gráficos agradables en los que las barras/puntos ascienden o descienden de forma constante a través del gráfico.</p>
<p>En los ejemplos siguientes, el eje x es <code>delay_cat</code>, y el eje y es la columna numérica <code>ct_blood</code> (valor de umbral de ciclo). Los gráficos de caja muestran la distribución del valor CT por grupo <code>delay_cat</code>. Queremos ordenar los gráficos de caja en orden ascendente por mediana del grupo CT.</p>
<p>En el primer ejemplo de abajo, se utiliza el orden por defecto de los niveles alfa-numéricos. Se puede ver que las alturas de los gráficos de caja están mezcladas y no en ningún orden particular. En el segundo ejemplo, la columna <code>delay_cat</code> (asignada al eje x) se ha envuelto en <code>fct_reorder()</code>, la columna <code>ct_blood</code> se da como segundo argumento, y la “mediana” se da como tercer argumento (también podría usar “max”, “mean”, “min”, etc). Por lo tanto, el orden de los niveles de <code>delay_cat</code> reflejará ahora los valores ascendentes de la mediana del CT de cada grupo de <code>delay_cat</code>. Esto se refleja en el segundo gráfico: los gráficos de caja se han reordenado de forma ascendente. Observa cómo <code>NA</code> (missing) aparecerá al final, a menos que se convierta en un nivel explícito.</p>
<div class="sourceCode" id="cb476"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># boxplots ordered by original factor levels</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">delay_cat</span>,</span>
<span>        y <span class="op">=</span> <span class="va">ct_blood</span>, </span>
<span>        fill <span class="op">=</span> <span class="va">delay_cat</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Delay onset to admission (days)"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Ordered by original alpha-numeric levels"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># boxplots ordered by median CT value</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_reorder</span><span class="op">(</span><span class="va">delay_cat</span>, <span class="va">ct_blood</span>, <span class="st">"median"</span><span class="op">)</span>,</span>
<span>        y <span class="op">=</span> <span class="va">ct_blood</span>,</span>
<span>        fill <span class="op">=</span> <span class="va">delay_cat</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Delay onset to admission (days)"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Ordered by median CT value in group"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-390-1.png" width="50%"><img src="_main_files/figure-html/unnamed-chunk-390-2.png" width="50%"></p>
<p>Observa que en este ejemplo no se requieren pasos previos a la llamada a <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> - la agrupación y los cálculos se realizan internamente en el comando ggplot.</p>
</div>
<div id="por-valor-final" class="section level3 unnumbered">
<h3>Por valor “final”<a class="anchor" aria-label="anchor" href="#por-valor-final"><i class="fas fa-link"></i></a>
</h3>
<p>Utiliza <code>fct_reorder2()</code> para los gráficos de líneas agrupadas. Ordena los niveles (y, por tanto, la <em>leyenda</em>) para que se alineen con la ordenación vertical de las líneas en el “final” del gráfico. Técnicamente hablando, “ordena por los valores-y asociados a los valores-x más grandes”.</p>
<p>Por ejemplo, si tienes líneas que muestran los recuentos de casos por hospital a lo largo del tiempo, puedes aplicar <code>fct_reorder2()</code> al argumento <code>color =</code>dentro de <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>, de forma que el orden vertical de los hospitales que aparecen en la leyenda se alinee con el orden de las líneas en el extremo terminal del gráfico. Lee más en la <a href="https://forcats.tidyverse.org/reference/fct_reorder.html">documentación en línea</a>.</p>
<div class="sourceCode" id="cb477"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">epidemic_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>         <span class="co"># begin with the linelist   </span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">date_onset</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2014-09-21"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>    <span class="co"># cut-off date, for visual clarity</span></span>
<span>    <span class="fu">count</span><span class="op">(</span>                                            <span class="co"># get case counts per week and by hospital</span></span>
<span>      epiweek <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date_onset</span>, <span class="st">"week"</span><span class="op">)</span>,  </span>
<span>      <span class="va">hospital</span>                                            </span>
<span>    <span class="op">)</span> </span>
<span>  </span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">epidemic_data</span><span class="op">)</span><span class="op">+</span>                       <span class="co"># start plot</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>                                        <span class="co"># make lines</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">epiweek</span>,                                  <span class="co"># x-axis epiweek</span></span>
<span>      y <span class="op">=</span> <span class="va">n</span>,                                        <span class="co"># height is number of cases per week</span></span>
<span>      color <span class="op">=</span> <span class="fu">fct_reorder2</span><span class="op">(</span><span class="va">hospital</span>, <span class="va">epiweek</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="co"># data grouped and colored by hospital, with factor order by height at end of plot</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Factor levels (and legend display) by line height at end of plot"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Hospital"</span><span class="op">)</span>                          <span class="co"># change legend title</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-391-1.png" width="672"></div>
</div>
</div>
<div id="fct_missing" class="section level2" number="11.5">
<h2>
<span class="header-section-number">11.5</span> Valores faltantes<a class="anchor" aria-label="anchor" href="#fct_missing"><i class="fas fa-link"></i></a>
</h2>
<p>Si hay valores <code>NA</code> en lu columna de factores, puede convertirlos fácilmente a un nivel con nombre como “Missing” con <code>fct_explicit_na()</code>. Los valores <code>NA</code> se convierten por defecto en “(Missing)” al final del orden de los niveles. Puedes ajustar el nombre del nivel con el argumento <code>na_level =</code>.</p>
<p>A continuación, esta operación se realiza en la columna <code>delay_cat</code> y se imprime una tabla con <code>tabyl()</code> con <code>NA</code> convertido en “Missing delay”.</p>
<div class="sourceCode" id="cb478"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>delay_cat <span class="op">=</span> <span class="fu">fct_explicit_na</span><span class="op">(</span><span class="va">delay_cat</span>, na_level <span class="op">=</span> <span class="st">"Missing delay"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tabyl</span><span class="op">(</span><span class="va">delay_cat</span><span class="op">)</span></span></code></pre></div>
<pre><code>##      delay_cat    n    percent
##       2-5 days 2040 0.34646739
##        &lt;2 days 2990 0.50781250
##        &gt;5 days  602 0.10224185
##  Missing delay  256 0.04347826</code></pre>
</div>
<div id="combine-levels" class="section level2" number="11.6">
<h2>
<span class="header-section-number">11.6</span> Combinar niveles<a class="anchor" aria-label="anchor" href="#combine-levels"><i class="fas fa-link"></i></a>
</h2>
<div id="manualmente-1" class="section level3 unnumbered">
<h3>Manualmente<a class="anchor" aria-label="anchor" href="#manualmente-1"><i class="fas fa-link"></i></a>
</h3>
<p>Puedes ajustar las visualizaciones de los niveles manualmente con <code>fct_recode()</code>. Es como la función <code>recode()</code> de <strong>dplyr</strong> (véase <a href="cleaning-data-and-core-functions.html#cleaning-data-and-core-functions">Limpieza de datos y funciones básicas</a>), pero permite la creación de nuevos niveles de factores. Si utilizas la función simple <code>recode()</code> en un factor, los nuevos valores recodificados serán rechazados a menos que ya hayan sido establecidos como niveles permitidos.</p>
<p>Esta herramienta también puede utilizarse para “combinar” niveles, asignando a varios niveles el mismo valor recodificado. Sólo hay que tener cuidado de no perder información. Considere la posibilidad de realizar estos pasos de combinación en una nueva columna (sin sobreescribir la columna existente).</p>
<p><code>fct_recode()</code> tiene una sintaxis diferente a la de <code>recode()</code>. <code>recode()</code> utiliza <code>OLD = NEW</code>, mientras que <code>fct_recode()</code> utiliza <code>NEW = OLD</code>.</p>
<p>Los niveles actuales de <code>delay_cat</code> son:</p>
<div class="sourceCode" id="cb480"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">delay_cat</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "&lt;2 days"  "2-5 days" "&gt;5 days"</code></pre>
<p>Los nuevos niveles se crean utilizando la sintaxis <code>fct_recode(column, "new" = "old", "new" = "old", "new" = "old")</code> y se imprimen:</p>
<div class="sourceCode" id="cb482"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>delay_cat <span class="op">=</span> <span class="fu">fct_recode</span><span class="op">(</span></span>
<span>    <span class="va">delay_cat</span>,</span>
<span>    <span class="st">"Less than 2 days"</span> <span class="op">=</span> <span class="st">"&lt;2 days"</span>,</span>
<span>    <span class="st">"2 to 5 days"</span>      <span class="op">=</span> <span class="st">"2-5 days"</span>,</span>
<span>    <span class="st">"More than 5 days"</span> <span class="op">=</span> <span class="st">"&gt;5 days"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tabyl</span><span class="op">(</span><span class="va">delay_cat</span><span class="op">)</span></span></code></pre></div>
<pre><code>##         delay_cat    n    percent valid_percent
##  Less than 2 days 2990 0.50781250     0.5308949
##       2 to 5 days 2040 0.34646739     0.3622159
##  More than 5 days  602 0.10224185     0.1068892
##              &lt;NA&gt;  256 0.04347826            NA</code></pre>
<p>Aquí se combinan manualmente con <code>fct_recode()</code>. Obsérvese que no se produce ningún error en la creación de un nuevo nivel “Menos de 5 días”.</p>
<div class="sourceCode" id="cb484"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>delay_cat <span class="op">=</span> <span class="fu">fct_recode</span><span class="op">(</span></span>
<span>    <span class="va">delay_cat</span>,</span>
<span>    <span class="st">"Less than 5 days"</span> <span class="op">=</span> <span class="st">"&lt;2 days"</span>,</span>
<span>    <span class="st">"Less than 5 days"</span> <span class="op">=</span> <span class="st">"2-5 days"</span>,</span>
<span>    <span class="st">"More than 5 days"</span> <span class="op">=</span> <span class="st">"&gt;5 days"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tabyl</span><span class="op">(</span><span class="va">delay_cat</span><span class="op">)</span></span></code></pre></div>
<pre><code>##         delay_cat    n    percent valid_percent
##  Less than 5 days 5030 0.85427989     0.8931108
##  More than 5 days  602 0.10224185     0.1068892
##              &lt;NA&gt;  256 0.04347826            NA</code></pre>
</div>
<div id="reducir-a-otros" class="section level3 unnumbered">
<h3>Reducir a “Otros”<a class="anchor" aria-label="anchor" href="#reducir-a-otros"><i class="fas fa-link"></i></a>
</h3>
<p>Puedes utilizar <code>fct_other()</code> para asignar manualmente niveles de factor a un nivel “Otro”. A continuación, todos los niveles de la columna <code>hospital</code>, aparte de “Port Hospital” y “Central Hospital”, se combinan en “Otros”. Puedes proporcionar el vector <code>keep =</code>, o <code>drop =</code> para mantener o eliminarlo. Puedes cambiar la visualización del nivel “Otro” con <code>other_level =</code>.</p>
<div class="sourceCode" id="cb486"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>    </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">fct_other</span><span class="op">(</span>                      <span class="co"># adjust levels</span></span>
<span>    <span class="va">hospital</span>,</span>
<span>    keep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Port Hospital"</span>, <span class="st">"Central Hospital"</span><span class="op">)</span>,  <span class="co"># keep these separate</span></span>
<span>    other_level <span class="op">=</span> <span class="st">"Other Hospital"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>            <span class="co"># All others as "Other Hospital"</span></span>
<span>  <span class="fu">tabyl</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span>                                   <span class="co"># print table</span></span></code></pre></div>
<pre><code>##          hospital    n    percent
##  Central Hospital  454 0.07710598
##     Port Hospital 1762 0.29925272
##    Other Hospital 3672 0.62364130</code></pre>
</div>
<div id="reducir-por-frecuencia" class="section level3 unnumbered">
<h3>Reducir por frecuencia<a class="anchor" aria-label="anchor" href="#reducir-por-frecuencia"><i class="fas fa-link"></i></a>
</h3>
<p>Puedes combinar los niveles del factor menos frecuente automáticamente utilizando <code>fct_lump()</code>.</p>
<p>Para “agrupar” muchos niveles de baja frecuencia en un grupo “Otros”, puedes hacer una de las siguientes cosas:</p>
<ul>
<li><p>Establecer con <code>n =</code> el número de grupos que deseas conservar. Los n niveles más frecuentes se mantendrán, y todos los demás se combinarán en “Otros”.</p></li>
<li><p>Fijar con <code>prop =</code> la proporción de frecuencia del umbral para los niveles por encima de los cuales deseas mantener. Todos los demás valores se combinarán en “Otros”.</p></li>
</ul>
<p>Puedes cambiar la visualización del nivel “Otros” con <code>other_level =</code>. A continuación, todos los hospitales excepto los dos más frecuentes se combinan en “Other hospitals”.</p>
<div class="sourceCode" id="cb488"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>    </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">fct_lump</span><span class="op">(</span>                      <span class="co"># adjust levels</span></span>
<span>    <span class="va">hospital</span>,</span>
<span>    n <span class="op">=</span> <span class="fl">2</span>,                                          <span class="co"># keep top 2 levels</span></span>
<span>    other_level <span class="op">=</span> <span class="st">"Other Hospital"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>            <span class="co"># all others as "Other Hospital"</span></span>
<span>  <span class="fu">tabyl</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span>                                   <span class="co"># print table</span></span></code></pre></div>
<pre><code>##        hospital    n   percent
##         Missing 1469 0.2494905
##   Port Hospital 1762 0.2992527
##  Other Hospital 2657 0.4512568</code></pre>
</div>
</div>
<div id="show-all-levels" class="section level2" number="11.7">
<h2>
<span class="header-section-number">11.7</span> Mostrar todos los niveles<a class="anchor" aria-label="anchor" href="#show-all-levels"><i class="fas fa-link"></i></a>
</h2>
<p>Una de las ventajas del uso de factores es la estandarización del aspecto de las leyendas de los gráficos y de las tablas, independientemente de los valores que estén realmente presentes en unos datos.</p>
<p>Si estás preparando muchas figuras (por ejemplo, para varias jurisdicciones), querrás que las leyendas y las tablas aparezcan de forma idéntica incluso con distintos niveles de cumplimentación o de composición de los datos.</p>
<div id="en-los-gráficos" class="section level3 unnumbered">
<h3>En los gráficos<a class="anchor" aria-label="anchor" href="#en-los-gr%C3%A1ficos"><i class="fas fa-link"></i></a>
</h3>
<p>En una figura <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>, basta con añadir el argumento <code>drop = FALSE</code> en la función <code>scale_xxxx()</code> correspondiente. Se mostrarán todos los niveles de los factores, independientemente de si están presentes en los datos. Si sus niveles de columna de factores se muestran con <code>fill =</code>, entonces en <code><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html">scale_fill_discrete()</a></code> incluye <code>drop = FALSE,</code> como se muestra a continuación. Si sus niveles se muestran con <code>x =</code> (al eje-x) <code>color =</code> o <code>size =</code>, deberás establecer esto con <code><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html">scale_color_discrete()</a></code> o <code><a href="https://ggplot2.tidyverse.org/reference/scale_size.html">scale_size_discrete()</a></code> según corresponda.</p>
<p>Este ejemplo es un gráfico de barras apiladas de la categoría de edad, por hospital. Añadiendo <code>scale_fill_discrete(drop = FALSE)</code> se garantiza que todos los grupos de edad aparezcan en la leyenda, aunque no estén presentes en los datos.</p>
<div class="sourceCode" id="cb490"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">linelist</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hospital</span>, fill <span class="op">=</span> <span class="va">age_cat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html">scale_fill_discrete</a></span><span class="op">(</span>drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span>                        <span class="co"># show all age groups in the legend, even those not present</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"All age groups will appear in legend, even if not present in data"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-399-1.png" width="672"></div>
</div>
<div id="en-tablas" class="section level3 unnumbered">
<h3>En tablas<a class="anchor" aria-label="anchor" href="#en-tablas"><i class="fas fa-link"></i></a>
</h3>
<p>Tanto <code><a href="https://rdrr.io/r/base/table.html">table()</a></code> de R <strong>base</strong> como <code>tabyl()</code> de <strong>janitor</strong> mostrarán todos los niveles de los factores (incluso los no utilizados).</p>
<p>Si utilizas <code>count()</code> o <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> de <strong>dplyr</strong> para hacer una tabla, añade el argumento <code>.drop = FALSE</code> para incluir los recuentos de todos los niveles del factor, incluso los no utilizados.</p>
<p>Puedes leer más en la página de <a href="descriptive-tables.html#descriptive-tables">tablas descriptivas</a>, o en la <a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">documentación de scale_discrete</a>, o en la <a href="https://dplyr.tidyverse.org/reference/count.html">documentación de <code>count()</code></a>. Puedes ver otro ejemplo en la página de <a href="contact-tracing-1.html#contact-tracing-1">rastreo de contactos</a>.</p>
</div>
</div>
<div id="epiweeks" class="section level2" number="11.8">
<h2>
<span class="header-section-number">11.8</span> Epiweeks<a class="anchor" aria-label="anchor" href="#epiweeks"><i class="fas fa-link"></i></a>
</h2>
<p>Por favor, consulta la extensa discusión sobre cómo crear semanas epidemiológicas en la página de <a href="grouping-data.html#grouping-data">Agrupar datos</a>. Consulta también la página <a href="working-with-dates.html#working-with-dates-1">Trabajar con fechas</a> para obtener consejos sobre cómo crear y dar formato a las semanas epidemiológicas.</p>
<div id="epiweeks-en-un-gráfico" class="section level3 unnumbered">
<h3>Epiweeks en un gráfico<a class="anchor" aria-label="anchor" href="#epiweeks-en-un-gr%C3%A1fico"><i class="fas fa-link"></i></a>
</h3>
<p>Si tu objetivo es crear epiweeks para mostrarlos en un gráfico, puedes hacerlo simplemente con <code>floor_date()</code> de <strong>lubridate</strong>, como se explica en la página de <a href="grouping-data.html#grouping-data">Agrupar datos</a>. Los valores devueltos serán del tipo Date con el formato YYYY-MM-DD. Si utilizas esta columna en un gráfico, las fechas se ordenarán correctamente de forma natural, y no tendrá que preocuparse de los niveles o de la conversión al tipo Factor. Mira el histograma <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> de las fechas de inicio más abajo.</p>
<p>En este enfoque, se puede ajustar la <em>visualización</em> de las fechas en un eje con <code><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date()</a></code>. Consulta la página sobre <a href="epidemic-curves.html#epidemic-curves">curvas epidémicas</a> para obtener más información. Puedes especificar un formato de visualización “strptime” al argumento <code>date_labels =</code> de <code><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date()</a></code>. Estos formatos utilizan marcadores de posición “%” y se tratan en la página <a href="working-with-dates.html#working-with-dates-1">Trabajar con fechas</a>. Utiliza “%Y” para representar un año de 4 dígitos, y “%W” o “%U” para representar el número de la semana (semana del lunes o del domingo respectivamente).</p>
<div class="sourceCode" id="cb491"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>epiweek_date <span class="op">=</span> <span class="fu">floor_date</span><span class="op">(</span><span class="va">date_onset</span>, <span class="st">"week"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># create week column</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>                                                  <span class="co"># begin ggplot</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">epiweek_date</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>           <span class="co"># histogram of date of onset</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%Y-W%W"</span><span class="op">)</span>                       <span class="co"># adjust disply of dates to be YYYY-WWw</span></span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-400-1.png" width="672"></div>
</div>
<div id="epiweeks-en-los-datos" class="section level3 unnumbered">
<h3>Epiweeks en los datos<a class="anchor" aria-label="anchor" href="#epiweeks-en-los-datos"><i class="fas fa-link"></i></a>
</h3>
<p>Sin embargo, si tu propósito al factorizar <em>no es</em> hacer gráficos, puedes enfocar esto de dos maneras:</p>
<ol style="list-style-type: decimal">
<li>
<em>Para un control preciso de la visualización</em>, convierte la columna de la semana-epi <strong>lubrificada</strong> (AAAA-MM-DD) al formato de visualización deseado (AAAA-WWw) <em>dentro del propio dataframe,</em> y luego conviértala en tipo Factor.</li>
</ol>
<p>En primer lugar, utiliza <code><a href="https://rdrr.io/r/base/format.html">format()</a></code> para convertir la visualización de la fecha de YYYY-MM-DD a YYYY-Www (consulta la página <a href="working-with-dates.html#working-with-dates-1">Trabajar con fechas</a>). En este proceso el tipo será convertida a carácter. A continuación, convierta de carácter a tipo Factor con <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code>.</p>
<div class="sourceCode" id="cb492"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>epiweek_date <span class="op">=</span> <span class="fu">floor_date</span><span class="op">(</span><span class="va">date_onset</span>, <span class="st">"week"</span><span class="op">)</span>,       <span class="co"># create epiweeks (YYYY-MM-DD)</span></span>
<span>         epiweek_formatted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">epiweek_date</span>, <span class="st">"%Y-W%W"</span><span class="op">)</span>,  <span class="co"># Convert to display (YYYY-WWw)</span></span>
<span>         epiweek_formatted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">epiweek_formatted</span><span class="op">)</span><span class="op">)</span>       <span class="co"># Convert to factor</span></span>
<span></span>
<span><span class="co"># Display levels</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">epiweek_formatted</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "2014-W13" "2014-W14" "2014-W15" "2014-W16" "2014-W17" "2014-W18" "2014-W19" "2014-W20" "2014-W21"
## [10] "2014-W22" "2014-W23" "2014-W24" "2014-W25" "2014-W26" "2014-W27" "2014-W28" "2014-W29" "2014-W30"
## [19] "2014-W31" "2014-W32" "2014-W33" "2014-W34" "2014-W35" "2014-W36" "2014-W37" "2014-W38" "2014-W39"
## [28] "2014-W40" "2014-W41" "2014-W42" "2014-W43" "2014-W44" "2014-W45" "2014-W46" "2014-W47" "2014-W48"
## [37] "2014-W49" "2014-W50" "2014-W51" "2015-W00" "2015-W01" "2015-W02" "2015-W03" "2015-W04" "2015-W05"
## [46] "2015-W06" "2015-W07" "2015-W08" "2015-W09" "2015-W10" "2015-W11" "2015-W12" "2015-W13" "2015-W14"
## [55] "2015-W15" "2015-W16"</code></pre>
<p><span style="color: red;"><strong><em>PELIGRO:</em></strong> Si colocas las semanas por delante de los años (“Www-YYY”) (“%W-%Y”), la ordenación por defecto del nivel alfanumérico será incorrecta (por ejemplo, 01-2015 estará antes que 35-2014). Podría ser necesario ajustar manualmente el orden, lo que sería un proceso largo y doloroso. </span></p>
<ol start="2" style="list-style-type: decimal">
<li>
<em>Para una visualización rápida por defecto</em>, utiliza el paquete <strong>aweek</strong> y su función <code>date2week()</code>. Puedes establecer el día de comienzo con <code>week_start =</code>, y si estableces <code>factor = TRUE</code> entonces la columna de salida es un factor ordenado. Como ventaja, el factor incluye niveles para <em>todas las</em> semanas posibles en el lapso - incluso si no hay casos esa semana.</li>
</ol>
<div class="sourceCode" id="cb494"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>epiweek <span class="op">=</span> <span class="fu">date2week</span><span class="op">(</span><span class="va">date_onset</span>, week_start <span class="op">=</span> <span class="st">"Monday"</span>, factor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">epiweek</span><span class="op">)</span></span></code></pre></div>
<p>Consulta la página <a href="working-with-dates.html#working-with-dates-1">Trabajar con fechas</a> para obtener más información sobre <strong>aweek</strong>. También ofrece la función inversa <code>week2date()</code>.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="resources-4" class="section level2" number="11.9">
<h2>
<span class="header-section-number">11.9</span> Recursos<a class="anchor" aria-label="anchor" href="#resources-4"><i class="fas fa-link"></i></a>
</h2>
<p>Página de R for Data Science en español sobre <a href="https://es.r4ds.hadley.nz/factores.html">factores</a>
<a href="https://cran.r-project.org/web/packages/aweek/vignettes/introduction.html">viñeta del paquete aweek</a></p>

<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="characters-and-strings.html"><span class="header-section-number">10</span> Caracteres y cadenas</a></div>
<div class="next"><a href="pivoting-data.html"><span class="header-section-number">12</span> Pivotar datos</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#factors"><span class="header-section-number">11</span> Factores</a></li>
<li>
<a class="nav-link" href="#preparation-2"><span class="header-section-number">11.1</span> Preparación</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#cargar-paquetes-2">Cargar paquetes</a></li>
<li><a class="nav-link" href="#importar-datos-2">Importar datos</a></li>
<li><a class="nav-link" href="#fct_newcat">Nueva variable categórica</a></li>
</ul>
</li>
<li><a class="nav-link" href="#convert-to-factor"><span class="header-section-number">11.2</span> Convertir en factor</a></li>
<li>
<a class="nav-link" href="#add-or-drop-levels"><span class="header-section-number">11.3</span> Añadir o quitar niveles</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#fct_add">Añadir</a></li>
<li><a class="nav-link" href="#quitar">Quitar</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#fct_adjust"><span class="header-section-number">11.4</span> Ajustar el orden de los niveles</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#manualmente">Manualmente</a></li>
<li><a class="nav-link" href="#dentro-de-un-gr%C3%A1fico">Dentro de un gráfico</a></li>
<li><a class="nav-link" href="#invertir">Invertir</a></li>
<li><a class="nav-link" href="#por-frecuencia">Por frecuencia</a></li>
<li><a class="nav-link" href="#por-apariencia">Por apariencia</a></li>
<li><a class="nav-link" href="#por-estad%C3%ADstica-resumida-de-otra-columna">Por estadística resumida de otra columna</a></li>
<li><a class="nav-link" href="#por-valor-final">Por valor “final”</a></li>
</ul>
</li>
<li><a class="nav-link" href="#fct_missing"><span class="header-section-number">11.5</span> Valores faltantes</a></li>
<li>
<a class="nav-link" href="#combine-levels"><span class="header-section-number">11.6</span> Combinar niveles</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#manualmente-1">Manualmente</a></li>
<li><a class="nav-link" href="#reducir-a-otros">Reducir a “Otros”</a></li>
<li><a class="nav-link" href="#reducir-por-frecuencia">Reducir por frecuencia</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#show-all-levels"><span class="header-section-number">11.7</span> Mostrar todos los niveles</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#en-los-gr%C3%A1ficos">En los gráficos</a></li>
<li><a class="nav-link" href="#en-tablas">En tablas</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#epiweeks"><span class="header-section-number">11.8</span> Epiweeks</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#epiweeks-en-un-gr%C3%A1fico">Epiweeks en un gráfico</a></li>
<li><a class="nav-link" href="#epiweeks-en-los-datos">Epiweeks en los datos</a></li>
</ul>
</li>
<li><a class="nav-link" href="#resources-4"><span class="header-section-number">11.9</span> Recursos</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>EpiRhandbook en español</strong>" was written by El equipo del manual. It was last built on 2022-11-22.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
