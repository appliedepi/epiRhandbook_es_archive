<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>8 Limpieza de datos y funciones básicas | EpiRhandbook en español</title>
<meta name="author" content="El equipo del manual">
<meta name="description" content="Esta página muestra los pasos más utilizados en el proceso de “limpieza” de datos, y también explica el uso de muchas funciones esenciales de gestión de datos en R. Para explicarlo, esta página...">
<meta name="generator" content="bookdown 0.29 with bs4_book()">
<meta property="og:title" content="8 Limpieza de datos y funciones básicas | EpiRhandbook en español">
<meta property="og:type" content="book">
<meta property="og:description" content="Esta página muestra los pasos más utilizados en el proceso de “limpieza” de datos, y también explica el uso de muchas funciones esenciales de gestión de datos en R. Para explicarlo, esta página...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="8 Limpieza de datos y funciones básicas | EpiRhandbook en español">
<meta name="twitter:description" content="Esta página muestra los pasos más utilizados en el proceso de “limpieza” de datos, y también explica el uso de muchas funciones esenciales de gestión de datos en R. Para explicarlo, esta página...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.25/datatables.js"></script><link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/tabwid.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/scrool.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.9/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.5.1/plotly-basic-2.5.1.min.js"></script><script src="libs/plotly-cartesian-2.5.1/plotly-cartesian-2.5.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">EpiRhandbook en español</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Buscar" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Tabla de contenidos</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">Acerca de este libro</li>
<li><a class="" href="editorial-and-technical-notes.html"><span class="header-section-number">1</span> Notas editoriales y técnicas</a></li>
<li><a class="" href="download-handbook-and-data.html"><span class="header-section-number">2</span> Descargando el manual y los datos</a></li>
<li class="book-part">Aspectos básicos</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">3</span> Fundamentos de R</a></li>
<li><a class="" href="transition-to-r.html"><span class="header-section-number">4</span> Transición a R</a></li>
<li><a class="" href="suggested-packages-1.html"><span class="header-section-number">5</span> Paquetes recomendados</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> Proyectos en R</a></li>
<li><a class="" href="import-and-export.html"><span class="header-section-number">7</span> Importación y exportación</a></li>
<li class="book-part">Gestión de datos</li>
<li><a class="active" href="cleaning-data-and-core-functions.html"><span class="header-section-number">8</span> Limpieza de datos y funciones básicas</a></li>
<li><a class="" href="working-with-dates.html"><span class="header-section-number">9</span> Trabajando con Fechas</a></li>
<li><a class="" href="characters-and-strings.html"><span class="header-section-number">10</span> Caracteres y cadenas</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">11</span> Factores</a></li>
<li><a class="" href="pivoting-data.html"><span class="header-section-number">12</span> Pivotar datos</a></li>
<li><a class="" href="grouping-data.html"><span class="header-section-number">13</span> Agrupar datos</a></li>
<li><a class="" href="joining-data.html"><span class="header-section-number">14</span> Unir datos</a></li>
<li><a class="" href="de-duplication.html"><span class="header-section-number">15</span> Borrador. De-duplicación</a></li>
<li><a class="" href="iteration-loops-and-lists.html"><span class="header-section-number">16</span> Borrador. Iteración, bucles y listas</a></li>
<li class="book-part">Análisis</li>
<li><a class="" href="descriptive-tables.html"><span class="header-section-number">17</span> Tablas descriptivas</a></li>
<li><a class="" href="simple-statistical-tests.html"><span class="header-section-number">18</span> Tests estadísticos sencillos</a></li>
<li><a class="" href="univariate-and-multivariable-regression.html"><span class="header-section-number">19</span> Borrador. Regresión univariante y multivariable</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">20</span> Borrador. Valores faltantes</a></li>
<li><a class="" href="standardised-rates.html"><span class="header-section-number">21</span> Borrador. Tasas estandarizadas</a></li>
<li><a class="" href="moving-averages.html"><span class="header-section-number">22</span> Borrador. Medias Móviles</a></li>
<li><a class="" href="time-series-and-outbreak-detection.html"><span class="header-section-number">23</span> Borrador. Series temporales y detección de brotes</a></li>
<li><a class="" href="epidemic-modeling.html"><span class="header-section-number">24</span> Borrador. Modelización de epidemias</a></li>
<li><a class="" href="contact-tracing-1.html"><span class="header-section-number">25</span> Borrador. Rastreo de contactos</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">26</span> Borrador. Análisis de encuestas</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">27</span> Borrador. Análisis de supervivencia</a></li>
<li><a class="" href="gis-basics.html"><span class="header-section-number">28</span> Conceptos básicos de los SIG</a></li>
<li class="book-part">Visualización de datos</li>
<li><a class="" href="tables-for-presentation.html"><span class="header-section-number">29</span> Tablas para presentaciones</a></li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">30</span> Conceptos básicos de ggplot</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">31</span> Consejos de ggplot</a></li>
<li><a class="" href="epidemic-curves.html"><span class="header-section-number">32</span> Curvas epidémicas</a></li>
<li><a class="" href="demographic-pyramids-and-likert-scales.html"><span class="header-section-number">33</span> Pirámides de población y escalas de Likert</a></li>
<li><a class="" href="heat-plots.html"><span class="header-section-number">34</span> Gráficos de calor</a></li>
<li><a class="" href="diagrams-and-charts.html"><span class="header-section-number">35</span> Diagramas y gráficos</a></li>
<li><a class="" href="combinations-analysis.html"><span class="header-section-number">36</span> Borrador. Análisis de combinaciones</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">37</span> Borrador. Cadenas de transmisión</a></li>
<li><a class="" href="phylogenetic-trees-1.html"><span class="header-section-number">38</span> Árboles filogenéticos</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">39</span> Gráficos interactivos</a></li>
<li class="book-part">Informes y Dashboards</li>
<li><a class="" href="reports-with-r-markdown.html"><span class="header-section-number">40</span> Informes con R Markdown</a></li>
<li><a class="" href="organizing-routine-reports.html"><span class="header-section-number">41</span> Organización de informes rutinarios</a></li>
<li><a class="" href="dashboards-with-r-markdown.html"><span class="header-section-number">42</span> Borrador. Dashboards con R Markdown</a></li>
<li><a class="" href="dashboards-with-shiny.html"><span class="header-section-number">43</span> Borrador. Dashboards con Shiny</a></li>
<li class="book-part">Miscelánea</li>
<li><a class="" href="writing-functions-1.html"><span class="header-section-number">44</span> Escribir funciones</a></li>
<li><a class="" href="directory-interactions.html"><span class="header-section-number">45</span> Interacciones con directorios</a></li>
<li><a class="" href="version-control-and-collaboration-with-git-and-github.html"><span class="header-section-number">46</span> Control de versiones y colaboración con Git y Github</a></li>
<li><a class="" href="common-errors.html"><span class="header-section-number">47</span> Errores comunes</a></li>
<li><a class="" href="getting-help.html"><span class="header-section-number">48</span> Cómo obtener ayuda</a></li>
<li><a class="" href="r-on-network-drives.html"><span class="header-section-number">49</span> R en redes locales</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">50</span> data.table</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="cleaning-data-and-core-functions" class="section level1" number="8">
<h1>
<span class="header-section-number">8</span> Limpieza de datos y funciones básicas<a class="anchor" aria-label="anchor" href="#cleaning-data-and-core-functions"><i class="fas fa-link"></i></a>
</h1>
<div class="inline-figure"><img src="images/cleaning.png" width="265" height="10%" style="display: block; margin: auto;"></div>
<p>Esta página muestra los pasos más utilizados en el proceso de “limpieza” de datos, y también explica el uso de muchas funciones esenciales de gestión de datos en R.</p>
<p>Para explicarlo, esta página comienza importando datos de un listado de casos crudo, y se avanza paso a paso a través del proceso de limpieza. En el código R, esto se manifiesta como una cadena de “tuberías”, que hacen referencia al operador “tuberías” <code>%&gt;%</code> que pasa unos datos de una operación a la siguiente.</p>
<div id="funciones-principales" class="section level3 unnumbered">
<h3>Funciones principales<a class="anchor" aria-label="anchor" href="#funciones-principales"><i class="fas fa-link"></i></a>
</h3>
<p>Este manual hace hincapié en el uso de las funciones de la familia de paquetes de R <a href="https://www.tidyverse.org/"><strong>tidyverse</strong></a>. Las funciones esenciales que se muestran en esta página se enumeran a continuación.</p>
<p>Muchas de estas funciones pertenecen al paquete <a href="https://dplyr.tidyverse.org/"><strong>dplyr</strong></a>, que proporciona funciones “verbales” para resolver los retos de la manipulación de datos (el nombre hace una referencia a unos alicates - <a href="https://www.thefreedictionary.com/plier#:~:text=also%20ply%C2%B7er%20(pl%C4%AB%E2%80%B2,holding%2C%20bending%2C%20or%20cutting.)">plier</a> - de dataframes). <strong>dplyr</strong> forma parte de la familia de paquetes de R <strong>tidyverse</strong> (que también incluye <strong>ggplot2</strong>, <strong>tidyr</strong>, <strong>stringr</strong>, <strong>tibble</strong>, <strong>purrr</strong>, <strong>magrittr</strong> y <strong>forcats</strong>, entre otros).</p>
<div class="inline-table"><table style="width:100%;" class="table table-sm">
<colgroup>
<col width="16%">
<col width="46%">
<col width="37%">
</colgroup>
<thead><tr class="header">
<th>Función</th>
<th>Utilidad</th>
<th>Paquete</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></td>
<td>“canalizar” (pasar) datos de una función a la siguiente</td>
<td><strong>magrittr</strong></td>
</tr>
<tr class="even">
<td><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></td>
<td>crear, transformar y redefinir columnas</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="odd">
<td><a href="https://dplyr.tidyverse.org/reference/select.html">selecct()</a></td>
<td>mantener, eliminar, seleccionar o renombrar columnas</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></td>
<td>cambiar el nombre de las columnas</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="odd">
<td>clean_names()</td>
<td>estandarizar la sintaxis de los nombres de las columnas</td>
<td><strong>janitor</strong></td>
</tr>
<tr class="even">
<td>
<a href="https://rdrr.io/r/base/character.html">as.character()</a>, <a href="https://rdrr.io/r/base/numeric.html">as.numeric()</a>, <a href="https://rdrr.io/r/base/as.Date.html">as.Date()</a>, etc.</td>
<td>convertir el tipo de una columna</td>
<td>R <strong>base</strong>
</td>
</tr>
<tr class="odd">
<td>across()</td>
<td>transformar varias columnas a la vez</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td>funciones <strong>tidyselect</strong>
</td>
<td>utilizar la lógica para seleccionar las columnas</td>
<td><strong>tidyselect</strong></td>
</tr>
<tr class="odd">
<td><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></td>
<td>mantener ciertas filas</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct()</a></td>
<td>de-duplicar filas</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="odd">
<td>rowwise()</td>
<td>operaciones por/en cada fila</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td>add_row()</td>
<td>añadir filas manualmente</td>
<td><strong>tiblle</strong></td>
</tr>
<tr class="odd">
<td><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></td>
<td>ordenar las filas</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td>recode()</td>
<td>recodificar los valores de una columna</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="odd">
<td>case_when()</td>
<td>recodificar los valores de una columna con criterios lógicos más complejos</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td>replace_na(), na_if(), coalesce()</td>
<td>funciones especiales de recodificación</td>
<td><strong>tidyr</strong></td>
</tr>
<tr class="odd">
<td>age_categories() y <a href="https://rdrr.io/r/base/cut.html">cut()</a>
</td>
<td>crear grupos categóricos a partir de una columna numérica</td>
<td>
<strong>epikit</strong> y R <strong>base</strong>
</td>
</tr>
<tr class="even">
<td>clean_variable_spelling()</td>
<td>recodificación/limpieza de valores mediante un diccionario de datos</td>
<td><strong>lista de líneas</strong></td>
</tr>
<tr class="odd">
<td><a href="https://rdrr.io/r/base/which.html">which()</a></td>
<td>aplicar los criterios lógicos; devolver los índices</td>
<td>R <strong>base</strong>
</td>
</tr>
</tbody>
</table></div>
<p>Si quieres ver cómo se comparan estas funciones con los comandos de Stata o SAS, consulta la página sobre la <a href="transition-to-r.html#transition-to-r">transición a R</a>.</p>
<p>Puedes encontrar una gestión de datos alternativa en el paquete R <strong>data.table</strong> con operadores como <code>:=</code> y el uso frecuente de corchetes <code>[ ]</code>. Este enfoque y la sintaxis se explican brevemente en la página <a href="data-table.html#data-table">Data.Table</a>.</p>
</div>
<div id="nomenclatura-1" class="section level3 unnumbered">
<h3>Nomenclatura<a class="anchor" aria-label="anchor" href="#nomenclatura-1"><i class="fas fa-link"></i></a>
</h3>
<p>En este manual, generalmente hacemos referencia a “columnas” y “filas” en lugar de “variables” y “observaciones”. Como se explica en este manual sobre <a href="https://tidyr.tidyverse.org/articles/tidy-data.html">“datos ordenados”</a>, la mayoría de los conjuntos de datos estadísticos epidemiológicos se componen estructuralmente de filas, columnas y valores.</p>
<p>Las <em>variables</em> contienen los valores que miden el mismo atributo subyacente (como el grupo de edad, el resultado o la fecha de inicio). Las <em>observaciones</em> contienen todos los valores medidos en la misma unidad (por ejemplo, una persona, un lugar o una muestra de laboratorio). Por lo tanto, estos aspectos pueden ser más difíciles de definir de forma tangible.</p>
<p>En los conjuntos de datos “ordenados”, cada columna es una variable, cada fila es una observación y cada celda es un único valor. Sin embargo, algunos conjuntos de datos que se encuentran no se ajustan a este molde: unos datos de formato “amplio” pueden tener una variable dividida en varias columnas (véase un ejemplo en la página <a href="pivoting-data.html#pivoting-data">Pivotar datos</a>). Del mismo modo, las observaciones pueden estar divididas en varias filas.</p>
<p>La mayor parte de este manual trata sobre la gestión y la transformación de datos, por lo que las referencias a las estructuras de datos concretas de filas y columnas son más relevantes que las observaciones y las variables más abstractas. Las excepciones se dan sobre todo en las páginas sobre análisis de datos, en las que verás más referencias a las variables y las observaciones.</p>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
<div id="cleaning-pipeline" class="section level2" number="8.1">
<h2>
<span class="header-section-number">8.1</span> Limpieza de tuberías<a class="anchor" aria-label="anchor" href="#cleaning-pipeline"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Esta página recorre los pasos típicos de limpieza, añadiéndolos secuencialmente a una cadena de tuberías de limpieza.</strong></p>
<p>En el análisis epidemiológico y el procesamiento de datos, los pasos de limpieza se realizan a menudo de forma secuencial, enlazados entre sí. En R, esto se manifiesta a menudo como una “tubería” de limpieza, en la que <em>los datos en bruto se pasan o se “canalizan” de un paso de limpieza a otro</em>.</p>
<p>Estas cadenas utilizan las funciones de <strong>dplyr</strong> y el operador <code>%&gt;%</code> de <strong>magrittr</strong>. Esta tubería comienza con los datos “en bruto” (“linelist_raw.xlsx”) y termina con un dataframe de R “limpio” (<code>linelist</code>) que se puede utilizar, guardar, exportar, etc.</p>
<p>En un proceso de limpieza, el orden de los pasos es importante. Los pasos de limpieza pueden incluir:</p>
<ul>
<li><p>Importación de datos</p></li>
<li><p>Limpieza o cambio de los nombres de las columnas</p></li>
<li><p>de-duplicación</p></li>
<li><p>Creación y transformación de columnas (por ejemplo, recodificación o normalización de valores)</p></li>
<li><p>Filtrado o añadido de filas</p></li>
</ul>
<!-- ======================================================= --><!-- ======================================================= --><!-- ======================================================= -->
</div>
<div id="load-packages" class="section level2" number="8.2">
<h2>
<span class="header-section-number">8.2</span> Carga de paquetes<a class="anchor" aria-label="anchor" href="#load-packages"><i class="fas fa-link"></i></a>
</h2>
<p>Este trozo de código muestra la carga de los paquetes necesarios para el análisis. En este manual destacamos <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> de <strong>pacman</strong>, que instala el paquete si es necesario <em>y</em> lo carga para su uso. También puedes cargar los paquetes instalados con <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> de R <strong>base.</strong> Consulta la página sobre <a href="r-basics.html#r-basics">Fundamentos de R</a> para obtener más información sobre los paquetes de R.</p>
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
  <span class="va">rio</span>,        <span class="co"># importing data  </span>
  <span class="va">here</span>,       <span class="co"># relative file pathways  </span>
  <span class="va">janitor</span>,    <span class="co"># data cleaning and tables</span>
  <span class="va">lubridate</span>,  <span class="co"># working with dates</span>
  <span class="va">epikit</span>,     <span class="co"># age_categories() function</span>
  <span class="va">tidyverse</span>   <span class="co"># data management and visualization</span>
<span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
<div id="import-data-1" class="section level2" number="8.3">
<h2>
<span class="header-section-number">8.3</span> Importar datos<a class="anchor" aria-label="anchor" href="#import-data-1"><i class="fas fa-link"></i></a>
</h2>
<div id="importar" class="section level3 unnumbered">
<h3>Importar<a class="anchor" aria-label="anchor" href="#importar"><i class="fas fa-link"></i></a>
</h3>
<p>Aquí importamos el archivo Excel de la lista de casos “en bruto” utilizando la función <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> del paquete <strong>rio</strong>. El paquete <strong>rio</strong> maneja con flexibilidad muchos tipos de archivos (por ejemplo, .xlsx, .csv, .tsv, .rds. Consulta la página sobre <a href="import-and-export.html#import-and-export">importación y exportación</a> para obtener más información y consejos sobre situaciones inusuales (por ejemplo, omitir filas, establecer valores que faltan, importar hojas de Google, etc).</p>
<p>Para continuar, <a href="https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/case_linelists/linelist_raw.xlsx">cliquea para descargar linelist “en crudo”</a> (como archivo .xlsx).</p>
<p>Si tu conjunto de datos es grande y tarda mucho en importarse, puede ser útil que el comando de importación esté separado de la cadena de tuberías y que el “crudo” se guarde como un archivo distinto. Esto también permite comparar fácilmente las versiones original y limpia.</p>
<p>A continuación, importamos el archivo de Excel sin procesar y lo guardamos como el dataframe <code>linelist_raw</code>. Suponemos que el archivo se encuentra en tu directorio de trabajo o en la raíz del proyecto R, por lo que no se especifican subcarpetas en la ruta del archivo.</p>
<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"linelist_raw.xlsx"</span><span class="op">)</span></code></pre></div>
<p>Puedes ver las primeras 50 filas del dataframe a continuación. Nota: la función <strong>base</strong> de R <code><a href="https://rdrr.io/r/utils/head.html">head(n)</a></code> te permite ver sólo las primeras n filas en la consola de R.</p>
<div id="htmlwidget-a2c0d01ab48c0515b00b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a2c0d01ab48c0515b00b">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08T00:00:00Z",null,null,"2014-05-04T00:00:00Z","2014-05-18T00:00:00Z","2014-05-03T00:00:00Z","2014-05-22T00:00:00Z","2014-05-28T00:00:00Z",null,null,"2014-05-30T00:00:00Z","2014-05-28T00:00:00Z","2014-06-14T00:00:00Z","2014-06-07T00:00:00Z","2014-06-09T00:00:00Z",null,null,null,"2014-06-23T00:00:00Z","2014-06-18T00:00:00Z","2014-06-24T00:00:00Z",null,null,"2014-07-03T00:00:00Z",null,"2014-07-10T00:00:00Z","2014-06-14T00:00:00Z",null,"2014-06-18T00:00:00Z","2014-06-29T00:00:00Z","2014-07-02T00:00:00Z","2014-07-12T00:00:00Z","2014-07-12T00:00:00Z","2014-06-13T00:00:00Z","2014-07-15T00:00:00Z","2014-06-20T00:00:00Z",null,null,"2014-07-20T00:00:00Z",null,"2014-07-12T00:00:00Z","2014-07-19T00:00:00Z","2014-07-18T00:00:00Z","2014-07-18T00:00:00Z","2014-07-27T00:00:00Z",null,"2014-07-19T00:00:00Z","2014-07-26T00:00:00Z","2014-07-24T00:00:00Z",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15T00:00:00Z","2014-05-14T00:00:00Z","2014-05-18T00:00:00Z","2014-05-20T00:00:00Z","2014-05-22T00:00:00Z","2014-05-23T00:00:00Z","2014-05-29T00:00:00Z","2014-06-03T00:00:00Z","2014-06-06T00:00:00Z","2014-06-07T00:00:00Z","2014-06-08T00:00:00Z","2014-06-15T00:00:00Z","2014-06-17T00:00:00Z","2014-06-17T00:00:00Z","2014-06-20T00:00:00Z","2014-06-19T00:00:00Z","2014-06-23T00:00:00Z","2014-06-24T00:00:00Z","2014-06-27T00:00:00Z","2014-06-28T00:00:00Z","2014-06-29T00:00:00Z","2014-07-03T00:00:00Z","2014-07-09T00:00:00Z","2014-07-09T00:00:00Z","2014-07-11T00:00:00Z","2014-07-11T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-14T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-17T00:00:00Z","2014-07-17T00:00:00Z","2014-07-18T00:00:00Z","2014-07-19T00:00:00Z","2014-07-20T00:00:00Z","2014-07-20T00:00:00Z","2014-07-22T00:00:00Z","2014-07-24T00:00:00Z","2014-07-26T00:00:00Z","2014-07-24T00:00:00Z","2014-07-27T00:00:00Z","2014-07-25T00:00:00Z","2014-07-27T00:00:00Z","2014-07-31T00:00:00Z","2014-08-01T00:00:00Z","2014-08-03T00:00:00Z","2014-08-02T00:00:00Z","2014-08-02T00:00:00Z","2014-08-04T00:00:00Z"],[null,"2014-05-18T00:00:00Z","2014-05-30T00:00:00Z",null,"2014-05-29T00:00:00Z","2014-05-24T00:00:00Z","2014-06-01T00:00:00Z","2014-06-07T00:00:00Z","2014-06-18T00:00:00Z","2014-06-09T00:00:00Z","2014-06-15T00:00:00Z",null,"2014-07-09T00:00:00Z",null,"2014-06-30T00:00:00Z","2014-07-11T00:00:00Z","2014-07-01T00:00:00Z","2014-06-25T00:00:00Z","2014-07-06T00:00:00Z","2014-07-02T00:00:00Z","2014-07-09T00:00:00Z","2014-07-07T00:00:00Z","2014-07-20T00:00:00Z",null,"2014-07-22T00:00:00Z","2014-07-16T00:00:00Z","2014-07-14T00:00:00Z","2014-07-20T00:00:00Z","2014-07-16T00:00:00Z","2014-07-19T00:00:00Z","2014-07-27T00:00:00Z","2014-07-19T00:00:00Z",null,"2014-07-26T00:00:00Z","2014-08-14T00:00:00Z","2014-08-01T00:00:00Z","2014-07-23T00:00:00Z","2014-08-28T00:00:00Z","2014-07-28T00:00:00Z","2014-07-19T00:00:00Z",null,"2014-08-03T00:00:00Z",null,null,null,"2014-08-06T00:00:00Z","2014-08-21T00:00:00Z","2014-09-13T00:00:00Z","2014-08-04T00:00:00Z",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],["Other",null,"St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital",null,null,null,null,"Port Hospital","Military Hospital",null,null,"Other","Port Hospital","Port Hospital","Port Hospital",null,"Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)",null,"Other",null,"St. Marks Maternity Hopital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital",null,"Military Hospital","Other",null,null,"Port Hospital","Port Hospital","Port Hospital",null,"Central Hospital","Military Hospital","Other","Other","Other",null,"St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)",null],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],["2","3","56","18","3","16","16","0","61","27","12","42","19","7","7","13","35","17","11","11","19","54","14","28","6","3","31","6","67","14","10","21","20","45","1","12","3","15","20","36","7","13","14","3","10","1","0","20","26","14"],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],["a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a"],["b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>infection date<\/th>\n      <th>date onset<\/th>\n      <th>hosp date<\/th>\n      <th>date_of_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>row_num<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>merged_header<\/th>\n      <th>...28<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,9,10,15,16,17,18,24]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="revisar" class="section level3 unnumbered">
<h3>Revisar<a class="anchor" aria-label="anchor" href="#revisar"><i class="fas fa-link"></i></a>
</h3>
<p>Puedes utilizar la función <code>skim()</code> del paquete <strong>skimr</strong> para obtener una visión general de todo el dataframe (véase la página sobre <a href="descriptive-tables.html#descriptive-tables">tablas descriptivas</a> para más información). Las columnas se resumen por clase o tipo, como, por ejemplo, carácter, numérico. Nota: “POSIXct” es un tipo de fecha cruda (ver <a href="working-with-dates.html#working-with-dates-1">Trabajar con fechas</a>.</p>
<div class="sourceCode" id="cb181"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">skimr</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/skimr/reference/skim.html">skim</a></span><span class="op">(</span><span class="va">linelist_raw</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:unnamed-chunk-155">Table 8.1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">linelist_raw</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">6611</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">28</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">17</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">8</td>
</tr>
<tr class="even">
<td align="left">POSIXct</td>
<td align="left">3</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table></div>
<p><strong>Variable type: character</strong></p>
<div class="inline-table"><table style="width:100%;" class="table table-sm">
<colgroup>
<col width="20%">
<col width="13%">
<col width="19%">
<col width="5%">
<col width="5%">
<col width="8%">
<col width="12%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">case_id</td>
<td align="right">137</td>
<td align="right">0.98</td>
<td align="right">6</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">5888</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">date onset</td>
<td align="right">293</td>
<td align="right">0.96</td>
<td align="right">10</td>
<td align="right">10</td>
<td align="right">0</td>
<td align="right">580</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">outcome</td>
<td align="right">1500</td>
<td align="right">0.77</td>
<td align="right">5</td>
<td align="right">7</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">gender</td>
<td align="right">324</td>
<td align="right">0.95</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">hospital</td>
<td align="right">1512</td>
<td align="right">0.77</td>
<td align="right">5</td>
<td align="right">36</td>
<td align="right">0</td>
<td align="right">13</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">infector</td>
<td align="right">2323</td>
<td align="right">0.65</td>
<td align="right">6</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">2697</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">source</td>
<td align="right">2323</td>
<td align="right">0.65</td>
<td align="right">5</td>
<td align="right">7</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">107</td>
<td align="right">0.98</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">75</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">age_unit</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">5</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">fever</td>
<td align="right">258</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">chills</td>
<td align="right">258</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">cough</td>
<td align="right">258</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">aches</td>
<td align="right">258</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">vomit</td>
<td align="right">258</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">time_admission</td>
<td align="right">844</td>
<td align="right">0.87</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="right">0</td>
<td align="right">1091</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">merged_header</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">…28</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table></div>
<p><strong>Variable type: numeric</strong></p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="15%">
<col width="10%">
<col width="15%">
<col width="8%">
<col width="8%">
<col width="7%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">generation</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">16.60</td>
<td align="right">5.71</td>
<td align="right">0.00</td>
<td align="right">13.00</td>
<td align="right">16.00</td>
<td align="right">20.00</td>
<td align="right">37.00</td>
</tr>
<tr class="even">
<td align="left">lon</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">-13.23</td>
<td align="right">0.02</td>
<td align="right">-13.27</td>
<td align="right">-13.25</td>
<td align="right">-13.23</td>
<td align="right">-13.22</td>
<td align="right">-13.21</td>
</tr>
<tr class="odd">
<td align="left">lat</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">8.47</td>
<td align="right">0.01</td>
<td align="right">8.45</td>
<td align="right">8.46</td>
<td align="right">8.47</td>
<td align="right">8.48</td>
<td align="right">8.49</td>
</tr>
<tr class="even">
<td align="left">row_num</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">3240.91</td>
<td align="right">1857.83</td>
<td align="right">1.00</td>
<td align="right">1647.50</td>
<td align="right">3241.00</td>
<td align="right">4836.50</td>
<td align="right">6481.00</td>
</tr>
<tr class="odd">
<td align="left">wt_kg</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">52.69</td>
<td align="right">18.59</td>
<td align="right">-11.00</td>
<td align="right">41.00</td>
<td align="right">54.00</td>
<td align="right">66.00</td>
<td align="right">111.00</td>
</tr>
<tr class="even">
<td align="left">ht_cm</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">125.25</td>
<td align="right">49.57</td>
<td align="right">4.00</td>
<td align="right">91.00</td>
<td align="right">130.00</td>
<td align="right">159.00</td>
<td align="right">295.00</td>
</tr>
<tr class="odd">
<td align="left">ct_blood</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">21.26</td>
<td align="right">1.67</td>
<td align="right">16.00</td>
<td align="right">20.00</td>
<td align="right">22.00</td>
<td align="right">22.00</td>
<td align="right">26.00</td>
</tr>
<tr class="even">
<td align="left">temp</td>
<td align="right">158</td>
<td align="right">0.98</td>
<td align="right">38.60</td>
<td align="right">0.95</td>
<td align="right">35.20</td>
<td align="right">38.30</td>
<td align="right">38.80</td>
<td align="right">39.20</td>
<td align="right">40.80</td>
</tr>
</tbody>
</table></div>
<p><strong>Variable type: POSIXct</strong></p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="19%">
<col width="12%">
<col width="17%">
<col width="13%">
<col width="13%">
<col width="13%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">min</th>
<th align="left">max</th>
<th align="left">median</th>
<th align="right">n_unique</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">infection date</td>
<td align="right">2322</td>
<td align="right">0.65</td>
<td align="left">2012-04-09</td>
<td align="left">2015-04-27</td>
<td align="left">2014-10-04</td>
<td align="right">538</td>
</tr>
<tr class="even">
<td align="left">hosp date</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="left">2012-04-20</td>
<td align="left">2015-04-30</td>
<td align="left">2014-10-15</td>
<td align="right">570</td>
</tr>
<tr class="odd">
<td align="left">date_of_outcome</td>
<td align="right">1068</td>
<td align="right">0.84</td>
<td align="left">2012-05-14</td>
<td align="left">2015-06-04</td>
<td align="left">2014-10-26</td>
<td align="right">575</td>
</tr>
</tbody>
</table></div>
<!-- ======================================================= --><!-- ======================================================= --><!-- ======================================================= -->
</div>
</div>
<div id="column-names" class="section level2" number="8.4">
<h2>
<span class="header-section-number">8.4</span> Nombres de columnas<a class="anchor" aria-label="anchor" href="#column-names"><i class="fas fa-link"></i></a>
</h2>
<p>En R, los <em>nombres</em> de las columnas son la “cabecera” o el valor “superior” de una columna. Se utilizan para referirse a las columnas en el código, y sirven como etiqueta por defecto en las figuras.</p>
<p>Otros programas estadísticos, como SAS y STATA, utilizan <em>“etiquetas”</em> que coexisten como versiones impresas más largas de los nombres de columna más cortos. Aunque R ofrece la posibilidad de añadir etiquetas de columna a los datos, no es una práctica que sea muy utilizada. Para hacer que los nombres de las columnas sean “fáciles de imprimir” para las figuras, normalmente se ajusta su visualización dentro de los comandos de gráficas que crean las salidas (por ejemplo, los títulos de los ejes o de las leyendas de una gráfica, o las cabeceras de las columnas en una tabla impresa - véase la <a href="ggplot-tips.html#ggplot_tips_scales">sección de escalas de la página de consejos de ggplot</a> y las páginas de <a href="tables-for-presentation.html#tables-for-presentation">Tablas para la presentación</a>). Si deseas asignar etiquetas de columna en los datos, lee más online <a href="https://cran.r-project.org/web/packages/expss/vignettes/labels-support.html">aquí</a> y <a href="https://cran.r-project.org/web/packages/labelled/vignettes/intro_labelled.html">aquí</a>.</p>
<p>Como los nombres de las columnas de R se utilizan con mucha frecuencia, deben tener una sintaxis “limpia”. Sugerimos lo siguiente:</p>
<ul>
<li>Nombres cortos</li>
<li>Sin espacios (sustituir por barras bajas _ )</li>
<li>Sin caracteres inusuales (&amp;, #, &lt;, &gt;, …)</li>
<li>Nomenclatura de estilo similar (por ejemplo, todas las columnas de fecha nombradas como <strong>date</strong>_onset, <strong>date</strong>_report, <strong>date</strong>_death…)</li>
</ul>
<p>Los nombres de las columnas de <code>linelist_raw</code> se muestran a continuación utilizando <code><a href="https://rdrr.io/r/base/names.html">names()</a></code> de R <strong>base</strong>. Podemos ver que inicialmente</p>
<ul>
<li><p>Algunos nombres contienen espacios (por ejemplo, <code>infection date</code>)</p></li>
<li><p>Se utilizan diferentes patrones de nomenclatura para las fechas (<code>date onset</code> vs. <code>infection date</code>)</p></li>
<li><p>Debe haber habido una <em>cabecera fusionada</em> en las dos últimas columnas del .xlsx. Lo sabemos porque el nombre de dos columnas fusionadas (“merged_header”) fue asignado por R a la primera columna, y a la segunda columna se le asignó un nombre de marcador de posición “…28” (ya que entonces estaba vacía y es la columna 28).</p></li>
</ul>
<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">linelist_raw</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "case_id"         "generation"      "infection date" 
##  [4] "date onset"      "hosp date"       "date_of_outcome"
##  [7] "outcome"         "gender"          "hospital"       
## [10] "lon"             "lat"             "infector"       
## [13] "source"          "age"             "age_unit"       
## [16] "row_num"         "wt_kg"           "ht_cm"          
## [19] "ct_blood"        "fever"           "chills"         
## [22] "cough"           "aches"           "vomit"          
## [25] "temp"            "time_admission"  "merged_header"  
## [28] "...28"</code></pre>
<p><span style="color: black;"><strong><em>NOTA:</em></strong> Para hacer referencia a un nombre de columna que incluya espacios, rodea el nombre con tildes, por ejemplo: linelist$<code>` '\x60infection date\x60'`</code>. Ten en cuenta que, en tu teclado, la tilde (`) es diferente de la comilla simple (’). </span></p>
<div id="limpieza-automática" class="section level3 unnumbered">
<h3>Limpieza automática<a class="anchor" aria-label="anchor" href="#limpieza-autom%C3%A1tica"><i class="fas fa-link"></i></a>
</h3>
<p>La función <code>clean_names()</code> del paquete <strong>janitor</strong> estandariza los nombres de las columnas y los hace únicos haciendo lo siguiente:</p>
<ul>
<li><p>Convierte todos los nombres para que estén compuestos sólo por barras bajas, números y letras</p></li>
<li><p>Los caracteres acentuados se transliteran a ASCII (por ejemplo, la o alemana con diéresis se convierte en “o”, la “ñ” española se convierte en “n”)</p></li>
<li><p>Se puede especificar la preferencia de mayúsculas para los nuevos nombres de columna utilizando <code>case =</code> argumento (“snake” es el valor por defecto, las alternativas incluyen “sentence”, “title”, “small_camel”…)</p></li>
<li><p>Puedes especificar sustituciones de nombres concretos proporcionando un vector <code>replace =</code> argumento (por ejemplo, <code>replace = c(onset = "date_of_onset")</code>)</p></li>
<li><p>Aquí puedes encontrar una <a href="https://cran.r-project.org/web/packages/janitor/vignettes/janitor.html#cleaning">viñeta</a> en línea sobre dicho paquete.</p></li>
</ul>
<p>A continuación, el proceso de limpieza comienza utilizando <code>clean_names()</code> sobre linelist_raw.</p>
<div class="sourceCode" id="cb184"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># pipe the raw dataset through the function clean_names(), assign result as "linelist"  </span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op">%&gt;%</span> 
  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># see the new column names</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "case_id"         "generation"      "infection_date" 
##  [4] "date_onset"      "hosp_date"       "date_of_outcome"
##  [7] "outcome"         "gender"          "hospital"       
## [10] "lon"             "lat"             "infector"       
## [13] "source"          "age"             "age_unit"       
## [16] "row_num"         "wt_kg"           "ht_cm"          
## [19] "ct_blood"        "fever"           "chills"         
## [22] "cough"           "aches"           "vomit"          
## [25] "temp"            "time_admission"  "merged_header"  
## [28] "x28"</code></pre>
<p><span style="color: black;"><strong><em>NOTA:</em></strong> El nombre de la última columna “…28” se ha cambiado por “x28”. </span></p>
</div>
<div id="limpieza-manual-de-nombres" class="section level3 unnumbered">
<h3>Limpieza manual de nombres<a class="anchor" aria-label="anchor" href="#limpieza-manual-de-nombres"><i class="fas fa-link"></i></a>
</h3>
<p>A menudo es necesario renombrar las columnas manualmente, incluso después del paso de estandarización anterior. A continuación, el renombramiento se realiza utilizando la función <code>rename()</code> del paquete <strong>dplyr</strong>, como parte de una cadena de tuberías. <code>rename()</code> utiliza el estilo <code>NUEVO = ANTIGUO</code> - el nombre nuevo de la columna se escribe antes que el antiguo.</p>
<p>A continuación, se añade un comando de renombramiento a la tubería de limpieza. Se han añadido espacios estratégicamente para alinear el código y facilitar la lectura.</p>
<div class="sourceCode" id="cb186"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># CLEANING 'PIPE' CHAIN (starts with raw data and pipes it through cleaning steps)</span>
<span class="co">##################################################################################</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op">%&gt;%</span>
    
    <span class="co"># standardize column name syntax</span>
    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># manually re-name columns</span>
           <span class="co"># NEW name             # OLD name</span>
    <span class="fu">rename</span><span class="op">(</span>date_infection       <span class="op">=</span> <span class="va">infection_date</span>,
           date_hospitalisation <span class="op">=</span> <span class="va">hosp_date</span>,
           date_outcome         <span class="op">=</span> <span class="va">date_of_outcome</span><span class="op">)</span></code></pre></div>
<p>Ahora puedes ver que los nombres de las columnas han cambiado:</p>
<pre><code>##  [1] "case_id"              "generation"          
##  [3] "date_infection"       "date_onset"          
##  [5] "date_hospitalisation" "date_outcome"        
##  [7] "outcome"              "gender"              
##  [9] "hospital"             "lon"                 
## [11] "lat"                  "infector"            
## [13] "source"               "age"                 
## [15] "age_unit"             "row_num"             
## [17] "wt_kg"                "ht_cm"               
## [19] "ct_blood"             "fever"               
## [21] "chills"               "cough"               
## [23] "aches"                "vomit"               
## [25] "temp"                 "time_admission"      
## [27] "merged_header"        "x28"</code></pre>
<div id="renombrar-por-posición-de-columna" class="section level4 unnumbered">
<h4>Renombrar por posición de columna<a class="anchor" aria-label="anchor" href="#renombrar-por-posici%C3%B3n-de-columna"><i class="fas fa-link"></i></a>
</h4>
<p>También puedes renombrar por la posición de la columna, en lugar del nombre de la columna, por ejemplo:</p>
<div class="sourceCode" id="cb188"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rename</span><span class="op">(</span>newNameForFirstColumn  <span class="op">=</span> <span class="fl">1</span>,
       newNameForSecondColumn <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
</div>
<div id="renombrar-mediante-select-y-summarise" class="section level4 unnumbered">
<h4>Renombrar mediante <code>select()</code> y <code>summarise()</code><a class="anchor" aria-label="anchor" href="#renombrar-mediante-select-y-summarise"><i class="fas fa-link"></i></a>
</h4>
<p>Como método abreviado, también puedes cambiar el nombre de las columnas dentro de las funciones de <strong>dplyr</strong> <code>select()</code> y <code>summarise()</code>. <code>select()</code> se utiliza para mantener sólo ciertas columnas (y se muestra más adelante en esta página). <code>summarise()</code> se muestra en las páginas <a href="grouping-data.html#grouping-data">Agrupar datos</a> y <a href="descriptive-tables.html#descriptive-tables">Tablas descriptivas</a>. Estas funciones también utilizan el formato <code>nombre_nuevo = nombre_antiguo</code>. He aquí un ejemplo:</p>
<div class="sourceCode" id="cb189"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_raw</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="co"># NEW name             # OLD name</span>
         date_infection       <span class="op">=</span> <span class="va">`infection date`</span>,    <span class="co"># rename and KEEP ONLY these columns</span>
         date_hospitalisation <span class="op">=</span> <span class="va">`hosp date`</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="otros-retos" class="section level3 unnumbered">
<h3>Otros retos<a class="anchor" aria-label="anchor" href="#otros-retos"><i class="fas fa-link"></i></a>
</h3>
<div id="nombres-de-columnas-de-excel-vacíos" class="section level4 unnumbered">
<h4>Nombres de columnas de Excel vacíos<a class="anchor" aria-label="anchor" href="#nombres-de-columnas-de-excel-vac%C3%ADos"><i class="fas fa-link"></i></a>
</h4>
<p>R no puede tener columnas de conjuntos de datos que no tengan nombres de columnas (cabeceras). Así, si importa unos datos de Excel con datos pero sin cabeceras de columna, R rellenará las cabeceras con nombres como “…1” o “…2”. El nombre asignado representa el número de la columna (por ejemplo, si la cuarta columna de los datos no tiene cabecera, R la nombrará “…4”).</p>
<p>Puedes limpiar estos nombres manualmente haciendo referencia a su número de posición (véase el ejemplo anterior), o a su nombre asignado (<code>linelist_raw$...1</code>).</p>
</div>
<div id="nombres-de-columnas-y-celdas-fusionadas-de-excel" class="section level4 unnumbered">
<h4>Nombres de columnas y celdas fusionadas de Excel<a class="anchor" aria-label="anchor" href="#nombres-de-columnas-y-celdas-fusionadas-de-excel"><i class="fas fa-link"></i></a>
</h4>
<p>Las celdas combinadas en un archivo de Excel son una ocurrencia común cuando se reciben datos. Como se explica en <a href="transition-to-r.html#transition-to-r">Transición a R</a>, las celdas combinadas pueden ser agradables para la lectura humana de los datos, pero no son “datos ordenados” y causan muchos problemas para la lectura de los datos por parte de las máquinas. R no puede ajustar las celdas combinadas.</p>
<p>Recuerda a las personas que introducen los datos que <strong>los datos legibles para el ser humano no son lo mismo que los datos legibles para la máquina</strong>. Esfuérzate en formar a los usuarios sobre los principios de los <a href="https://es.r4ds.hadley.nz/datos-ordenados.html"><strong>datos ordenados</strong></a>. Si es posible, intenta cambiar los procedimientos para que los datos lleguen en un formato ordenado y sin celdas fusionadas.</p>
<ul>
<li>Cada variable debe tener su propia columna.</li>
<li>Cada observación debe tener su propia fila.</li>
<li>Cada valor debe tener su propia celda.</li>
</ul>
<p>Al utilizar la función <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code> de <strong>rio</strong>, el valor de una celda combinada se asignará a la primera celda y las siguientes estarán vacías.</p>
<p>Una solución para tratar las celdas combinadas es importar los datos con la función <code>readWorkbook()</code> del paquete <strong>openxlsx</strong>. Establece el argumento <code>fillMergedCells = TRUE</code>. Esto da el valor en una celda fusionada a todas las celdas dentro del rango de fusión.</p>
<div class="sourceCode" id="cb190"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist_raw</span> <span class="op">&lt;-</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/readWorkbook.html">readWorkbook</a></span><span class="op">(</span><span class="st">"linelist_raw.xlsx"</span>, fillMergedCells <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><span style="color: red;"><strong><em>PELIGRO:</em></strong> Si los nombres de las columnas se fusionan con <code>readWorkbook()</code>, terminarás con nombres de columnas duplicados, que tendrás que arreglar manualmente - ¡R no funciona bien con nombres de columnas duplicados! Puedes renombrarlas haciendo referencia a su posición (por ejemplo, la columna 5), como se explica en la sección de limpieza manual de nombres de columnas. </span></p>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="select-or-re-order-columns" class="section level2" number="8.5">
<h2>
<span class="header-section-number">8.5</span> Seleccionar o reordenar columnas<a class="anchor" aria-label="anchor" href="#select-or-re-order-columns"><i class="fas fa-link"></i></a>
</h2>
<p>Utiliza <code>select()</code> de <strong>dplyr</strong> para seleccionar las columnas que deseas conservar y para especificar su orden en el dataframe.</p>
<p><span style="color: orange;"><strong><em>ATENCIÓN:</em></strong> En los ejemplos siguientes, el dataframe <code>linelist</code> se modifica con <code>select()</code> y se muestra, pero no se guarda. Esto es a efectos de demostración. Los nombres de las columnas modificadas se imprimen pasando el dataframe a <code><a href="https://rdrr.io/r/base/names.html">names()</a></code>.</span></p>
<p><strong>Aquí están TODOS los nombres de las columnas en linelist en este punto de la cadena de limpieza:</strong></p>
<div class="sourceCode" id="cb191"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "case_id"              "generation"          
##  [3] "date_infection"       "date_onset"          
##  [5] "date_hospitalisation" "date_outcome"        
##  [7] "outcome"              "gender"              
##  [9] "hospital"             "lon"                 
## [11] "lat"                  "infector"            
## [13] "source"               "age"                 
## [15] "age_unit"             "row_num"             
## [17] "wt_kg"                "ht_cm"               
## [19] "ct_blood"             "fever"               
## [21] "chills"               "cough"               
## [23] "aches"                "vomit"               
## [25] "temp"                 "time_admission"      
## [27] "merged_header"        "x28"</code></pre>
<div id="mantener-las-columnas" class="section level3 unnumbered">
<h3>Mantener las columnas<a class="anchor" aria-label="anchor" href="#mantener-las-columnas"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Selecciona sólo las columnas que desees conservar</strong></p>
<p>Escribe sus nombres en el comando <code>select()</code>, sin comillas. Aparecerán en el dataframe en el orden que indiques. Ten en cuenta que si incluyes una columna que no existe, R devolverá un error (véase el uso de <code>any_of()</code> más adelante para evitar un error de este tipo).</p>
<div class="sourceCode" id="cb193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># linelist dataset is piped through select() command, and names() prints just the column names</span>
<span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">case_id</span>, <span class="va">date_onset</span>, <span class="va">date_hospitalisation</span>, <span class="va">fever</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># display the column names</span></code></pre></div>
<pre><code>## [1] "case_id"              "date_onset"          
## [3] "date_hospitalisation" "fever"</code></pre>
</div>
<div id="clean_tidyselect" class="section level3 unnumbered">
<h3>Funciones de ayuda “tidyselect”<a class="anchor" aria-label="anchor" href="#clean_tidyselect"><i class="fas fa-link"></i></a>
</h3>
<p>Estas funciones de ayuda existen para facilitar la especificación de las columnas a conservar, descartar o transformar. Provienen del paquete <strong>tidyselect</strong>, que se incluye en <strong>tidyverse</strong> y se basa en la forma en que se seleccionan las columnas en las funciones de <strong>dplyr</strong>.</p>
<p>Por ejemplo, si deseas reordenar las columnas, <code>everything()</code> es una función útil para indicar “todas las demás columnas no mencionadas”. El comando siguiente mueve las columnas <code>date_onset</code> y <code>date_hospitalisation</code> al principio (izquierda) de los datos, pero mantiene todas las demás columnas después. Fíjate en que <code>everything()</code> se escribe con paréntesis vacíos:</p>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># move date_onset and date_hospitalisation to beginning</span>
<span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">date_onset</span>, <span class="va">date_hospitalisation</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "date_onset"           "date_hospitalisation"
##  [3] "case_id"              "generation"          
##  [5] "date_infection"       "date_outcome"        
##  [7] "outcome"              "gender"              
##  [9] "hospital"             "lon"                 
## [11] "lat"                  "infector"            
## [13] "source"               "age"                 
## [15] "age_unit"             "row_num"             
## [17] "wt_kg"                "ht_cm"               
## [19] "ct_blood"             "fever"               
## [21] "chills"               "cough"               
## [23] "aches"                "vomit"               
## [25] "temp"                 "time_admission"      
## [27] "merged_header"        "x28"</code></pre>
<p>Aquí hay otras funciones de ayuda “tidyselect” que también funcionan <em>dentro de</em> las funciones de <strong>dplyr</strong> como <code>select()</code>, <code>across()</code> y <code>summarise()</code>:</p>
<ul>
<li>
<code>everything()</code> - todas las demás columnas no mencionadas</li>
<li>
<code>last_col()</code> - la última columna</li>
<li>
<code>where()</code> - aplica una función a todas las columnas y selecciona las que son TRUE</li>
<li>
<code>contains()</code> - columnas que contienen una cadena de caracteres
<ul>
<li>ejemplo: <code>select(contains("time"))</code>
</li>
</ul>
</li>
<li>
<code>starts_with()</code> - coincide con un prefijo especificado
<ul>
<li>ejemplo: <code>select(starts_with("date_"))</code>
</li>
</ul>
</li>
<li>
<code>ends_with()</code> - coincide con un sufijo especificado
<ul>
<li>ejemplo: <code>select(ends_with("_post))</code>
</li>
</ul>
</li>
<li>
<code>matches()</code> - para aplicar una expresión regular (regex)
<ul>
<li>ejemplo: <code>select(matches("[pt]al"))</code>
</li>
</ul>
</li>
<li>
<code>num_range()</code> - un rango numérico como x01, x02, x03</li>
<li>
<code>any_of()</code> - coincide con la columna SI existe pero no devuelve ningún error si no se encuentra
<ul>
<li>ejemplo: <code>select(any_of(date_onset, date_death,     cardiac_arrest))</code>
</li>
</ul>
</li>
</ul>
<p>Además, utiliza operadores normales como <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> para listar varias columnas, <code><a href="https://rdrr.io/r/base/Colon.html">:</a></code> para columnas consecutivas, <code><a href="https://rdrr.io/r/base/Logic.html">!</a></code> para opuestas, <code><a href="https://rdrr.io/r/base/Logic.html">&amp;</a></code> para “Y” y <code><a href="https://rdrr.io/r/base/Logic.html">|</a></code> para “O”.</p>
<p>Utiliza <code>where()</code> para especificar criterios lógicos para las columnas. Si escribes una función dentro de <code>where()</code>, no incluyas los paréntesis vacíos de la función. El comando siguiente selecciona las columnas de tipo Numeric.</p>
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># select columns that are class Numeric</span>
<span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "generation" "lon"        "lat"        "row_num"   
## [5] "wt_kg"      "ht_cm"      "ct_blood"   "temp"</code></pre>
<p>Utiliza <code>contains()</code> para seleccionar sólo las columnas en las que el nombre de la columna contiene una cadena de caracteres especificada. <code>ends_with()</code> y <code>starts_with()</code> proporcionan más matices.</p>
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># select columns containing certain characters</span>
<span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="fu">contains</span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "date_infection"       "date_onset"          
## [3] "date_hospitalisation" "date_outcome"</code></pre>
<p>La función <code>matches()</code> funciona de forma similar a <code>contains()</code>, pero puede escribirse en una expresión regular (mira la página sobre <a href="characters-and-strings.html#characters-and-strings">Caracteres y cadenas</a>), como varias cadenas separadas por barras “O” dentro de los paréntesis:</p>
<div class="sourceCode" id="cb201"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># searched for multiple character matches</span>
<span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="fu">matches</span><span class="op">(</span><span class="st">"onset|hosp|fev"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co"># note the OR symbol "|"</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "date_onset"           "date_hospitalisation"
## [3] "hospital"             "fever"</code></pre>
<p><span style="color: orange;"><strong><em>ATENCIÓN:</em></strong> Si has escrito un nombre de columna y no existen datos para ella, puede devolver un error y detener tu código. Considera el uso de <code>any_of()</code> para citar columnas que pueden o no existir, especialmente útil en selecciones negativas (eliminar). </span></p>
<p>Sólo existe una de estas columnas, pero no se produce ningún error y el código continúa sin detener su cadena de limpieza.</p>
<div class="sourceCode" id="cb203"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="fu">any_of</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"date_onset"</span>, <span class="st">"village_origin"</span>, <span class="st">"village_detection"</span>, <span class="st">"village_residence"</span>, <span class="st">"village_travel"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "date_onset"</code></pre>
</div>
<div id="eliminar-columnas" class="section level3 unnumbered">
<h3>Eliminar columnas<a class="anchor" aria-label="anchor" href="#eliminar-columnas"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Indica qué columnas se van a eliminar</strong> colocando el símbolo “-” delante del nombre de la columna (por ejemplo, <code>select(-outcome)</code>), o un vector de nombres de columnas (como se indica a continuación). Todas las demás columnas se mantendrán.</p>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">date_onset</span>, <span class="va">fever</span><span class="op">:</span><span class="va">vomit</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># remove date_onset and all columns from fever to vomit</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "case_id"              "generation"          
##  [3] "date_infection"       "date_hospitalisation"
##  [5] "date_outcome"         "outcome"             
##  [7] "gender"               "hospital"            
##  [9] "lon"                  "lat"                 
## [11] "infector"             "source"              
## [13] "age"                  "age_unit"            
## [15] "row_num"              "wt_kg"               
## [17] "ht_cm"                "ct_blood"            
## [19] "temp"                 "time_admission"      
## [21] "merged_header"        "x28"</code></pre>
<p>También puedes eliminar una columna utilizando la sintaxis de R <strong>base</strong>, definiéndola como <code>NULL</code>. Por ejemplo:</p>
<div class="sourceCode" id="cb207"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>   <span class="co"># deletes column with base R syntax </span></code></pre></div>
</div>
<div id="independiente" class="section level3 unnumbered">
<h3>Independiente<a class="anchor" aria-label="anchor" href="#independiente"><i class="fas fa-link"></i></a>
</h3>
<p><code>select()</code> también puede utilizarse como un comando independiente (no en una cadena de tuberías). En este caso, el primer argumento es el dataframe original sobre el que se va a operar.</p>
<div class="sourceCode" id="cb208"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a new linelist with id and age-related columns</span>
<span class="va">linelist_age</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="va">linelist</span>, <span class="va">case_id</span>, <span class="fu">contains</span><span class="op">(</span><span class="st">"age"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># display the column names</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">linelist_age</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "case_id"  "age"      "age_unit"</code></pre>
<div id="añadir-a-la-cadena-de-tuberías" class="section level4 unnumbered">
<h4>Añadir a la cadena de tuberías<a class="anchor" aria-label="anchor" href="#a%C3%B1adir-a-la-cadena-de-tuber%C3%ADas"><i class="fas fa-link"></i></a>
</h4>
<p>En <code>linelist_raw</code>, hay algunas columnas que no necesitamos: <code>row_num</code>, <code>merged_header</code> y <code>x28</code>. Las eliminamos con un comando <code>select()</code> en la cadena de tuberías de limpieza:</p>
<div class="sourceCode" id="cb210"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># CLEANING 'PIPE' CHAIN (starts with raw data and pipes it through cleaning steps)</span>
<span class="co">##################################################################################</span>

<span class="co"># begin cleaning pipe chain</span>
<span class="co">###########################</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op">%&gt;%</span>
    
    <span class="co"># standardize column name syntax</span>
    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># manually re-name columns</span>
           <span class="co"># NEW name             # OLD name</span>
    <span class="fu">rename</span><span class="op">(</span>date_infection       <span class="op">=</span> <span class="va">infection_date</span>,
           date_hospitalisation <span class="op">=</span> <span class="va">hosp_date</span>,
           date_outcome         <span class="op">=</span> <span class="va">date_of_outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># ABOVE ARE UPSTREAM CLEANING STEPS ALREADY DISCUSSED</span>
    <span class="co">#####################################################</span>

    <span class="co"># remove column</span>
    <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">row_num</span>, <span class="va">merged_header</span>, <span class="va">x28</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="deduplication" class="section level2" number="8.6">
<h2>
<span class="header-section-number">8.6</span> De-duplicación<a class="anchor" aria-label="anchor" href="#deduplication"><i class="fas fa-link"></i></a>
</h2>
<p>Consulta la página sobre <a href="de-duplication.html#de-duplication">de-duplicación</a> para ver la cantidad de opciones sobre cómo eliminar las duplicidades (de-duplicar). Aquí sólo se presenta un ejemplo muy sencillo de de-duplicación de filas.</p>
<p>El paquete <strong>dplyr</strong> ofrece la función <code>distinct()</code>. Esta función examina cada fila y reduce el dataframe con sólo filas únicas. Es decir, elimina las filas que están 100% duplicadas.</p>
<p>Al evaluar las filas duplicadas, tiene en cuenta un rango de columnas - por defecto considera todas las columnas. Como se muestra en la página de de-duplicación, puedes ajustar este rango de columnas para que la singularidad de las filas sólo se evalúe con respecto a determinadas columnas.</p>
<p>En este sencillo ejemplo, simplemente añadimos el comando vacío <code>distinct()</code> a la cadena de tuberías. Esto garantiza que no haya filas que estén 100% duplicadas de otras filas (evaluadas en todas las columnas).</p>
<p>Comenzamos con <code><a href="https://rdrr.io/r/base/nrow.html">nrow(linelist)</a></code> filas en <code>linelist</code>.</p>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Después de la de-duplicación hay <code><a href="https://rdrr.io/r/base/nrow.html">nrow(linelist)</a></code> filas. Las filas eliminadas habrían sido 100% duplicados de otras filas.</p>
<p>A continuación, se añade el comando <code>distinct()</code> a la cadena de tuberías de limpieza:</p>
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># CLEANING 'PIPE' CHAIN (starts with raw data and pipes it through cleaning steps)</span>
<span class="co">##################################################################################</span>

<span class="co"># begin cleaning pipe chain</span>
<span class="co">###########################</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op">%&gt;%</span>
    
    <span class="co"># standardize column name syntax</span>
    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># manually re-name columns</span>
           <span class="co"># NEW name             # OLD name</span>
    <span class="fu">rename</span><span class="op">(</span>date_infection       <span class="op">=</span> <span class="va">infection_date</span>,
           date_hospitalisation <span class="op">=</span> <span class="va">hosp_date</span>,
           date_outcome         <span class="op">=</span> <span class="va">date_of_outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># remove column</span>
    <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">row_num</span>, <span class="va">merged_header</span>, <span class="va">x28</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
    <span class="co"># ABOVE ARE UPSTREAM CLEANING STEPS ALREADY DISCUSSED</span>
    <span class="co">#####################################################</span>
    
    <span class="co"># de-duplicate</span>
    <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
<div id="column-creation-and-transformation" class="section level2" number="8.7">
<h2>
<span class="header-section-number">8.7</span> Creación y transformación de columnas<a class="anchor" aria-label="anchor" href="#column-creation-and-transformation"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Recomendamos utilizar la función <code>mutate()</code> de dplyr para añadir una nueva columna, o para modificar una existente.</strong></p>
<p>A continuación se muestra un ejemplo de creación de una nueva columna con <code>mutate()</code>. La sintaxis es: <code>mutate(nombre_nueva_columna = valor o transformación)</code></p>
<p>En Stata, esto es similar al comando <code>generate</code>, pero también se puede utilizar <code>mutate()</code> de R para modificar una columna existente.</p>
<div id="nuevas-columnas" class="section level3 unnumbered">
<h3>Nuevas columnas<a class="anchor" aria-label="anchor" href="#nuevas-columnas"><i class="fas fa-link"></i></a>
</h3>
<p>El comando más básico de <code>mutate()</code> para crear una nueva columna podría tener este aspecto. Crea una nueva columna <code>new_col</code> donde el valor en cada fila es 10.</p>
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>new_col <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<p>También puedes referenciar valores en otras columnas, para realizar cálculos. A continuación, se crea una nueva columna <code>bmi</code> para mantener el Índice de Masa Corporal (BMI) de cada caso - calculado mediante la fórmula <code>BMI = kg/m^2</code>, utilizando la columnas <code>ht_cm</code> y <code>wt_kg</code>.</p>
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>bmi <span class="op">=</span> <span class="va">wt_kg</span> <span class="op">/</span> <span class="op">(</span><span class="va">ht_cm</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>Si creas varias columnas nuevas, separa cada una con una coma y una nueva línea. A continuación se muestran ejemplos de nuevas columnas, incluidas las que consisten en valores de otras columnas combinadas mediante <code>str_glue()</code> del paquete <strong>stringr</strong> (véase la página sobre <a href="characters-and-strings.html#characters-and-strings">Caracteres y cadenas</a>.</p>
<div class="sourceCode" id="cb215"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_col_demo</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>                       
  <span class="fu">mutate</span><span class="op">(</span>
    new_var_dup    <span class="op">=</span> <span class="va">case_id</span>,             <span class="co"># new column = duplicate/copy another existing column</span>
    new_var_static <span class="op">=</span> <span class="fl">7</span>,                   <span class="co"># new column = all values the same</span>
    new_var_static <span class="op">=</span> <span class="va">new_var_static</span> <span class="op">+</span> <span class="fl">5</span>,  <span class="co"># you can overwrite a column, and it can be a calculation using other variables</span>
    new_var_paste  <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html">str_glue</a></span><span class="op">(</span><span class="st">"{hospital} on ({date_hospitalisation})"</span><span class="op">)</span> <span class="co"># new column = pasting together values from other columns</span>
    <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">case_id</span>, <span class="va">hospital</span>, <span class="va">date_hospitalisation</span>, <span class="fu">contains</span><span class="op">(</span><span class="st">"new"</span><span class="op">)</span><span class="op">)</span>        <span class="co"># show only new columns, for demonstration purposes</span></code></pre></div>
<p>Revisa las columnas nuevas. A efectos de demostración, sólo se muestran las columnas nuevas y las utilizadas para crearlas:</p>
<div id="htmlwidget-cf1aebaa703f3f833c76" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-cf1aebaa703f3f833c76">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],["Other",null,"St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital",null,null,null,null,"Port Hospital","Military Hospital",null,null,"Other","Port Hospital","Port Hospital","Port Hospital",null,"Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)",null,"Other",null,"St. Marks Maternity Hopital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital",null,"Military Hospital","Other",null,null,"Port Hospital","Port Hospital","Port Hospital",null,"Central Hospital","Military Hospital","Other","Other","Other",null,"St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)",null],["2014-05-15T00:00:00Z","2014-05-14T00:00:00Z","2014-05-18T00:00:00Z","2014-05-20T00:00:00Z","2014-05-22T00:00:00Z","2014-05-23T00:00:00Z","2014-05-29T00:00:00Z","2014-06-03T00:00:00Z","2014-06-06T00:00:00Z","2014-06-07T00:00:00Z","2014-06-08T00:00:00Z","2014-06-15T00:00:00Z","2014-06-17T00:00:00Z","2014-06-17T00:00:00Z","2014-06-20T00:00:00Z","2014-06-19T00:00:00Z","2014-06-23T00:00:00Z","2014-06-24T00:00:00Z","2014-06-27T00:00:00Z","2014-06-28T00:00:00Z","2014-06-29T00:00:00Z","2014-07-03T00:00:00Z","2014-07-09T00:00:00Z","2014-07-09T00:00:00Z","2014-07-11T00:00:00Z","2014-07-11T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-14T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-17T00:00:00Z","2014-07-17T00:00:00Z","2014-07-18T00:00:00Z","2014-07-19T00:00:00Z","2014-07-20T00:00:00Z","2014-07-20T00:00:00Z","2014-07-22T00:00:00Z","2014-07-24T00:00:00Z","2014-07-26T00:00:00Z","2014-07-24T00:00:00Z","2014-07-27T00:00:00Z","2014-07-25T00:00:00Z","2014-07-27T00:00:00Z","2014-07-31T00:00:00Z","2014-08-01T00:00:00Z","2014-08-03T00:00:00Z","2014-08-02T00:00:00Z","2014-08-02T00:00:00Z","2014-08-04T00:00:00Z"],["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12],["Other on (2014-05-15)","NA on (2014-05-14)","St. Mark's Maternity Hospital (SMMH) on (2014-05-18)","Port Hospital on (2014-05-20)","Military Hospital on (2014-05-22)","Port Hospital on (2014-05-23)","NA on (2014-05-29)","NA on (2014-06-03)","NA on (2014-06-06)","NA on (2014-06-07)","Port Hospital on (2014-06-08)","Military Hospital on (2014-06-15)","NA on (2014-06-17)","NA on (2014-06-17)","Other on (2014-06-20)","Port Hospital on (2014-06-19)","Port Hospital on (2014-06-23)","Port Hospital on (2014-06-24)","NA on (2014-06-27)","Other on (2014-06-28)","Port Hospital on (2014-06-29)","Port Hospital on (2014-07-03)","St. Mark's Maternity Hospital (SMMH) on (2014-07-09)","NA on (2014-07-09)","Other on (2014-07-11)","NA on (2014-07-11)","St. Marks Maternity Hopital (SMMH) on (2014-07-13)","Military Hospital on (2014-07-14)","Port Hospital on (2014-07-14)","Central Hospital on (2014-07-13)","Military Hospital on (2014-07-14)","Central Hospital on (2014-07-17)","NA on (2014-07-17)","Military Hospital on (2014-07-18)","Other on (2014-07-19)","NA on (2014-07-20)","NA on (2014-07-20)","Port Hospital on (2014-07-22)","Port Hospital on (2014-07-24)","Port Hospital on (2014-07-26)","NA on (2014-07-24)","Central Hospital on (2014-07-27)","Military Hospital on (2014-07-25)","Other on (2014-07-27)","Other on (2014-07-31)","Other on (2014-08-01)","NA on (2014-08-03)","St. Mark's Maternity Hospital (SMMH) on (2014-08-02)","St. Mark's Maternity Hospital (SMMH) on (2014-08-02)","NA on (2014-08-04)"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>hospital<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>new_var_dup<\/th>\n      <th>new_var_static<\/th>\n      <th>new_var_paste<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p><span style="color: darkgreen;"><strong><em>CONSEJO:</em></strong> Una variación de <code>mutate()</code> es la función <code>transmute()</code>. Esta función añade una nueva columna al igual que <code>mutate()</code>, pero también elimina todas las demás columnas que no se mencionan dentro de sus paréntesis. </span></p>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># HIDDEN FROM READER</span>
<span class="co"># removes new demo columns created above</span>
<span class="co"># linelist &lt;- linelist %&gt;% </span>
<span class="co">#   select(-contains("new_var"))</span></code></pre></div>
</div>
<div id="convertir-el-tipo-de-columna" class="section level3 unnumbered">
<h3>Convertir el tipo de columna<a class="anchor" aria-label="anchor" href="#convertir-el-tipo-de-columna"><i class="fas fa-link"></i></a>
</h3>
<p>Las columnas que contienen valores que son fechas, números o valores lógicos (TRUE/FALSE) sólo se comportarán como se espera si están correctamente clasificadas. Hay una diferencia entre “2” de tipo carácter y 2 de tipo numérico!</p>
<p>Hay formas de establecer el tipo de la columna durante los comandos de importación, pero esto suele ser engorroso. Consulta la sección sobre los tipos de objeto en <a href="r-basics.html#r-basics">Fundamentos de R</a> para saber más sobre la conversión de los tipos de objetos y columnas.</p>
<p>En primer lugar, vamos a realizar algunas comprobaciones en las columnas importantes para ver si son del tipo correcto. También vimos esto al principio cuando ejecutamos <code>skim()</code>.</p>
<p>Actualmente, el tipo de la columna <code>age</code> es un carácter. Para realizar análisis cuantitativos, ¡necesitamos que estos números sean reconocidos como numéricos!.</p>
<div class="sourceCode" id="cb217"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "character"</code></pre>
<p>El tipo de la columna <code>date_onset</code> ¡también es un carácter! Para realizar los análisis, ¡estas fechas deben ser reconocidas como fechas!</p>
<div class="sourceCode" id="cb219"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "character"</code></pre>
<p>Para resolver esto, utiliza la capacidad de <code>mutate()</code> para redefinir una columna mediante una transformación. Definimos la columna como ella misma, pero convertida a un tipo diferente. He aquí un ejemplo básico, convirtiendo o asegurando que la columna <code>age</code> sea de tipo Numeric:</p>
<div class="sourceCode" id="cb221"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>De forma similar, puedes utilizar <code><a href="https://rdrr.io/r/base/character.html">as.character()</a></code> y <code><a href="https://rdrr.io/r/base/logical.html">as.logical()</a></code>. Para convertir al tipo Factor, puedes utilizar <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code> de R <strong>base</strong> o <code>as_factor()</code> de <strong>forcats</strong>. Lee más sobre esto en la página de <a href="factors.html#factors">Factores</a>.</p>
<p>Hay que tener cuidado al convertir al tipo Fecha. En la página <a href="working-with-dates.html#working-with-dates-1">Trabajar con fechas</a> se explican varios métodos. Normalmente, los valores de fecha en el fichero crudo deben estar todos en el mismo formato para que la conversión funcione correctamente (por ejemplo, “MM/DD/AAAA”, o “DD MM AAAA”). Después de convertir al tipo Fecha, comprueba tus datos para confirmar que cada valor se ha convertido correctamente.</p>
</div>
<div id="datos-agrupados" class="section level3 unnumbered">
<h3>Datos agrupados<a class="anchor" aria-label="anchor" href="#datos-agrupados"><i class="fas fa-link"></i></a>
</h3>
<p>Si tu dataframe ya está <em>agrupado</em> (véase la página sobre <a href="grouping-data.html#grouping-data">Agrupar datos</a>), <code>mutate()</code> puede comportarse de forma diferente que si el dataframe no está agrupado. Cualquier función de resumen, como <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code>, <code><a href="https://rdrr.io/r/stats/median.html">median()</a></code>, <code><a href="https://rdrr.io/r/base/Extremes.html">max()</a></code>, etc. calculará con datos agrupados, no con filas de registros individualizados.</p>
<div class="sourceCode" id="cb222"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># age normalized to mean of ALL rows</span>
<span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>age_norm <span class="op">=</span> <span class="va">age</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">age</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span>

<span class="co"># age normalized to mean of hospital group</span>
<span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>age_norm <span class="op">=</span> <span class="va">age</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">age</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Lee más sobre el uso de <code>mutate()</code> sobre dataframes agrupados en esta <a href="https://dplyr.tidyverse.org/reference/mutate.html">documentación mutate de tidyverse</a>.</p>
</div>
<div id="clean_across" class="section level3 unnumbered">
<h3>Transformar múltiples columnas<a class="anchor" aria-label="anchor" href="#clean_across"><i class="fas fa-link"></i></a>
</h3>
<p>A menudo, para escribir un código conciso, se desea aplicar la misma transformación a varias columnas a la vez. Se puede aplicar una transformación a varias columnas a la vez utilizando la función <code>across()</code> del paquete <strong>dplyr</strong> (también contenido en el paquete <strong>tidyverse</strong>). <code>across()</code> se puede utilizar con cualquier función <strong>de dplyr</strong>, pero se suele utilizar dentro de <code>select()</code>, <code>mutate()</code>, <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> o <code>summarise()</code>. Mira cómo se aplica a <code>summarise()</code> en la página sobre <a href="descriptive-tables.html#descriptive-tables">Tablas descriptivas</a>.</p>
<p>Especificar los argumentos de las columnas <code>.cols =</code> y la(s) función(es) a aplicar a <code>.fns =</code>. Cualquier argumento adicional a la función <code>.fns</code> puede incluirse después de una coma, todavía dentro de <code>across()</code>.</p>
<div id="selección-de-columnas-con-across" class="section level4 unnumbered">
<h4>Selección de columnas con <code>across()</code><a class="anchor" aria-label="anchor" href="#selecci%C3%B3n-de-columnas-con-across"><i class="fas fa-link"></i></a>
</h4>
<p>Especificar las columnas de <code>.cols =</code>. Puedes nombrarlas individualmente, o utilizar funciones de ayuda “tidyselect”. Especifica la función en <code>.fns =</code>. Ten en cuenta que, utilizando el modo de función mostrado a continuación, la función se escribe <em>sin</em> sus paréntesis ().</p>
<p>Aquí la transformación <code><a href="https://rdrr.io/r/base/character.html">as.character()</a></code> se aplica a columnas específicas nombradas dentro de <code>across()</code>.</p>
<div class="sourceCode" id="cb223"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">ht_cm</span>, <span class="va">wt_kg</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="va">as.character</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Las funciones de ayuda “tidyselect” están disponibles para ayudarle a especificar las columnas. Se detallan más arriba en la sección sobre Selección y reordenación de columnas, e incluyen: <code>everything()</code>, <code>last_col()</code>, <code>where()</code>, <code>starts_with()</code>, <code>ends_with()</code>, <code>contains()</code>, <code>matches()</code>, <code>num_range()</code> y <code>any_of()</code>.</p>
<p>Este es un ejemplo de cómo se pueden cambiar <strong>todas las columnas</strong> al tipo carácter:</p>
<div class="sourceCode" id="cb224"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#to change all columns to character class</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu">everything</span><span class="op">(</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="va">as.character</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Convertir en caracteres todas las columnas cuyo nombre contenga la cadena “date” (fíjate en la colocación de comas y paréntesis):</p>
<div class="sourceCode" id="cb225"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#to change all columns to character class</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu">contains</span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="va">as.character</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>A continuación, un ejemplo de mutación de las columnas que actualmente son de tipo POSIXct (un tipo datetime cruda que muestra etiquetas) - en otras palabras, donde la función <code>is.POSIXct()</code> evalúa a <code>TRUE</code>. Entonces queremos convertirlas con la función <code><a href="https://rdrr.io/r/base/as.Date.html">as.Date()</a></code> en columnas de tipo Date normal.</p>
<div class="sourceCode" id="cb226"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu">where</span><span class="op">(</span><span class="va">is.POSIXct</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="va">as.Date</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<ul>
<li><p>Ten en cuenta que dentro de <code>across()</code> también utilizamos la función <code>where()</code> como <code>is.POSIXct</code> está evaluando a TRUE o FALSE.</p></li>
<li><p>Ten en cuenta que <code>is.POSIXct()</code> es del paquete <strong>lubridate</strong>. Otras funciones “is” similares como <code><a href="https://rdrr.io/r/base/character.html">is.character()</a></code>, <code><a href="https://rdrr.io/r/base/numeric.html">is.numeric()</a></code>, e <code><a href="https://rdrr.io/r/base/logical.html">is.logical()</a></code> son de R <strong>base</strong></p></li>
</ul>
</div>
<div id="funciones-across" class="section level4 unnumbered">
<h4>funciones <code>across()</code><a class="anchor" aria-label="anchor" href="#funciones-across"><i class="fas fa-link"></i></a>
</h4>
<p>Puedes leer la documentación de ayuda con detalles sobre cómo proporcionar funciones a <code>across()</code> escribiendo <code>?across</code>: hay varias formas de especificar la(s) función(es) a realizar en una columna e incluso puedes definir tus propias funciones:</p>
<ul>
<li>Puedes escribir el nombre de la función sola (por ejemplo, <code>mean</code> o <code>as.character</code>)</li>
<li>Puedes escribir la función en <strong>estilo purrr</strong> (por ejemplo, <code>~ mean(.x, na.rm = TRUE)</code>) (mira <a href="iteration-loops-and-lists.html#iteration-loops-and-lists">esta página</a>)</li>
<li>Puedes especificar varias funciones escribiendo una lista (por ejemplo, <code>list(mean = mean, n_miss = ~ sum(is.na(.x))</code>). * Si proporcionas varias funciones, se devolverán varias columnas transformadas por cada columna de entrada, con nombres únicos con formato <code>col_fn</code>. Puedes ajustar cómo se nombran las columnas nuevas con el argumento <code>.names =</code> utilizando la sintaxis <strong>glue</strong> (mira la página sobre <a href="characters-and-strings.html#characters-and-strings">Caracteres y cadenas</a>) donde <code>{.col}</code> y <code>{.fn}</code> son la abreviatura de la columna de entrada y la función.</li>
</ul>
<p>Aquí hay algunos recursos en línea sobre el uso de <code>across()</code>: <a href="https://www.tidyverse.org/blog/2020/04/dplyr-1-0-0-colwise/">pensamientos/razones del creador Hadley Wickham</a></p>
</div>
</div>
<div id="coalesce" class="section level3 unnumbered">
<h3>
<code>coalesce()</code><a class="anchor" aria-label="anchor" href="#coalesce"><i class="fas fa-link"></i></a>
</h3>
<p>Esta función de <strong>dplyr</strong> encuentra el primer valor no missing en cada posición. Rellena los valores que faltan con el primer valor disponible en el orden que especifiques.</p>
<p>Aquí hay un ejemplo <em>fuera del contexto de un dataframe</em>: Supongamos que tienes dos vectores, uno que contiene el pueblo de detección del paciente y otro que contiene el pueblo de residencia del paciente. Puedes utilizar coalesce para elegir el primer valor no ausente de cada índice:</p>
<div class="sourceCode" id="cb227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">village_detection</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="cn">NA</span>,  <span class="cn">NA</span><span class="op">)</span>
<span class="va">village_residence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"a"</span>, <span class="st">"d"</span><span class="op">)</span>

<span class="va">village</span> <span class="op">&lt;-</span> <span class="fu">coalesce</span><span class="op">(</span><span class="va">village_detection</span>, <span class="va">village_residence</span><span class="op">)</span>
<span class="va">village</span>    <span class="co"># print</span></code></pre></div>
<pre><code>## [1] "a" "b" "a" "d"</code></pre>
<p>Esto funciona de la misma manera si se proporcionan columnas del dataframe: para cada fila, la función asignará el nuevo valor de la columna con el primer valor que no falte en las columnas proporcionadas (en el orden indicado).</p>
<div class="sourceCode" id="cb229"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>village <span class="op">=</span> <span class="fu">coalesce</span><span class="op">(</span><span class="va">village_detection</span>, <span class="va">village_residence</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Este es un ejemplo de operación “por filas”. Para cálculos más complicados por filas, consulta la sección siguiente sobre cálculos por filas.</p>
</div>
<div id="matemáticas-acumulativas" class="section level3 unnumbered">
<h3>Matemáticas acumulativas<a class="anchor" aria-label="anchor" href="#matem%C3%A1ticas-acumulativas"><i class="fas fa-link"></i></a>
</h3>
<p>Si deseas que una columna refleje acumulados la sum/mean/min/max, etc., tal y como se ha evaluado en las filas de un dataframe hasta ese punto, utiliza las siguientes funciones:</p>
<p><code><a href="https://rdrr.io/r/base/cumsum.html">cumsum()</a></code> devuelve la suma acumulada, como se muestra a continuación:</p>
<div class="sourceCode" id="cb230"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">15</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span>     <span class="co"># returns only one number</span></code></pre></div>
<pre><code>## [1] 31</code></pre>
<div class="sourceCode" id="cb232"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">15</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span>  <span class="co"># returns the cumulative sum at each step</span></code></pre></div>
<pre><code>## [1]  2  6 21 31</code></pre>
<p>Esto se puede utilizar en un dataframe al crear una nueva columna. Por ejemplo, para calcular el número acumulado de casos por día en un brote, considere un código como este:</p>
<div class="sourceCode" id="cb234"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cumulative_case_counts</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span>  <span class="co"># begin with case linelist</span>
  <span class="fu">count</span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op">%&gt;%</span>                 <span class="co"># count of rows per day, as column 'n'   </span>
  <span class="fu">mutate</span><span class="op">(</span>cumulative_cases <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>  <span class="co"># new column, of the cumulative sum at each row</span></code></pre></div>
<p>A continuación se muestran las 10 primeras filas:</p>
<div class="sourceCode" id="cb235"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">cumulative_case_counts</span>, <span class="fl">10</span><span class="op">)</span></code></pre></div>
<pre><code>##    date_onset n cumulative_cases
## 1  2012-04-15 1                1
## 2  2012-05-05 1                2
## 3  2012-05-08 1                3
## 4  2012-05-31 1                4
## 5  2012-06-02 1                5
## 6  2012-06-07 1                6
## 7  2012-06-14 1                7
## 8  2012-06-21 1                8
## 9  2012-06-24 1                9
## 10 2012-06-25 1               10</code></pre>
<p>Consulta la página sobre <a href="epidemic-curves.html#epidemic-curves">curvas epidémicas</a> para saber cómo representar la incidencia acumulada con epicurve.</p>
<p>Véase también:<br><code><a href="https://rdrr.io/r/base/cumsum.html">cumsum()</a></code>, <code>cummean()</code>, <code><a href="https://rdrr.io/r/base/cumsum.html">cummin()</a></code>, <code><a href="https://rdrr.io/r/base/cumsum.html">cummax()</a></code>, <code>cumany()</code>, <code>cumall()</code></p>
</div>
<div id="utilizando-r-base" class="section level3 unnumbered">
<h3>Utilizando R <strong>base</strong><a class="anchor" aria-label="anchor" href="#utilizando-r-base"><i class="fas fa-link"></i></a>
</h3>
<p>Para definir una nueva columna (o redefinir una columna) utilizando R <strong>base</strong>, escribe el nombre del dataframe, conectado con <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code>, a la <em>nueva</em> columna (o la columna a modificar). Utiliza el operador de asignación <code><a href="https://rdrr.io/r/base/assignOps.html">&lt;-</a></code> para definir el nuevo valor o valores. Recuerda que al usar R <strong>base</strong> debes especificar siempre el nombre del dataframe antes del nombre de la columna (por ejemplo, <code>dataframe$column</code>). Este es un ejemplo de creación de la columna <code>bmi</code> usando R <strong>base</strong>:</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="cleaning-data-and-core-functions.html#cb237-1" aria-hidden="true" tabindex="-1"></a>linelist<span class="sc">$</span>bmi <span class="ot">=</span> linelist<span class="sc">$</span>wt_kg <span class="sc">/</span> (linelist<span class="sc">$</span>ht_cm <span class="sc">/</span> <span class="dv">100</span>) <span class="sc">^</span> <span class="dv">2</span><span class="er">)</span></span></code></pre></div>
</div>
<div id="añadir-a-la-cadena-de-tuberías-1" class="section level3 unnumbered">
<h3>Añadir a la cadena de tuberías<a class="anchor" aria-label="anchor" href="#a%C3%B1adir-a-la-cadena-de-tuber%C3%ADas-1"><i class="fas fa-link"></i></a>
</h3>
<p><strong>A continuación, se añade una nueva columna a la cadena de tuberías y se convierten algunos tipos.</strong></p>
<div class="sourceCode" id="cb238"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># CLEANING 'PIPE' CHAIN (starts with raw data and pipes it through cleaning steps)</span>
<span class="co">##################################################################################</span>

<span class="co"># begin cleaning pipe chain</span>
<span class="co">###########################</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op">%&gt;%</span>
    
    <span class="co"># standardize column name syntax</span>
    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># manually re-name columns</span>
           <span class="co"># NEW name             # OLD name</span>
    <span class="fu">rename</span><span class="op">(</span>date_infection       <span class="op">=</span> <span class="va">infection_date</span>,
           date_hospitalisation <span class="op">=</span> <span class="va">hosp_date</span>,
           date_outcome         <span class="op">=</span> <span class="va">date_of_outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># remove column</span>
    <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">row_num</span>, <span class="va">merged_header</span>, <span class="va">x28</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
    <span class="co"># de-duplicate</span>
    <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
    <span class="co"># ABOVE ARE UPSTREAM CLEANING STEPS ALREADY DISCUSSED</span>
    <span class="co">###################################################</span>
    <span class="co"># add new column</span>
    <span class="fu">mutate</span><span class="op">(</span>bmi <span class="op">=</span> <span class="va">wt_kg</span> <span class="op">/</span> <span class="op">(</span><span class="va">ht_cm</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
    <span class="co"># convert class of columns</span>
    <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">contains</span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span>, <span class="va">as.Date</span><span class="op">)</span>, 
           generation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">generation</span><span class="op">)</span>,
           age        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
</div>
</div>
<div id="re-code-values" class="section level2" number="8.8">
<h2>
<span class="header-section-number">8.8</span> Recodificar valores<a class="anchor" aria-label="anchor" href="#re-code-values"><i class="fas fa-link"></i></a>
</h2>
<p>A continuación, se presentan algunos escenarios en los que es necesario recodificar (cambiar) los valores:</p>
<ul>
<li>para editar un valor específico (por ejemplo, una fecha con un año o formato incorrecto)</li>
<li>para conciliar valores que no se escriben igual</li>
<li>para crear una nueva columna de valores categóricos</li>
<li>para crear una nueva columna de categorías numéricas (por ejemplo, categorías de edad)</li>
</ul>
<div id="valores-específicos" class="section level3 unnumbered">
<h3>Valores específicos<a class="anchor" aria-label="anchor" href="#valores-espec%C3%ADficos"><i class="fas fa-link"></i></a>
</h3>
<p>Para cambiar los valores manualmente puedes utilizar la función <code>recode()</code> dentro de la función <code>mutate()</code>.</p>
<p>Imagínate que hay una fecha sin sentido en los datos (por ejemplo, “2014-14-15”): podrías corregir la fecha manualmente en los datos originales, o bien, podrías escribir el cambio en la serie de comandos de limpieza a través de <code>mutate()</code> y <code>recode()</code>. Esto último es más transparente y reproducible para cualquier otra persona que quiera entender o repetir su análisis.</p>
<div class="sourceCode" id="cb239"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># fix incorrect values                   # old value       # new value</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>date_onset <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span><span class="va">date_onset</span>, <span class="st">"2014-14-15"</span> <span class="op">=</span> <span class="st">"2014-04-15"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>La línea <code>mutate()</code> anterior puede leerse como: “mutar la columna <code>date_onset</code> para que sea igual a la columna <code>date_onset</code> recodificada de forma que el VALOR ANTIGUO se cambie por el NUEVO VALOR”. Ten en cuenta que este patrón (VIEJO = NUEVO) para <code>recode()</code> es el opuesto a la mayoría de los patrones de R (nuevo = viejo). La comunidad de desarrollo de R está trabajando en la revisión de esto.</p>
<p><strong>Aquí hay otro ejemplo de recodificación de múltiples valores dentro de una columna.</strong></p>
<p>En <code>linelist</code> hay que limpiar los valores de la columna “hospital”. Hay varias grafías diferentes y muchos valores que faltan.</p>
<div class="sourceCode" id="cb240"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span>  <span class="co"># print table of all unique values, including missing  </span></code></pre></div>
<pre><code>## 
##                      Central Hopital 
##                                   11 
##                     Central Hospital 
##                                  457 
##                           Hospital A 
##                                  290 
##                           Hospital B 
##                                  289 
##                     Military Hopital 
##                                   32 
##                    Military Hospital 
##                                  798 
##                     Mitylira Hopital 
##                                    1 
##                    Mitylira Hospital 
##                                   79 
##                                Other 
##                                  907 
##                         Port Hopital 
##                                   48 
##                        Port Hospital 
##                                 1756 
## St. Mark's Maternity Hospital (SMMH) 
##                                  417 
##   St. Marks Maternity Hopital (SMMH) 
##                                   11 
##                                 &lt;NA&gt; 
##                                 1512</code></pre>
<p>El comando <code>recode()</code> de abajo redefine la columna “hospital” como la columna actual “hospital”, pero con los cambios especificados en la recodificación. ¡No olvides las comas después de cada uno!</p>
<div class="sourceCode" id="cb242"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span><span class="va">hospital</span>,
                     <span class="co"># for reference: OLD = NEW</span>
                      <span class="st">"Mitylira Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Mitylira Hospital"</span> <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Military Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Port Hopital"</span>      <span class="op">=</span> <span class="st">"Port Hospital"</span>,
                      <span class="st">"Central Hopital"</span>   <span class="op">=</span> <span class="st">"Central Hospital"</span>,
                      <span class="st">"other"</span>             <span class="op">=</span> <span class="st">"Other"</span>,
                      <span class="st">"St. Marks Maternity Hopital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span>
                      <span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Ahora vemos que se han corregido y consolidado las grafías de la columna <code>hospital</code>:</p>
<div class="sourceCode" id="cb243"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##                     Central Hospital 
##                                  468 
##                           Hospital A 
##                                  290 
##                           Hospital B 
##                                  289 
##                    Military Hospital 
##                                  910 
##                                Other 
##                                  907 
##                        Port Hospital 
##                                 1804 
## St. Mark's Maternity Hospital (SMMH) 
##                                  428 
##                                 &lt;NA&gt; 
##                                 1512</code></pre>
<p><span style="color: darkgreen;"><strong><em>CONSEJO:</em></strong> El número de espacios antes y después de un signo de igualdad no importa. Haz que tu código sea más fácil de leer alineando el signo = para todas o la mayoría de las filas. Además, considera la posibilidad de añadir una fila de comentarios con hash (#) para aclarar a los futuros lectores qué lado es VIEJO y qué lado es NUEVO. </span></p>
<p><span style="color: darkgreen;"><strong><em>CONSEJO:</em></strong> A veces existe un valor con caracteres <em>en blanco</em> en unos datos (no reconocido como valor Missing - <code>NA</code> de R. Puedes hacer referencia a este valor con dos comillas sin espacio intermedio (““). </span></p>
</div>
<div id="por-lógica" class="section level3 unnumbered">
<h3>Por lógica<a class="anchor" aria-label="anchor" href="#por-l%C3%B3gica"><i class="fas fa-link"></i></a>
</h3>
<p>A continuación, demostramos cómo recodificar los valores de una columna utilizando lógica y condiciones:</p>
<ul>
<li>Uso de <code><a href="https://rdrr.io/r/base/replace.html">replace()</a></code>, <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> e <code>if_else()</code> para una lógica simple</li>
<li>Uso de <code>case_when()</code> para una lógica más compleja</li>
</ul>
</div>
<div id="lógica-simple" class="section level3 unnumbered">
<h3>Lógica simple<a class="anchor" aria-label="anchor" href="#l%C3%B3gica-simple"><i class="fas fa-link"></i></a>
</h3>
<div id="sustituir-con-replace" class="section level4 unnumbered">
<h4>sustituir con <code>replace()</code><a class="anchor" aria-label="anchor" href="#sustituir-con-replace"><i class="fas fa-link"></i></a>
</h4>
<p>Para recodificar con criterios lógicos simples, puedes utilizar <code><a href="https://rdrr.io/r/base/replace.html">replace()</a></code> dentro de <code>mutate()</code>. <code><a href="https://rdrr.io/r/base/replace.html">replace()</a></code> es una función de R <strong>base</strong>. Utiliza una condición lógica para especificar las filas a cambiar. La sintaxis general es:</p>
<p><code>mutate(col_to_change = replace(col_a_cambiar, criterio para filas, nuevo valor))</code>.</p>
<p>Una situación frecuente es utilizar <code><a href="https://rdrr.io/r/base/replace.html">replace()</a></code> para <strong>cambiar sólo un valor en una fila, utilizando un identificador de fila único</strong>. A continuación, el género se cambia a “Mujer” en la fila donde la columna <code>case_id</code> es “2195”.</p>
<div class="sourceCode" id="cb245"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Example: change gender of one specific observation to "Female" </span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span><span class="op">(</span><span class="va">gender</span>, <span class="va">case_id</span> <span class="op">==</span> <span class="st">"2195"</span>, <span class="st">"Female"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Abajo se puede ver un ejemplo equivalente utilizando la sintaxis de R <strong>base</strong> y los paréntesis de indexación <code>[ ]</code>. Se lee como “Cambia el valor de la columna <code>gender</code> del dataframe <code>linelist</code> a ‘Female’” (para las filas en las que la columna <code>case_id</code> de <code>linelist</code> tiene el valor ‘2195’).</p>
<div class="sourceCode" id="cb246"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span><span class="op">$</span><span class="va">gender</span><span class="op">[</span><span class="va">linelist</span><span class="op">$</span><span class="va">case_id</span> <span class="op">==</span> <span class="st">"2195"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Female"</span></code></pre></div>
</div>
<div id="ifelse-e-if_else" class="section level4 unnumbered">
<h4>
<code>ifelse()</code> e <code>if_else()</code><a class="anchor" aria-label="anchor" href="#ifelse-e-if_else"><i class="fas fa-link"></i></a>
</h4>
<p>Otra herramienta para la lógica simple es <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> y su compañero <code>if_else()</code>. Sin embargo, en la mayoría de los casos para la recodificación es más claro utilizar <code>case_when()</code> (detallado a continuación). Estos comandos “if else” son versiones simplificadas de una sentencia de programación <code>if</code> y <code>else</code>. La sintaxis general es:<br><code>ifelse(condición, valor a devolver si la condición evalúa como TRUE, valor a devolver si la condición evalúa como FALSE)</code></p>
<p>A continuación, se define la columna <code>source_known</code>. Su valor en una fila determinada se establece como “known” si <em>no falta</em> el valor de la fila en la columna <code>source</code>. <em>Si falta</em> el valor en <code>source</code>, el valor de <code>source_known</code> se establece como “unknown”.</p>
<div class="sourceCode" id="cb247"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>source_known <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">source</span><span class="op">)</span>, <span class="st">"known"</span>, <span class="st">"unknown"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><code>if_else()</code> es una versión especial de <strong>dplyr</strong> que maneja fechas. Ten en cuenta que, si el valor “verdadero” es una fecha, el valor “falso” también debe calificar una fecha, de ahí que se utilice el valor especial <code>NA_real_</code> en lugar de simplemente <code>NA</code>.</p>
<div class="sourceCode" id="cb248"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a date of death column, which is NA if patient has not died.</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>date_death <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">outcome</span> <span class="op">==</span> <span class="st">"Death"</span>, <span class="va">date_outcome</span>, <span class="cn">NA_real_</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><strong>Evita encadenar muchos comandos ifelse… ¡utilza</strong> case_when<strong>() en su lugar!</strong> <code>case_when()</code> es mucho más fácil de leer y cometerás menos errores.</p>
<div class="inline-figure"><img src="images/ifelse%20bad.png" width="100%" style="display: block; margin: auto;"></div>
<p>Fuera del contexto de un dataframe, si deseas que un objeto utilizado en su código cambie su valor, considere el uso de <code><a href="https://rdrr.io/r/base/switch.html">switch()</a></code> de R <strong>base</strong>.</p>
</div>
</div>
<div id="clean_case_when" class="section level3 unnumbered">
<h3>Lógica compleja<a class="anchor" aria-label="anchor" href="#clean_case_when"><i class="fas fa-link"></i></a>
</h3>
<p>Utiliza <code>case_when()</code> de <strong>dplyr</strong> si estás recodificando en muchos grupos nuevos, o si necesita utilizar sentencias lógicas complejas para recodificar valores. Esta función evalúa si cada fila del dataframe cumple los criterios especificados y asigna el nuevo valor correcto.</p>
<p>Los comandos <code>case_when()</code> consisten en sentencias que tienen un lado derecho (RHS) y un lado izquierdo (LHS) separados por una “tilde” <code><a href="https://rdrr.io/r/base/tilde.html">~</a></code> (cola de chancho). Los criterios lógicos están en el lado izquierdo y los valores de conformidad están en el lado derecho de cada sentencia. Las declaraciones están separadas por comas.</p>
<p>Por ejemplo, aquí utilizamos las columnas <code>age</code> y <code>age_unit</code> para crear una columna <code>age_years</code>:</p>
<div class="sourceCode" id="cb249"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>age_years <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span>
            <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"years"</span>  <span class="op">~</span> <span class="va">age</span>,       <span class="co"># if age is given in years</span>
            <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"months"</span> <span class="op">~</span> <span class="va">age</span><span class="op">/</span><span class="fl">12</span>,    <span class="co"># if age is given in months</span>
            <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">age_unit</span><span class="op">)</span>      <span class="op">~</span> <span class="va">age</span>,       <span class="co"># if age unit is missing, assume years</span>
            <span class="cn">TRUE</span>                 <span class="op">~</span> <span class="cn">NA_real_</span><span class="op">)</span><span class="op">)</span> <span class="co"># any other circumstance, assign missing</span></code></pre></div>
<p>A medida que se evalúa cada fila de los datos, los criterios se aplican/evalúan en el orden en que se escriben las sentencias <code>case_when()</code>, de arriba a abajo. Si el criterio superior se evalúa como <code>TRUE</code> para una fila determinada, se asigna el valor RHS, y los criterios restantes ni siquiera se prueban para esa fila. Por lo tanto, es mejor escribir los criterios más específicos primero y los más generales al final.</p>
<p>En esta línea, en su declaración final, coloca <code>TRUE</code> en el lado izquierdo, lo que capturará cualquier fila que no cumpla ninguno de los criterios anteriores. Al lado derecho de esta declaración se le podría asignar un valor como “¡comprobado!” o faltante.</p>
<p><span style="color: red;"><strong><em>PELIGRO:</em> Los valores del lado derecho deben ser todos del mismo tipo</strong>: numéricos, de caracteres, de fecha, lógicos, etc. Para asignar faltantes (<code>NA</code>), puede ser necesario utilizar variaciones especiales de <code>NA</code> como <code>NA_character_</code>, <code>NA_real_</code> (para numérico o POSIX), y <code><a href="https://rdrr.io/r/base/as.Date.html">as.Date(NA)</a></code>. Lee más en <a href="working-with-dates.html#working-with-dates-1">Trabajar con fechas</a>. </span></p>
</div>
<div id="valores-faltantes-1" class="section level3 unnumbered">
<h3>Valores faltantes<a class="anchor" aria-label="anchor" href="#valores-faltantes-1"><i class="fas fa-link"></i></a>
</h3>
<p>A continuación, se presentan funciones especiales para el tratamiento de los valores faltantes en el contexto de la limpieza de datos.</p>
<p>Consulta la página sobre <a href="missing-data.html#missing-data">Valores faltantes</a> para obtener consejos más detallados sobre la identificación y el tratamiento de los valores faltantes. Por ejemplo, la función <code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code> que comprueba lógicamente la ausencia de datos.</p>
<p><strong><code>replace_na()</code></strong></p>
<p>Para cambiar los valores faltantes (<code>NA</code>) por un valor específico, como “Missing”, utiliza la función de <strong>dplyr</strong> <code>replace_na()</code> dentro de <code>mutate()</code>. Ten en cuenta que se utiliza de la misma manera que recodificar anteriormente - el nombre de la variable debe repetirse dentro de <code>replace_na()</code>.</p>
<div class="sourceCode" id="cb250"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><strong>fct_explicit_na()</strong></p>
<p>Esta es una función del paquete <strong>forcats</strong>. El paquete <strong>forcats</strong> maneja columnas del tipo Factor. Los factores son la forma en que R maneja valores <em>ordenados</em> como <code><a href="https://rdrr.io/r/base/c.html">c("First", "Second", "Third")</a></code> o para establecer el orden en que los valores (por ejemplo, hospitales) aparecen en las tablas y gráficos. Vea la página sobre <a href="factors.html#factors">Factores</a>.</p>
<p>Si tus datos son del tipo Factor y tratas de convertir <code>NA</code> en “Missing” utilizando <code>replace_na()</code>, obtendrás este error: <code>invalid factor level, NA generated</code> (nivel de factor no válido, NA generado). Has intentado añadir “Missing” como valor, cuando no estaba definido como un posible nivel del factor, y ha sido rechazado.</p>
<p>La forma más fácil de resolver esto es utilizar la función <code>fct_explicit_na()</code> de <strong>forcats</strong> que convierte una columna en factor de tipo, y convierte los valores <code>NA</code> en el carácter “(Missing)”.</p>
<div class="sourceCode" id="cb251"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">fct_explicit_na</span><span class="op">(</span><span class="va">hospital</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Una alternativa más lenta sería añadir el nivel del factor utilizando <code>fct_expand()</code> y luego convertir los valores que faltan.</p>
<p><strong><code>na_if()</code></strong></p>
<p>Para convertir un <em>valor específico en</em> <code>NA</code>, utiliza <code>na_if()</code> de <strong>dplyr</strong>. El comando siguiente realiza la operación opuesta a <code>replace_na()</code>. En el siguiente ejemplo, cualquier valor de “Missing” en la columna <code>hospital</code> se convierte en <code>NA</code>.</p>
<div class="sourceCode" id="cb252"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">na_if</span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Nota: <code>na_if()</code> <strong>no puede utilizarse para criterios lógicos</strong> (por ejemplo, “todos los valores &gt; 99”) - utiliza <code><a href="https://rdrr.io/r/base/replace.html">replace()</a></code> o <code>case_when()</code> para ello:</p>
<div class="sourceCode" id="cb253"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Convert temperatures above 40 to NA </span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>temp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span><span class="op">(</span><span class="va">temp</span>, <span class="va">temp</span> <span class="op">&gt;</span> <span class="fl">40</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Convert onset dates earlier than 1 Jan 2000 to missing</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>date_onset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span><span class="op">(</span><span class="va">date_onset</span>, <span class="va">date_onset</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2000-01-01"</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="diccionario-de-limpieza" class="section level3 unnumbered">
<h3>Diccionario de limpieza<a class="anchor" aria-label="anchor" href="#diccionario-de-limpieza"><i class="fas fa-link"></i></a>
</h3>
<p>Utiliza el paquete R <strong>linelist</strong> y su función <code>clean_variable_spelling()</code> para limpiar un dataframe con un <em>diccionario de limpieza</em>. <strong>linelist</strong> es un paquete desarrollado por <a href="https://github.com/reconhub/linelist">RECON</a> - el R Epidemics Consortium.</p>
<ol style="list-style-type: decimal">
<li>Crear un diccionario de limpieza con 3 columnas:
<ul>
<li>Una columna “desde” (el valor incorrecto)<br>
</li>
<li>Una columna “para” (el valor correcto)<br>
</li>
<li>Una columna que especifica la columna a la que se aplicarán los cambios (o “.global” para aplicarlo a todas las columnas)</li>
</ul>
</li>
</ol>
<p>Nota: Las entradas del diccionario .global serán anuladas por las entradas del diccionario específico de la columna.</p>
<div class="inline-figure"><img src="images/cleaning_dict.png" width="100%" style="display: block; margin: auto;"></div>
<ol start="2" style="list-style-type: decimal">
<li>Importa el archivo del diccionario a R. Este ejemplo puede descargarse a través de las instrucciones de la página <a href="download-handbook-and-data.html#download-handbook-and-data">Descargar manual y datos</a>.</li>
</ol>
<div class="sourceCode" id="cb254"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cleaning_dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"cleaning_dict.csv"</span><span class="op">)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Pasa linelist crudas a <code>clean_variable_spelling()</code>, especificando en <code>wordlists =</code> el dataframe del diccionario de limpieza. El argumento <code>spelling_vars =</code> puede utilizarse para especificar a qué columna del diccionario se refieren las columnas (la tercera por defecto), o puede establecerse como <code>NULL</code> para que el diccionario se aplique a todas las columnas de caracteres y factores. Ten en cuenta que esta función puede tardar mucho en ejecutarse.</li>
</ol>
<div class="sourceCode" id="cb255"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">linelist</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/linelist/man/clean_variable_spelling.html">clean_variable_spelling</a></span><span class="op">(</span>
    wordlists <span class="op">=</span> <span class="va">cleaning_dict</span>,
    spelling_vars <span class="op">=</span> <span class="st">"col"</span>,        <span class="co"># dict column containing column names, defaults to 3rd column in dict</span>
  <span class="op">)</span></code></pre></div>
<p>Ahora desplázate a la derecha para ver cómo han cambiado los valores - en particular el <code>gender</code> (de minúsculas a mayúsculas), y todas las columnas de síntomas se han transformado de sí/no a 1/0.</p>
<div id="htmlwidget-704d9e6dd8954ac359df" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-704d9e6dd8954ac359df">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399939200000\" data-max=\"1407024000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["M","F","M","F","M","F","F","F","M","F","M","M","M","F","F","M","F","F","F","F","M","M","F","M","F","M","M","F","M","F","F","F","M","M","F","M","F","F","F","M","F","M","F","M","M","F","M","F","M","M"],["Other",null,"St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital",null,null,null,null,"Port Hospital","Military Hospital",null,null,"Other","Port Hospital","Port Hospital","Port Hospital",null,"Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)",null,"Other",null,"St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital",null,"Military Hospital","Other",null,null,"Port Hospital","Port Hospital","Port Hospital",null,"Central Hospital","Military Hospital","Other","Other","Other",null,"St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)",null],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.46183062600728,8.46272931462646,8.46144367534271,8.46191259217774,8.47292327643506,8.48401630165138,8.45837125340844,8.47761705512509,8.47570184950483,8.47779946878972,8.47145134147474,8.47804840685363,8.48528034195779,8.46957530395867,8.45957352078114,8.47404889511544,8.48802917129884,8.473437335922,8.48408263734462,8.46242233645879,8.47026822126572,8.46398447480533,8.4641347894342,8.45623094629607,8.48334624336805,8.47493999153642,8.47832062438022,8.4693933891765,8.48480589906514,8.47121232619015,8.48438437371817,8.48466158574339,8.47714159984428,8.46238127010609,8.45568597813113,8.4632880274758,8.47940722413856,8.46353857052336,8.46178968158864,8.47508713872833,8.45825808128071,8.4532568143863,8.4732571907655,8.47911586641933,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["0",null,null,"0","0","0",null,"0","0","0","0","0","0","0","0","0","0","0",null,"0","0","0","0","0",null,"0","0","0",null,null,"0","0",null,"0","0",null,null,"0","0",null,"0","0",null,"0","0","0","0","0","0",null],["0",null,null,"0","0","0",null,"0","0","0","0","0","0","0","0","0","1","0",null,"0","0","0","1","0",null,"0","0","1",null,null,"0","0",null,"0","0",null,null,"0","0",null,"0","0",null,"0","1","0","0","0","0",null],["1",null,null,"0","1","1",null,"1","1","1","1","1","1","1","1","1","1","1",null,"1","1","1","1","1",null,"1","1","1",null,null,"1","1",null,"1","1",null,null,"1","1",null,"1","1",null,"1","1","1","1","1","0",null],["0",null,null,"0","0","0",null,"0","0","0","0","0","0","0","0","1","0","0",null,"0","0","0","0","0",null,"0","0","0",null,null,"0","0",null,"0","0",null,null,"1","1",null,"0","0",null,"0","0","0","0","0","0",null],["1",null,null,"0","1","1",null,"1","1","0","1","0","0","0","1","0","0","0",null,"0","1","0","0","0",null,"0","0","0",null,null,"0","1",null,"1","1",null,null,"1","1",null,"1","1",null,"1","1","0","1","1","1",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.8184429761563,16.0652496292635,22.4965706447188,71.4144019043841,41.6171224732461,62.0953890870657,0,16.8376536925366,22.7903289734443,53.4119897959184,24.2802636142907,22.4600343506408,54.320987654321,41.0578432556455,28.5664819944598,17.0320552013276,25.0412914912888,38.7172182043977,27.3876813705495,31.5555555555556,14.8069075945662,30.8839811199813,26.6193433895297,59.375,96.6183574879227,19.2394748755093,84.9403122130395,18.4199377406104,27.7722674072605,41.3223140495868,17.2080666586161,24.1671624033314,15.7218971089178,428.994082840237,27.9930220292912,243.261012491782,20.2395007589813,30.527446435638,25.15589569161,47,39.04,31.0661643201798,77.9683671196257,29.5165961238583,166.493236212279,100.308641975309,37.76,20.6037803457852,23.458562375267],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>age_years<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,9,10,13,15,16,17,23,25,26]}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Ten en cuenta que los nombres de las columnas en el diccionario de limpieza deben corresponder a los nombres <em>en este punto</em> de tu script de limpieza. Consulta esta <a href="https://www.repidemicsconsortium.org/linelist/reference/clean_data.html">referencia en línea para el paquete linelist</a> para obtener más detalles.</p>
<div id="añadir-a-la-cadena-de-tuberías-2" class="section level4 unnumbered">
<h4>Añadir a la cadena de tuberías<a class="anchor" aria-label="anchor" href="#a%C3%B1adir-a-la-cadena-de-tuber%C3%ADas-2"><i class="fas fa-link"></i></a>
</h4>
<p><strong>A continuación, se añaden algunas columnas y transformaciones de columna nuevas a la cadena de tuberías.</strong></p>
<div class="sourceCode" id="cb256"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># CLEANING 'PIPE' CHAIN (starts with raw data and pipes it through cleaning steps)</span>
<span class="co">##################################################################################</span>

<span class="co"># begin cleaning pipe chain</span>
<span class="co">###########################</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op">%&gt;%</span>
    
    <span class="co"># standardize column name syntax</span>
    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># manually re-name columns</span>
           <span class="co"># NEW name             # OLD name</span>
    <span class="fu">rename</span><span class="op">(</span>date_infection       <span class="op">=</span> <span class="va">infection_date</span>,
           date_hospitalisation <span class="op">=</span> <span class="va">hosp_date</span>,
           date_outcome         <span class="op">=</span> <span class="va">date_of_outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># remove column</span>
    <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">row_num</span>, <span class="va">merged_header</span>, <span class="va">x28</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
    <span class="co"># de-duplicate</span>
    <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
    <span class="co"># add column</span>
    <span class="fu">mutate</span><span class="op">(</span>bmi <span class="op">=</span> <span class="va">wt_kg</span> <span class="op">/</span> <span class="op">(</span><span class="va">ht_cm</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>     

    <span class="co"># convert class of columns</span>
    <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">contains</span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span>, <span class="va">as.Date</span><span class="op">)</span>, 
           generation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">generation</span><span class="op">)</span>,
           age        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># add column: delay to hospitalisation</span>
    <span class="fu">mutate</span><span class="op">(</span>days_onset_hosp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">date_hospitalisation</span> <span class="op">-</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
   <span class="co"># ABOVE ARE UPSTREAM CLEANING STEPS ALREADY DISCUSSED</span>
   <span class="co">###################################################</span>

    <span class="co"># clean values of hospital column</span>
    <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span><span class="va">hospital</span>,
                      <span class="co"># OLD = NEW</span>
                      <span class="st">"Mitylira Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Mitylira Hospital"</span> <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Military Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Port Hopital"</span>      <span class="op">=</span> <span class="st">"Port Hospital"</span>,
                      <span class="st">"Central Hopital"</span>   <span class="op">=</span> <span class="st">"Central Hospital"</span>,
                      <span class="st">"other"</span>             <span class="op">=</span> <span class="st">"Other"</span>,
                      <span class="st">"St. Marks Maternity Hopital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span>
                      <span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 

    <span class="co"># create age_years column (from age and age_unit)</span>
    <span class="fu">mutate</span><span class="op">(</span>age_years <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span>
          <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"years"</span> <span class="op">~</span> <span class="va">age</span>,
          <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"months"</span> <span class="op">~</span> <span class="va">age</span><span class="op">/</span><span class="fl">12</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">age_unit</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span>,
          <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_real_</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="num_cats" class="section level2" number="8.9">
<h2>
<span class="header-section-number">8.9</span> Categorías numéricas<a class="anchor" aria-label="anchor" href="#num_cats"><i class="fas fa-link"></i></a>
</h2>
<p>Aquí describimos algunos enfoques especiales para crear categorías a partir de columnas numéricas. Algunos ejemplos comunes son las categorías de edad, los grupos de valores de laboratorio, etc. Aquí discutiremos:</p>
<ul>
<li>
<code>age_categories()</code>, del paquete <strong>epikit</strong><br>
</li>
<li>
<code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code>, de R <strong>base</strong>
</li>
<li>
<code>case_when()</code><br>
</li>
<li>ruptura de cuantiles con <code><a href="https://rdrr.io/r/stats/quantile.html">quantile()</a></code> y <code>ntile()</code>
</li>
</ul>
<div id="revisión-de-la-distribución" class="section level3 unnumbered">
<h3>Revisión de la distribución<a class="anchor" aria-label="anchor" href="#revisi%C3%B3n-de-la-distribuci%C3%B3n"><i class="fas fa-link"></i></a>
</h3>
<p>Para este ejemplo crearemos una columna <code>age_cat</code> utilizando la columna <code>age_years.</code></p>
<div class="sourceCode" id="cb257"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#check the class of the linelist variable age</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_years</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "numeric"</code></pre>
<p>En primer lugar, examina la distribución de tus datos, para hacer los puntos de corte apropiados. Consulta la página sobre <a href="ggplot-basics.html#ggplot-basics">Conceptos básicos de ggplot</a>.</p>
<div class="sourceCode" id="cb259"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># examine the distribution</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_years</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-216-1.png" width="672" height="50%"></div>
<div class="sourceCode" id="cb260"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_years</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##    0.00    6.00   13.00   16.04   23.00   84.00     107</code></pre>
<p><span style="color: orange;"><strong><em>ATENCIÓN:</em></strong> A veces, las variables numéricas se importarán como tipo “carácter”. Esto ocurre si hay caracteres no numéricos en algunos de los valores, por ejemplo, una entrada de “2 meses” para la edad, o (dependiendo de la configuración de su configuración local de R) si se utiliza una coma en el lugar de los decimales (por ejemplo, “4,5” para significar cuatro años y medio). </span></p>
<!-- ======================================================= -->
</div>
<div id="age_categories" class="section level3 unnumbered">
<h3>
<code>age_categories()</code><a class="anchor" aria-label="anchor" href="#age_categories"><i class="fas fa-link"></i></a>
</h3>
<p>Con el paquete <strong>epikit</strong>, puedes utilizar la función <code>age_categories()</code> para categorizar y etiquetar fácilmente las columnas numéricas (nota: esta función puede aplicarse también a las variables numéricas no relacionadas con la edad). Además, la columna de salida es automáticamente un factor ordenado.</p>
<p>Aquí están las entradas requeridas:</p>
<ul>
<li>Un vector numérico (columna)</li>
<li>El argumento + breakers = ` - proporciona un vector numérico de puntos de ruptura para los nuevos grupos</li>
</ul>
<p>Primero, el ejemplo más sencillo:</p>
<div class="sourceCode" id="cb262"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Simple example</span>
<span class="co">################</span>
<span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">epikit</span><span class="op">)</span>                    <span class="co"># load package</span>

<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    age_cat <span class="op">=</span> <span class="fu">age_categories</span><span class="op">(</span>             <span class="co"># create new column</span>
      <span class="va">age_years</span>,                            <span class="co"># numeric column to make groups from</span>
      breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>,        <span class="co"># break points</span>
                   <span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">50</span>, <span class="fl">60</span>, <span class="fl">70</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># show table</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##   0-4   5-9 10-14 15-19 20-29 30-39 40-49 50-59 60-69 
##  1227  1223  1048   827  1216   597   251    78    27 
##   70+  &lt;NA&gt; 
##     7   107</code></pre>
<p>Los valores de ruptura que especificas son por defecto los límites inferiores - es decir, están incluidos en el grupo “superior” / los grupos están “abiertos” en la parte inferior/izquierda. Como se muestra a continuación, puedes añadir 1 a cada valor de ruptura para conseguir grupos que estén abiertos por la parte superior/derecha.</p>
<div class="sourceCode" id="cb264"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Include upper ends for the same categories</span>
<span class="co">############################################</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    age_cat <span class="op">=</span> <span class="fu">age_categories</span><span class="op">(</span>
      <span class="va">age_years</span>, 
      breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span>, <span class="fl">11</span>, <span class="fl">16</span>, <span class="fl">21</span>, <span class="fl">31</span>, <span class="fl">41</span>, <span class="fl">51</span>, <span class="fl">61</span>, <span class="fl">71</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># show table</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##   0-5  6-10 11-15 16-20 21-30 31-40 41-50 51-60 61-70 
##  1469  1195  1040   770  1149   547   231    70    24 
##   71+  &lt;NA&gt; 
##     6   107</code></pre>
<p>Puedes ajustar cómo se muestran las etiquetas con el <code>separator =</code>. El valor predeterminado es “-”</p>
<p>Puedes ajustar cómo se manejan los números superiores, con el argumento <code>ceiling =</code>. Para establecer un corte superior establezca <code>ceiling = TRUE</code>. En este uso, el valor de ruptura más alto proporcionado es un “techo” y no se crea una categoría “XX+”. Cualquier valor por encima del valor de corte más alto (o hasta el límite <code>upper =</code>, si está definido) se categoriza como <code>NA</code>. A continuación, se muestra un ejemplo con <code>ceiling = TRUE</code>, de modo que no hay categoría de XX+ y los valores por encima de 70 (el valor de ruptura más alto) se asignan como <code>NA</code>.</p>
<div class="sourceCode" id="cb266"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># With ceiling set to TRUE</span>
<span class="co">##########################</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    age_cat <span class="op">=</span> <span class="fu">age_categories</span><span class="op">(</span>
      <span class="va">age_years</span>, 
      breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">50</span>, <span class="fl">60</span>, <span class="fl">70</span><span class="op">)</span>,
      ceiling <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="co"># 70 is ceiling, all above become NA</span>

<span class="co"># show table</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##   0-4   5-9 10-14 15-19 20-29 30-39 40-49 50-59 60-70 
##  1227  1223  1048   827  1216   597   251    78    28 
##  &lt;NA&gt; 
##   113</code></pre>
<p>Alternativamente, en lugar de los <code>breakers =</code>, puedes proporcionar todos los <code>lower =</code>, <code>upper =</code>, and <code>by =</code>:</p>
<ul>
<li>
<code>lower =</code> El número más bajo que se quiere considerar - por defecto es 0</li>
<li>
<code>upper =</code> El número más alto que quiere que se considere<br>
</li>
<li>
<code>by =</code> El número de años entre los grupos</li>
</ul>
<div class="sourceCode" id="cb268"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    age_cat <span class="op">=</span> <span class="fu">age_categories</span><span class="op">(</span>
      <span class="va">age_years</span>, 
      lower <span class="op">=</span> <span class="fl">0</span>,
      upper <span class="op">=</span> <span class="fl">100</span>,
      by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span>

<span class="co"># show table</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##   0-9 10-19 20-29 30-39 40-49 50-59 60-69 70-79 80-89 
##  2450  1875  1216   597   251    78    27     6     1 
## 90-99  100+  &lt;NA&gt; 
##     0     0   107</code></pre>
<p>Consulta la página de ayuda de la función para más detalles (escribe <code>?age_categories</code> en la consola de R).</p>
<!-- ======================================================= -->
</div>
<div id="cut" class="section level3 unnumbered">
<h3>
<code>cut()</code><a class="anchor" aria-label="anchor" href="#cut"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> es una alternativa a <code>age_categories()</code> de R <strong>base</strong>, pero creo que verás por qué <code>age_categories()</code> se desarrolló para simplificar este proceso. Algunas diferencias notables de <code>age_categories()</code> son:</p>
<ul>
<li>No es necesario instalar/cargar otro paquete</li>
<li>Puedes especificar si los grupos están abiertos/cerrados a la derecha/izquierda</li>
<li>Debes proporcionar etiquetas precisas</li>
<li>Si quieres que el 0 se incluya en el grupo más bajo debes especificarlo</li>
</ul>
<p>La sintaxis básica dentro de <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> es proporcionar primero la columna numérica que se va a cortar (<code>age_years</code>), y luego el argumento <em>breaks</em>, que es un vector numérico <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> de puntos de ruptura. Utilizando <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code>, la columna resultante es un factor ordenado.</p>
<p>Por defecto, la categorización se produce de manera que el lado derecho/superior es “abierto” e inclusivo (y el lado izquierdo/inferior es “cerrado” o exclusivo). Este es el comportamiento opuesto al de la función <code>age_categories()</code>. Las etiquetas por defecto utilizan la notación “(A, B]”, lo que significa que A no está incluido pero B sí. <strong>Invierte este comportamiento proporcionando el argumento right = TRUE</strong>.</p>
<p>Así, por defecto, ¡los valores “0” se excluyen del grupo más bajo, y se categorizan como <code>NA</code>! Los valores “0” podrían ser codificados para los bebés como edad 0, así que ¡ten cuidado! Para cambiar esto, añade el argumento <code>include.lowest = TRUE</code> para que cualquier valor “0” se incluya en el grupo más bajo. La etiqueta generada automáticamente para la categoría más baja será entonces “[A],B]”. Ten en cuenta que si incluye el argumento <code>include.lowest = TRUE</code> <strong>y</strong> <code>right = TRUE</code>, la inclusión extrema se aplicará ahora al valor del punto de ruptura y a la categoría <em>más altos</em>, no a los más bajos.</p>
<p>Puedes proporcionar un vector de etiquetas personalizadas utilizando el argumento <code>labels =</code>. Como se escriben manualmente, ¡ten mucho cuidado de que sean precisas! Comprueba el trabajo utilizando una tabulación cruzada, como se describe a continuación.</p>
<p>A continuación se muestra un ejemplo de <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> aplicado a <code>age_years</code> para crear la nueva variable <code>age_cat</code>:</p>
<div class="sourceCode" id="cb270"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create new variable, by cutting the numeric age variable</span>
<span class="co"># lower break is excluded but upper break is included in each category</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    age_cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span>
      <span class="va">age_years</span>,
      breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>,
                 <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">70</span>, <span class="fl">100</span><span class="op">)</span>,
      include.lowest <span class="op">=</span> <span class="cn">TRUE</span>         <span class="co"># include 0 in lowest group</span>
      <span class="op">)</span><span class="op">)</span>

<span class="co"># tabulate the number of observations per group</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##    [0,5]   (5,10]  (10,15]  (15,20]  (20,30]  (30,50] 
##     1469     1195     1040      770     1149      778 
##  (50,70] (70,100]     &lt;NA&gt; 
##       94        6      107</code></pre>
<p><strong>¡Comprueba tu trabajo!</strong> Verifica que cada valor de edad fue asignado a la categoría correcta cruzando las columnas numéricas y de categoría. Examina la asignación de los valores límite (por ejemplo, 15, si las categorías vecinas son 10-15 y 16-20).</p>
<div class="sourceCode" id="cb272"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Cross tabulation of the numeric and category columns. </span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="st">"Numeric Values"</span> <span class="op">=</span> <span class="va">linelist</span><span class="op">$</span><span class="va">age_years</span>,   <span class="co"># names specified in table for clarity.</span>
      <span class="st">"Categories"</span>     <span class="op">=</span> <span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>,
      useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span>                        <span class="co"># don't forget to examine NA values</span></code></pre></div>
<pre><code>##                     Categories
## Numeric Values       [0,5] (5,10] (10,15] (15,20] (20,30]
##   0                    136      0       0       0       0
##   0.0833333333333333     1      0       0       0       0
##   0.25                   2      0       0       0       0
##   0.333333333333333      6      0       0       0       0
##   0.416666666666667      1      0       0       0       0
##   0.5                    6      0       0       0       0
##   0.583333333333333      3      0       0       0       0
##   0.666666666666667      3      0       0       0       0
##   0.75                   3      0       0       0       0
##   0.833333333333333      1      0       0       0       0
##   0.916666666666667      1      0       0       0       0
##   1                    275      0       0       0       0
##   1.5                    2      0       0       0       0
##   2                    308      0       0       0       0
##   3                    246      0       0       0       0
##   4                    233      0       0       0       0
##   5                    242      0       0       0       0
##   6                      0    241       0       0       0
##   7                      0    256       0       0       0
##   8                      0    239       0       0       0
##   9                      0    245       0       0       0
##   10                     0    214       0       0       0
##   11                     0      0     220       0       0
##   12                     0      0     224       0       0
##   13                     0      0     191       0       0
##   14                     0      0     199       0       0
##   15                     0      0     206       0       0
##   16                     0      0       0     186       0
##   17                     0      0       0     164       0
##   18                     0      0       0     141       0
##   19                     0      0       0     130       0
##   20                     0      0       0     149       0
##   21                     0      0       0       0     158
##   22                     0      0       0       0     149
##   23                     0      0       0       0     125
##   24                     0      0       0       0     144
##   25                     0      0       0       0     107
##   26                     0      0       0       0     100
##   27                     0      0       0       0     117
##   28                     0      0       0       0      85
##   29                     0      0       0       0      82
##   30                     0      0       0       0      82
##   31                     0      0       0       0       0
##   32                     0      0       0       0       0
##   33                     0      0       0       0       0
##   34                     0      0       0       0       0
##   35                     0      0       0       0       0
##   36                     0      0       0       0       0
##   37                     0      0       0       0       0
##   38                     0      0       0       0       0
##   39                     0      0       0       0       0
##   40                     0      0       0       0       0
##   41                     0      0       0       0       0
##   42                     0      0       0       0       0
##   43                     0      0       0       0       0
##   44                     0      0       0       0       0
##   45                     0      0       0       0       0
##   46                     0      0       0       0       0
##   47                     0      0       0       0       0
##   48                     0      0       0       0       0
##   49                     0      0       0       0       0
##   50                     0      0       0       0       0
##   51                     0      0       0       0       0
##   52                     0      0       0       0       0
##   53                     0      0       0       0       0
##   54                     0      0       0       0       0
##   55                     0      0       0       0       0
##   56                     0      0       0       0       0
##   57                     0      0       0       0       0
##   58                     0      0       0       0       0
##   59                     0      0       0       0       0
##   60                     0      0       0       0       0
##   61                     0      0       0       0       0
##   62                     0      0       0       0       0
##   63                     0      0       0       0       0
##   64                     0      0       0       0       0
##   65                     0      0       0       0       0
##   66                     0      0       0       0       0
##   67                     0      0       0       0       0
##   68                     0      0       0       0       0
##   69                     0      0       0       0       0
##   70                     0      0       0       0       0
##   72                     0      0       0       0       0
##   73                     0      0       0       0       0
##   76                     0      0       0       0       0
##   84                     0      0       0       0       0
##   &lt;NA&gt;                   0      0       0       0       0
##                     Categories
## Numeric Values       (30,50] (50,70] (70,100] &lt;NA&gt;
##   0                        0       0        0    0
##   0.0833333333333333       0       0        0    0
##   0.25                     0       0        0    0
##   0.333333333333333        0       0        0    0
##   0.416666666666667        0       0        0    0
##   0.5                      0       0        0    0
##   0.583333333333333        0       0        0    0
##   0.666666666666667        0       0        0    0
##   0.75                     0       0        0    0
##   0.833333333333333        0       0        0    0
##   0.916666666666667        0       0        0    0
##   1                        0       0        0    0
##   1.5                      0       0        0    0
##   2                        0       0        0    0
##   3                        0       0        0    0
##   4                        0       0        0    0
##   5                        0       0        0    0
##   6                        0       0        0    0
##   7                        0       0        0    0
##   8                        0       0        0    0
##   9                        0       0        0    0
##   10                       0       0        0    0
##   11                       0       0        0    0
##   12                       0       0        0    0
##   13                       0       0        0    0
##   14                       0       0        0    0
##   15                       0       0        0    0
##   16                       0       0        0    0
##   17                       0       0        0    0
##   18                       0       0        0    0
##   19                       0       0        0    0
##   20                       0       0        0    0
##   21                       0       0        0    0
##   22                       0       0        0    0
##   23                       0       0        0    0
##   24                       0       0        0    0
##   25                       0       0        0    0
##   26                       0       0        0    0
##   27                       0       0        0    0
##   28                       0       0        0    0
##   29                       0       0        0    0
##   30                       0       0        0    0
##   31                      68       0        0    0
##   32                      84       0        0    0
##   33                      78       0        0    0
##   34                      58       0        0    0
##   35                      58       0        0    0
##   36                      33       0        0    0
##   37                      46       0        0    0
##   38                      45       0        0    0
##   39                      45       0        0    0
##   40                      32       0        0    0
##   41                      34       0        0    0
##   42                      26       0        0    0
##   43                      31       0        0    0
##   44                      24       0        0    0
##   45                      27       0        0    0
##   46                      25       0        0    0
##   47                      16       0        0    0
##   48                      21       0        0    0
##   49                      15       0        0    0
##   50                      12       0        0    0
##   51                       0      13        0    0
##   52                       0       7        0    0
##   53                       0       4        0    0
##   54                       0       6        0    0
##   55                       0       9        0    0
##   56                       0       7        0    0
##   57                       0       9        0    0
##   58                       0       6        0    0
##   59                       0       5        0    0
##   60                       0       4        0    0
##   61                       0       2        0    0
##   62                       0       1        0    0
##   63                       0       5        0    0
##   64                       0       1        0    0
##   65                       0       5        0    0
##   66                       0       3        0    0
##   67                       0       2        0    0
##   68                       0       1        0    0
##   69                       0       3        0    0
##   70                       0       1        0    0
##   72                       0       0        1    0
##   73                       0       0        3    0
##   76                       0       0        1    0
##   84                       0       0        1    0
##   &lt;NA&gt;                     0       0        0  107</code></pre>
<p><strong>Re-etiquetado de los valores <code>NA</code></strong></p>
<p>Puedes asignar a los valores <code>NA</code> una etiqueta como “Missing”. Como la nueva columna es del tipo Factor (valores restringidos), no puedes simplemente mutarla con <code>replace_na()</code>, ya que este valor será rechazado. En su lugar, utilice <code>fct_explicit_na()</code> de <strong>forcats</strong> como se explica en la página de <a href="factors.html#factors">Factores</a>.</p>
<div class="sourceCode" id="cb274"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  
  <span class="co"># cut() creates age_cat, automatically of class Factor      </span>
  <span class="fu">mutate</span><span class="op">(</span>age_cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span>
    <span class="va">age_years</span>,
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">70</span>, <span class="fl">100</span><span class="op">)</span>,          
    right <span class="op">=</span> <span class="cn">FALSE</span>,
    include.lowest <span class="op">=</span> <span class="cn">TRUE</span>,        
    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0-4"</span>, <span class="st">"5-9"</span>, <span class="st">"10-14"</span>, <span class="st">"15-19"</span>, <span class="st">"20-29"</span>, <span class="st">"30-49"</span>, <span class="st">"50-69"</span>, <span class="st">"70-100"</span><span class="op">)</span><span class="op">)</span>,
         
    <span class="co"># make missing values explicit</span>
    age_cat <span class="op">=</span> <span class="fu">fct_explicit_na</span><span class="op">(</span>
      <span class="va">age_cat</span>,
      na_level <span class="op">=</span> <span class="st">"Missing age"</span><span class="op">)</span>  <span class="co"># you can specify the label</span>
  <span class="op">)</span>    

<span class="co"># table to view counts</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_cat</span>, useNA <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##         0-4         5-9       10-14       15-19 
##        1227        1223        1048         827 
##       20-29       30-49       50-69      70-100 
##        1216         848         105           7 
## Missing age        &lt;NA&gt; 
##         107           0</code></pre>
<p><strong>Realiza rápidamente pausas y etiquetas</strong></p>
<p>Para una forma rápida de hacer rupturas y etiquetar vectores, utiliza algo como lo siguiente. Consulta la página de <a href="r-basics.html#r-basics">fundamentos de R</a> para obtener referencias sobre <code><a href="https://rdrr.io/r/base/seq.html">seq()</a></code> y <code><a href="https://rdrr.io/r/base/rep.html">rep()</a></code>.</p>
<div class="sourceCode" id="cb276"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make break points from 0 to 90 by 5</span>
<span class="va">age_seq</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">90</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="va">age_seq</span>

<span class="co"># Make labels for the above categories, assuming default cut() settings</span>
<span class="va">age_labels</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">age_seq</span> <span class="op">+</span> <span class="fl">1</span>, <span class="st">"-"</span>, <span class="va">age_seq</span> <span class="op">+</span> <span class="fl">5</span><span class="op">)</span>
<span class="va">age_labels</span>

<span class="co"># check that both vectors are the same length</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">age_seq</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">age_labels</span><span class="op">)</span></code></pre></div>
<p>Lee más sobre <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> en la página de ayuda escribiendo <code><a href="https://rdrr.io/r/base/cut.html">?cut</a></code> en la consola de R.</p>
</div>
<div id="roturas-cuartílicas" class="section level3 unnumbered">
<h3>Roturas cuartílicas<a class="anchor" aria-label="anchor" href="#roturas-cuart%C3%ADlicas"><i class="fas fa-link"></i></a>
</h3>
<p>En el entendimiento común, los “cuartiles” o “percentiles” suelen referirse a un valor por debajo del cual cae una proporción de valores. Por ejemplo, el percentil 95 de las edades en <code>linelist</code> sería la edad por debajo de la cual cae el 95% de las edades.</p>
<p>Sin embargo, en el lenguaje común, “cuartiles” y “deciles” también pueden referirse a los <em>grupos de datos</em> divididos por igual en 4 o 10 grupos (Ten en cuenta que habrá un punto de ruptura más que un grupo).</p>
<p>Para obtener los puntos de ruptura de los cuartiles, se puede utilizar <code><a href="https://rdrr.io/r/stats/quantile.html">quantile()</a></code> del paquete <strong>stats</strong> de R <strong>base.</strong> Se proporciona un vector numérico (por ejemplo, una columna en unos datos) y un vector de valores de probabilidad numérica que van de 0 a 1,0. Los puntos de ruptura se devuelven como un vector numérico. Explore los detalles de las metodologías estadísticas escribiendo <code>?quantile.</code></p>
<ul>
<li>Si su vector numérico de entrada tiene valores faltantes, es mejor establecer <code>na.rm = TRUE</code>
</li>
<li>Establecer <code>names = FALSE</code> para obtener un vector numérico sin nombre</li>
</ul>
<div class="sourceCode" id="cb277"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">age_years</span>,               <span class="co"># specify numeric vector to work on</span>
  probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.25</span>, <span class="fl">.50</span>, <span class="fl">.75</span>, <span class="fl">.90</span>, <span class="fl">.95</span><span class="op">)</span>,   <span class="co"># specify the percentiles you want</span>
  na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>                            <span class="co"># ignore missing values </span></code></pre></div>
<pre><code>##  0% 25% 50% 75% 90% 95% 
##   0   6  13  23  33  41</code></pre>
<p>Puedes utilizar los resultados de <code><a href="https://rdrr.io/r/stats/quantile.html">quantile()</a></code> como puntos de ruptura en <code>age_categories()</code> o <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code>. A continuación creamos una nueva columna <code>deciles</code> utilizando <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> donde los puntos de ruptura se definen utilizando <code>quantiles()</code> en <code>age_years</code>. A continuación, mostramos los resultados utilizando <code>tabyl()</code> de <strong>janitor</strong> para que puedas ver los porcentajes (véase la página de <a href="descriptive-tables.html#descriptive-tables">tablas descriptivas</a>). Observa cómo no son exactamente el 10% en cada grupo.</p>
<div class="sourceCode" id="cb279"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span>                                <span class="co"># begin with linelist</span>
  <span class="fu">mutate</span><span class="op">(</span>deciles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">age_years</span>,           <span class="co"># create new column decile as cut() on column age_years</span>
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span>                      <span class="co"># define cut breaks using quantile()</span>
      <span class="va">age_years</span>,                               <span class="co"># operate on age_years</span>
      probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,             <span class="co"># 0.0 to 1.0 by 0.1</span>
      na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,                           <span class="co"># ignore missing values</span>
    include.lowest <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>             <span class="co"># for cut() include age 0</span>
  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/tabyl.html">tabyl</a></span><span class="op">(</span><span class="va">deciles</span><span class="op">)</span>                   <span class="co"># pipe to table to display</span></code></pre></div>
<pre><code>##  deciles   n    percent valid_percent
##    [0,2] 748 0.11319613    0.11505922
##    (2,5] 721 0.10911017    0.11090601
##    (5,7] 497 0.07521186    0.07644978
##   (7,10] 698 0.10562954    0.10736810
##  (10,13] 635 0.09609564    0.09767728
##  (13,17] 755 0.11425545    0.11613598
##  (17,21] 578 0.08746973    0.08890940
##  (21,26] 625 0.09458232    0.09613906
##  (26,33] 596 0.09019370    0.09167820
##  (33,84] 648 0.09806295    0.09967697
##     &lt;NA&gt; 107 0.01619249            NA</code></pre>
</div>
<div id="grupos-de-tamaño-uniforme" class="section level3 unnumbered">
<h3>Grupos de tamaño uniforme<a class="anchor" aria-label="anchor" href="#grupos-de-tama%C3%B1o-uniforme"><i class="fas fa-link"></i></a>
</h3>
<p>Otra herramienta para hacer grupos numéricos es la función <code>ntile()</code> de <strong>dplyr</strong>, que intenta dividir los datos en n <em>grupos de tamaño uniforme -</em> pero ten en cuenta que, a diferencia de <em>quantile(),</em> el mismo valor podría aparecer en más de un grupo<em>.</em> Proporcione el vector numérico y luego el número de grupos. Los valores de la nueva columna creada son sólo “números” de grupo (por ejemplo, del 1 al 10), no el rango de valores en sí mismo como cuando se utiliza <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code>.</p>
<div class="sourceCode" id="cb281"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># make groups with ntile()</span>
<span class="va">ntile_data</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>even_groups <span class="op">=</span> <span class="fu">ntile</span><span class="op">(</span><span class="va">age_years</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>

<span class="co"># make table of counts and proportions by group</span>
<span class="va">ntile_table</span> <span class="op">&lt;-</span> <span class="va">ntile_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/tabyl.html">tabyl</a></span><span class="op">(</span><span class="va">even_groups</span><span class="op">)</span>
  
<span class="co"># attach min/max values to demonstrate ranges</span>
<span class="va">ntile_ranges</span> <span class="op">&lt;-</span> <span class="va">ntile_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">even_groups</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarise</span><span class="op">(</span>
    min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">age_years</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,
    max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">age_years</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<pre><code>## Warning in min(age_years, na.rm = T): no non-missing
## arguments to min; returning Inf</code></pre>
<pre><code>## Warning in max(age_years, na.rm = T): no non-missing
## arguments to max; returning -Inf</code></pre>
<div class="sourceCode" id="cb284"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># combine and print - note that values are present in multiple groups</span>
<span class="fu">left_join</span><span class="op">(</span><span class="va">ntile_table</span>, <span class="va">ntile_ranges</span>, by <span class="op">=</span> <span class="st">"even_groups"</span><span class="op">)</span></code></pre></div>
<pre><code>##  even_groups   n    percent valid_percent min  max
##            1 651 0.09851695    0.10013844   0    2
##            2 650 0.09836562    0.09998462   2    5
##            3 650 0.09836562    0.09998462   5    7
##            4 650 0.09836562    0.09998462   7   10
##            5 650 0.09836562    0.09998462  10   13
##            6 650 0.09836562    0.09998462  13   17
##            7 650 0.09836562    0.09998462  17   21
##            8 650 0.09836562    0.09998462  21   26
##            9 650 0.09836562    0.09998462  26   33
##           10 650 0.09836562    0.09998462  33   84
##           NA 107 0.01619249            NA Inf -Inf</code></pre>
<!-- ======================================================= -->
</div>
<div id="case_when" class="section level3 unnumbered">
<h3>
<code>case_when()</code><a class="anchor" aria-label="anchor" href="#case_when"><i class="fas fa-link"></i></a>
</h3>
<p>Es posible utilizar la función <code>case_when()</code> de <strong>dplyr</strong> para crear categorías a partir de una columna numérica, pero es más fácil utilizar <code>age_categories()</code> de <strong>epikit</strong> o <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> porque éstas crearán un factor ordenado automáticamente.</p>
<p>Si utilizas <code>case_when()</code>, por favor, revise el uso adecuado como se ha descrito anteriormente en la sección Re-codificar valores de esta página. También Ten en cuenta que todos los valores del lado derecho deben ser del mismo tipo. Por lo tanto, si quiere <code>NA</code> en el lado derecho debes escribir “Missing” o utilizar el valor especial <code>NA_character_</code>.</p>
</div>
<div id="añadir-a-la-cadena-de-tuberías-3" class="section level3 unnumbered">
<h3>Añadir a la cadena de tuberías<a class="anchor" aria-label="anchor" href="#a%C3%B1adir-a-la-cadena-de-tuber%C3%ADas-3"><i class="fas fa-link"></i></a>
</h3>
<p>A continuación, se añade el código para crear dos columnas categóricas de edad a la cadena de tuberías de limpieza:</p>
<div class="sourceCode" id="cb286"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># CLEANING 'PIPE' CHAIN (starts with raw data and pipes it through cleaning steps)</span>
<span class="co">##################################################################################</span>

<span class="co"># begin cleaning pipe chain</span>
<span class="co">###########################</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op">%&gt;%</span>
    
    <span class="co"># standardize column name syntax</span>
    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># manually re-name columns</span>
           <span class="co"># NEW name             # OLD name</span>
    <span class="fu">rename</span><span class="op">(</span>date_infection       <span class="op">=</span> <span class="va">infection_date</span>,
           date_hospitalisation <span class="op">=</span> <span class="va">hosp_date</span>,
           date_outcome         <span class="op">=</span> <span class="va">date_of_outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># remove column</span>
    <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">row_num</span>, <span class="va">merged_header</span>, <span class="va">x28</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
    <span class="co"># de-duplicate</span>
    <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 

    <span class="co"># add column</span>
    <span class="fu">mutate</span><span class="op">(</span>bmi <span class="op">=</span> <span class="va">wt_kg</span> <span class="op">/</span> <span class="op">(</span><span class="va">ht_cm</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>     

    <span class="co"># convert class of columns</span>
    <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">contains</span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span>, <span class="va">as.Date</span><span class="op">)</span>, 
           generation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">generation</span><span class="op">)</span>,
           age        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># add column: delay to hospitalisation</span>
    <span class="fu">mutate</span><span class="op">(</span>days_onset_hosp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">date_hospitalisation</span> <span class="op">-</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># clean values of hospital column</span>
    <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span><span class="va">hospital</span>,
                      <span class="co"># OLD = NEW</span>
                      <span class="st">"Mitylira Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Mitylira Hospital"</span> <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Military Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Port Hopital"</span>      <span class="op">=</span> <span class="st">"Port Hospital"</span>,
                      <span class="st">"Central Hopital"</span>   <span class="op">=</span> <span class="st">"Central Hospital"</span>,
                      <span class="st">"other"</span>             <span class="op">=</span> <span class="st">"Other"</span>,
                      <span class="st">"St. Marks Maternity Hopital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span>
                      <span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 

    <span class="co"># create age_years column (from age and age_unit)</span>
    <span class="fu">mutate</span><span class="op">(</span>age_years <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span>
          <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"years"</span> <span class="op">~</span> <span class="va">age</span>,
          <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"months"</span> <span class="op">~</span> <span class="va">age</span><span class="op">/</span><span class="fl">12</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">age_unit</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span>,
          <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_real_</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
    <span class="co"># ABOVE ARE UPSTREAM CLEANING STEPS ALREADY DISCUSSED</span>
    <span class="co">###################################################   </span>
    <span class="fu">mutate</span><span class="op">(</span>
          <span class="co"># age categories: custom</span>
          age_cat <span class="op">=</span> <span class="fu">epikit</span><span class="fu">::</span><span class="fu"><a href="https://r4epi.github.io/epikit/reference/age_categories.html">age_categories</a></span><span class="op">(</span><span class="va">age_years</span>, breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">70</span><span class="op">)</span><span class="op">)</span>,
        
          <span class="co"># age categories: 0 to 85 by 5s</span>
          age_cat5 <span class="op">=</span> <span class="fu">epikit</span><span class="fu">::</span><span class="fu"><a href="https://r4epi.github.io/epikit/reference/age_categories.html">age_categories</a></span><span class="op">(</span><span class="va">age_years</span>, breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">85</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="add-rows" class="section level2" number="8.10">
<h2>
<span class="header-section-number">8.10</span> Añadir filas<a class="anchor" aria-label="anchor" href="#add-rows"><i class="fas fa-link"></i></a>
</h2>
<div id="uno-a-uno" class="section level3 unnumbered">
<h3>Uno a uno<a class="anchor" aria-label="anchor" href="#uno-a-uno"><i class="fas fa-link"></i></a>
</h3>
<p>Añadir filas una a una manualmente es tedioso pero puede hacerse con <code>add_row()</code> de <strong>dplyr</strong>. Recuerda que cada columna debe contener valores de un solo tipo (ya sea carácter, numérico, lógico, etc.). Así que añadir una fila requiere matizar para mantener esto.</p>
<div class="sourceCode" id="cb287"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">add_row</span><span class="op">(</span>row_num <span class="op">=</span> <span class="fl">666</span>,
          case_id <span class="op">=</span> <span class="st">"abc"</span>,
          generation <span class="op">=</span> <span class="fl">4</span>,
          `infection date` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2020-10-10"</span><span class="op">)</span>,
          .before <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>Utiliza <code>.before</code> y <code>.after</code>. para especificar la ubicación de la fila que deseas añadir. <code>.before = 3</code> pondrá la nueva fila antes de la tercera fila actual. El comportamiento por defecto es añadir la fila al final. Las columnas no especificadas se dejarán vacías (<code>NA</code>).</p>
<p>El nuevo <em>número de fila</em> puede parecer extraño (“…23”) pero los números de fila de las filas preexistentes <em>han</em> cambiado. Por lo tanto, si utiliza el comando dos veces, examine/pruebe la inserción cuidadosamente.</p>
<p>Si uno de los tipos que proporcionas está desactivado, verás un error como este:</p>
<pre><code>Error: Can't combine ..1$infection date &lt;date&gt; and ..2$infection date &lt;character&gt;.</code></pre>
<p>(al insertar una fila con un valor de fecha, recuerde envolver la fecha en la función <code><a href="https://rdrr.io/r/base/as.Date.html">as.Date()</a></code> como <code><a href="https://rdrr.io/r/base/as.Date.html">as.Date("2020-10-10")</a></code>).</p>
</div>
<div id="unir-filas" class="section level3 unnumbered">
<h3>Unir filas<a class="anchor" aria-label="anchor" href="#unir-filas"><i class="fas fa-link"></i></a>
</h3>
<p>Para combinar conjuntos de datos uniendo las filas de un dataframe al final de otro dataframe, puedes utilizar <code>bind_rows()</code> de <strong>dplyr</strong>. Esto se explica con más detalle en la página <a href="joining-data.html#joining-data">Unir datos</a>.</p>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
<div id="filter-rows" class="section level2" number="8.11">
<h2>
<span class="header-section-number">8.11</span> Filtrar filas<a class="anchor" aria-label="anchor" href="#filter-rows"><i class="fas fa-link"></i></a>
</h2>
<p>Un paso típico de limpieza después de haber limpiado las columnas y recodificado los valores es <em>filtrar</em> el dataframe para filas específicas usando el verbo <strong>dplyr</strong> <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code>.</p>
<p>Dentro de <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code>, especifique la lógica que debe ser <code>TRUE</code> para que se mantenga una fila en los datos. A continuación, mostramos cómo filtrar filas basándose en condiciones lógicas simples y complejas.</p>
<!-- ======================================================= -->
<div id="filtro-simple" class="section level3 unnumbered">
<h3>Filtro simple<a class="anchor" aria-label="anchor" href="#filtro-simple"><i class="fas fa-link"></i></a>
</h3>
<p>Este sencillo ejemplo redefine el dataframe <code>linelist</code> en sí mismo, habiendo filtrado las filas para que cumplan una condición lógica. <strong>Sólo se conservan las filas en las que la declaración lógica dentro de los paréntesis se evalúa como TRUE.</strong></p>
<p>En este ejemplo, la sentencia lógica es <code>gender == "f"</code>, que pregunta si el valor de la columna <code>gender</code> es igual a “f” (distingue entre mayúsculas y minúsculas).</p>
<p>Antes de aplicar el filtro, el número de filas de <code>linelist</code> es <code><a href="https://rdrr.io/r/base/nrow.html">nrow(linelist)</a></code>.</p>
<div class="sourceCode" id="cb289"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">gender</span> <span class="op">==</span> <span class="st">"f"</span><span class="op">)</span>   <span class="co"># keep only rows where gender is equal to "f"</span></code></pre></div>
<p>Después de aplicar el filtro, el número de filas de <code>linelist</code> is <code>linelist %&gt;% filter(gender == "f") %&gt;% nrow()</code>.</p>
</div>
<div id="filtrar-los-valores-faltantes" class="section level3 unnumbered">
<h3>Filtrar los valores faltantes<a class="anchor" aria-label="anchor" href="#filtrar-los-valores-faltantes"><i class="fas fa-link"></i></a>
</h3>
<p>Es bastante común querer filtrar las filas que tienen valores faltantes. Resiste la tentación de escribir <code><a href="https://rdrr.io/r/stats/filter.html">filter(!is.na(column) &amp; !is.na(column))</a></code> y utiliza en su lugar la función de tidyr que está hecha a medida para este propósito: drop_na(). Si se ejecuta con paréntesis vacíos, elimina las filas con <em>cualquier</em> valor que falte. Como alternativa, puedes proporcionar los nombres de las columnas específicas que deben evaluarse para comprobar si faltan, o utilizar las funciones de ayuda “tidyselect” descritas <a href="cleaning-data-and-core-functions.html#clean_tidyselect">anteriormente</a>.</p>
<div class="sourceCode" id="cb290"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="fu">drop_na</span><span class="op">(</span><span class="va">case_id</span>, <span class="va">age_years</span><span class="op">)</span>  <span class="co"># drop rows with missing values for case_id or age_years</span></code></pre></div>
<p>Consulta la página sobre <a href="missing-data.html#missing-data">Valores faltantes</a> para conocer muchas técnicas para analizar y gestionar los datos ausentes.</p>
</div>
<div id="filtrar-por-número-de-fila" class="section level3 unnumbered">
<h3>Filtrar por número de fila<a class="anchor" aria-label="anchor" href="#filtrar-por-n%C3%BAmero-de-fila"><i class="fas fa-link"></i></a>
</h3>
<p>En un dataframe o tibble, cada fila suele tener un “número de fila” que (cuando se ve en R Viewer) aparece a la izquierda de la primera columna. No es en sí misma una columna real en los datos, pero puede utilizarse en una sentencia <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code>.</p>
<p>Para filtrar en base al “número de fila”, puedes utilizar la función <code>row_number()</code> de <strong>dplyr</strong> con paréntesis abiertos como parte de una sentencia lógica de filtrado. A menudo se utiliza el operador <code><a href="https://rdrr.io/r/base/match.html">%in%</a></code> y un rango de números como parte de esa sentencia lógica, como se muestra a continuación. Para ver las <em>primeras</em> N filas, también puedes utilizar la función especial <code><a href="https://rdrr.io/r/utils/head.html">head()</a></code> de <strong>dplyr</strong>.</p>
<div class="sourceCode" id="cb291"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># View first 100 rows</span>
<span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>     <span class="co"># or use tail() to see the n last rows</span>

<span class="co"># Show row 5 only</span>
<span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">row_number</span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span>

<span class="co"># View rows 2 through 20, and three specific columns</span>
<span class="va">linelist</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">row_number</span><span class="op">(</span><span class="op">)</span> <span class="op">%in%</span> <span class="fl">2</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">date_onset</span>, <span class="va">outcome</span>, <span class="va">age</span><span class="op">)</span></code></pre></div>
<p>También puedes convertir los números de fila en una verdadera columna pasando su dataframe a la función <code>rownames_to_column()</code> de <strong>tibble</strong> (no escribas nada en los paréntesis).</p>
<!-- ======================================================= -->
</div>
<div id="filtro-complejo" class="section level3 unnumbered">
<h3>Filtro complejo<a class="anchor" aria-label="anchor" href="#filtro-complejo"><i class="fas fa-link"></i></a>
</h3>
<p>Se pueden construir sentencias lógicas más complejas utilizando paréntesis <code>( )</code>, OR <code><a href="https://rdrr.io/r/base/Logic.html">|</a></code>, negación <code><a href="https://rdrr.io/r/base/Logic.html">!</a></code> , <code><a href="https://rdrr.io/r/base/match.html">%in%</a></code>, y operadores AND <code><a href="https://rdrr.io/r/base/Logic.html">&amp;</a></code>. Un ejemplo es el siguiente:</p>
<p>Nota: Puedes utilizar el operador <code><a href="https://rdrr.io/r/base/Logic.html">!</a></code> delante de un criterio lógico para negarlo. Por ejemplo, <code>!is.na(column)</code> se evalúa como verdadero si el valor de la columna <em>no</em> falta. Del mismo modo, <code>!column %in% c("a", "b", "c")</code> es verdadero si el valor de la columna <em>no está</em> en el vector.</p>
<div id="examinar-los-datos" class="section level4 unnumbered">
<h4>Examinar los datos<a class="anchor" aria-label="anchor" href="#examinar-los-datos"><i class="fas fa-link"></i></a>
</h4>
<p>A continuación, se muestra un sencillo comando de una línea para crear un histograma de las fechas de inicio. Vea que un segundo brote más pequeño de 2012-2013 también está incluido en este conjunto de datos sin procesar. <strong>Para nuestros análisis, queremos eliminar las entradas de este brote anterior.</strong></p>
<div class="sourceCode" id="cb292"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span>, breaks <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="_main_files/figure-html/unnamed-chunk-234-1.png" width="50%"></div>
</div>
<div id="cómo-manejan-los-filtros-los-valores-numéricos-y-de-fecha-que-faltan" class="section level4 unnumbered">
<h4>¿Cómo manejan los filtros los valores numéricos y de fecha que faltan?<a class="anchor" aria-label="anchor" href="#c%C3%B3mo-manejan-los-filtros-los-valores-num%C3%A9ricos-y-de-fecha-que-faltan"><i class="fas fa-link"></i></a>
</h4>
<p>¿Podemos simplemente filtrar por <code>date_onset</code> a las filas posteriores a junio de 2013? <strong>Precaución. La aplicación del código <code><a href="https://rdrr.io/r/stats/filter.html">filter(date_onset &gt; as.Date("2013-06-01"))</a></code> eliminaría todas las filas de la epidemia posterior con una fecha de inicio ausente!</strong></p>
<p><span style="color: red;"><strong><em>PELIGRO:</em></strong> Filtrar a mayor que (&gt;) o menor que (&lt;) una fecha o número puede eliminar cualquier fila con valores faltantes (<code>NA</code>). Esto se debe a que <code>NA</code> es tratado como infinitamente grande y pequeño. </span></p>
<p><em>(Consulta la página sobre el <a href="working-with-dates.html#working-with-dates">trabajando con fechas</a> para obtener más información sobre el trabajo con fechas y el paquete <strong>lubridate</strong>)</em></p>
</div>
<div id="diseñar-el-filtro" class="section level4 unnumbered">
<h4>Diseñar el filtro<a class="anchor" aria-label="anchor" href="#dise%C3%B1ar-el-filtro"><i class="fas fa-link"></i></a>
</h4>
<p>Examina una tabulación cruzada para asegurarte de que excluimos sólo las filas correctas:</p>
<div class="sourceCode" id="cb293"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span>Hospital  <span class="op">=</span> <span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span>,                     <span class="co"># hospital name</span>
      YearOnset <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span><span class="op">)</span>,  <span class="co"># year of date_onset</span>
      useNA     <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span>                              <span class="co"># show missing values</span></code></pre></div>
<pre><code>##                                       YearOnset
## Hospital                               2012 2013 2014
##   Central Hospital                        0    0  351
##   Hospital A                            229   46    0
##   Hospital B                            227   47    0
##   Military Hospital                       0    0  676
##   Missing                                 0    0 1117
##   Other                                   0    0  684
##   Port Hospital                           9    1 1372
##   St. Mark's Maternity Hospital (SMMH)    0    0  322
##   &lt;NA&gt;                                    0    0    0
##                                       YearOnset
## Hospital                               2015 &lt;NA&gt;
##   Central Hospital                       99   18
##   Hospital A                              0   15
##   Hospital B                              0   15
##   Military Hospital                     200   34
##   Missing                               318   77
##   Other                                 177   46
##   Port Hospital                         347   75
##   St. Mark's Maternity Hospital (SMMH)   93   13
##   &lt;NA&gt;                                    0    0</code></pre>
<p>¿Qué otros criterios podemos filtrar para eliminar el primer brote (en 2012 y 2013) de los datos? Vemos que:</p>
<ul>
<li>La primera epidemia en 2012 y 2013 ocurrió en el Hospital A, el Hospital B, y que también hubo 10 casos en el Hospital del Puerto.</li>
<li>Los hospitales A y B <em>no</em> tuvieron casos en la segunda epidemia, pero Port Hospital sí.</li>
</ul>
<p>Queremos excluir:</p>
<ul>
<li>Las filas con inicio en 2012 y 2013 en cualquiera de los hospitales A, B o Port <code><a href="https://rdrr.io/r/base/nrow.html">nrow(linelist %&gt;% filter(hospital %in% c("Hospital A", "Hospital B") | date_onset &lt; as.Date("2013-06-01")))</a></code> :
<ul>
<li>Excluir <code><a href="https://rdrr.io/r/base/nrow.html">nrow(linelist %&gt;% filter(date_onset &lt; as.Date("2013-06-01")))</a></code> filas con inicio en 2012 y 2013 * Excluir <code><a href="https://rdrr.io/r/base/nrow.html">nrow(linelist %&gt;% filter(hospital %in% c('Hospital A', 'Hospital B') &amp; is.na(date_onset)))</a></code> filas de los hospitales A y B con fechas de inicio ausentes<br>
</li>
<li>
<strong>No</strong> excluir <code><a href="https://rdrr.io/r/base/nrow.html">nrow(linelist %&gt;% filter(!hospital %in% c('Hospital A', 'Hospital B') &amp; is.na(date_onset)))</a></code> otras filas con fechas de inicio ausentes.</li>
</ul>
</li>
</ul>
<p>Comenzamos con un listado de <code><a href="https://rdrr.io/r/base/nrow.html">nrow(linelist)</a></code>. Aquí está nuestro filtro:</p>
<div class="sourceCode" id="cb295"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span> <span class="op">%&gt;%</span> 
  <span class="co"># keep rows where onset is after 1 June 2013 OR where onset is missing and it was a hospital OTHER than Hospital A or B</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">date_onset</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2013-06-01"</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">hospital</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Hospital A"</span>, <span class="st">"Hospital B"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 6019</code></pre>
<p>Cuando volvemos a hacer la tabulación cruzada, vemos que los hospitales A y B se eliminan por completo, y los 10 casos del Port Hospital de 2012 y 2013 se eliminan, y todos los demás valores son los mismos, tal y como queríamos.</p>
<div class="sourceCode" id="cb297"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span>Hospital  <span class="op">=</span> <span class="va">linelist</span><span class="op">$</span><span class="va">hospital</span>,                     <span class="co"># hospital name</span>
      YearOnset <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">$</span><span class="va">date_onset</span><span class="op">)</span>,  <span class="co"># year of date_onset</span>
      useNA     <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span>                              <span class="co"># show missing values</span></code></pre></div>
<pre><code>##                                       YearOnset
## Hospital                               2014 2015 &lt;NA&gt;
##   Central Hospital                      351   99   18
##   Military Hospital                     676  200   34
##   Missing                              1117  318   77
##   Other                                 684  177   46
##   Port Hospital                        1372  347   75
##   St. Mark's Maternity Hospital (SMMH)  322   93   13
##   &lt;NA&gt;                                    0    0    0</code></pre>
<p>Se pueden incluir varias sentencias dentro de un comando de filtrado (separadas por comas), o siempre se puede canalizar a un comando <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> separado para mayor claridad.</p>
<p><em>Nota: algunos lectores pueden notar que sería más fácil filtrar sólo por date_hospitalisation porque es 100% completo sin valores faltantes. Esto es cierto. Pero date_onset se utiliza para demostrar un filtro complejo.</em></p>
</div>
</div>
<div id="independiente-1" class="section level3 unnumbered">
<h3>Independiente<a class="anchor" aria-label="anchor" href="#independiente-1"><i class="fas fa-link"></i></a>
</h3>
<p>El filtrado también puede realizarse como un comando independiente (no como parte de una cadena de tuberías). Como otros verbos de <strong>dplyr</strong>, en este caso el primer argumento debe ser el propio conjunto de datos.</p>
<div class="sourceCode" id="cb299"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># dataframe &lt;- filter(dataframe, condition(s) for rows to keep)</span>

<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">linelist</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">case_id</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>También puedes utilizar R <strong>base</strong> para hacer un subconjunto utilizando corchetes que reflejen las [filas, columnas] que deseas conservar.</p>
<div class="sourceCode" id="cb300"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># dataframe &lt;- dataframe[row conditions, column conditions] (blank means keep all)</span>

<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">case_id</span><span class="op">)</span>, <span class="op">]</span></code></pre></div>
</div>
<div id="revisar-rápidamente-los-registros" class="section level3 unnumbered">
<h3>Revisar rápidamente los registros<a class="anchor" aria-label="anchor" href="#revisar-r%C3%A1pidamente-los-registros"><i class="fas fa-link"></i></a>
</h3>
<p>A menudo se quiere revisar rápidamente unos pocos registros, para sólo unas pocas columnas. La función View() de R <strong>base</strong> imprimirá un dataframe para su visualización en su RStudio.</p>
<p>Mira el listado en RStudio:</p>
<div class="sourceCode" id="cb301"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">)</span></code></pre></div>
<p>Aquí hay dos ejemplos de visualización de celdas específicas (filas específicas y columnas específicas):</p>
<p><strong>Con las funciones <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> y <code>select()</code> de dplyr :</strong></p>
<p>Dentro de <code><a href="https://rdrr.io/r/utils/View.html">View()</a></code>, canaliza los datos a <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> para mantener ciertas filas, y luego a <code>select()</code> para mantener ciertas columnas. Por ejemplo, para revisar las fechas de inicio y hospitalización de 3 casos específicos:</p>
<div class="sourceCode" id="cb302"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op">(</span><span class="va">linelist</span> <span class="op">%&gt;%</span>
       <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">case_id</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"11f8ea"</span>, <span class="st">"76b97a"</span>, <span class="st">"47a5f5"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
       <span class="fu">select</span><span class="op">(</span><span class="va">date_onset</span>, <span class="va">date_hospitalisation</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Puedes lograr lo mismo con la sintaxis de R <strong>base</strong>, utilizando los corchetes <code>[ ]</code> para el subconjunto que deseas ver.</p>
<div class="sourceCode" id="cb303"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op">(</span><span class="va">linelist</span><span class="op">[</span><span class="va">linelist</span><span class="op">$</span><span class="va">case_id</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"11f8ea"</span>, <span class="st">"76b97a"</span>, <span class="st">"47a5f5"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"date_onset"</span>, <span class="st">"date_hospitalisation"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<div id="añadir-a-la-cadena-de-pipes" class="section level4 unnumbered">
<h4>Añadir a la cadena de pipes<a class="anchor" aria-label="anchor" href="#a%C3%B1adir-a-la-cadena-de-pipes"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb304"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># CLEANING 'PIPE' CHAIN (starts with raw data and pipes it through cleaning steps)</span>
<span class="co">##################################################################################</span>

<span class="co"># begin cleaning pipe chain</span>
<span class="co">###########################</span>
<span class="va">linelist</span> <span class="op">&lt;-</span> <span class="va">linelist_raw</span> <span class="op">%&gt;%</span>
    
    <span class="co"># standardize column name syntax</span>
    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># manually re-name columns</span>
           <span class="co"># NEW name             # OLD name</span>
    <span class="fu">rename</span><span class="op">(</span>date_infection       <span class="op">=</span> <span class="va">infection_date</span>,
           date_hospitalisation <span class="op">=</span> <span class="va">hosp_date</span>,
           date_outcome         <span class="op">=</span> <span class="va">date_of_outcome</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># remove column</span>
    <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">row_num</span>, <span class="va">merged_header</span>, <span class="va">x28</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
    <span class="co"># de-duplicate</span>
    <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 

    <span class="co"># add column</span>
    <span class="fu">mutate</span><span class="op">(</span>bmi <span class="op">=</span> <span class="va">wt_kg</span> <span class="op">/</span> <span class="op">(</span><span class="va">ht_cm</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>     

    <span class="co"># convert class of columns</span>
    <span class="fu">mutate</span><span class="op">(</span><span class="fu">across</span><span class="op">(</span><span class="fu">contains</span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span>, <span class="va">as.Date</span><span class="op">)</span>, 
           generation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">generation</span><span class="op">)</span>,
           age        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># add column: delay to hospitalisation</span>
    <span class="fu">mutate</span><span class="op">(</span>days_onset_hosp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">date_hospitalisation</span> <span class="op">-</span> <span class="va">date_onset</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># clean values of hospital column</span>
    <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span><span class="va">hospital</span>,
                      <span class="co"># OLD = NEW</span>
                      <span class="st">"Mitylira Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Mitylira Hospital"</span> <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Military Hopital"</span>  <span class="op">=</span> <span class="st">"Military Hospital"</span>,
                      <span class="st">"Port Hopital"</span>      <span class="op">=</span> <span class="st">"Port Hospital"</span>,
                      <span class="st">"Central Hopital"</span>   <span class="op">=</span> <span class="st">"Central Hospital"</span>,
                      <span class="st">"other"</span>             <span class="op">=</span> <span class="st">"Other"</span>,
                      <span class="st">"St. Marks Maternity Hopital (SMMH)"</span> <span class="op">=</span> <span class="st">"St. Mark's Maternity Hospital (SMMH)"</span>
                      <span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="fu">mutate</span><span class="op">(</span>hospital <span class="op">=</span> <span class="fu">replace_na</span><span class="op">(</span><span class="va">hospital</span>, <span class="st">"Missing"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 

    <span class="co"># create age_years column (from age and age_unit)</span>
    <span class="fu">mutate</span><span class="op">(</span>age_years <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span>
          <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"years"</span> <span class="op">~</span> <span class="va">age</span>,
          <span class="va">age_unit</span> <span class="op">==</span> <span class="st">"months"</span> <span class="op">~</span> <span class="va">age</span><span class="op">/</span><span class="fl">12</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">age_unit</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span>,
          <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_real_</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  
    <span class="fu">mutate</span><span class="op">(</span>
          <span class="co"># age categories: custom</span>
          age_cat <span class="op">=</span> <span class="fu">epikit</span><span class="fu">::</span><span class="fu"><a href="https://r4epi.github.io/epikit/reference/age_categories.html">age_categories</a></span><span class="op">(</span><span class="va">age_years</span>, breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">70</span><span class="op">)</span><span class="op">)</span>,
        
          <span class="co"># age categories: 0 to 85 by 5s</span>
          age_cat5 <span class="op">=</span> <span class="fu">epikit</span><span class="fu">::</span><span class="fu"><a href="https://r4epi.github.io/epikit/reference/age_categories.html">age_categories</a></span><span class="op">(</span><span class="va">age_years</span>, breakers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">85</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    
    <span class="co"># ABOVE ARE UPSTREAM CLEANING STEPS ALREADY DISCUSSED</span>
    <span class="co">###################################################</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span>
          <span class="co"># keep only rows where case_id is not missing</span>
          <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">case_id</span><span class="op">)</span>,  
          
          <span class="co"># also filter to keep only the second outbreak</span>
          <span class="va">date_onset</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2013-06-01"</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">hospital</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Hospital A"</span>, <span class="st">"Hospital B"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="row-wise-calculations" class="section level2" number="8.12">
<h2>
<span class="header-section-number">8.12</span> Cálculos por filas<a class="anchor" aria-label="anchor" href="#row-wise-calculations"><i class="fas fa-link"></i></a>
</h2>
<p>Si deseas realizar un cálculo dentro de una fila, puedes utilizar <code>rowwise()</code> de <strong>dplyr</strong>. Consulta esta viñeta en línea sobre los cálculos <a href="https://cran.r-project.org/web/packages/dplyr/vignettes/rowwise.html">por filas</a>. Por ejemplo, este código aplica <code>rowwise()</code> y luego crea una nueva columna que suma el número de las columnas de síntomas especificadas que tienen valor “yes”, para cada fila Las columnas se especifican dentro de <code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code> por su nombre dentro de un vector <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>. <code>rowwise()</code> es esencialmente un tipo especial de <code>group_by()</code>, por lo que es mejor utilizar <code>ungroup()</code> cuando hayas terminado (página sobre <a href="grouping-data.html#grouping-data">Agrupar datos</a>).</p>
<div class="sourceCode" id="cb305"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span>
  <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>num_symptoms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">fever</span>, <span class="va">chills</span>, <span class="va">cough</span>, <span class="va">aches</span>, <span class="va">vomit</span><span class="op">)</span> <span class="op">==</span> <span class="st">"yes"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">fever</span>, <span class="va">chills</span>, <span class="va">cough</span>, <span class="va">aches</span>, <span class="va">vomit</span>, <span class="va">num_symptoms</span><span class="op">)</span> <span class="co"># for display</span></code></pre></div>
<pre><code>## # A tibble: 5,888 x 6
##    fever chills cough aches vomit num_symptoms
##    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;        &lt;int&gt;
##  1 no    no     yes   no    yes              2
##  2 &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;            NA
##  3 &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;            NA
##  4 no    no     no    no    no               0
##  5 no    no     yes   no    yes              2
##  6 no    no     yes   no    yes              2
##  7 &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;            NA
##  8 no    no     yes   no    yes              2
##  9 no    no     yes   no    yes              2
## 10 no    no     yes   no    no               1
## # ... with 5,878 more rows</code></pre>
<p>Al especificar la columna a evaluar, puedes utilizar las funciones de ayuda “tidyselect” descritas en la sección <code>select()</code> de esta página. Sólo tiene que hacer un ajuste (porque no las está utilizando dentro de una función <strong>de dplyr</strong> como <code>select()</code> o <code>summarise()</code>).</p>
<p>Especifica los criterios de la columna dentro de la función <code>c_across()</code> de <strong>dplyr</strong>. Esto se debe a que c_across (<a href="https://dplyr.tidyverse.org/reference/c_across.html">documentación</a>) está diseñada para trabajar con <code>rowwise()</code> específicamente. Por ejemplo, el siguiente código:</p>
<ul>
<li>Utiliza <code>rowwise()</code> para que la siguiente operación (<code><a href="https://rdrr.io/r/base/sum.html">sum()</a></code>) se aplique dentro de cada fila (no sumando columnas enteras)</li>
<li>Crea una nueva columna <code>num_NA_dates</code>, definida para cada fila como el número de columnas (con nombre que contiene “date”) para las que <code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code> se evaluó como TRUE (son valores faltantes).</li>
<li>
<code>ungroup()</code> para eliminar los efectos de <code>rowwise()</code> en los pasos siguientes</li>
</ul>
<div class="sourceCode" id="cb307"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span>
  <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>num_NA_dates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="fu">c_across</span><span class="op">(</span><span class="fu">contains</span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">num_NA_dates</span>, <span class="fu">contains</span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span><span class="op">)</span> <span class="co"># for display</span></code></pre></div>
<pre><code>## # A tibble: 5,888 x 5
##    num_NA_da~1 date_inf~2 date_onset date_hos~3 date_out~4
##          &lt;int&gt; &lt;date&gt;     &lt;date&gt;     &lt;date&gt;     &lt;date&gt;    
##  1           1 2014-05-08 2014-05-13 2014-05-15 NA        
##  2           1 NA         2014-05-13 2014-05-14 2014-05-18
##  3           1 NA         2014-05-16 2014-05-18 2014-05-30
##  4           1 2014-05-04 2014-05-18 2014-05-20 NA        
##  5           0 2014-05-18 2014-05-21 2014-05-22 2014-05-29
##  6           0 2014-05-03 2014-05-22 2014-05-23 2014-05-24
##  7           0 2014-05-22 2014-05-27 2014-05-29 2014-06-01
##  8           0 2014-05-28 2014-06-02 2014-06-03 2014-06-07
##  9           1 NA         2014-06-05 2014-06-06 2014-06-18
## 10           1 NA         2014-06-05 2014-06-07 2014-06-09
## # ... with 5,878 more rows, and abbreviated variable
## #   names 1: num_NA_dates, 2: date_infection,
## #   3: date_hospitalisation, 4: date_outcome</code></pre>
<p>También podrías proporcionar otras funciones, como <code><a href="https://rdrr.io/r/base/Extremes.html">max()</a></code> para obtener la fecha más reciente o más reciente de cada fila:</p>
<div class="sourceCode" id="cb309"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span>
  <span class="fu">rowwise</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>latest_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu">c_across</span><span class="op">(</span><span class="fu">contains</span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">latest_date</span>, <span class="fu">contains</span><span class="op">(</span><span class="st">"date"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># for display</span></code></pre></div>
<pre><code>## # A tibble: 5,888 x 5
##    latest_date date_inf~1 date_onset date_hos~2 date_out~3
##    &lt;date&gt;      &lt;date&gt;     &lt;date&gt;     &lt;date&gt;     &lt;date&gt;    
##  1 2014-05-15  2014-05-08 2014-05-13 2014-05-15 NA        
##  2 2014-05-18  NA         2014-05-13 2014-05-14 2014-05-18
##  3 2014-05-30  NA         2014-05-16 2014-05-18 2014-05-30
##  4 2014-05-20  2014-05-04 2014-05-18 2014-05-20 NA        
##  5 2014-05-29  2014-05-18 2014-05-21 2014-05-22 2014-05-29
##  6 2014-05-24  2014-05-03 2014-05-22 2014-05-23 2014-05-24
##  7 2014-06-01  2014-05-22 2014-05-27 2014-05-29 2014-06-01
##  8 2014-06-07  2014-05-28 2014-06-02 2014-06-03 2014-06-07
##  9 2014-06-18  NA         2014-06-05 2014-06-06 2014-06-18
## 10 2014-06-09  NA         2014-06-05 2014-06-07 2014-06-09
## # ... with 5,878 more rows, and abbreviated variable
## #   names 1: date_infection, 2: date_hospitalisation,
## #   3: date_outcome</code></pre>
</div>
<div id="arrange-and-sort" class="section level2" number="8.13">
<h2>
<span class="header-section-number">8.13</span> Ordenar y clasificar<a class="anchor" aria-label="anchor" href="#arrange-and-sort"><i class="fas fa-link"></i></a>
</h2>
<p>Utiliza la función arrange() de <strong>dplyr</strong> para ordenar las filas por los valores de las columnas.</p>
<p>Lista las columnas en el orden en que deben ser ordenadas. Especifica <code>.by_group = TRUE</code> si deseas que la ordenación se realice primero por cualquier <em>agrupación</em> aplicada a los datos (véase la página sobre <a href="grouping-data.html#grouping-data">Agrupar datos</a>).</p>
<p>Por defecto, la columna se ordenará en orden “ascendente” (que se aplica a las columnas numéricas y también a las de caracteres). Puedes ordenar una variable en orden “descendente” envolviéndola con <code>desc()</code>.</p>
<p>La ordenación de los datos con <code>arrange()</code> es particularmente útil cuando se hacen <a href="tables-for-presentation.html#tables-for-presentation">Tablas para presentaciones</a>, utilizando <code>slice()</code> para tomar las filas “superiores” por grupo, o estableciendo el orden de los niveles de los factores por orden de aparición.</p>
<p>Por ejemplo, para ordenar las filas de nuestro <code>linelist</code> por <code>hospital</code> y luego por <code>date_onset</code> (fecha de inicio) en orden descendente, utilizaríamos:</p>
<div class="sourceCode" id="cb311"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">linelist</span> <span class="op">%&gt;%</span> 
   <span class="fu">arrange</span><span class="op">(</span><span class="va">hospital</span>, <span class="fu">desc</span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span><span class="op">)</span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="import-and-export.html"><span class="header-section-number">7</span> Importación y exportación</a></div>
<div class="next"><a href="working-with-dates.html"><span class="header-section-number">9</span> Trabajando con Fechas</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>En esta página</h2>
      <ul class="nav navbar-nav">
<li>
<a class="nav-link" href="#cleaning-data-and-core-functions"><span class="header-section-number">8</span> Limpieza de datos y funciones básicas</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#funciones-principales">Funciones principales</a></li>
<li><a class="nav-link" href="#nomenclatura-1">Nomenclatura</a></li>
</ul>
</li>
<li><a class="nav-link" href="#cleaning-pipeline"><span class="header-section-number">8.1</span> Limpieza de tuberías</a></li>
<li><a class="nav-link" href="#load-packages"><span class="header-section-number">8.2</span> Carga de paquetes</a></li>
<li>
<a class="nav-link" href="#import-data-1"><span class="header-section-number">8.3</span> Importar datos</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#importar">Importar</a></li>
<li><a class="nav-link" href="#revisar">Revisar</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#column-names"><span class="header-section-number">8.4</span> Nombres de columnas</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#limpieza-autom%C3%A1tica">Limpieza automática</a></li>
<li><a class="nav-link" href="#limpieza-manual-de-nombres">Limpieza manual de nombres</a></li>
<li><a class="nav-link" href="#otros-retos">Otros retos</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#select-or-re-order-columns"><span class="header-section-number">8.5</span> Seleccionar o reordenar columnas</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#mantener-las-columnas">Mantener las columnas</a></li>
<li><a class="nav-link" href="#clean_tidyselect">Funciones de ayuda “tidyselect”</a></li>
<li><a class="nav-link" href="#eliminar-columnas">Eliminar columnas</a></li>
<li><a class="nav-link" href="#independiente">Independiente</a></li>
</ul>
</li>
<li><a class="nav-link" href="#deduplication"><span class="header-section-number">8.6</span> De-duplicación</a></li>
<li>
<a class="nav-link" href="#column-creation-and-transformation"><span class="header-section-number">8.7</span> Creación y transformación de columnas</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#nuevas-columnas">Nuevas columnas</a></li>
<li><a class="nav-link" href="#convertir-el-tipo-de-columna">Convertir el tipo de columna</a></li>
<li><a class="nav-link" href="#datos-agrupados">Datos agrupados</a></li>
<li><a class="nav-link" href="#clean_across">Transformar múltiples columnas</a></li>
<li><a class="nav-link" href="#coalesce">coalesce()</a></li>
<li><a class="nav-link" href="#matem%C3%A1ticas-acumulativas">Matemáticas acumulativas</a></li>
<li><a class="nav-link" href="#utilizando-r-base">Utilizando R base</a></li>
<li><a class="nav-link" href="#a%C3%B1adir-a-la-cadena-de-tuber%C3%ADas-1">Añadir a la cadena de tuberías</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#re-code-values"><span class="header-section-number">8.8</span> Recodificar valores</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#valores-espec%C3%ADficos">Valores específicos</a></li>
<li><a class="nav-link" href="#por-l%C3%B3gica">Por lógica</a></li>
<li><a class="nav-link" href="#l%C3%B3gica-simple">Lógica simple</a></li>
<li><a class="nav-link" href="#clean_case_when">Lógica compleja</a></li>
<li><a class="nav-link" href="#valores-faltantes-1">Valores faltantes</a></li>
<li><a class="nav-link" href="#diccionario-de-limpieza">Diccionario de limpieza</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#num_cats"><span class="header-section-number">8.9</span> Categorías numéricas</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#revisi%C3%B3n-de-la-distribuci%C3%B3n">Revisión de la distribución</a></li>
<li><a class="nav-link" href="#age_categories">age_categories()</a></li>
<li><a class="nav-link" href="#cut">cut()</a></li>
<li><a class="nav-link" href="#roturas-cuart%C3%ADlicas">Roturas cuartílicas</a></li>
<li><a class="nav-link" href="#grupos-de-tama%C3%B1o-uniforme">Grupos de tamaño uniforme</a></li>
<li><a class="nav-link" href="#case_when">case_when()</a></li>
<li><a class="nav-link" href="#a%C3%B1adir-a-la-cadena-de-tuber%C3%ADas-3">Añadir a la cadena de tuberías</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#add-rows"><span class="header-section-number">8.10</span> Añadir filas</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#uno-a-uno">Uno a uno</a></li>
<li><a class="nav-link" href="#unir-filas">Unir filas</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#filter-rows"><span class="header-section-number">8.11</span> Filtrar filas</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#filtro-simple">Filtro simple</a></li>
<li><a class="nav-link" href="#filtrar-los-valores-faltantes">Filtrar los valores faltantes</a></li>
<li><a class="nav-link" href="#filtrar-por-n%C3%BAmero-de-fila">Filtrar por número de fila</a></li>
<li><a class="nav-link" href="#filtro-complejo">Filtro complejo</a></li>
<li><a class="nav-link" href="#independiente-1">Independiente</a></li>
<li><a class="nav-link" href="#revisar-r%C3%A1pidamente-los-registros">Revisar rápidamente los registros</a></li>
</ul>
</li>
<li><a class="nav-link" href="#row-wise-calculations"><span class="header-section-number">8.12</span> Cálculos por filas</a></li>
<li><a class="nav-link" href="#arrange-and-sort"><span class="header-section-number">8.13</span> Ordenar y clasificar</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>EpiRhandbook en español</strong>" fué escrito por el equipo del manual. Compilado el 2022-10-27.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>Este libro fué construido con el paquete <a class="text-light" href="https://bookdown.org">bookdown</a> de R.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
