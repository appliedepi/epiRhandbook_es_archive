<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>20 Borrador. Tasas estandarizadas | El manual de R para Epi’s</title>
<meta name="author" content="El equipo del manual">
<meta name="description" content="ADVERTENCIA: Esta traducción es sólo un borrador de la traducción al español. Este documento tal cual está ha sido generado automáticamente con DeepL.com y se han hecho algunas correcciones...">
<meta name="generator" content="bookdown 0.29 with bs4_book()">
<meta property="og:title" content="20 Borrador. Tasas estandarizadas | El manual de R para Epi’s">
<meta property="og:type" content="book">
<meta property="og:description" content="ADVERTENCIA: Esta traducción es sólo un borrador de la traducción al español. Este documento tal cual está ha sido generado automáticamente con DeepL.com y se han hecho algunas correcciones...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="20 Borrador. Tasas estandarizadas | El manual de R para Epi’s">
<meta name="twitter:description" content="ADVERTENCIA: Esta traducción es sólo un borrador de la traducción al español. Este documento tal cual está ha sido generado automáticamente con DeepL.com y se han hecho algunas correcciones...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.25/datatables.js"></script><link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script><link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="libs/selectize-0.12.0/selectize.min.js"></script><link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/tabwid.css" rel="stylesheet">
<link href="libs/tabwid-1.1.0/scrool.css" rel="stylesheet">
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script><script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script><script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.9/grViz.js"></script><script src="libs/d3-4.5.0/d3.min.js"></script><script src="libs/sankey-1/sankey.js"></script><script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="libs/vis-9.1.0/vis-network.min.js"></script><script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script><link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script src="libs/plotly-basic-2.5.1/plotly-basic-2.5.1.min.js"></script><script src="libs/plotly-cartesian-2.5.1/plotly-cartesian-2.5.1.min.js"></script><script src="libs/proj4js-2.3.15/proj4.js"></script><link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">
<script src="libs/highcharts-9.3.1/highcharts.js"></script><script src="libs/highcharts-9.3.1/highcharts-3d.js"></script><script src="libs/highcharts-9.3.1/highcharts-more.js"></script><script src="libs/highcharts-9.3.1/modules/stock.js"></script><script src="libs/highcharts-9.3.1/modules/map.js"></script><script src="libs/highcharts-9.3.1/modules/data.js"></script><script src="libs/highcharts-9.3.1/modules/exporting.js"></script><script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script><script src="libs/highcharts-9.3.1/modules/drilldown.js"></script><script src="libs/highcharts-9.3.1/modules/item-series.js"></script><script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script><script src="libs/highcharts-9.3.1/modules/annotations.js"></script><script src="libs/highcharts-9.3.1/modules/export-data.js"></script><script src="libs/highcharts-9.3.1/modules/funnel.js"></script><script src="libs/highcharts-9.3.1/modules/heatmap.js"></script><script src="libs/highcharts-9.3.1/modules/treemap.js"></script><script src="libs/highcharts-9.3.1/modules/sankey.js"></script><script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script><script src="libs/highcharts-9.3.1/modules/organization.js"></script><script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script><script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script><script src="libs/highcharts-9.3.1/modules/sunburst.js"></script><script src="libs/highcharts-9.3.1/modules/vector.js"></script><script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script><script src="libs/highcharts-9.3.1/modules/xrange.js"></script><script src="libs/highcharts-9.3.1/modules/tilemap.js"></script><script src="libs/highcharts-9.3.1/modules/venn.js"></script><script src="libs/highcharts-9.3.1/modules/gantt.js"></script><script src="libs/highcharts-9.3.1/modules/timeline.js"></script><script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script><script src="libs/highcharts-9.3.1/modules/bullet.js"></script><script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script><script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script><script src="libs/highcharts-9.3.1/modules/lollipop.js"></script><script src="libs/highcharts-9.3.1/modules/series-label.js"></script><script src="libs/highcharts-9.3.1/plugins/motion.js"></script><script src="libs/highcharts-9.3.1/custom/reset.js"></script><script src="libs/highcharts-9.3.1/modules/boost.js"></script><script src="libs/highchart-binding-0.9.4/highchart.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style_bs4.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">El manual de R para Epi’s</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"></a></li>
<li class="book-part">Acerca de este libro</li>
<li><a class="" href="editorial-and-technical-notes.html"><span class="header-section-number">1</span> Notas editoriales y técnicas</a></li>
<li><a class="" href="download-handbook-and-data.html"><span class="header-section-number">2</span> Descargando el manual y los datos</a></li>
<li class="book-part">Aspectos básicos</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">3</span> Fundamentos de R</a></li>
<li><a class="" href="transition-to-r.html"><span class="header-section-number">4</span> Transición a R</a></li>
<li><a class="" href="suggested-packages-1.html"><span class="header-section-number">5</span> Paquetes recomendados</a></li>
<li><a class="" href="r-projects.html"><span class="header-section-number">6</span> Proyectos en R</a></li>
<li><a class="" href="import-and-export.html"><span class="header-section-number">7</span> Importación y exportación</a></li>
<li class="book-part">Gestión de datos</li>
<li><a class="" href="cleaning-data-and-core-functions.html"><span class="header-section-number">8</span> Limpieza de datos y funciones básicas</a></li>
<li><a class="" href="working-with-dates.html"><span class="header-section-number">9</span> Borrador. Trabajando con Fechas</a></li>
<li><a class="" href="characters-and-strings.html"><span class="header-section-number">10</span> Caracteres y cadenas</a></li>
<li><a class="" href="pivoting-data.html"><span class="header-section-number">11</span> Pivotar datos</a></li>
<li><a class="" href="grouping-data.html"><span class="header-section-number">12</span> Agrupar datos</a></li>
<li><a class="" href="joining-data.html"><span class="header-section-number">13</span> Unir datos</a></li>
<li><a class="" href="de-duplication.html"><span class="header-section-number">14</span> Borrador. De-duplicación</a></li>
<li><a class="" href="iteration-loops-and-lists.html"><span class="header-section-number">15</span> Borrador. Iteración, bucles y listas</a></li>
<li class="book-part">Análisis</li>
<li><a class="" href="descriptive-tables.html"><span class="header-section-number">16</span> Tablas descriptivas</a></li>
<li><a class="" href="simple-statistical-tests.html"><span class="header-section-number">17</span> Tests estadísticos sencillos</a></li>
<li><a class="" href="univariate-and-multivariable-regression.html"><span class="header-section-number">18</span> Borrador. Regresión univariante y multivariable</a></li>
<li><a class="" href="missing-data.html"><span class="header-section-number">19</span> Borrador. Valores faltantes</a></li>
<li><a class="active" href="standardised-rates.html"><span class="header-section-number">20</span> Borrador. Tasas estandarizadas</a></li>
<li><a class="" href="moving-averages.html"><span class="header-section-number">21</span> Borrador. Medias Móviles</a></li>
<li><a class="" href="time-series-and-outbreak-detection.html"><span class="header-section-number">22</span> Borrador. Series temporales y detección de brotes</a></li>
<li><a class="" href="epidemic-modeling.html"><span class="header-section-number">23</span> Borrador. Modelización de epidemias</a></li>
<li><a class="" href="contact-tracing-1.html"><span class="header-section-number">24</span> Borrador. Rastreo de contactos</a></li>
<li><a class="" href="survey-analysis.html"><span class="header-section-number">25</span> Borrador. Análisis de encuestas</a></li>
<li><a class="" href="survival-analysis.html"><span class="header-section-number">26</span> Borrador. Análisis de supervivencia</a></li>
<li><a class="" href="gis-basics.html"><span class="header-section-number">27</span> Conceptos básicos de los SIG</a></li>
<li class="book-part">Visualización de datos</li>
<li><a class="" href="ggplot-basics.html"><span class="header-section-number">28</span> Conceptos básicos de ggplot</a></li>
<li><a class="" href="ggplot-tips.html"><span class="header-section-number">29</span> Consejos de ggplot</a></li>
<li><a class="" href="epidemic-curves.html"><span class="header-section-number">30</span> Curvas epidémicas</a></li>
<li><a class="" href="demographic-pyramids-and-likert-scales.html"><span class="header-section-number">31</span> Pirámides de población y escalas de Likert</a></li>
<li><a class="" href="heat-plots.html"><span class="header-section-number">32</span> Gráficos de calor</a></li>
<li><a class="" href="diagrams-and-charts.html"><span class="header-section-number">33</span> Diagramas y gráficos</a></li>
<li><a class="" href="combinations-analysis.html"><span class="header-section-number">34</span> Borrador. Análisis de combinaciones</a></li>
<li><a class="" href="transmission-chains.html"><span class="header-section-number">35</span> Borrador. Cadenas de transmisión</a></li>
<li><a class="" href="phylogenetic-trees-1.html"><span class="header-section-number">36</span> Árboles filogenéticos</a></li>
<li><a class="" href="interactive-plots.html"><span class="header-section-number">37</span> Gráficos interactivos</a></li>
<li class="book-part">Informes y Dashboards</li>
<li><a class="" href="reports-with-r-markdown.html"><span class="header-section-number">38</span> Informes con R Markdown</a></li>
<li><a class="" href="organizing-routine-reports.html"><span class="header-section-number">39</span> Organización de informes rutinarios</a></li>
<li><a class="" href="dashboards-with-r-markdown.html"><span class="header-section-number">40</span> Borrador. Dashboards con R Markdown</a></li>
<li><a class="" href="dashboards-with-shiny.html"><span class="header-section-number">41</span> Borrador. Dashboards con Shiny</a></li>
<li class="book-part">Miscelánea</li>
<li><a class="" href="writing-functions-1.html"><span class="header-section-number">42</span> Escribir funciones</a></li>
<li><a class="" href="directory-interactions.html"><span class="header-section-number">43</span> Borrador. Interacciones con directorios</a></li>
<li><a class="" href="version-control-and-collaboration-with-git-and-github.html"><span class="header-section-number">44</span> Control de versiones y colaboración con Git y Github</a></li>
<li><a class="" href="common-errors.html"><span class="header-section-number">45</span> Errores comunes</a></li>
<li><a class="" href="getting-help.html"><span class="header-section-number">46</span> Cómo obtener ayuda</a></li>
<li><a class="" href="r-on-network-drives.html"><span class="header-section-number">47</span> Borrador. R en redes locales</a></li>
<li><a class="" href="data-table.html"><span class="header-section-number">48</span> Borrador. data.table</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="standardised-rates" class="section level1" number="20">
<h1>
<span class="header-section-number">20</span> Borrador. Tasas estandarizadas<a class="anchor" aria-label="anchor" href="#standardised-rates"><i class="fas fa-link"></i></a>
</h1>
<p><span style="color: red;"><strong><em>ADVERTENCIA:</em></strong> Esta traducción es sólo un borrador de la traducción al español. Este documento tal cual está ha sido generado automáticamente con DeepL.com y se han hecho algunas correcciones globales. Está pendiente de una revisión completa. </span></p>
<p>Esta página te mostrará dos formas de estandarizar un resultado, como las hospitalizaciones o la mortalidad, por características como la edad y el sexo.</p>
<ul>
<li>Uso del paquete <strong>dsr</strong>
</li>
<li>Uso del paquete <strong>PHEindicatormethods</strong>
</li>
</ul>
<p>Comenzamos demostrando ampliamente los procesos de preparación/limpieza/unión de datos, ya que esto es común cuando se combinan datos de población de múltiples países, datos de población estándar, defunciones, etc.</p>
<div id="overview-1" class="section level2" number="20.1">
<h2>
<span class="header-section-number">20.1</span> Resumen<a class="anchor" aria-label="anchor" href="#overview-1"><i class="fas fa-link"></i></a>
</h2>
<p>Hay dos formas principales de estandarizar: la estandarización directa y la indirecta. Supongamos que queremos estandarizar la tasa de mortalidad por edad y sexo para el país A y el país B, y comparar las tasas estandarizadas entre estos países.</p>
<ul>
<li>Para la estandarización directa, tendrás que conocer el número de la población de riesgo y el número de defunciones para cada estrato de edad y sexo, para el país A y el país B. Un estrato en nuestro ejemplo podría ser el de las mujeres entre 15-44 años.</li>
<li>Para la estandarización indirecta, sólo es necesario conocer el número total de defunciones y la estructura por edad y sexo de cada país. Por tanto, esta opción es factible si no se dispone de tasas de mortalidad específicas por edad y sexo o de cifras de población. La estandarización indirecta es, además, preferible en caso de números pequeños por estrato, ya que las estimaciones en la estandarización directa estarían influenciadas por una variación sustancial del muestreo.</li>
</ul>
<!-- ======================================================= -->
</div>
<div id="preparation-12" class="section level2" number="20.2">
<h2>
<span class="header-section-number">20.2</span> Preparación<a class="anchor" aria-label="anchor" href="#preparation-12"><i class="fas fa-link"></i></a>
</h2>
<p>Para mostrar cómo se realiza la estandarización, utilizaremos recuentos ficticios de la población y de las defunciones del país A y del país B, por edad (en categorías de 5 años) y por sexo (femenino, masculino). Para que los conjuntos de datos estén listos para tu uso, realizaremos los siguientes pasos de preparación:</p>
<ol style="list-style-type: decimal">
<li>Cargar paquetes</li>
<li>Cargar conjuntos de datos</li>
<li>Unir los datos de población y mortalidad de los dos países</li>
<li>Pivotar a lo largo para que haya una fila por estrato de edad y sexo</li>
<li>Limpiar la población de referencia (población estándar mundial) y unirla a los datos del país</li>
</ol>
<p>En tu caso, sus datos pueden tener un formato diferente. Tal vez sus datos sean por provincia, ciudad u otra zona de captación. Puedes que tenga una fila para cada defunció e información sobre la edad y el sexo de cada una (o de una proporción significativa) de estas defunciones. En este caso, consulta las páginas sobre <a href="grouping-data.html#grouping-data">Agrupar de datos</a>, <a href="pivoting-data.html#pivoting-data">Pivotar de datos</a> y <a href="descriptive-tables.html#descriptive-tables">Tablas descriptivas</a> para crear unos datos con recuentos de eventos y población por estrato de edad y sexo.</p>
<p>También necesitamos una población de referencia, la población estándar. Para los fines de este ejercicio utilizaremos la <code>world_standard_population_by_sex</code>. La población estándar mundial se basa en las poblaciones de 46 países y se elaboró en 1960. Hay muchas poblaciones “estándar”; por ejemplo, el sitio web <a href="https://www.opendata.nhs.scot/dataset/standard-populations">del NHS de Escocia</a> ofrece bastante información sobre la población estándar europea, la población estándar mundial y la población estándar de Escocia.</p>
<!-- ======================================================= -->
<div id="cargar-paquetes-13" class="section level3 unnumbered">
<h3>Cargar paquetes<a class="anchor" aria-label="anchor" href="#cargar-paquetes-13"><i class="fas fa-link"></i></a>
</h3>
<p>Este trozo de código muestra la carga de los paquetes necesarios para los análisis. En este manual destacamos <code><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load()</a></code> de <strong>pacman</strong>, que instala el paquete si es necesario <em>y</em> lo carga para su uso. También puedes cargar los paquetes instalados con <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> de R <strong>base</strong> Consulta la página sobre <a href="r-basics.html#r-basics">fundamentos de R</a> para obtener más información sobre los paquetes de R.</p>
<div class="sourceCode" id="cb1083"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span>
     <span class="va">rio</span>,                 <span class="co"># import/export data</span>
     <span class="va">here</span>,                <span class="co"># locate files</span>
     <span class="va">tidyverse</span>,           <span class="co"># data management and visualization</span>
     <span class="va">stringr</span>,             <span class="co"># cleaning characters and strings</span>
     <span class="va">frailtypack</span>,         <span class="co"># needed for dsr, for frailty models</span>
     <span class="va">dsr</span>,                 <span class="co"># standardise rates</span>
     <span class="va">PHEindicatormethods</span><span class="op">)</span> <span class="co"># alternative for rate standardisation</span></code></pre></div>
<p><span style="color: orange;"><strong><em>PRECAUCIÓN:</em></strong> Si tienes una versión más reciente de R, el paquete <strong>dsr</strong> no puede descargarse directamente de CRAN. Sin embargo, todavía está disponible en el archivo CRAN. Puedes instalar y utilizar éste.</span></p>
<p>Para los que no son usuarios de Mac:</p>
<div class="sourceCode" id="cb1084"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">packageurl</span> <span class="op">&lt;-</span> <span class="st">"https://cran.r-project.org/src/contrib/Archive/dsr/dsr_0.2.2.tar.gz"</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="va">packageurl</span>, repos<span class="op">=</span><span class="cn">NULL</span>, type<span class="op">=</span><span class="st">"source"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb1085"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Other solution that may work</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/">devtools</a></span><span class="op">)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/remote-reexports.html">install_version</a></span><span class="op">(</span><span class="st">"dsr"</span>, version<span class="op">=</span><span class="st">"0.2.2"</span>, repos<span class="op">=</span><span class="st">"http:/cran.us.r.project.org"</span><span class="op">)</span></code></pre></div>
<p>Para los usuarios de Mac:</p>
<div class="sourceCode" id="cb1086"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/">devtools</a></span><span class="op">)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/remote-reexports.html">install_version</a></span><span class="op">(</span><span class="st">"dsr"</span>, version<span class="op">=</span><span class="st">"0.2.2"</span>, repos<span class="op">=</span><span class="st">"https://mac.R-project.org"</span><span class="op">)</span></code></pre></div>
</div>
<div id="cargar-los-datos-de-población" class="section level3 unnumbered">
<h3>Cargar los datos de población<a class="anchor" aria-label="anchor" href="#cargar-los-datos-de-poblaci%C3%B3n"><i class="fas fa-link"></i></a>
</h3>
<p>Consulta la página de <a href="download-handbook-and-data.html#download-handbook-and-data">descargando el manual y los datos</a> para obtener instrucciones sobre cómo descargar todos los datos de ejemplo del manual. Puedes importar los datos de la página de normalización directamente a R desde nuestro repositorio de Github ejecutando los siguientes comandos <code><a href="https://rdrr.io/pkg/rio/man/import.html">import()</a></code>:</p>
<div class="sourceCode" id="cb1087"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># import demographics for country A directly from Github</span>
<span class="va">A_demo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/standardization/country_demographics.csv"</span><span class="op">)</span>

<span class="co"># import deaths for country A directly from Github</span>
<span class="va">A_deaths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/standardization/deaths_countryA.csv"</span><span class="op">)</span>

<span class="co"># import demographics for country B directly from Github</span>
<span class="va">B_demo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/standardization/country_demographics_2.csv"</span><span class="op">)</span>

<span class="co"># import deaths for country B directly from Github</span>
<span class="va">B_deaths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/standardization/deaths_countryB.csv"</span><span class="op">)</span>

<span class="co"># import demographics for country B directly from Github</span>
<span class="va">standard_pop_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/standardization/world_standard_population_by_sex.csv"</span><span class="op">)</span></code></pre></div>
<p>En primer lugar, cargamos los datos demográficos (recuentos de hombres y mujeres por categoría de edad de 5 años) de los dos países que vamos a comparar, “Country A” y “Country B”.</p>
<div class="sourceCode" id="cb1088"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Country A</span>
<span class="va">A_demo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"country_demographics.csv"</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-ff1ba4465c2788d276c6" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ff1ba4465c2788d276c6">{"x":{"filter":"none","vertical":false,"data":[["A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A"],["0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85"],[7828087,6705882,5601230,4576430,3734111,3111651,2571215,2121247,1735468,1418749,1145345,900239,685141,500248,347093,202240,94325,40402],[7674675,6592449,5522555,4533885,3726537,3118040,2592416,2150490,1771213,1459439,1193903,956070,745682,563894,416543,258538,130479,64656]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>age_cat5<\/th>\n      <th>m<\/th>\n      <th>f<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><div class="sourceCode" id="cb1089"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Country B</span>
<span class="va">B_demo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"country_demographics_2.csv"</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-663a6d5e839870370688" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-663a6d5e839870370688">{"x":{"filter":"none","vertical":false,"data":[["B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B"],["0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85"],[513458,508728,673522,844532,965423,1243552,1400065,1428773,1546221,1562880,2355220,2324555,2988200,2527110,1552200,1466902,876251,1073611],[503262,559249,652455,145453,965237,1238640,1392676,1505040,1671213,1459439,2218733,3528103,3204770,2500130,1683925,1683828,987362,1147563]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>age_cat5<\/th>\n      <th>m<\/th>\n      <th>f<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="cargar-datos-de-defunciones" class="section level3 unnumbered">
<h3>Cargar datos de defunciones<a class="anchor" aria-label="anchor" href="#cargar-datos-de-defunciones"><i class="fas fa-link"></i></a>
</h3>
<p>Convenientemente, también tenemos los recuentos de las defunciones durante el período de interés, por edad y sexo. Los recuentos de cada país están en un archivo separado, que se muestra a continuación.</p>
<p>Defunciones en Country A</p>
<div id="htmlwidget-62f35daa56e78b67a8ab" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-62f35daa56e78b67a8ab">{"x":{"filter":"none","vertical":false,"data":[["A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A"],["0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85"],[224,257,251,245,334,245,154,189,334,342,565,432,543,432,245,543,234,354],[194,254,232,214,316,224,163,167,354,354,463,574,493,295,175,380,177,392]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>AgeCat<\/th>\n      <th>Male<\/th>\n      <th>Female<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Defunciones en Country B</p>
<div id="htmlwidget-ba0a2fea002d0e1ff373" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ba0a2fea002d0e1ff373">{"x":{"filter":"none","vertical":false,"data":[["B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B"],["0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85"],[34,37,51,145,434,120,100,143,307,354,463,639,706,232,275,543,234,274],[54,24,32,154,276,254,123,164,254,354,453,654,435,354,165,432,287,395]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>AgeCat<\/th>\n      <th>Male<\/th>\n      <th>Female<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="poblaciones-y-defunciones-limpias" class="section level3 unnumbered">
<h3>Poblaciones y defunciones limpias<a class="anchor" aria-label="anchor" href="#poblaciones-y-defunciones-limpias"><i class="fas fa-link"></i></a>
</h3>
<p>Necesitamos unir y transformar estos datos de la siguiente manera:</p>
<ul>
<li>Combinar las poblaciones de los países en un solo conjunto de datos y hacer un pivote “largo” para que cada estrato de edad y sexo sea una fila</li>
<li>Combinar los recuentos de defunciones por país en un solo conjunto de datos y hacer un pivote “largo” para que cada estrato de edad y sexo sea una fila</li>
<li>Unir las defunciones a las poblaciones</li>
</ul>
<p>En primer lugar, combinamos los conjuntos de datos de las poblaciones de los países, los pivotamos durante más tiempo y realizamos una pequeña limpieza. Para más detalles, consulta la página sobre <a href="pivoting-data.html#pivoting-data">pivotar datos</a>.</p>
<div class="sourceCode" id="cb1090"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pop_countries</span> <span class="op">&lt;-</span> <span class="va">A_demo</span> <span class="op">%&gt;%</span>  <span class="co"># begin with country A dataset</span>
     <span class="fu">bind_rows</span><span class="op">(</span><span class="va">B_demo</span><span class="op">)</span> <span class="op">%&gt;%</span>        <span class="co"># bind rows, because cols are identically named</span>
     <span class="fu">pivot_longer</span><span class="op">(</span>                       <span class="co"># pivot longer</span>
          cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">f</span><span class="op">)</span>,                   <span class="co"># columns to combine into one</span>
          names_to <span class="op">=</span> <span class="st">"Sex"</span>,                 <span class="co"># name for new column containing the category ("m" or "f") </span>
          values_to <span class="op">=</span> <span class="st">"Population"</span><span class="op">)</span> <span class="op">%&gt;%</span>     <span class="co"># name for new column containing the numeric values pivoted</span>
     <span class="fu">mutate</span><span class="op">(</span>Sex <span class="op">=</span> <span class="fu">recode</span><span class="op">(</span><span class="va">Sex</span>,            <span class="co"># re-code values for clarity</span>
          <span class="st">"m"</span> <span class="op">=</span> <span class="st">"Male"</span>,
          <span class="st">"f"</span> <span class="op">=</span> <span class="st">"Female"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Los datos de población combinados tienen ahora este aspecto (clica para ver los países A y B):</p>
<div id="htmlwidget-d0f79e30c49c2112fd40" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-d0f79e30c49c2112fd40">{"x":{"filter":"none","vertical":false,"data":[["A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B"],["0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85","0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85"],["Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female"],[7828087,7674675,6705882,6592449,5601230,5522555,4576430,4533885,3734111,3726537,3111651,3118040,2571215,2592416,2121247,2150490,1735468,1771213,1418749,1459439,1145345,1193903,900239,956070,685141,745682,500248,563894,347093,416543,202240,258538,94325,130479,40402,64656,513458,503262,508728,559249,673522,652455,844532,145453,965423,965237,1243552,1238640,1400065,1392676,1428773,1505040,1546221,1671213,1562880,1459439,2355220,2218733,2324555,3528103,2988200,3204770,2527110,2500130,1552200,1683925,1466902,1683828,876251,987362,1073611,1147563]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>age_cat5<\/th>\n      <th>Sex<\/th>\n      <th>Population<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Y ahora realizamos operaciones similares en los dos conjuntos de datos de defunciones.</p>
<div class="sourceCode" id="cb1091"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">deaths_countries</span> <span class="op">&lt;-</span> <span class="va">A_deaths</span> <span class="op">%&gt;%</span>    <span class="co"># begin with country A deaths dataset</span>
     <span class="fu">bind_rows</span><span class="op">(</span><span class="va">B_deaths</span><span class="op">)</span> <span class="op">%&gt;%</span>        <span class="co"># bind rows with B dataset, because cols are identically named</span>
     <span class="fu">pivot_longer</span><span class="op">(</span>                  <span class="co"># pivot longer</span>
          cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Male</span>, <span class="va">Female</span><span class="op">)</span>,        <span class="co"># column to transform into one</span>
          names_to <span class="op">=</span> <span class="st">"Sex"</span>,              <span class="co"># name for new column containing the category ("m" or "f") </span>
          values_to <span class="op">=</span> <span class="st">"Deaths"</span><span class="op">)</span> <span class="op">%&gt;%</span>      <span class="co"># name for new column containing the numeric values pivoted</span>
     <span class="fu">rename</span><span class="op">(</span>age_cat5 <span class="op">=</span> <span class="va">AgeCat</span><span class="op">)</span>      <span class="co"># rename for clarity</span></code></pre></div>
<p>Los datos de las defunciones tienen ahora este aspecto, y contienen datos de ambos países:</p>
<div id="htmlwidget-992ee4e43410390588a4" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-992ee4e43410390588a4">{"x":{"filter":"none","vertical":false,"data":[["A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B"],["0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85","0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85"],["Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female"],[224,194,257,254,251,232,245,214,334,316,245,224,154,163,189,167,334,354,342,354,565,463,432,574,543,493,432,295,245,175,543,380,234,177,354,392,34,54,37,24,51,32,145,154,434,276,120,254,100,123,143,164,307,254,354,354,463,453,639,654,706,435,232,354,275,165,543,432,234,287,274,395]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>age_cat5<\/th>\n      <th>Sex<\/th>\n      <th>Deaths<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>Ahora unimos los datos de defunciones y población basándonos en las columnas comunes <code>Country</code>, <code>age_cat5</code>, y <code>Sex</code>. Esto añade la columna <code>Deaths</code>.</p>
<div class="sourceCode" id="cb1092"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">country_data</span> <span class="op">&lt;-</span> <span class="va">pop_countries</span> <span class="op">%&gt;%</span> 
     <span class="fu">left_join</span><span class="op">(</span><span class="va">deaths_countries</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Country"</span>, <span class="st">"age_cat5"</span>, <span class="st">"Sex"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Ahora podemos clasificar <code>Sex</code>, <code>age_cat5</code>, y <code>Country</code> como factores y establecer el orden de los niveles utilizando la función <code>fct_relevel()</code> del paquete <strong>forcats</strong>, como se describe en la página sobre <a href="#factors">Factores</a>. Ten en cuenta que la clasificación de los niveles de los factores no cambia visiblemente los datos, pero el comando <code>arrange()</code> los ordena por Country, age category, y sex.</p>
<div class="sourceCode" id="cb1093"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">country_data</span> <span class="op">&lt;-</span> <span class="va">country_data</span> <span class="op">%&gt;%</span> 
  <span class="fu">mutate</span><span class="op">(</span>
    Country <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">Country</span>, <span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>,
      
    Sex <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span><span class="va">Sex</span>, <span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span>,
        
    age_cat5 <span class="op">=</span> <span class="fu">fct_relevel</span><span class="op">(</span>
      <span class="va">age_cat5</span>,
      <span class="st">"0-4"</span>, <span class="st">"5-9"</span>, <span class="st">"10-14"</span>, <span class="st">"15-19"</span>,
      <span class="st">"20-24"</span>, <span class="st">"25-29"</span>,  <span class="st">"30-34"</span>, <span class="st">"35-39"</span>,
      <span class="st">"40-44"</span>, <span class="st">"45-49"</span>, <span class="st">"50-54"</span>, <span class="st">"55-59"</span>,
      <span class="st">"60-64"</span>, <span class="st">"65-69"</span>, <span class="st">"70-74"</span>,
      <span class="st">"75-79"</span>, <span class="st">"80-84"</span>, <span class="st">"85"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
          
  <span class="fu">arrange</span><span class="op">(</span><span class="va">Country</span>, <span class="va">age_cat5</span>, <span class="va">Sex</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-4dd01c4acd292843da32" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-4dd01c4acd292843da32">{"x":{"filter":"none","vertical":false,"data":[["A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B"],["0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85","0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85"],["Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female"],[7828087,7674675,6705882,6592449,5601230,5522555,4576430,4533885,3734111,3726537,3111651,3118040,2571215,2592416,2121247,2150490,1735468,1771213,1418749,1459439,1145345,1193903,900239,956070,685141,745682,500248,563894,347093,416543,202240,258538,94325,130479,40402,64656,513458,503262,508728,559249,673522,652455,844532,145453,965423,965237,1243552,1238640,1400065,1392676,1428773,1505040,1546221,1671213,1562880,1459439,2355220,2218733,2324555,3528103,2988200,3204770,2527110,2500130,1552200,1683925,1466902,1683828,876251,987362,1073611,1147563],[224,194,257,254,251,232,245,214,334,316,245,224,154,163,189,167,334,354,342,354,565,463,432,574,543,493,432,295,245,175,543,380,234,177,354,392,34,54,37,24,51,32,145,154,434,276,120,254,100,123,143,164,307,254,354,354,463,453,639,654,706,435,232,354,275,165,543,432,234,287,274,395]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>age_cat5<\/th>\n      <th>Sex<\/th>\n      <th>Population<\/th>\n      <th>Deaths<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[3,4]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p><span style="color: orange;"><strong><em>PRECAUCIÓN:</em></strong> Si tienes pocas defunciones por estrato, considera la posibilidad de utilizar categorías de 10 o 15 años, en lugar de categorías de 5 años para la edad.</span></p>
</div>
<div id="carga-de-la-población-de-referencia" class="section level3 unnumbered">
<h3>Carga de la población de referencia<a class="anchor" aria-label="anchor" href="#carga-de-la-poblaci%C3%B3n-de-referencia"><i class="fas fa-link"></i></a>
</h3>
<p>Por último, para la estandarización directa, importamos la población de referencia (la “población estándar” mundial por sexo)</p>
<div class="sourceCode" id="cb1094"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Reference population</span>
<span class="va">standard_pop_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rio/man/import.html">import</a></span><span class="op">(</span><span class="st">"world_standard_population_by_sex.csv"</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-fefbfc11b11fc63d8b5d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-fefbfc11b11fc63d8b5d">{"x":{"filter":"none","vertical":false,"data":[["0-4 years","0-4 years","5-9 years","5-9 years","10-14 years","10-14 years","15-19 years","15-19 years","20-24 years","20-24 years","25-29 years","25-29 years","30-34 years","30-34 years","35-39 years","35-39 years","40-44 years","40-44 years","45-49 years","45-49 years","50-54 years","50-54 years","55-59 years","55-59 years","60-64 years","60-64 years","65-69 years","65-69 years","70-74 years","70-74 years","75-79 years","75-79 years","80-84 years","80-84 years","85plus years","85plus years"],["Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female"],[12000,12000,10000,10000,9000,9000,9000,9000,8000,8000,8000,8000,6000,6000,6000,6000,6000,6000,6000,6000,5000,5000,4000,4000,4000,4000,3000,3000,2000,2000,1000,1000,500,500,500,500]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>age_cat5<\/th>\n      <th>Sex<\/th>\n      <th>WorldStandardPopulation<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
<div id="población-de-referencia-limpia" class="section level3 unnumbered">
<h3>Población de referencia limpia<a class="anchor" aria-label="anchor" href="#poblaci%C3%B3n-de-referencia-limpia"><i class="fas fa-link"></i></a>
</h3>
<p>Los valores de la categoría de edad en los dataframes <code>country_data</code> y <code>standard_pop_data</code> tendrán que estar alineados.</p>
<p>Actualmente, los valores de la columna age_cat5 del dataframe <code>standard_pop_data</code> contienen la palabra “years” y “plus”, mientras que los del dataframe <code>country_data</code> no. Tendremos que hacer coincidir los valores de la categoría de edad. Usamos <code>str_replace_all()</code> del paquete <strong>stringr</strong>, como se describe en la página sobre <a href="characters-and-strings.html#characters-and-strings">Caracteres y cadenas</a>, para reemplazar estos patrones sin espacio <code>""</code>.</p>
<p>Además, el paquete <strong>dsr</strong> espera que en la población estándar, la columna que contiene los recuentos se llame <code>"pop"</code>. Así que cambiamos el nombre de esa columna en consecuencia.</p>
<div class="sourceCode" id="cb1095"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Remove specific string from column values</span>
<span class="va">standard_pop_clean</span> <span class="op">&lt;-</span> <span class="va">standard_pop_data</span> <span class="op">%&gt;%</span>
     <span class="fu">mutate</span><span class="op">(</span>
          age_cat5 <span class="op">=</span> <span class="fu">str_replace_all</span><span class="op">(</span><span class="va">age_cat5</span>, <span class="st">"years"</span>, <span class="st">""</span><span class="op">)</span>,   <span class="co"># remove "year"</span>
          age_cat5 <span class="op">=</span> <span class="fu">str_replace_all</span><span class="op">(</span><span class="va">age_cat5</span>, <span class="st">"plus"</span>, <span class="st">""</span><span class="op">)</span>,    <span class="co"># remove "plus"</span>
          age_cat5 <span class="op">=</span> <span class="fu">str_replace_all</span><span class="op">(</span><span class="va">age_cat5</span>, <span class="st">" "</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>   <span class="co"># remove " " space</span>
     
     <span class="fu">rename</span><span class="op">(</span>pop <span class="op">=</span> <span class="va">WorldStandardPopulation</span><span class="op">)</span>   <span class="co"># change col name to "pop", as this is expected by dsr package</span></code></pre></div>
<p><span style="color: orange;"><strong><em>PRECAUCIÓN:</em></strong> Si intenta utilizar <code>str_replace_all()</code> para eliminar un <em>símbolo</em> de suma, no funcionará porque es un símbolo especial. “Escapa” de los especiales poniendo dos barras invertidas delante, como en <code>str_replace_call(columna, "\\+", "")</code>. </span></p>
</div>
<div id="standard_all" class="section level3 unnumbered">
<h3>Crear un conjunto de datos con una población estándar<a class="anchor" aria-label="anchor" href="#standard_all"><i class="fas fa-link"></i></a>
</h3>
<p>Por último, el paquete <strong>PHEindicatormethods</strong>, que se detalla <a href="standardised-rates.html#standard_phe">a continuación</a>, espera que las poblaciones estándar se unan a los recuentos de eventos y poblaciones del país. Por lo tanto, crearemos un conjunto de datos <code>all_data</code> con ese fin.</p>
<div class="sourceCode" id="cb1096"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all_data</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">country_data</span>, <span class="va">standard_pop_clean</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"age_cat5"</span>, <span class="st">"Sex"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Este conjunto de datos completo tiene el siguiente aspecto:</p>
<div id="htmlwidget-edd24452a5bb89a14dba" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-edd24452a5bb89a14dba">{"x":{"filter":"none","vertical":false,"data":[["A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","A","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B"],["0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85","0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85","85"],["Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female","Male","Female"],[7828087,7674675,6705882,6592449,5601230,5522555,4576430,4533885,3734111,3726537,3111651,3118040,2571215,2592416,2121247,2150490,1735468,1771213,1418749,1459439,1145345,1193903,900239,956070,685141,745682,500248,563894,347093,416543,202240,258538,94325,130479,40402,64656,513458,503262,508728,559249,673522,652455,844532,145453,965423,965237,1243552,1238640,1400065,1392676,1428773,1505040,1546221,1671213,1562880,1459439,2355220,2218733,2324555,3528103,2988200,3204770,2527110,2500130,1552200,1683925,1466902,1683828,876251,987362,1073611,1147563],[224,194,257,254,251,232,245,214,334,316,245,224,154,163,189,167,334,354,342,354,565,463,432,574,543,493,432,295,245,175,543,380,234,177,354,392,34,54,37,24,51,32,145,154,434,276,120,254,100,123,143,164,307,254,354,354,463,453,639,654,706,435,232,354,275,165,543,432,234,287,274,395],[12000,12000,10000,10000,9000,9000,9000,9000,8000,8000,8000,8000,6000,6000,6000,6000,6000,6000,6000,6000,5000,5000,4000,4000,4000,4000,3000,3000,2000,2000,1000,1000,500,500,500,500,12000,12000,10000,10000,9000,9000,9000,9000,8000,8000,8000,8000,6000,6000,6000,6000,6000,6000,6000,6000,5000,5000,4000,4000,4000,4000,3000,3000,2000,2000,1000,1000,500,500,500,500]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>Country<\/th>\n      <th>age_cat5<\/th>\n      <th>Sex<\/th>\n      <th>Population<\/th>\n      <th>Deaths<\/th>\n      <th>pop<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[3,4,5]}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><!-- ======================================================= -->
</div>
</div>
<div id="dsr-package" class="section level2" number="20.3">
<h2>
<span class="header-section-number">20.3</span> paquete <strong>dsr</strong><a class="anchor" aria-label="anchor" href="#dsr-package"><i class="fas fa-link"></i></a>
</h2>
<p>A continuación mostramos el cálculo y la comparación de tasas estandarizadas directamente utilizando el paquete <strong>dsr</strong>. El paquete <strong>dsr</strong> permite calcular y comparar tasas estandarizadas directamente (¡no hay tasas estandarizadas indirectamente!).</p>
<p>En la sección de preparación de datos, hemos creado conjuntos de datos separados para los recuentos de países y la población estándar:</p>
<ol style="list-style-type: decimal">
<li>el objeto <code>country_data</code>, que es una tabla de población con el número de habitantes y el número de defunciones por estrato por país</li>
<li>el objeto <code>standard_pop_clean</code>, que contiene el número de población por estrato para nuestra población de referencia, la población estándar mundial</li>
</ol>
<p>Utilizaremos estos conjuntos de datos separados para el enfoque <strong>dsr</strong>.</p>
<!-- ======================================================= -->
<div id="tasas-estandarizadas" class="section level3 unnumbered">
<h3>Tasas estandarizadas<a class="anchor" aria-label="anchor" href="#tasas-estandarizadas"><i class="fas fa-link"></i></a>
</h3>
<p>A continuación, calculamos las tasas por país directamente estandarizadas por edad y sexo. Utilizamos la función <code>dsr()</code>.</p>
<p>Cabe destacar que <code>dsr()</code> espera un dataframe para las poblaciones de los países y los recuentos de eventos (defunciones), <em>y un dataframe <strong>separado</strong> con la población de referencia</em>. También espera que en este conjunto de datos de la población de referencia el nombre de la columna de la unidad de tiempo sea “pop” (lo aseguramos en la sección de preparación de datos).</p>
<p>Hay muchos argumentos, como se anota en el código siguiente. En particular, el <code>event =</code> se establece en la columna <code>Deaths</code>, y <code>fu =</code> (“seguimiento”) con la columna <code>Population</code>. Establecemos los subgrupos de comparación como la columna <code>Country</code> y estandarizamos en base a <code>age_cat5</code> y <code>Sex</code>. A estas dos últimas columnas no se les asigna un argumento con nombre concreto. Consulta <code>?dsr</code> para obtener más detalles.</p>
<div class="sourceCode" id="cb1097"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate rates per country directly standardized for age and sex</span>
<span class="va">mortality_rate</span> <span class="op">&lt;-</span> <span class="fu">dsr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dsr/man/dsr.html">dsr</a></span><span class="op">(</span>
     data <span class="op">=</span> <span class="va">country_data</span>,  <span class="co"># specify object containing number of deaths per stratum</span>
     event <span class="op">=</span> <span class="va">Deaths</span>,       <span class="co"># column containing number of deaths per stratum </span>
     fu <span class="op">=</span> <span class="va">Population</span>,      <span class="co"># column containing number of population per stratum</span>
     subgroup <span class="op">=</span> <span class="va">Country</span>,   <span class="co"># units we would like to compare</span>
     <span class="va">age_cat5</span>,             <span class="co"># other columns - rates will be standardized by these</span>
     <span class="va">Sex</span>,
     refdata <span class="op">=</span> <span class="va">standard_pop_clean</span>, <span class="co"># reference population data frame, with column called pop</span>
     method <span class="op">=</span> <span class="st">"gamma"</span>,      <span class="co"># method to calculate 95% CI</span>
     sig <span class="op">=</span> <span class="fl">0.95</span>,            <span class="co"># significance level</span>
     mp <span class="op">=</span> <span class="fl">100000</span>,           <span class="co"># we want rates per 100.000 population</span>
     decimals <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>          <span class="co"># number of decimals)</span>


<span class="co"># Print output as nice-looking HTML table</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">mortality_rate</span><span class="op">)</span> <span class="co"># show mortality rate before and after direct standardization</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
Subgroup
</th>
<th style="text-align:right;">
Numerator
</th>
<th style="text-align:right;">
Denominator
</th>
<th style="text-align:right;">
Crude Rate (per 100000)
</th>
<th style="text-align:right;">
95% LCL (Crude)
</th>
<th style="text-align:right;">
95% UCL (Crude)
</th>
<th style="text-align:right;">
Std Rate (per 100000)
</th>
<th style="text-align:right;">
95% LCL (Std)
</th>
<th style="text-align:right;">
95% UCL (Std)
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
11344
</td>
<td style="text-align:right;">
86790567
</td>
<td style="text-align:right;">
13.07
</td>
<td style="text-align:right;">
12.83
</td>
<td style="text-align:right;">
13.31
</td>
<td style="text-align:right;">
23.57
</td>
<td style="text-align:right;">
23.08
</td>
<td style="text-align:right;">
24.06
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
9955
</td>
<td style="text-align:right;">
52898281
</td>
<td style="text-align:right;">
18.82
</td>
<td style="text-align:right;">
18.45
</td>
<td style="text-align:right;">
19.19
</td>
<td style="text-align:right;">
19.33
</td>
<td style="text-align:right;">
18.46
</td>
<td style="text-align:right;">
20.22
</td>
</tr>
</tbody>
</table></div>
<p>Arriba, vemos que mientras Country A tenía una tasa de mortalidad bruta más baja que Country B, tiene una tasa estandarizada más alta después de la estandarización directa por edad y sexo.</p>
<!-- ======================================================= -->
</div>
<div id="razón-de-tasas-estandarizadas" class="section level3 unnumbered">
<h3>Razón de tasas estandarizadas<a class="anchor" aria-label="anchor" href="#raz%C3%B3n-de-tasas-estandarizadas"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb1098"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate RR</span>
<span class="va">mortality_rr</span> <span class="op">&lt;-</span> <span class="fu">dsr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dsr/man/dsrr.html">dsrr</a></span><span class="op">(</span>
     data <span class="op">=</span> <span class="va">country_data</span>, <span class="co"># specify object containing number of deaths per stratum</span>
     event <span class="op">=</span> <span class="va">Deaths</span>,      <span class="co"># column containing number of deaths per stratum </span>
     fu <span class="op">=</span> <span class="va">Population</span>,     <span class="co"># column containing number of population per stratum</span>
     subgroup <span class="op">=</span> <span class="va">Country</span>,  <span class="co"># units we would like to compare</span>
     <span class="va">age_cat5</span>,
     <span class="va">Sex</span>,                 <span class="co"># characteristics to which we would like to standardize </span>
     refdata <span class="op">=</span> <span class="va">standard_pop_clean</span>, <span class="co"># reference population, with numbers in column called pop</span>
     refgroup <span class="op">=</span> <span class="st">"B"</span>,      <span class="co"># reference for comparison</span>
     estimate <span class="op">=</span> <span class="st">"ratio"</span>,  <span class="co"># type of estimate</span>
     sig <span class="op">=</span> <span class="fl">0.95</span>,          <span class="co"># significance level</span>
     mp <span class="op">=</span> <span class="fl">100000</span>,         <span class="co"># we want rates per 100.000 population</span>
     decimals <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>        <span class="co"># number of decimals</span>

<span class="co"># Print table</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">mortality_rr</span><span class="op">)</span> </code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
Comparator
</th>
<th style="text-align:left;">
Reference
</th>
<th style="text-align:right;">
Std Rate (per 100000)
</th>
<th style="text-align:right;">
Rate Ratio (RR)
</th>
<th style="text-align:right;">
95% LCL (RR)
</th>
<th style="text-align:right;">
95% UCL (RR)
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
23.57
</td>
<td style="text-align:right;">
1.22
</td>
<td style="text-align:right;">
1.17
</td>
<td style="text-align:right;">
1.27
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
19.33
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.94
</td>
<td style="text-align:right;">
1.06
</td>
</tr>
</tbody>
</table></div>
<p>La tasa de mortalidad estandarizada es 1,22 veces mayor en Country A en comparación con Country B (IC del 95%: 1,17-1,27).</p>
<!-- ======================================================= -->
</div>
<div id="diferencia-de-tasas-estandarizadas" class="section level3 unnumbered">
<h3>Diferencia de tasas estandarizadas<a class="anchor" aria-label="anchor" href="#diferencia-de-tasas-estandarizadas"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb1099"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate RD</span>
<span class="va">mortality_rd</span> <span class="op">&lt;-</span> <span class="fu">dsr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dsr/man/dsrr.html">dsrr</a></span><span class="op">(</span>
     data <span class="op">=</span> <span class="va">country_data</span>,       <span class="co"># specify object containing number of deaths per stratum</span>
     event <span class="op">=</span> <span class="va">Deaths</span>,            <span class="co"># column containing number of deaths per stratum </span>
     fu <span class="op">=</span> <span class="va">Population</span>,           <span class="co"># column containing number of population per stratum</span>
     subgroup <span class="op">=</span> <span class="va">Country</span>,        <span class="co"># units we would like to compare</span>
     <span class="va">age_cat5</span>,                  <span class="co"># characteristics to which we would like to standardize</span>
     <span class="va">Sex</span>,                        
     refdata <span class="op">=</span> <span class="va">standard_pop_clean</span>, <span class="co"># reference population, with numbers in column called pop</span>
     refgroup <span class="op">=</span> <span class="st">"B"</span>,            <span class="co"># reference for comparison</span>
     estimate <span class="op">=</span> <span class="st">"difference"</span>,   <span class="co"># type of estimate</span>
     sig <span class="op">=</span> <span class="fl">0.95</span>,                <span class="co"># significance level</span>
     mp <span class="op">=</span> <span class="fl">100000</span>,               <span class="co"># we want rates per 100.000 population</span>
     decimals <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>              <span class="co"># number of decimals</span>

<span class="co"># Print table</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">mortality_rd</span><span class="op">)</span> </code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
Comparator
</th>
<th style="text-align:left;">
Reference
</th>
<th style="text-align:right;">
Std Rate (per 100000)
</th>
<th style="text-align:right;">
Rate Difference (RD)
</th>
<th style="text-align:right;">
95% LCL (RD)
</th>
<th style="text-align:right;">
95% UCL (RD)
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
23.57
</td>
<td style="text-align:right;">
4.24
</td>
<td style="text-align:right;">
3.24
</td>
<td style="text-align:right;">
5.24
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
19.33
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
-1.24
</td>
<td style="text-align:right;">
1.24
</td>
</tr>
</tbody>
</table></div>
<p>El país A tiene 4,24 defunciones adicionales por cada 100.000 habitantes (IC del 95%: 3,24-5,24) en comparación con el país A.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="standard_phe" class="section level2" number="20.4">
<h2>
<span class="header-section-number">20.4</span> Paquete <strong>PHEindicatormethods</strong><a class="anchor" aria-label="anchor" href="#standard_phe"><i class="fas fa-link"></i></a>
</h2>
<p>Otra forma de calcular las tasas estandarizadas es con el paquete <strong>PHEindicatormethods</strong>. Este paquete permite calcular las tasas estandarizadas tanto directa como indirectamente. Mostraremos ambos métodos.</p>
<p>En esta sección se utilizará el dataframe <code>all_data</code> creado al final de la sección Preparación. Este dataframe incluye las poblaciones de los países, los eventos de defuncione y la población de referencia mundial estándar. Puedes verlo <a href="standardised-rates.html#standard_all">aquí</a>.</p>
<!-- ======================================================= -->
<div id="tasas-estandarizadas-directamente" class="section level3 unnumbered">
<h3>Tasas estandarizadas directamente<a class="anchor" aria-label="anchor" href="#tasas-estandarizadas-directamente"><i class="fas fa-link"></i></a>
</h3>
<p>A continuación, primero agrupamos los datos por país y luego los pasamos a la función <code>phe_dsr()</code> para obtener directamente las tasas estandarizadas por país.</p>
<p>Cabe destacar que la población de referencia (estándar) puede proporcionarse como una <strong>columna dentro del dataframe específico del país</strong> o como un <strong>vector separado</strong>. Si se proporciona dentro del dataframe específico del país, hay que establecer <code>stdpoptype = "field"</code>. Si se proporciona como un vector, hay que establecer <code>stdpoptype = "vector"</code>. En este último caso, hay que asegurarse de que el orden de las filas por estratos es similar tanto en el dataframe específico del país como en la población de referencia, ya que los registros se emparejarán por posición. En nuestro ejemplo siguiente, proporcionamos la población de referencia como una columna dentro del dataframe específico del país.</p>
<p>Consulta la ayuda de <code>?phr_dsr</code> o los enlaces de la sección Referencias para obtener más información.</p>
<div class="sourceCode" id="cb1100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate rates per country directly standardized for age and sex</span>
<span class="va">mortality_ds_rate_phe</span> <span class="op">&lt;-</span> <span class="va">all_data</span> <span class="op">%&gt;%</span>
     <span class="fu">group_by</span><span class="op">(</span><span class="va">Country</span><span class="op">)</span> <span class="op">%&gt;%</span>
     <span class="fu">PHEindicatormethods</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PHEindicatormethods/man/phe_dsr.html">phe_dsr</a></span><span class="op">(</span>
          x <span class="op">=</span> <span class="va">Deaths</span>,                 <span class="co"># column with observed number of events</span>
          n <span class="op">=</span> <span class="va">Population</span>,             <span class="co"># column with non-standard pops for each stratum</span>
          stdpop <span class="op">=</span> <span class="va">pop</span>,               <span class="co"># standard populations for each stratum</span>
          stdpoptype <span class="op">=</span> <span class="st">"field"</span><span class="op">)</span>       <span class="co"># either "vector" for a standalone vector or "field" meaning std populations are in the data  </span>

<span class="co"># Print table</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">mortality_ds_rate_phe</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
Country
</th>
<th style="text-align:right;">
total_count
</th>
<th style="text-align:right;">
total_pop
</th>
<th style="text-align:right;">
value
</th>
<th style="text-align:right;">
lowercl
</th>
<th style="text-align:right;">
uppercl
</th>
<th style="text-align:left;">
confidence
</th>
<th style="text-align:left;">
statistic
</th>
<th style="text-align:left;">
method
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
A
</td>
<td style="text-align:right;">
11344
</td>
<td style="text-align:right;">
86790567
</td>
<td style="text-align:right;">
23.56686
</td>
<td style="text-align:right;">
23.08107
</td>
<td style="text-align:right;">
24.05944
</td>
<td style="text-align:left;">
95%
</td>
<td style="text-align:left;">
dsr per 100000
</td>
<td style="text-align:left;">
Dobson
</td>
</tr>
<tr>
<td style="text-align:left;">
B
</td>
<td style="text-align:right;">
9955
</td>
<td style="text-align:right;">
52898281
</td>
<td style="text-align:right;">
19.32549
</td>
<td style="text-align:right;">
18.45516
</td>
<td style="text-align:right;">
20.20882
</td>
<td style="text-align:left;">
95%
</td>
<td style="text-align:left;">
dsr per 100000
</td>
<td style="text-align:left;">
Dobson
</td>
</tr>
</tbody>
</table></div>
<!-- ======================================================= -->
</div>
<div id="standard_indirect" class="section level3 unnumbered">
<h3>Tasas estandarizadas indirectamente<a class="anchor" aria-label="anchor" href="#standard_indirect"><i class="fas fa-link"></i></a>
</h3>
<p>Para la estandarización indirecta, se necesita una población de referencia con el número de defunciones y el número de población por estrato. En este ejemplo, calcularemos las tasas del país A <em>utilizando el país B como población de referencia</em>, ya que la población de referencia de <code>standard_pop_clean</code> no incluye el número de defunciones por estrato.</p>
<p>A continuación, creamos primero la población de referencia del país B. Luego, pasamos los datos de mortalidad y población del país A, los combinamos con la población de referencia y los pasamos a la función <code>phe_isr()</code>, para obtener tasas estandarizadas indirectamente. Por supuesto, también se puede hacer a la inversa.</p>
<p>En nuestro ejemplo, la población de referencia se proporciona como un dataframe separado. En este caso, nos aseguramos de que los vectores <code>x =</code>, <code>n =</code>, <code>x_ref =</code> y <code>n_ref =</code> estén ordenados por los mismos valores de categoría de normalización (estrato) que los de nuestro dataframe específico del país, ya que los registros se emparejarán por posición.</p>
<p>Consulta la ayuda de <code>?phr_isr</code> o los enlaces de la sección Referencias para obtener más información.</p>
<div class="sourceCode" id="cb1101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create reference population</span>
<span class="va">refpopCountryB</span> <span class="op">&lt;-</span> <span class="va">country_data</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Country</span> <span class="op">==</span> <span class="st">"B"</span><span class="op">)</span> 

<span class="co"># Calculate rates for country A indirectly standardized by age and sex</span>
<span class="va">mortality_is_rate_phe_A</span> <span class="op">&lt;-</span> <span class="va">country_data</span> <span class="op">%&gt;%</span>
     <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Country</span> <span class="op">==</span> <span class="st">"A"</span><span class="op">)</span> <span class="op">%&gt;%</span>
     <span class="fu">PHEindicatormethods</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PHEindicatormethods/man/phe_isr.html">phe_isr</a></span><span class="op">(</span>
          x <span class="op">=</span> <span class="va">Deaths</span>,                 <span class="co"># column with observed number of events</span>
          n <span class="op">=</span> <span class="va">Population</span>,             <span class="co"># column with non-standard pops for each stratum</span>
          x_ref <span class="op">=</span> <span class="va">refpopCountryB</span><span class="op">$</span><span class="va">Deaths</span>,  <span class="co"># reference number of deaths for each stratum</span>
          n_ref <span class="op">=</span> <span class="va">refpopCountryB</span><span class="op">$</span><span class="va">Population</span><span class="op">)</span>  <span class="co"># reference population for each stratum</span>

<span class="co"># Print table</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">mortality_is_rate_phe_A</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
observed
</th>
<th style="text-align:right;">
expected
</th>
<th style="text-align:right;">
ref_rate
</th>
<th style="text-align:right;">
value
</th>
<th style="text-align:right;">
lowercl
</th>
<th style="text-align:right;">
uppercl
</th>
<th style="text-align:left;">
confidence
</th>
<th style="text-align:left;">
statistic
</th>
<th style="text-align:left;">
method
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:right;">
11344
</td>
<td style="text-align:right;">
15847.42
</td>
<td style="text-align:right;">
18.81914
</td>
<td style="text-align:right;">
13.47123
</td>
<td style="text-align:right;">
13.22446
</td>
<td style="text-align:right;">
13.72145
</td>
<td style="text-align:left;">
95%
</td>
<td style="text-align:left;">
indirectly standardised rate per 100000
</td>
<td style="text-align:left;">
Byars
</td>
</tr></tbody>
</table></div>
<!-- ======================================================= -->
</div>
</div>
<div id="resources-14" class="section level2" number="20.5">
<h2>
<span class="header-section-number">20.5</span> Recursos<a class="anchor" aria-label="anchor" href="#resources-14"><i class="fas fa-link"></i></a>
</h2>
<p>Si deseas ver otro ejemplo reproducible utilizando <strong>dsr</strong>, consulta <a href="https://mran.microsoft.com/snapshot/2020-02-12/web/packages/dsr/vignettes/dsr.html">esta viñeta</a></p>
<p>Si deseas ver otro ejemplo en el que se utilizan <strong>los métodos de PHEindicator</strong>, visita <a href="https://mran.microsoft.com/snapshot/2018-10-22/web/packages/PHEindicatormethods/vignettes/IntroductiontoPHEindicatormethods.html">este sitio web</a></p>
<p>Ver el archivo pdf de referencia de <a href="https://cran.r-project.org/web/packages/PHEindicatormethods/PHEindicatormethods.pdf"><strong>PHEindicatormethods</strong></a></p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="missing-data.html"><span class="header-section-number">19</span> Borrador. Valores faltantes</a></div>
<div class="next"><a href="moving-averages.html"><span class="header-section-number">21</span> Borrador. Medias Móviles</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#standardised-rates"><span class="header-section-number">20</span> Borrador. Tasas estandarizadas</a></li>
<li><a class="nav-link" href="#overview-1"><span class="header-section-number">20.1</span> Resumen</a></li>
<li>
<a class="nav-link" href="#preparation-12"><span class="header-section-number">20.2</span> Preparación</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#cargar-paquetes-13">Cargar paquetes</a></li>
<li><a class="nav-link" href="#cargar-los-datos-de-poblaci%C3%B3n">Cargar los datos de población</a></li>
<li><a class="nav-link" href="#cargar-datos-de-defunciones">Cargar datos de defunciones</a></li>
<li><a class="nav-link" href="#poblaciones-y-defunciones-limpias">Poblaciones y defunciones limpias</a></li>
<li><a class="nav-link" href="#carga-de-la-poblaci%C3%B3n-de-referencia">Carga de la población de referencia</a></li>
<li><a class="nav-link" href="#poblaci%C3%B3n-de-referencia-limpia">Población de referencia limpia</a></li>
<li><a class="nav-link" href="#standard_all">Crear un conjunto de datos con una población estándar</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#dsr-package"><span class="header-section-number">20.3</span> paquete dsr</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#tasas-estandarizadas">Tasas estandarizadas</a></li>
<li><a class="nav-link" href="#raz%C3%B3n-de-tasas-estandarizadas">Razón de tasas estandarizadas</a></li>
<li><a class="nav-link" href="#diferencia-de-tasas-estandarizadas">Diferencia de tasas estandarizadas</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#standard_phe"><span class="header-section-number">20.4</span> Paquete PHEindicatormethods</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#tasas-estandarizadas-directamente">Tasas estandarizadas directamente</a></li>
<li><a class="nav-link" href="#standard_indirect">Tasas estandarizadas indirectamente</a></li>
</ul>
</li>
<li><a class="nav-link" href="#resources-14"><span class="header-section-number">20.5</span> Recursos</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>El manual de R para Epi’s</strong>" was written by El equipo del manual. It was last built on 2022-10-18.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
